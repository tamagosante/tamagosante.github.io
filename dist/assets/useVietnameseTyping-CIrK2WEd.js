import{r as b}from"./react-vendor-BOZDwKwV.js";const S={a:["a","á","à","ả","ã","ạ","ă","ắ","ằ","ẳ","ẵ","ặ","â","ấ","ầ","ẩ","ẫ","ậ"],A:["A","Á","À","Ả","Ã","Ạ","Ă","Ắ","Ằ","Ẳ","Ẵ","Ặ","Â","Ấ","Ầ","Ẩ","Ẫ","Ậ"],e:["e","é","è","ẻ","ẽ","ẹ","ê","ế","ề","ể","ễ","ệ"],E:["E","É","È","Ẻ","Ẽ","Ẹ","Ê","Ế","Ề","Ể","Ễ","Ệ"],i:["i","í","ì","ỉ","ĩ","ị"],I:["I","Í","Ì","Ỉ","Ĩ","Ị"],o:["o","ó","ò","ỏ","õ","ọ","ô","ố","ồ","ổ","ỗ","ộ","ơ","ớ","ờ","ở","ỡ","ợ"],O:["O","Ó","Ò","Ỏ","Õ","Ọ","Ô","Ố","Ồ","Ổ","Ỗ","Ộ","Ơ","Ớ","Ờ","Ở","Ỡ","Ợ"],u:["u","ú","ù","ủ","ũ","ụ","ư","ứ","ừ","ử","ữ","ự"],U:["U","Ú","Ù","Ủ","Ũ","Ụ","Ư","Ứ","Ừ","Ử","Ữ","Ự"],y:["y","ý","ỳ","ỷ","ỹ","ỵ"],Y:["Y","Ý","Ỳ","Ỷ","Ỹ","Ỵ"],d:["d","đ"],D:["D","Đ"]},te={s:"acute",f:"grave",r:"hook",x:"tilde",j:"dot"},ne={w:"horn",aa:"circumflex",aw:"breve",ee:"circumflex",oo:"circumflex",ow:"horn",uw:"horn",dd:"stroke"},K={a:null,e:null,i:null,o:null,u:null,y:null,d:null,ă:null,â:null,ê:null,ô:null,ơ:null,ư:null,đ:null,á:"s",ắ:"s",ấ:"s",é:"s",ế:"s",í:"s",ó:"s",ố:"s",ớ:"s",ú:"s",ứ:"s",ý:"s",à:"f",ằ:"f",ầ:"f",è:"f",ề:"f",ì:"f",ò:"f",ồ:"f",ờ:"f",ù:"f",ừ:"f",ỳ:"f",ả:"r",ẳ:"r",ẩ:"r",ẻ:"r",ể:"r",ỉ:"r",ỏ:"r",ổ:"r",ở:"r",ủ:"r",ử:"r",ỷ:"r",ã:"x",ẵ:"x",ẫ:"x",ẽ:"x",ễ:"x",ĩ:"x",õ:"x",ỗ:"x",ỡ:"x",ũ:"x",ữ:"x",ỹ:"x",ạ:"j",ặ:"j",ậ:"j",ẹ:"j",ệ:"j",ị:"j",ọ:"j",ộ:"j",ợ:"j",ụ:"j",ự:"j",ỵ:"j"};Object.keys(K).forEach(e=>{const t=e.toUpperCase(),r=K[e];t!==e&&(K[t]=r)});function U(e,t){const r=e.toLowerCase();switch(t){case"breve":return["ă","ắ","ằ","ẳ","ẵ","ặ"].includes(r);case"circumflex":return["â","ấ","ầ","ẩ","ẫ","ậ","ê","ế","ề","ể","ễ","ệ","ô","ố","ồ","ổ","ỗ","ộ"].includes(r);case"horn":return["ơ","ớ","ờ","ở","ỡ","ợ","ư","ứ","ừ","ử","ữ","ự"].includes(r);case"stroke":return["đ"].includes(r);default:return!1}}function W(e){return e in te}function H(e){return e==="w"||e==="a"||e==="e"||e==="o"||e==="u"||e==="d"}function re(e,t,r){const c=e.substring(t,r).toLowerCase(),o=[];for(let n=0;n<c.length;n++){const w=c[n];S[w]!==void 0&&o.push({char:w,pos:t+n})}if(o.length===0)return-1;if(o.length===1)return o[0].pos;const s=o.map(n=>n.char).join("");return o.length===2?["ao","ay","au","eo","ey","ia","ie","ua","ui","uy","ưa","ya"].includes(s)||["oa","oe","oi","oy","uo","ươ"].includes(s)?o[0].pos:o[1].pos:o.length>=3?o[1].pos:o[o.length-1].pos}function x(e){return e?/[\s.,;:!?()[\]{}'"<>\/\\-]/.test(e):!0}function z(e,t){return e==="a"&&t.includes("a")&&t.includes("w")||e==="a"&&t==="w"?"aw":e==="o"&&t.includes("w")?"ow":e==="u"&&t.includes("w")?"uw":e==="a"&&t.includes("a")?"aa":e==="e"&&t.includes("e")?"ee":e==="o"&&t.includes("o")?"oo":e==="d"&&t.includes("d")?"dd":t.includes("w")?"w":null}function se(e){const t=ne[e];return t==="breve"?"breve":t.includes("circumflex")?"circumflex":t.includes("horn")?"horn":t==="stroke"?"stroke":null}function B(e,t){const r=S[e]||[];if(!t||t===e)return r;const c=t.slice(e.length).toLowerCase();let o=null;c.includes("s")?o="s":c.includes("j")?o="j":c.includes("r")?o="r":c.includes("x")?o="x":c.includes("f")&&(o="f");const s=z(e,c),n=s?se(s):null;return r.filter(w=>!(o!==null&&K[w]!==o||n&&!U(w,n)))}function Q(e){const t=e.toLowerCase();for(const r in S)if(S[r].includes(t))return!0;return!1}function X(e){const t=e.toLowerCase();for(const r in S)if(S[r].includes(t))return r;return e}function G(e,t){let r=-1,c="";const o=e.charAt(t-1).toLowerCase();if(W(o))for(let s=t-2;s>=Math.max(0,t-6);s--){const n=e.charAt(s);if(x(n))break;if(Q(n))return{sequenceStart:s,detectedBaseChar:X(n),found:!0};if(S[n.toLowerCase()])break}if(H(o)){if(o==="w")for(let s=t-2;s>=Math.max(0,t-6);s--){const n=e.charAt(s).toLowerCase();if(x(n))break;if(n==="o"&&s>0&&e.charAt(s-1).toLowerCase()==="u")return{sequenceStart:s-1,detectedBaseChar:"u",found:!0}}for(let s=t-2;s>=Math.max(0,t-6);s--){const n=e.charAt(s).toLowerCase();if(x(n))break;if(n===o&&S[n])return{sequenceStart:s,detectedBaseChar:n,found:!0}}}for(let s=t-2;s>=Math.max(0,t-6);s--){const n=e.charAt(s).toLowerCase();if(S[n]){if(r=s,c=n,s>0){const d=e.charAt(s-1).toLowerCase();d===n&&S[d]&&(r=s-1,c=d)}const w=e.slice(r+1,t-1).toLowerCase();for(const d of w)if(!W(d)&&!H(d)&&d!==c)return{sequenceStart:-1,detectedBaseChar:"",found:!1};break}}return{sequenceStart:r,detectedBaseChar:c,found:r>=0}}function oe(e){const t=e.slice(0,-1);return/\s/.test(t)}function J(e,t,r,c,o){const s=e.slice(r,t).toLowerCase(),n=e.charAt(t-1).toLowerCase();if(t>=2&&e.charAt(t-2),W(n)){let a=0;for(let f=t-2;f>=0;f--)if(x(e.charAt(f))){a=f+1;break}e.substring(a,t-1);const l=re(e,a,t-1);if(l>=0){const f=e.charAt(l),y=f.toLowerCase();if(S[y]){const p=y+n,T=B(y,p);if(T.length>0){const m=T[0],L=f===f.toUpperCase()?m.toUpperCase():m,A=e.substring(0,l),M=e.substring(l+1,t-1),q=e.substring(t);return{type:"auto-complete",replacement:A+L+M+q,newCursorPos:t-1,realTimeReplacement:!0}}}}for(let f=t-2;f>=Math.max(0,t-6);f--){const y=e.charAt(f);if(x(y))break;if(Q(y)){const p=X(y);let T="";const m=y.toLowerCase();U(m,"breve")||U(m,"circumflex")?T=p:U(m,"horn")&&(T="w");const L=p+T+n,A=B(p,L);if(A.length>0){const M=A[0],q=e.substring(0,f),F=e.substring(f+1,t-1),D=e.substring(t);return{type:"auto-complete",replacement:q+M+F+D,newCursorPos:t-1,realTimeReplacement:!0}}}if(S[y.toLowerCase()])break}}if(H(n)){if(n==="w"){if(e.substring(0,t),c==="u"){const l=e.substring(r,t).toLowerCase();if(l.startsWith("uo")){const f=l.substring(2,l.length-1),y=e.substring(0,r),p=e.substring(t);return{type:"auto-complete",replacement:y+"ươ"+f+p,newCursorPos:r+2+f.length,realTimeReplacement:!0}}}const a=s.toLowerCase();if(a==="uow"||a.endsWith("uow")){const l=e.substring(0,r),f=e.substring(t);return{type:"auto-complete",replacement:l+"ươ"+f,newCursorPos:r+2,realTimeReplacement:!0}}}for(let a=t-2;a>=Math.max(0,t-6);a--){const l=e.charAt(a).toLowerCase();if(x(l))break;if(l===n&&S[l]){const f=n+n;if(z(l,f)){const p=B(l,f);if(p.length>0){const T=p[0],m=e.substring(0,a),L=e.substring(a+1,t-1),A=e.substring(t);return{type:"auto-complete",replacement:m+T+L+A,newCursorPos:t-1,realTimeReplacement:!0}}}break}}}if(oe(s))return{type:"terminate"};const w=W(n)||H(n);let d=!1;if(w)if(W(n))d=!0;else{const a=s.slice(c.length).toLowerCase();z(c,a)===null?(t>=2&&e.charAt(t-2).toLowerCase(),r<t-1&&e.charAt(r).toLowerCase()===n&&(d=!0)):d=!0}if(d){const a=B(c,s);if(a.length>0){const l=a[0],f=e.substring(0,r),y=e.substring(t);return{type:"auto-complete",replacement:f+l+y,newCursorPos:r+1,realTimeReplacement:!0}}return{type:"terminate"}}else return ce(e,t,r,c,s)}function ce(e,t,r,c,o){const n=(r>0?e.charAt(r-1).toLowerCase():"")+o;if(n==="uown"||n==="uow"){const d=e.substring(0,r-1),a=e.substring(t),l=e.charAt(t-1);return{type:"auto-complete",replacement:d+"ươ"+l+a,newCursorPos:r-1+2+1}}const w=B(c,o.slice(0,-1));if(w.length>0){const d=w[0],a=e.substring(0,r),l=e.substring(t),f=e.charAt(t-1);return{type:"auto-complete",replacement:a+d+f+l,newCursorPos:r+1+1}}return{type:"terminate"}}function ae(e){return e!==""&&S[e]!==void 0}function O(e,t,r,c){const o=r-1;switch(t){case"right":{const n=Math.floor(e/c)*c,w=Math.min(n+c-1,o);return e===w?n:e+1}case"left":{const n=Math.floor(e/c)*c,w=Math.min(n+c-1,o);return e===n?w:e-1}case"down":{const s=e%c,n=Math.floor(e/c),w=Math.ceil((o+1)/c),d=n+1;if(d>=w){const a=s;return a<=o?a:e}else{const a=d*c+s;return a<=o?a:e}}case"up":{const s=e%c,n=Math.floor(e/c);if(n===0){const a=(Math.ceil((o+1)/c)-1)*c+s;return a<=o?a:e}else return(n-1)*c+s}default:return e}}function fe(e={}){const{maxRows:t=3,maxColumnsPerRow:r=7,enabled:c=!0}=e,[o,s]=b.useState(!1),[n,w]=b.useState([]),[d,a]=b.useState(0),[l,f]=b.useState(0),[y,p]=b.useState(""),[T,m]=b.useState(""),[L,A]=b.useState([]),[M,q]=b.useState(0),F=b.useRef(0),D=b.useRef(!1),E=b.useRef(null),j=b.useCallback(()=>{A([]),q(0)},[]),I=b.useCallback(u=>{let i="";for(const v of u){i+=v;const h=i.length,g=G(i,h);if(g.found){const C=J(i,h,g.sequenceStart,g.detectedBaseChar);C.type==="auto-complete"&&C.replacement&&(i=C.replacement)}}return i},[t,r]),R=b.useCallback(()=>{s(!1),w([]),a(0),p(""),m("")},[]),_=b.useCallback(u=>{if(!E.current)return;const i=E.current;if(R(),i.focus(),i.setSelectionRange(l,l+1),!document.execCommand("insertText",!1,u)){const g=i.value,C=g.substring(0,l)+u+g.substring(l+1);i.value=C;const k=new Event("input",{bubbles:!0});i.dispatchEvent(k)}const h=l+1;i.setSelectionRange(h,h),requestAnimationFrame(()=>{E.current&&E.current.focus()})},[l,R]),Z=b.useCallback(u=>{if(!c)return;const i=u.currentTarget,v=i.selectionStart||0,h=i.value.charAt(v-1).toLowerCase();if(D.current)D.current=!1;else{const C=v>=2?i.value.charAt(v-2):"";(/[\s.,;:!?()[\]{}'"<>/\\-]/.test(C)||C==="")&&h&&!/[\s.,;:!?()[\]{}'"<>/\\-]/.test(h)?(q(v-1),A([h])):h&&!/[\s.,;:!?()[\]{}'"<>/\\-]/.test(h)?A(N=>[...N,h]):j()}const g=G(i.value,v);if(g.found&&g.sequenceStart<v-1){const C=i.value.slice(g.sequenceStart,v).toLowerCase(),k=J(i.value,v,g.sequenceStart,g.detectedBaseChar);switch(k.type){case"terminate":s(!1),p(""),m("");return;case"auto-complete":i.value=k.replacement,i.setSelectionRange(k.newCursorPos,k.newCursorPos),s(!1),p(""),m("");return;case"show-popover":p(C),m(g.detectedBaseChar),f(g.sequenceStart),w(k.diacritics),a(0),s(!0);return}return}if(ae(h)){const C=S[h],k=t*r;w(C.slice(0,k)),f(v-1),p(h),m(h),a(0),s(!0)}else s(!1),p(""),m("")},[c,t,r,j]),$=b.useCallback(u=>{if(!c)return;const i=u.currentTarget,v=i.selectionStart||0;if(u.key==="Backspace"&&L.length>0){const h=i.value.substring(M).split(/[\s.,;:!?()[\]{}'"<>/\\-]/)[0].length,g=M+h;if(v>M&&v<=g){u.preventDefault(),u.stopPropagation();const C=L.slice(0,-1);A(C);const k=I(C),N=i.value.substring(0,M),P=i.value.substring(g),V=N+k+P;if(D.current=!0,i.setSelectionRange(M,g),!document.execCommand("insertText",!1,k)){i.value=V;const ee=new Event("input",{bubbles:!0});i.dispatchEvent(ee)}const Y=M+k.length;i.setSelectionRange(Y,Y),F.current=Y,C.length===0&&j();return}}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(u.key)&&j(),!!o)switch(u.key){case"ArrowRight":u.preventDefault(),u.stopPropagation(),a(h=>O(h,"right",n.length,r));break;case"ArrowLeft":u.preventDefault(),u.stopPropagation(),a(h=>O(h,"left",n.length,r));break;case"ArrowDown":u.preventDefault(),u.stopPropagation(),a(h=>O(h,"down",n.length,r));break;case"ArrowUp":u.preventDefault(),u.stopPropagation(),a(h=>O(h,"up",n.length,r));break;case"Enter":case"Tab":u.preventDefault(),u.stopPropagation(),_(n[d]);break;case"Escape":u.preventDefault(),u.stopPropagation(),R();break;default:u.key.length===1&&R();break}},[o,c,n,d,r,_,R,L,M,I,j]);return b.useEffect(()=>{if(!o)return;const u=i=>{E.current&&!E.current.contains(i.target)&&R()};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[o,R]),{showPopover:o,diacritics:n,selectedIndex:d,handleKeyDown:$,handleInput:Z,selectDiacritic:_,closePopover:R,inputRef:E}}export{fe as u};
