var V=Object.defineProperty;var M=(c,s,t)=>s in c?V(c,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[s]=t;var v=(c,s,t)=>M(c,typeof s!="symbol"?s+"":s,t);import{f as G,u as K,r as f,j as e}from"./react-vendor-BOZDwKwV.js";import{az as o,aA as q,aB as W,B as b,I as u,C as S,r as A,s as T,u as C}from"./index-Cmkaodfg.js";import{g as X}from"./format-utils-Ba8uG3XU.js";import{aA as I,aa as D,D as L,V as O,J as Y,X as Z}from"./icons-Cf9puwNc.js";import"./utils-CGefl9Xh.js";import"./radix-ui-DhHtVSYQ.js";import"./ui-utils-BxIQ3qGg.js";class Q{constructor(){v(this,"baseUrl");v(this,"serviceName","ContentApiService");this.baseUrl="http://localhost:3030",o.info(`Initialized with baseUrl: ${this.baseUrl}`,this.serviceName)}async getVersion(){if(!this.baseUrl)return o.info("No API base URL configured, skipping version fetch",this.serviceName),{version:"dev-mode",message:"API disabled for local development"};o.info(`Fetching version from: ${this.baseUrl}/version`,this.serviceName);try{const s=await fetch(`${this.baseUrl}/version`);if(o.info(`Version response status: ${s.status}`,this.serviceName),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();return o.info(`Version data received: ${JSON.stringify(t)}`,this.serviceName),t}catch(s){throw o.error(`Failed to fetch version: ${s}`,this.serviceName),s}}async getContent(s,t){if(!this.baseUrl){o.info("No API base URL configured, using localStorage fallback",this.serviceName);const n=localStorage.getItem("content_items");return n?JSON.parse(n):[]}const r=new URLSearchParams;s!==void 0&&r.append("limit",s.toString()),t!==void 0&&r.append("offset",t.toString());const a=r.toString()?`?${r.toString()}`:"";o.info(`Fetching content from: ${this.baseUrl}/api/content${a}`,this.serviceName);try{const n=await fetch(`${this.baseUrl}/api/content${a}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return(await n.json()).data}catch(n){o.error(`Failed to fetch content: ${n}`,this.serviceName);const l=localStorage.getItem("content_items");return l?JSON.parse(l):[]}}async createContent(s){if(!this.baseUrl){o.info("No API base URL configured, using localStorage fallback",this.serviceName);const t={id:X(),text:s,createdAt:new Date,updatedAt:new Date},r=localStorage.getItem("content_items"),a=r?JSON.parse(r):[];return a.unshift(t),localStorage.setItem("content_items",JSON.stringify(a)),t}o.info(`Creating content at: ${this.baseUrl}/api/content`,this.serviceName);try{const t=await fetch(`${this.baseUrl}/api/content`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw o.error(`Failed to create content: ${t}`,this.serviceName),t}}async updateContent(s,t){if(!this.baseUrl){o.info("No API base URL configured, using localStorage fallback",this.serviceName);const r=localStorage.getItem("content_items"),a=r?JSON.parse(r):[],n=a.findIndex(l=>l.id===s);if(n===-1)throw new Error("Content item not found");return a[n]={...a[n],text:t,updatedAt:new Date},localStorage.setItem("content_items",JSON.stringify(a)),a[n]}o.info(`Updating content at: ${this.baseUrl}/api/content/${s}`,this.serviceName);try{const r=await fetch(`${this.baseUrl}/api/content/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw o.error(`Failed to update content: ${r}`,this.serviceName),r}}async deleteContent(s){if(!this.baseUrl){o.info("No API base URL configured, using localStorage fallback",this.serviceName);const t=localStorage.getItem("content_items"),a=(t?JSON.parse(t):[]).filter(n=>n.id!==s);localStorage.setItem("content_items",JSON.stringify(a));return}o.info(`Deleting content at: ${this.baseUrl}/api/content/${s}`,this.serviceName);try{const t=await fetch(`${this.baseUrl}/api/content/${s}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`)}catch(t){throw o.error(`Failed to delete content: ${t}`,this.serviceName),t}}}const ee=new Q;class te{constructor(){v(this,"baseUrl");v(this,"serviceName","TranscribeApiService");this.baseUrl="http://localhost:3030",o.info(`Initialized with baseUrl: ${this.baseUrl}`,this.serviceName)}async transcribe(s){if(!this.baseUrl)throw o.error("No API base URL configured for transcription",this.serviceName),new Error("API base URL not configured");o.info(`Transcribing audio at: ${this.baseUrl}/api/transcriptions`,this.serviceName);try{const t=await fetch(`${this.baseUrl}/api/transcriptions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const n=await t.json();switch(o.error(`Transcription failed with status ${t.status}: ${n.error}`,this.serviceName),t.status){case 400:throw new Error(n.message||"Bad request");case 413:throw new Error(n.message||"File too large");case 500:throw new Error(n.message||"Internal server error");default:throw new Error(`HTTP error! status: ${t.status}`)}}const r=await t.json(),a=typeof r.data=="string"?r.data:r.data.transcription;return o.info(`Transcription successful, received ${a.length} characters`,this.serviceName),r}catch(t){throw o.error(`Failed to transcribe audio: ${t}`,this.serviceName),t}}async getAllTranscriptions(){if(!this.baseUrl)throw o.error("No API base URL configured for getting transcriptions",this.serviceName),new Error("API base URL not configured");o.info(`Getting all transcriptions from: ${this.baseUrl}/api/transcriptions`,this.serviceName);try{const s=await fetch(`${this.baseUrl}/api/transcriptions`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok){const r=await s.json();switch(o.error(`Get transcriptions failed with status ${s.status}: ${r.error}`,this.serviceName),s.status){case 500:throw new Error(r.message??"Internal server error");default:throw new Error(`HTTP error! status: ${s.status}`)}}const t=await s.json();return o.info(`Retrieved ${t.data.length} transcriptions successfully`,this.serviceName),t}catch(s){throw o.error(`Failed to get transcriptions: ${s}`,this.serviceName),s}}}const se=new te;function re(c){let s="";for(let r=0;r<c.length;r+=8192){const a=c.subarray(r,r+8192);s+=String.fromCharCode.apply(null,Array.from(a))}return btoa(s)}function ne(c){const s=atob(c),t=new Uint8Array(s.length),r=8192;for(let a=0;a<s.length;a+=r){const n=Math.min(r,s.length-a);for(let l=0;l<n;l++)t[a+l]=s.charCodeAt(a+l)}return t}async function ae(c){const s=await c.arrayBuffer(),t=new Uint8Array(s);return re(t)}function ie(c,s="application/octet-stream"){const t=ne(c);return new Blob([t],{type:s})}class oe{constructor(){v(this,"baseUrl");v(this,"serviceName","SilenceApiService");this.baseUrl="http://localhost:3030",o.info(`Initialized with baseUrl: ${this.baseUrl}`,this.serviceName)}async removeSilence(s){var t;if(!this.baseUrl)throw o.error("No API base URL configured for silence removal",this.serviceName),new Error("API base URL not configured");o.info(`Removing silence from audio at: ${this.baseUrl}/api/audio/remove-silence`,this.serviceName);try{const r=await ae(s.audioFile);o.info(`Converted ${(s.audioFile.size/1024).toFixed(2)} KB audio to base64`,this.serviceName);const a={audio:r,silenceThreshold:s.silenceThreshold??-50,silenceDuration:s.minSilenceDuration??.5},n=await fetch(`${this.baseUrl}/api/audio/remove-silence`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){let m;try{m=await n.json()}catch{m={error:"Unknown error",message:`HTTP error! status: ${n.status}`}}switch(o.error(`Silence removal failed with status ${n.status}: ${m.error}`,this.serviceName),n.status){case 400:throw new Error(m.message??"Bad request - invalid file format or parameters");case 413:throw new Error(m.message??"File too large");case 415:throw new Error(m.message??"Unsupported media type - only WAV files are supported");case 422:throw new Error(m.message??"Processing error - could not process the audio file");case 500:throw new Error(m.message??"Internal server error");default:throw new Error(`HTTP error! status: ${n.status}`)}}const l=await n.json();if(!l.success||!((t=l.data)!=null&&t.audio))throw new Error("Invalid response format from server");const p=l.data.audio,g=ie(p,"audio/wav"),x={originalDuration:l.data.originalDuration,processedDuration:l.data.processedDuration,silenceRemoved:l.data.timeSaved,segmentsRemoved:l.data.silentSegments};return o.info(`Silence removal successful, processed ${(g.size/1024).toFixed(2)} KB audio`,this.serviceName),{success:!0,processedAudioBlob:g,stats:x}}catch(r){const a=r instanceof Error?r.message:String(r);throw o.error(`Failed to remove silence: ${a}`,this.serviceName),r}}}const ce=new oe;class le{constructor(){v(this,"serviceName","BackendApiService");o.info("Initialized backend API service",this.serviceName)}get content(){return ee}get transcribe(){return se}get silence(){return ce}async getVersion(){return this.content.getVersion()}}const $=new le;function z({content:c,handleSelectContent:s,selectedContent:t,formatDate:r}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-header p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Content Library"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.length," items"]})]}),e.jsx("div",{className:"content-sidebar-list flex-1 overflow-y-auto",children:c.length===0?e.jsx("div",{className:"empty-sidebar p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No content yet. Create your first item in the main area!"})}):e.jsx("div",{className:"content-items",children:c.map(a=>e.jsx("div",{onClick:()=>s(a),className:`content-list-item p-4 border-b cursor-pointer hover:bg-muted/50 transition-colors ${(t==null?void 0:t.id)===a.id?"bg-muted border-l-4 border-l-primary":""}`,children:e.jsxs("div",{className:"content-preview",children:[e.jsx("p",{className:"text-sm font-medium line-clamp-2 mb-1",children:a.text.length>60?`${a.text.substring(0,60)}...`:a.text}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r(a.createdAt)})]})},a.id))})})]})}function ve({logger:c}){const{contentId:s}=G(),t=K(),[r,a]=f.useState([]),[n,l]=f.useState(null),[p,g]=f.useState(""),[x,m]=f.useState(null),[U,j]=f.useState(""),[N,E]=f.useState(!1),[B,w]=f.useState(!1),k=f.useCallback(async()=>{try{c.info("Loading content items","Content");const i=await $.content.getContent();if(console.log(">>>> _ >>>> ~ Content.tsx:109 ~ loadContent:",i),a(i),s){const d=i.find(h=>h.id===s);d?l(d):t("/content")}else i.length>0&&!n&&(l(i[0]),t(`/content/${i[0].id}`))}catch(i){c.error(`Failed to load content: ${String(i)}`,"Content")}},[s,n,t,c]);f.useEffect(()=>{k()},[k]),f.useEffect(()=>{if(s&&r.length>0){const i=r.find(d=>d.id===s);i&&l(i)}},[s,r]);const P=async i=>{if(i.preventDefault(),!!p.trim()){E(!0);try{c.info(`Creating new content: ${p}`,"Content");const d=await $.content.createContent(p.trim());a(h=>[d,...h]),g(""),l(d),t(`/content/${d.id}`),c.info("Content created successfully","Content")}catch(d){c.error(`Failed to create content: ${String(d)}`,"Content")}finally{E(!1)}}},F=i=>{l(i),t(`/content/${i.id}`),w(!1)},R=i=>{m(i.id),j(i.text)},J=async()=>{if(!(!x||!U.trim()))try{c.info(`Updating content: ${x}`,"Content");const i=await $.content.updateContent(x,U.trim());a(d=>d.map(h=>h.id===x?i:h)),(n==null?void 0:n.id)===x&&l(i),m(null),j(""),c.info("Content updated successfully","Content")}catch(i){c.error(`Failed to update content: ${String(i)}`,"Content")}},H=()=>{m(null),j("")},_=async i=>{if(confirm("Are you sure you want to delete this content?"))try{c.info(`Deleting content: ${i}`,"Content"),await $.content.deleteContent(i);const d=r.filter(h=>h.id!==i);if(a(d),(n==null?void 0:n.id)===i)if(d.length>0){const h=d[0];l(h),t(`/content/${h.id}`)}else l(null),t("/content");c.info("Content deleted successfully","Content")}catch(d){c.error(`Failed to delete content: ${String(d)}`,"Content")}},y=i=>(typeof i=="string"?new Date(i):i).toLocaleString();return e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"sidebar-content hidden md:flex w-80 border-r bg-muted/20 flex-col",children:e.jsx(z,{content:r,handleSelectContent:F,selectedContent:n,formatDate:y})}),e.jsx(q,{open:B,onOpenChange:w,children:e.jsx(W,{side:"left",className:"w-80 p-0 flex flex-col",children:e.jsx(z,{content:r,handleSelectContent:F,selectedContent:n,formatDate:y})})}),e.jsx("div",{className:"main-content flex-1 flex flex-col",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"content-header p-4 md:p-6 border-b",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{className:"content-info flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 md:hidden",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>w(!0),className:"mobile-menu-button",children:e.jsx(I,{className:u.sm})}),e.jsx("span",{className:"text-sm font-medium",children:"Content Library"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Created: ",y(n.createdAt),n.updatedAt!==n.createdAt&&e.jsxs(e.Fragment,{children:[" â€¢ Updated: ",y(n.updatedAt)]})]})]}),e.jsxs("div",{className:"content-actions flex gap-2",children:[e.jsxs(b,{onClick:()=>R(n),variant:"outline",size:"sm",className:"button-edit",children:[e.jsx(D,{className:`${u.sm} mr-2 hidden sm:inline`}),e.jsx(D,{className:`${u.sm} sm:hidden`}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),e.jsxs(b,{onClick:()=>_(n.id),variant:"destructive",size:"sm",className:"button-delete",children:[e.jsx(L,{className:`${u.sm} mr-2 hidden sm:inline`}),e.jsx(L,{className:`${u.sm} sm:hidden`}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(T,{children:"Add New Content"})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("textarea",{value:p,onChange:i=>g(i.target.value),placeholder:"Enter your content here...",className:"w-full min-h-[150px] p-3 border rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary",disabled:N}),e.jsxs(b,{type:"submit",disabled:!p.trim()||N,className:"button-create",children:[e.jsx(O,{className:`${u.sm} mr-2`}),N?"Creating...":"Create Content"]})]})})]})]}),e.jsx("div",{className:"content-display-area flex-1 p-4 md:p-6",children:x===n.id?e.jsxs(S,{className:"edit-card",children:[e.jsx(A,{children:e.jsx(T,{children:"Edit Content"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx("textarea",{value:U,onChange:i=>j(i.target.value),className:"w-full min-h-[300px] p-3 border rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter your content here..."}),e.jsxs("div",{className:"edit-actions flex gap-2",children:[e.jsxs(b,{onClick:J,className:"button-save",children:[e.jsx(Y,{className:`${u.sm} mr-2`}),"Save Changes"]}),e.jsxs(b,{onClick:H,variant:"outline",className:"button-cancel",children:[e.jsx(Z,{className:`${u.sm} mr-2`}),"Cancel"]})]})]})]}):e.jsx(S,{className:"display-card",children:e.jsx(C,{className:"p-6",children:e.jsx("div",{className:"content-text prose max-w-none",children:e.jsx("p",{className:"text-content whitespace-pre-wrap",children:n.text})})})})})]}):e.jsxs("div",{className:"empty-main flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b md:hidden",children:e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>w(!0),className:"mobile-menu-button",children:[e.jsx(I,{className:`${u.sm} mr-2`}),"Content Library"]})}),e.jsx("div",{className:"p-4 md:p-6 border-b",children:e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(T,{children:"Add New Content"})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("textarea",{value:p,onChange:i=>g(i.target.value),placeholder:"Enter your content here...",className:"w-full min-h-[200px] p-3 border rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary",disabled:N}),e.jsxs(b,{type:"submit",disabled:!p.trim()||N,className:"button-create",children:[e.jsx(O,{className:`${u.sm} mr-2`}),N?"Creating...":"Create Content"]})]})})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"empty-state text-center p-6",children:[e.jsx("p",{className:"text-lg text-muted-foreground mb-2",children:"Create your first content item above"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Your content will appear in the sidebar and you can select items to view them here"}),e.jsxs(b,{onClick:()=>w(!0),variant:"outline",className:"md:hidden",children:[e.jsx(I,{className:`${u.sm} mr-2`}),"Open Content Library"]})]})})]})})]})}export{ve as Content};
