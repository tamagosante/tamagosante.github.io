var q=Object.defineProperty;var _=(d,e,n)=>e in d?q(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var c=(d,e,n)=>_(d,typeof e!="symbol"?e+"":e,n);import{r as l,j as t}from"./react-vendor-CrhW4DYn.js";import{aF as P,aE as K,b4 as B,au as w,B as j,b3 as O}from"./index-CgyRe94A.js";import{D as $}from"./DraggableCrudTree-7toDmunK.js";import{t as y}from"./utils-DPdF7W5J.js";import{D as z,$ as J,_ as H,S as W,F as R,aX as G,aY as V,X}from"./icons-6Gjq1X59.js";import"./radix-ui-BcQf1l4u.js";import"./ui-utils-BxIQ3qGg.js";import"./DragDropManager-BCQ9eUTy.js";import"./DropIndicator-BK5HbmlC.js";class U{constructor(){c(this,"nodes",[]);c(this,"hierarchyMode","sibling");c(this,"lastCapturedId",null);c(this,"currentParentId",null);c(this,"isActive",!1);c(this,"listeners",new Set)}onChange(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getState(){return{nodes:[...this.nodes],hierarchyMode:this.hierarchyMode,lastCapturedId:this.lastCapturedId,currentParentId:this.currentParentId,isActive:this.isActive}}notifyListeners(){const e=this.getState();this.listeners.forEach(n=>n(e))}activate(){this.isActive=!0,this.notifyListeners()}deactivate(){this.isActive=!1,this.notifyListeners()}setHierarchyMode(e){e==="sibling"&&this.goUpOneLevel(),this.hierarchyMode=e,this.notifyListeners()}goUpOneLevel(){if(this.currentParentId===null)return;const e=this.nodes.find(n=>n.id===this.currentParentId);e&&(this.currentParentId=e.parentId)}getNextOrder(e){const n=this.nodes.filter(s=>s.parentId===e);return n.length>0?Math.max(...n.map(s=>s.order))+1:0}captureNode(e,n){const s=this.hierarchyMode==="child"?this.lastCapturedId:this.currentParentId,r={id:P(10),text:e.trim(),content:n==null?void 0:n.trim(),parentId:s,order:this.getNextOrder(s)};return this.nodes.push(r),this.lastCapturedId=r.id,this.currentParentId=s,this.hierarchyMode="sibling",this.notifyListeners(),r}removeNode(e){const n=new Set,s=r=>{n.add(r),this.nodes.filter(a=>a.parentId===r).forEach(a=>s(a.id))};s(e),this.nodes=this.nodes.filter(r=>!n.has(r.id)),n.has(this.lastCapturedId??"")&&(this.lastCapturedId=this.nodes.length>0?this.nodes[this.nodes.length-1].id:null),n.has(this.currentParentId??"")&&(this.currentParentId=null),this.notifyListeners()}updateNode(e,n){const s=this.nodes.find(r=>r.id===e);s&&(s.text=n.trim(),this.notifyListeners())}findNodeByText(e){return this.nodes.find(n=>n.text===e)}getNodes(){return[...this.nodes]}getDepth(e){let n=0,s=this.nodes.find(r=>r.id===e);for(;s!=null&&s.parentId;)n++,s=this.nodes.find(r=>r.id===(s==null?void 0:s.parentId));return n}generateCanvasJson(){const e=this.nodes.map((s,r)=>({id:s.id,type:K.TEXT,x:100+this.getDepth(s.id)*B.contentCapture.depthOffset,y:100+r*150,width:200,height:80,title:s.content?s.text:void 0,content:s.content||s.text})),n=this.nodes.filter(s=>s.parentId).map(s=>({id:P(10),startNodeId:s.parentId,endNodeId:s.id,startPoint:{x:0,y:0},endPoint:{x:0,y:0}}));return{nodes:e,arrows:n}}toTreeNodes(){const e=n=>this.nodes.filter(s=>s.parentId===n).sort((s,r)=>s.order-r.order).map(s=>({id:s.id,label:s.text.slice(0,50)+(s.text.length>50?"...":""),children:e(s.id),data:s}));return e(null)}updateFromTree(e){const n=(s,r)=>{s.forEach((a,h)=>{const g=this.nodes.find(b=>b.id===a.id);g&&(g.parentId=r,g.order=h),a.children&&n(a.children,a.id)})};n(e,null),this.notifyListeners()}clear(){this.nodes=[],this.hierarchyMode="sibling",this.lastCapturedId=null,this.currentParentId=null,this.notifyListeners()}importNode(e){this.nodes.push(e),this.lastCapturedId=e.id}importNodes(e){this.clear(),e.forEach(n=>{this.nodes.push(n)}),e.length>0&&(this.lastCapturedId=e[e.length-1].id),this.notifyListeners()}}const Y={childKey:"c",siblingKey:"m",finishKey:"Escape"};class Z{constructor(e={}){c(this,"config");c(this,"isEnabled",!1);c(this,"listeners",new Set);c(this,"boundHandler");this.config={...Y,...e},this.boundHandler=this.handleKeyDown.bind(this)}onAction(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}parseKey(e){return e.toLowerCase()===this.config.childKey.toLowerCase()?{type:"SET_MODE",mode:"child"}:e.toLowerCase()===this.config.siblingKey.toLowerCase()?{type:"SET_MODE",mode:"sibling"}:e===this.config.finishKey?{type:"FINISH"}:{type:"NONE"}}handleKeyDown(e){if(!this.isEnabled)return;const n=this.parseKey(e.key);n.type!=="NONE"&&(e.preventDefault(),e.stopPropagation(),this.notifyListeners(n))}notifyListeners(e){this.listeners.forEach(n=>n(e))}enable(){this.isEnabled||(this.isEnabled=!0,document.addEventListener("keydown",this.boundHandler,!0))}disable(){this.isEnabled&&(this.isEnabled=!1,document.removeEventListener("keydown",this.boundHandler,!0))}getIsEnabled(){return this.isEnabled}getConfig(){return{...this.config}}destroy(){this.disable(),this.listeners.clear()}}class Q{constructor(e){this.adapter=e}extract(e){const n=[];return this.processElement(e,n),n}processElement(e,n){const s=this.adapter.getTagName(e);if(this.isHeading(s)){n.push({type:"heading",level:this.getHeadingLevel(s),text:this.adapter.getAllText(e).trim()});return}if(s==="p"){const r=this.adapter.getAllText(e).trim();r&&n.push({type:"paragraph",text:r});return}if(s==="ul"||s==="ol"){const r={type:"list",listType:s==="ol"?"ordered":"unordered",children:[]};for(const a of this.adapter.getChildren(e))this.adapter.getTagName(a)==="li"&&r.children.push({type:"list-item",text:this.adapter.getAllText(a).trim()});r.children.length>0&&n.push(r);return}if(s==="li"){n.push({type:"list-item",text:this.adapter.getAllText(e).trim()});return}if(s==="blockquote"){n.push({type:"blockquote",text:this.adapter.getAllText(e).trim()});return}if(s==="strong"||s==="b"){n.push({type:"strong",text:this.adapter.getAllText(e).trim()});return}if(s==="em"||s==="i"){n.push({type:"emphasis",text:this.adapter.getAllText(e).trim()});return}if(this.adapter.hasChildren(e))for(const r of this.adapter.getChildren(e))this.processElement(r,n);else{const r=this.adapter.getDirectText(e).trim();r&&n.push({type:"text",text:r})}}isHeading(e){return/^h[1-6]$/.test(e)}getHeadingLevel(e){return parseInt(e.charAt(1),10)}}function ee(d){var n;const e=[];for(const s of d)switch(s.type){case"heading":e.push("#".repeat(s.level||1)+" "+s.text);break;case"paragraph":e.push(s.text||""),e.push("");break;case"text":e.push(s.text||"");break;case"list":for(let r=0;r<(((n=s.children)==null?void 0:n.length)||0);r++){const a=s.children[r],h=s.listType==="ordered"?`${r+1}.`:"-";e.push(`${h} ${a.text}`)}e.push("");break;case"list-item":e.push("- "+s.text);break;case"blockquote":e.push("> "+s.text);break;case"strong":e.length>0&&!e[e.length-1].match(/^(#|>|-|\d+\.|\s*$)/)?e[e.length-1]+=" **"+s.text+"**":e.push("**"+s.text+"**");break;case"emphasis":e.length>0&&!e[e.length-1].match(/^(#|>|-|\d+\.|\s*$)/)?e[e.length-1]+=" *"+s.text+"*":e.push("*"+s.text+"*");break}return e.join(`
`).trim()}class te{getChildren(e){return Array.from(e.children)}getTagName(e){return e.tagName.toLowerCase()}getDirectText(e){let n="";for(const s of e.childNodes)s.nodeType===Node.TEXT_NODE&&(n+=s.textContent||"");return n}getAllText(e){return e.innerText||e.textContent||""}hasChildren(e){return e.children.length>0}}class A{static getExtensionURL(e){var n,s;return typeof chrome<"u"&&((n=chrome.runtime)!=null&&n.getURL)?chrome.runtime.getURL(e):typeof browser<"u"&&((s=browser.runtime)!=null&&s.getURL)?browser.runtime.getURL(e):null}static async getConfigForDomain(e){const n=this.normalizeDomain(e);if(this.cache.has(n))return this.cache.get(n)??null;try{let s=this.getExtensionURL(`site-configs/${n}.json`);s||(s=`/site-configs/${n}.json`);const r=await fetch(s);if(!r.ok)return this.cache.set(n,null),null;const a=await r.json();return this.cache.set(n,a),a}catch{return this.cache.set(n,null),null}}static clearCache(){this.cache.clear()}static normalizeDomain(e){return e.replace(/^www\./,"").toLowerCase()}}c(A,"cache",new Map);class se{static extract(e,n){var a;if(console.log("[SiteExtractor] extract() called"),console.log("[SiteExtractor] clicked element:",e),console.log(`[SiteExtractor] containerSelector: "${n.containerSelector}"`),!n.containerSelector)return console.log("[SiteExtractor] NO containerSelector configured - returning null"),null;const s=e.closest(n.containerSelector);if(console.log("[SiteExtractor] container found:",s),!s)return console.log("[SiteExtractor] NO CONTAINER - returning null"),null;const r={siteName:n.name};if(n.fields){for(const[h,g]of Object.entries(n.fields))if(g){const b=s.querySelector(g);if(console.log(`[SiteExtractor] field "${h}" selector "${g}" => element:`,b),b){const v=((a=b.innerText)==null?void 0:a.trim())||"";console.log(`[SiteExtractor] field "${h}" innerText: "${v}"`),r[h]=v}}}return console.log("[SiteExtractor] result:",r),r}}const ne="0.2.4";class re{constructor(e="content-capture-inspector"){c(this,"ownerId");c(this,"clickCallbacks",new Set);c(this,"stateCallbacks",new Set);c(this,"unsubscribeService",null);c(this,"boundClickHandler",null);c(this,"isManaged",!1);c(this,"semanticExtractor");c(this,"siteConfig",null);c(this,"handleClick",e=>{if(!w.getState())return;const n=e.target;if(n.closest(".inspector-tooltip")||n.closest(".content-capture-popover"))return;e.preventDefault(),e.stopPropagation();const s=this.extractSemanticContent(n);let r;this.siteConfig&&(r=se.extract(n,this.siteConfig)||void 0);const a={element:n,text:this.extractText(n),tagName:n.tagName.toLowerCase(),classes:Array.from(n.classList),dataTest:n.getAttribute("data-test")||void 0,semanticNodes:s.nodes,semanticMarkdown:s.markdown,siteFields:r};this.clickCallbacks.forEach(h=>h(a))});this.ownerId=e;const n=new te;this.semanticExtractor=new Q(n)}async init(){console.log(`[InspectorFacade] v${ne} init() for: ${window.location.hostname}`),this.siteConfig=await A.getConfigForDomain(window.location.hostname),console.log("[InspectorFacade] Site config:",this.siteConfig)}onElementClick(e){return this.clickCallbacks.add(e),()=>{this.clickCallbacks.delete(e)}}onStateChange(e){return this.stateCallbacks.add(e),()=>{this.stateCallbacks.delete(e)}}extractText(e){return(e.innerText||e.textContent||"").replace(/\s+/g," ").trim()}extractSemanticContent(e){const n=this.semanticExtractor.extract(e),s=ee(n);return{nodes:n,markdown:s}}startManaging(){this.isManaged||(this.isManaged=!0,w.claimTooltip(this.ownerId),w.claimPanel(this.ownerId),this.unsubscribeService=w.subscribe(e=>{this.stateCallbacks.forEach(n=>n(e))}),this.boundClickHandler=this.handleClick,document.addEventListener("click",this.boundClickHandler,!0))}stopManaging(){this.isManaged&&(this.isManaged=!1,w.releaseTooltip(this.ownerId),w.releasePanel(this.ownerId),this.unsubscribeService&&(this.unsubscribeService(),this.unsubscribeService=null),this.boundClickHandler&&(document.removeEventListener("click",this.boundClickHandler,!0),this.boundClickHandler=null))}activate(){w.activate()}deactivate(){w.deactivate()}isActive(){return w.getState()}getOwnerId(){return this.ownerId}destroy(){this.stopManaging(),this.clickCallbacks.clear(),this.stateCallbacks.clear()}}class ae{constructor(){c(this,"captureFacade");c(this,"keyboardFacade");c(this,"inspectorFacade");c(this,"phase","idle");c(this,"listeners",new Set);c(this,"unsubscribeCapture",null);c(this,"unsubscribeKeyboard",null);c(this,"unsubscribeInspectorClick",null);this.captureFacade=new U,this.keyboardFacade=new Z,this.inspectorFacade=new re}onStateChange(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getState(){return{phase:this.phase,captureState:this.captureFacade.getState(),inspectorActive:this.inspectorFacade.isActive()}}notifyListeners(){const e=this.getState();this.listeners.forEach(n=>n(e))}setPhase(e){this.phase=e,this.notifyListeners()}async startCapture(){this.phase==="idle"&&(await this.inspectorFacade.init(),this.captureFacade.clear(),this.captureFacade.activate(),this.unsubscribeCapture=this.captureFacade.onChange(()=>{this.notifyListeners()}),this.unsubscribeKeyboard=this.keyboardFacade.onAction(e=>{this.handleKeyboardAction(e)}),this.unsubscribeInspectorClick=this.inspectorFacade.onElementClick(e=>{var r;let n,s;(r=e.siteFields)!=null&&r.title?(n=e.siteFields.title,s=e.siteFields.content||e.semanticMarkdown||e.text):(n=e.semanticMarkdown||e.text,s=void 0),this.captureElement(n,s)}),this.keyboardFacade.enable(),this.inspectorFacade.startManaging(),this.inspectorFacade.activate(),this.setPhase("capturing"))}handleKeyboardAction(e){switch(e.type){case"SET_MODE":this.captureFacade.setHierarchyMode(e.mode);break;case"FINISH":this.finishCapture();break}}captureElement(e,n){this.phase==="capturing"&&this.captureFacade.captureNode(e,n)}finishCapture(){this.phase==="capturing"&&(this.keyboardFacade.disable(),this.inspectorFacade.deactivate(),this.captureFacade.deactivate(),this.setPhase("preview"))}closePreview(){this.phase==="preview"&&(this.cleanup(),this.setPhase("idle"))}resumeCapture(){this.phase==="preview"&&(this.captureFacade.activate(),this.keyboardFacade.enable(),this.inspectorFacade.activate(),this.setPhase("capturing"))}cancel(){this.cleanup(),this.captureFacade.clear(),this.setPhase("idle")}cleanup(){this.keyboardFacade.disable(),this.inspectorFacade.deactivate(),this.inspectorFacade.stopManaging(),this.captureFacade.deactivate(),this.unsubscribeCapture&&(this.unsubscribeCapture(),this.unsubscribeCapture=null),this.unsubscribeKeyboard&&(this.unsubscribeKeyboard(),this.unsubscribeKeyboard=null),this.unsubscribeInspectorClick&&(this.unsubscribeInspectorClick(),this.unsubscribeInspectorClick=null)}getCaptureFacade(){return this.captureFacade}getKeyboardFacade(){return this.keyboardFacade}exportCanvasJson(){const e=this.captureFacade.generateCanvasJson();return JSON.stringify(e,null,2)}async copyToClipboard(){try{const e=this.exportCanvasJson();return await navigator.clipboard.writeText(`__paste-create__${e}`),!0}catch{return!1}}getInspectorFacade(){return this.inspectorFacade}destroy(){this.cleanup(),this.keyboardFacade.destroy(),this.inspectorFacade.destroy(),this.listeners.clear()}}function ie({onCaptureComplete:d,autoStart:e=!1,portalContainer:n}){const s=l.useRef(null),r=l.useRef(null),[a,h]=l.useState(null);l.useEffect(()=>{const i=new ae;s.current=i;const o=i.onStateChange(m=>{h({...m})});return h(i.getState()),e&&(i.startCapture(),y.info("Capture mode activated",{description:"Click elements to capture. Press 'c' for child, 'm' for sibling, ESC to finish."})),()=>{o(),i.destroy()}},[e]);const g=l.useCallback(()=>{var i;(i=s.current)==null||i.startCapture(),y.info("Capture mode activated",{description:"Click elements to capture. Press 'c' for child, 'm' for sibling, ESC to finish."})},[]),b=l.useCallback(async()=>{if(s.current)if(await s.current.copyToClipboard()){const o=s.current.exportCanvasJson();d==null||d(o),y.success("Canvas JSON copied to clipboard!")}else y.error("Failed to copy to clipboard")},[d]),p=l.useCallback(()=>{var i;(i=s.current)==null||i.closePreview()},[]),v=l.useCallback(()=>{var i;(i=s.current)==null||i.resumeCapture(),y.info("Resumed capture mode",{description:"Click elements to capture. Press ESC to finish."})},[]),S=l.useCallback(()=>{var i;(i=s.current)==null||i.cancel()},[]),L=l.useCallback(()=>{if(!s.current)return[];const i=s.current.getCaptureFacade().toTreeNodes(),o=m=>m.map(f=>({id:f.id,label:f.label,children:f.children?o(f.children):void 0,data:f.data}));return o(i)},[]),k=l.useCallback((i,o,m,f)=>{const C=i.data;return C!=null&&C.content&&C.content!==C.text?t.jsxs("div",{"data-test":"tree-node-with-content",children:[f,t.jsxs("div",{className:"ml-8 mr-2 -mt-1 mb-1 px-2 py-1 text-xs text-muted-foreground bg-muted/30 rounded line-clamp-2",title:C.content,"data-test":"node-content-preview",children:[C.content.slice(0,150),C.content.length>150?"...":""]})]}):f},[]),E=l.useCallback((i,o)=>{var m;(m=s.current)==null||m.getCaptureFacade().updateNode(i,o)},[]),I=l.useCallback(i=>{var o;(o=s.current)==null||o.getCaptureFacade().removeNode(i)},[]),T=l.useCallback(i=>{var m;const o=f=>f.map(C=>({id:C.id,label:C.label,children:C.children?o(C.children):void 0,data:C.data}));(m=s.current)==null||m.getCaptureFacade().updateFromTree(o(i))},[]),N=(a==null?void 0:a.captureState.nodes.length)??0;if(l.useEffect(()=>{r.current&&N>0&&(r.current.scrollTop=r.current.scrollHeight)},[N]),!a)return null;const F=L(),M=new Set(a.captureState.nodes.map(i=>i.id)),D=a.phase==="capturing"&&N>0||a.phase==="preview",u=a.phase==="capturing",x=u?`Capturing (${N}) - ${a.captureState.hierarchyMode==="child"?"→ Child":"↔ Sibling"}`:`Captured Nodes (${N})`;return t.jsxs("div",{className:"content-capture-controller","data-test":"content-capture-controller",children:[a.phase==="idle"&&t.jsxs(j,{onClick:g,variant:"default","data-test":"start-capture-button",children:[t.jsx(z,{className:"w-4 h-4 mr-2"}),"Start Capture"]}),t.jsx(O,{isVisible:D,onClose:p,title:x,shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-370,y:20},initialSize:{width:350,height:400},portalContainer:n,headerActions:t.jsxs(t.Fragment,{children:[!u&&t.jsx(j,{variant:"ghost",size:"sm",onClick:v,className:"h-6 px-2",title:"Resume Capture","data-test":"resume-capture-button",children:t.jsx(J,{className:"w-3 h-3"})}),t.jsx(j,{variant:"ghost",size:"sm",onClick:b,className:"h-6 px-2",title:"Copy Canvas JSON","data-test":"copy-json-button",children:t.jsx(H,{className:"w-3 h-3"})}),t.jsx(j,{variant:"ghost",size:"sm",onClick:S,className:"h-6 px-2 text-destructive",title:"Clear All","data-test":"clear-button",children:t.jsx(W,{className:"w-3 h-3"})})]}),children:t.jsxs("div",{ref:r,className:"p-2 h-full overflow-auto","data-test":"capture-tree-container",children:[N===0?t.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No elements captured yet."}):t.jsx($,{data:F,onUpdate:E,onDelete:I,onReorder:T,defaultExpandedIds:M,enableEdit:!0,enableDelete:!0,enableDrag:!0,renderNode:k}),u&&t.jsxs("div",{className:"mt-2 p-2 bg-muted/50 rounded text-xs text-muted-foreground",children:[t.jsx("span",{className:"font-medium",children:"c"})," child  ",t.jsx("span",{className:"font-medium",children:"m"})," up/sibling  ",t.jsx("span",{className:"font-medium",children:"ESC"})," finish"]})]})})]})}class oe{constructor(e){c(this,"config");c(this,"maxDepth");this.config=e,this.maxDepth=e.maxDepth??10}capture(){const e=[];let n=0;if(console.log("[SiteCaptureService] Starting capture..."),this.config.article){const s=this.captureArticle();s&&(e.push({...s,order:n++}),console.log("[SiteCaptureService] Captured article:",s.text))}if(this.config.comments){const s=this.captureComments(n);e.push(...s),console.log(`[SiteCaptureService] Captured ${s.length} comments`)}return console.log(`[SiteCaptureService] Total captured: ${e.length} nodes`),e}captureArticle(){var g,b,p,v;const{containerSelector:e,titleSelector:n,contentSelector:s}=this.config.article,r=document.querySelector(e);if(!r)return console.log(`[SiteCaptureService] Article container not found: ${e}`),null;const a=((b=(g=r.querySelector(n))==null?void 0:g.textContent)==null?void 0:b.trim())||"Untitled",h=((v=(p=r.querySelector(s))==null?void 0:p.textContent)==null?void 0:v.trim())||"";return{id:`article-${P(8)}`,text:a,content:h,parentId:null}}captureComments(e){const n=[],{sectionSelector:s,commentContainerSelector:r}=this.config.comments,a=document.querySelector(s);if(!a)return console.log(`[SiteCaptureService] Comments section not found: ${s}`),n;const h=a.querySelectorAll(`:scope > ${r}`);console.log(`[SiteCaptureService] Found ${h.length} top-level comments`);let g=e;return h.forEach(b=>{const p=this.extractCommentTree(b,null,0,g);n.push(...p.nodes),g=p.nextOrder}),n}extractCommentTree(e,n,s,r){var E,I,T,N;const a=[],{commentSelector:h,childrenSelector:g,fields:b,commentContainerSelector:p}=this.config.comments,v=e.querySelector(h);if(!v)return{nodes:a,nextOrder:r};const S=((I=(E=v.querySelector(b.title))==null?void 0:E.textContent)==null?void 0:I.trim())||"Unknown",L=((N=(T=v.querySelector(b.content))==null?void 0:T.textContent)==null?void 0:N.trim())||"",k=`comment-${P(8)}`;if(a.push({id:k,text:S,content:L,parentId:n,order:r++}),s<this.maxDepth){const F=e.querySelector(g);F&&F.querySelectorAll(`:scope > ${p}`).forEach(D=>{const u=this.extractCommentTree(D,k,s+1,r);a.push(...u.nodes),r=u.nextOrder})}return{nodes:a,nextOrder:r}}}function ce({portalContainer:d,onCaptureComplete:e,config:n}){const[s,r]=l.useState(!1),[a,h]=l.useState([]),[g,b]=l.useState(!1),p=l.useRef(null),v=l.useRef(null);l.useEffect(()=>{const u=async()=>{console.log("[SiteCaptureController] Triggered");const x=n??await A.getConfigForDomain(window.location.hostname);if(!(x!=null&&x.article)&&!(x!=null&&x.comments)){console.warn("[SiteCaptureController] No site capture config for this domain"),y.error("No site capture config for this domain");return}const o=new oe(x).capture();if(o.length===0){y.warning("No content captured");return}const m=new U;m.importNodes(o),p.current=m,h(o),r(!0),y.success(`Captured ${o.length} items`)};return window.addEventListener("watcher:site-capture:trigger",u),()=>{window.removeEventListener("watcher:site-capture:trigger",u)}},[]);const S=l.useCallback(()=>{r(!1),h([]),p.current=null},[]),L=l.useCallback(async()=>{if(!p.current)return;const u=p.current.generateCanvasJson(),x=`__paste-create__${JSON.stringify(u)}`;try{await navigator.clipboard.writeText(x),y.success("Canvas JSON copied to clipboard!"),e==null||e(JSON.stringify(u))}catch(i){console.error("[SiteCaptureController] Failed to copy:",i),y.error("Failed to copy to clipboard")}},[e]),k=l.useCallback(()=>{if(!p.current)return[];const u=p.current.toTreeNodes(),x=i=>i.map(o=>({id:o.id,label:o.label,children:o.children?x(o.children):void 0,data:o.data}));return x(u)},[a]),E=l.useCallback((u,x,i,o)=>{const m=u.data;return m!=null&&m.content&&m.content!==m.text?t.jsxs("div",{"data-test":"tree-node-with-content",children:[o,t.jsxs("div",{className:"ml-8 mr-2 -mt-1 mb-1 px-2 py-1 text-xs text-muted-foreground bg-muted/30 rounded line-clamp-2",title:m.content,"data-test":"node-content-preview",children:[m.content.slice(0,150),m.content.length>150?"...":""]})]}):o},[]),I=l.useCallback((u,x)=>{var i,o;(i=p.current)==null||i.updateNode(u,x),h([...((o=p.current)==null?void 0:o.getNodes())??[]])},[]),T=l.useCallback(u=>{var x,i;(x=p.current)==null||x.removeNode(u),h([...((i=p.current)==null?void 0:i.getNodes())??[]])},[]),N=l.useCallback(u=>{var i,o;const x=m=>m.map(f=>({id:f.id,label:f.label,children:f.children?x(f.children):void 0,data:f.data}));(i=p.current)==null||i.updateFromTree(x(u)),h([...((o=p.current)==null?void 0:o.getNodes())??[]])},[]);if(!s)return null;const F=k(),M=new Set(a.map(u=>u.id)),D=g?"!bg-[#1a1a1a] !text-white !border-[#333]":"!bg-white !text-black !border-gray-200";return t.jsx(O,{isVisible:s,onClose:S,title:`Site Capture (${a.length})`,shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-420,y:20},initialSize:{width:400,height:500},portalContainer:d,className:D,headerActions:t.jsxs(t.Fragment,{children:[t.jsx(j,{variant:"ghost",size:"sm",onClick:()=>b(!g),className:"h-6 px-2",title:g?"Light mode":"Dark mode","data-test":"theme-toggle-button",children:g?t.jsx(G,{className:"w-3 h-3"}):t.jsx(V,{className:"w-3 h-3"})}),t.jsx(j,{variant:"ghost",size:"sm",onClick:L,className:"h-6 px-2",title:"Copy Canvas JSON","data-test":"copy-json-button",children:t.jsx(H,{className:"w-3 h-3"})}),t.jsx(j,{variant:"ghost",size:"sm",onClick:S,className:"h-6 px-2 text-destructive",title:"Close","data-test":"close-button",children:t.jsx(X,{className:"w-3 h-3"})})]}),children:t.jsx("div",{ref:v,className:"p-2 h-full overflow-auto","data-test":"site-capture-tree-container",children:a.length===0?t.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No content captured."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-2 p-2 bg-muted/50 rounded text-xs text-muted-foreground flex items-center gap-2",children:[t.jsx(R,{className:"w-3 h-3"}),"Article + ",a.length-1," comments captured"]}),t.jsx($,{data:F,onUpdate:I,onDelete:T,onReorder:N,defaultExpandedIds:M,enableEdit:!0,enableDelete:!0,enableDrag:!0,renderNode:E})]})})})}const le={domain:"localhost",name:"LessWrong Demo",maxDepth:10,article:{containerSelector:".MultiToCLayout-content",titleSelector:".PostsPageTitle-root",contentSelector:".PostsPage-postContent"},comments:{sectionSelector:".CommentsListMeta-root + div",commentContainerSelector:".CommentFrame-node",commentSelector:".CommentsItem-root",childrenSelector:".CommentsNode-children",fields:{title:".CommentsItemMeta-root .UsersNameDisplay-noColor",content:".CommentBody-root"}}};function de(){const[d,e]=l.useState(null),n=()=>{window.dispatchEvent(new CustomEvent("watcher:site-capture:trigger"))};return t.jsxs("div",{className:"content-capture-demo p-4 space-y-6","data-test":"content-capture-demo",children:[t.jsxs("div",{className:"controls-section","data-test":"controls-section",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Content Capture Demo"}),t.jsxs("div",{className:"flex gap-2","data-test":"capture-buttons",children:[t.jsx(ie,{onCaptureComplete:e}),t.jsxs(j,{onClick:n,variant:"outline","data-test":"start-site-capture-button",children:[t.jsx(R,{className:"w-4 h-4 mr-2"}),"Start Site Capture"]})]}),t.jsx(ce,{onCaptureComplete:e,config:le})]}),t.jsxs("div",{className:"sample-content border rounded-lg p-4 bg-muted/30 space-y-3","data-test":"semantic-showcase",children:[t.jsx("h3",{className:"text-md font-medium mb-2",children:"Semantic HTML Showcase"}),t.jsx("h1",{"data-test":"h1",children:"Heading Level 1"}),t.jsx("h2",{"data-test":"h2",children:"Heading Level 2"}),t.jsx("h3",{"data-test":"h3",children:"Heading Level 3"}),t.jsx("h4",{"data-test":"h4",children:"Heading Level 4"}),t.jsx("h5",{"data-test":"h5",children:"Heading Level 5"}),t.jsx("h6",{"data-test":"h6",children:"Heading Level 6"}),t.jsx("p",{"data-test":"paragraph",children:"A simple paragraph element."}),t.jsx("strong",{"data-test":"strong",children:"Bold text using strong tag"}),t.jsx("em",{"data-test":"em",children:"Italic text using em tag"}),t.jsxs("ul",{"data-test":"ul",children:[t.jsx("li",{children:"Unordered item one"}),t.jsx("li",{children:"Unordered item two"})]}),t.jsxs("ol",{"data-test":"ol",children:[t.jsx("li",{children:"Ordered item one"}),t.jsx("li",{children:"Ordered item two"})]}),t.jsx("blockquote",{"data-test":"blockquote",children:"A blockquote for citations."})]}),t.jsxs("div",{className:"sample-content border rounded-lg p-4 bg-muted/30","data-test":"lesswrong-demo",children:[t.jsx("h3",{className:"text-md font-medium mb-4",children:"LessWrong Site Mock"}),t.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Matches site-config selectors for Site Capture testing"}),t.jsxs("div",{className:"MultiToCLayout-content border rounded p-4 mb-4 bg-background",children:[t.jsx("h1",{className:"PostsPageTitle-root text-xl font-bold mb-3",children:"The Rationalist's Guide to Epistemology"}),t.jsxs("div",{className:"PostsPage-postContent text-sm space-y-2",children:[t.jsx("p",{children:"Rationality is systematized winning. It's the art of thinking in ways that lead to true beliefs and effective actions. The core insight is that our intuitions can be wrong, and we need methods to correct them."}),t.jsx("p",{children:"This post explores the foundations of epistemic rationality and how we can apply it to everyday decision-making."})]})]}),t.jsx("div",{className:"CommentsListMeta-root text-sm text-muted-foreground mb-2",children:"4 comments"}),t.jsxs("div",{className:"comments-section","data-test":"comments-section",children:[t.jsxs("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-1",children:[t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Eliezer Yudkowsky"})," · 2h"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:"The key insight here is that rationality is about winning, not about following rules. When your map disagrees with the territory, update the map."})]}),t.jsxs("div",{className:"CommentsNode-children ml-6 mt-2",children:[t.jsxs("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-1-1",children:[t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Scott Alexander"})," · 1h"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:"I think this connects to the broader point about epistemic humility. We should hold our beliefs provisionally and be willing to change them when presented with new evidence."})]}),t.jsx("div",{className:"CommentsNode-children ml-6 mt-2",children:t.jsx("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-1-1-1",children:t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Gwern"})," · 45m"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:"Related: my analysis of prediction markets shows they consistently outperform expert forecasts in domains with clear resolution criteria."})]})})})]}),t.jsx("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-1-2",children:t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Anna Salamon"})," · 50m"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:'This reminds me of the distinction between "rationality as etiquette" vs "rationality as winning". The former is cargo-culting.'})]})})]})]}),t.jsxs("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-2",children:[t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Zvi Mowshowitz"})," · 30m"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:"The practical implication is that we need better institutional mechanisms for aggregating and acting on distributed knowledge. Current systems are systematically biased toward legibility over effectiveness."})]}),t.jsx("div",{className:"CommentsNode-children ml-6 mt-2",children:t.jsx("div",{className:"CommentFrame-node mb-3","data-test":"lw-comment-2-1",children:t.jsxs("div",{className:"CommentsItem-root p-3 bg-background rounded border",children:[t.jsxs("div",{className:"CommentsItemMeta-root text-sm text-muted-foreground mb-1",children:[t.jsx("span",{className:"UsersNameDisplay-noColor font-medium text-blue-600",children:"Wei Dai"})," · 15m"]}),t.jsx("div",{className:"CommentBody-root text-sm",children:"Have you considered how this applies to AI alignment? The same coordination problems seem relevant there."})]})})})]})]})]}),t.jsxs("div",{className:"sample-content border rounded-lg p-4 bg-muted/30","data-test":"comment-thread-section",children:[t.jsx("h3",{className:"text-md font-medium mb-4",children:"Sample Comment Thread"}),t.jsxs("div",{className:"comment p-3 bg-background rounded border mb-2","data-test":"comment-root",children:[t.jsx("div",{className:"font-medium text-sm",children:"Alice"}),t.jsx("p",{className:"text-sm mt-1",children:"This is the root comment. It starts the discussion about the new feature proposal."})]}),t.jsxs("div",{className:"ml-6",children:[t.jsxs("div",{className:"comment p-3 bg-background rounded border mb-2","data-test":"comment-child-1",children:[t.jsx("div",{className:"font-medium text-sm",children:"Bob"}),t.jsx("p",{className:"text-sm mt-1",children:"I agree with the proposal. Here are my thoughts on the implementation details."})]}),t.jsx("div",{className:"ml-6",children:t.jsxs("div",{className:"comment p-3 bg-background rounded border mb-2","data-test":"comment-grandchild",children:[t.jsx("div",{className:"font-medium text-sm",children:"Carol"}),t.jsx("p",{className:"text-sm mt-1",children:"Good point Bob! I have a follow-up question about the timeline."})]})})]}),t.jsx("div",{className:"ml-6",children:t.jsxs("div",{className:"comment p-3 bg-background rounded border mb-2","data-test":"comment-child-2",children:[t.jsx("div",{className:"font-medium text-sm",children:"Dave"}),t.jsx("p",{className:"text-sm mt-1",children:"I have some concerns about the approach. Let me share my alternative suggestion."})]})}),t.jsxs("div",{className:"comment p-3 bg-background rounded border mb-2 mt-4","data-test":"comment-root-2",children:[t.jsx("div",{className:"font-medium text-sm",children:"Eve"}),t.jsx("p",{className:"text-sm mt-1",children:"Starting a new thread here. This is unrelated to Alice's comment above."})]})]}),t.jsxs("div",{className:"instructions text-sm text-muted-foreground bg-muted/20 p-4 rounded","data-test":"instructions",children:[t.jsx("h4",{className:"font-medium mb-2",children:"How to use:"}),t.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[t.jsx("li",{children:'Click "Start Capture" to activate capture mode'}),t.jsx("li",{children:"Click on any semantic element (h1-h6, p, ul, ol, blockquote)"}),t.jsx("li",{children:"See the captured text converted to markdown format"}),t.jsx("li",{children:"Press 'c' before clicking to capture as a child node"}),t.jsx("li",{children:"Press 'm' before clicking to capture as a sibling node"}),t.jsx("li",{children:"Press ESC when done to see the preview"}),t.jsx("li",{children:"Edit or reorder nodes in the preview panel"})]}),t.jsxs("p",{className:"mt-3 text-xs",children:[t.jsx("strong",{children:"Semantic extraction:"})," h1→# heading, p→paragraph, ul→- list, ol→1. list, blockquote→> quote"]})]}),d&&t.jsxs("div",{className:"last-export border rounded-lg p-4","data-test":"last-export",children:[t.jsx("h4",{className:"text-sm font-medium mb-2",children:"Last Exported JSON:"}),t.jsx("pre",{className:"text-xs bg-muted p-3 rounded overflow-auto max-h-64",children:d})]})]})}function Ne(){return t.jsx("div",{className:"content-capture-demo-page h-full overflow-auto p-6","data-test":"content-capture-demo-page",children:t.jsx(de,{})})}export{Ne as default};
