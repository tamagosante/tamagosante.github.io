var te=Object.defineProperty;var oe=(o,e,t)=>e in o?te(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>oe(o,typeof e!="symbol"?e+"":e,t);import{r as p,j as s}from"./react-vendor-Byz07MLO.js";import{ak as re,C as T,b as m,c as x,e as _,B as S,d as v,I as N,a as f,aj as se}from"./index-BbgB-sev.js";import{d as ae,a2 as ie,C as ne,X as ce,_ as le,T as de}from"./icons-Detj0uxE.js";import"./utils-DjFvUtuq.js";import"./radix-ui-B6r6BEmy.js";import"./ui-utils-BxIQ3qGg.js";class k{calculateStats(e){return{total:e.length,active:e.filter(t=>t.status==="active").length,completed:e.filter(t=>t.status==="completed").length,completionRate:e.length>0?e.filter(t=>t.status==="completed").length/e.length*100:0}}filterTodos(e,t){let r=e;if(t.status&&t.status!=="all"&&(r=r.filter(a=>a.status===t.status)),t.searchText){const a=t.searchText.toLowerCase();r=r.filter(i=>i.text.toLowerCase().includes(a))}return t.createdAfter&&(r=r.filter(a=>new Date(a.createdAt)>=t.createdAfter)),t.createdBefore&&(r=r.filter(a=>new Date(a.createdAt)<=t.createdBefore)),r}sortTodos(e,t){const r=[...e];switch(t){case"createdAt-desc":return r.sort((a,i)=>new Date(i.createdAt).getTime()-new Date(a.createdAt).getTime());case"createdAt-asc":return r.sort((a,i)=>new Date(a.createdAt).getTime()-new Date(i.createdAt).getTime());case"text-asc":return r.sort((a,i)=>a.text.localeCompare(i.text));case"text-desc":return r.sort((a,i)=>i.text.localeCompare(a.text));case"status":return r.sort((a,i)=>a.status==="completed"&&i.status!=="completed"?1:a.status!=="completed"&&i.status==="completed"?-1:0);default:return r}}canDelete(e){const t=Date.now()-5e3;return new Date(e.createdAt).getTime()>t?{valid:!1,reason:"Cannot delete todo immediately after creation. Wait 5 seconds."}:{valid:!0}}validateTodoText(e){const t=e.trim();return t.length===0?{valid:!1,reason:"Todo text cannot be empty"}:t.length<3?{valid:!1,reason:"Todo text must be at least 3 characters"}:t.length>500?{valid:!1,reason:"Todo text cannot exceed 500 characters"}:/(.)\1{9,}/.test(t)?{valid:!1,reason:"Todo text contains suspicious patterns"}:{valid:!0}}findSimilarTodos(e,t){const r=e.toLowerCase().trim();return t.filter(a=>{const i=a.text.toLowerCase().trim();return!!(i===r||i.includes(r)||r.includes(i))})}}class U extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class A extends U{constructor(e,t){super(e),this.field=t}}class ue extends A{constructor(e){super(`Todo text must be at least ${e} characters`,"text")}}class he extends A{constructor(e){super(`Todo text cannot exceed ${e} characters`,"text")}}class pe extends A{constructor(){super("Todo text cannot be empty","text")}}class ge extends A{constructor(e){super(`Todo text contains invalid pattern: ${e}`,"text")}}class fe extends U{}class Te extends fe{constructor(e){super(`Cannot delete todo: ${e}`)}}class ye extends U{}class C extends ye{constructor(e){super(`Todo with ID ${e} not found`),this.todoId=e}}class O{constructor(e){l(this,"isSuccess",!0);l(this,"isFailure",!1);this.value=e}static of(e){return new O(e)}}class j{constructor(e){l(this,"isSuccess",!1);l(this,"isFailure",!0);this.error=e}static of(e){return new j(e)}}const c={success:o=>O.of(o),failure:o=>j.of(o)};class g{constructor(e,t,r,a,i){this.id=e,this.text=t,this.status=r,this.createdAt=a,this.updatedAt=i,this.validate()}validate(){if(!this.id.trim())throw new Error("Todo ID cannot be empty");if(!this.text.trim())throw new Error("Todo text cannot be empty");if(this.text.length>500)throw new Error("Todo text cannot exceed 500 characters")}static create(e){const t=new Date().toISOString();return new g(crypto.randomUUID(),e.trim(),"active",t,t)}static fromData(e){return new g(e.id,e.text,e.status,e.createdAt,e.updatedAt)}toggleStatus(){return new g(this.id,this.text,this.status==="active"?"completed":"active",this.createdAt,new Date().toISOString())}updateText(e){return new g(this.id,e.trim(),this.status,this.createdAt,new Date().toISOString())}toJSON(){return{id:this.id,text:this.text,status:this.status,createdAt:this.createdAt,updatedAt:this.updatedAt}}}class we{constructor(e,t,r,a){this.repository=e,this.todoService=t,this.analytics=r,this.clientLogsApiClient=a}async execute(e){var t;try{const r=this.todoService.validateTodoText(e.text);if(!r.valid)return c.failure(this.mapValidationError(r.reason));const a=await this.repository.getAll(),i=this.todoService.findSimilarTodos(e.text,a);i.length>0&&console.warn("[AddTodoUseCase] Similar todos found:",i.map(h=>h.id));const n=g.create(e.text),u=await this.repository.create(n);return this.analytics.trackEvent({name:"todo_created",category:"todo",properties:{text_length:e.text.length,has_similar:i.length>0,similar_count:i.length}}).catch(h=>console.error("[AddTodoUseCase] Analytics error:",h)),(t=this.clientLogsApiClient)==null||t.sendLogs("todo_created",{todoId:u.id,textLength:e.text.length,similarCount:i.length}),c.success(u)}catch(r){return await this.analytics.trackError(r instanceof Error?r:new Error("Unknown error in AddTodoUseCase"),{command:e}).catch(a=>console.error("[AddTodoUseCase] Analytics error:",a)),c.failure(r instanceof Error?r:new Error("Failed to add todo"))}}mapValidationError(e){return e.includes("empty")?new pe:e.includes("at least")?new ue(3):e.includes("exceed")?new he(500):e.includes("pattern")?new ge(e):new Error(e)}}class me{constructor(e,t,r){this.repository=e,this.todoService=t,this.analytics=r}async execute(e){try{const t=this.todoService.validateTodoText(e.text);if(!t.valid)return c.failure(new Error(t.reason));const r=await this.repository.getById(e.id);if(!r)return c.failure(new C(e.id));const a=r.updateText(e.text),i=await this.repository.update(a);return this.analytics.trackEvent({name:"todo_updated",category:"todo",properties:{old_length:r.text.length,new_length:e.text.length}}).catch(n=>console.error("[UpdateTodoUseCase] Analytics error:",n)),c.success(i)}catch(t){return await this.analytics.trackError(t instanceof Error?t:new Error("Unknown error in UpdateTodoUseCase"),{command:e}).catch(r=>console.error("[UpdateTodoUseCase] Analytics error:",r)),c.failure(t instanceof Error?t:new Error("Failed to update todo"))}}}class xe{constructor(e,t){this.repository=e,this.analytics=t}async execute(e){try{const t=await this.repository.getById(e.id);if(!t)return c.failure(new C(e.id));const r=t.toggleStatus(),a=await this.repository.update(r);return this.analytics.trackEvent({name:"todo_toggled",category:"todo",properties:{from_status:t.status,to_status:a.status}}).catch(i=>console.error("[ToggleTodoUseCase] Analytics error:",i)),c.success(a)}catch(t){return await this.analytics.trackError(t instanceof Error?t:new Error("Unknown error in ToggleTodoUseCase"),{command:e}).catch(r=>console.error("[ToggleTodoUseCase] Analytics error:",r)),c.failure(t instanceof Error?t:new Error("Failed to toggle todo"))}}}class Ee{constructor(e,t,r){this.repository=e,this.todoService=t,this.analytics=r}async execute(e){try{const t=await this.repository.getById(e.id);if(!t)return c.failure(new C(e.id));const r=this.todoService.canDelete(t);return r.valid?(await this.repository.delete(e.id),this.analytics.trackEvent({name:"todo_deleted",category:"todo",properties:{status:t.status,age_seconds:(Date.now()-new Date(t.createdAt).getTime())/1e3}}).catch(a=>console.error("[DeleteTodoUseCase] Analytics error:",a)),c.success(void 0)):c.failure(new Te(r.reason))}catch(t){return await this.analytics.trackError(t instanceof Error?t:new Error("Unknown error in DeleteTodoUseCase"),{command:e}).catch(r=>console.error("[DeleteTodoUseCase] Analytics error:",r)),c.failure(t instanceof Error?t:new Error("Failed to delete todo"))}}}class Se{constructor(e,t){this.repository=e,this.todoService=t}async execute(e){try{let t=await this.repository.getAll();if(e.filter&&e.filter!=="all"&&(t=this.todoService.filterTodos(t,{status:e.filter})),e.sortBy){const r=this.mapSortCriteria(e.sortBy,e.sortOrder);t=this.todoService.sortTodos(t,r)}return c.success(t)}catch(t){return c.failure(t instanceof Error?t:new Error("Failed to get todos"))}}mapSortCriteria(e,t){const r=t||"desc";return e==="createdAt"?r==="desc"?"createdAt-desc":"createdAt-asc":e==="text"?r==="desc"?"text-desc":"text-asc":"createdAt-desc"}}class ve{constructor(e,t,r){l(this,"todoService");l(this,"_addTodoUseCase");l(this,"_updateTodoUseCase");l(this,"_toggleTodoUseCase");l(this,"_deleteTodoUseCase");l(this,"_getAllTodosUseCase");this.repository=e,this.analytics=t,this.clientLogsApiClient=r,this.todoService=new k}async addTodo(e){return this._addTodoUseCase||(this._addTodoUseCase=new we(this.repository,this.todoService,this.analytics,this.clientLogsApiClient)),this._addTodoUseCase.execute(e)}async updateTodo(e){return this._updateTodoUseCase||(this._updateTodoUseCase=new me(this.repository,this.todoService,this.analytics)),this._updateTodoUseCase.execute(e)}async toggleTodo(e){return this._toggleTodoUseCase||(this._toggleTodoUseCase=new xe(this.repository,this.analytics)),this._toggleTodoUseCase.execute(e)}async deleteTodo(e){return this._deleteTodoUseCase||(this._deleteTodoUseCase=new Ee(this.repository,this.todoService,this.analytics)),this._deleteTodoUseCase.execute(e)}async clearTodos(e){try{const t=await this.repository.getAll(),r=this.todoService.calculateStats(t);return await this.repository.clear(),this.analytics.trackEvent({name:"todos_cleared",category:"todo",properties:{total_cleared:r.total,active_cleared:r.active,completed_cleared:r.completed}}).catch(a=>console.error("[ClearTodos] Analytics error:",a)),c.success(void 0)}catch(t){return await this.analytics.trackError(t instanceof Error?t:new Error("Unknown error in clearTodos"),{command:e}).catch(r=>console.error("[ClearTodos] Analytics error:",r)),c.failure(t instanceof Error?t:new Error("Failed to clear todos"))}}async getAllTodos(e){return this._getAllTodosUseCase||(this._getAllTodosUseCase=new Se(this.repository,this.todoService)),this._getAllTodosUseCase.execute(e)}async getTodoById(e){try{const t=await this.repository.getById(e.id);return t?c.success(t):c.failure(new C(e.id))}catch(t){return c.failure(t instanceof Error?t:new Error("Failed to get todo"))}}async getTodosByStatus(e){try{const t=await this.repository.getAll(),r=this.todoService.filterTodos(t,{status:e.status});return c.success(r)}catch(t){return c.failure(t instanceof Error?t:new Error("Failed to get todos by status"))}}async searchTodos(e){try{const t=await this.repository.getAll(),r=this.todoService.filterTodos(t,{searchText:e.searchText});return c.success(r)}catch(t){return c.failure(t instanceof Error?t:new Error("Failed to search todos"))}}async getTodoStats(e){try{const t=await this.repository.getAll(),r=this.todoService.calculateStats(t);return c.success(r)}catch(t){return c.failure(t instanceof Error?t:new Error("Failed to get stats"))}}}class _e{constructor(){l(this,"storageKey","action_todos")}async getAll(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e).map(r=>g.fromData(r)):[]}catch(e){return console.error("Failed to load todos from localStorage:",e),[]}}async getById(e){return(await this.getAll()).find(r=>r.id===e)||null}async create(e){const t=await this.getAll();return t.push(e),await this.saveAll(t),e}async update(e){const t=await this.getAll(),r=t.findIndex(a=>a.id===e.id);if(r===-1)throw new Error(`Todo with id ${e.id} not found`);return t[r]=e,await this.saveAll(t),e}async delete(e){const t=await this.getAll(),r=t.filter(a=>a.id!==e);if(r.length===t.length)throw new Error(`Todo with id ${e} not found`);await this.saveAll(r)}async clear(){localStorage.removeItem(this.storageKey)}async saveAll(e){try{const t=e.map(r=>r.toJSON());localStorage.setItem(this.storageKey,JSON.stringify(t))}catch(t){throw console.error("Failed to save todos to localStorage:",t),new Error("Failed to save todos")}}}class Ae{constructor(e="/api/todos",t=5e3){l(this,"baseUrl");l(this,"timeout");this.baseUrl=e,this.timeout=t}async getAll(){try{const e=await this.fetchWithTimeout(`${this.baseUrl}`,{method:"GET"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).map(r=>g.fromData(r))}catch(e){throw console.error("Failed to fetch todos:",e),new Error("Failed to fetch todos from server")}}async getById(e){try{const t=await this.fetchWithTimeout(`${this.baseUrl}/${e}`,{method:"GET"});if(t.status===404)return null;if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();return g.fromData(r)}catch(t){throw console.error(`Failed to fetch todo ${e}:`,t),new Error("Failed to fetch todo from server")}}async create(e){try{const t=await this.fetchWithTimeout(`${this.baseUrl}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.toJSON())});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();return g.fromData(r)}catch(t){throw console.error("Failed to create todo:",t),new Error("Failed to create todo on server")}}async update(e){try{const t=await this.fetchWithTimeout(`${this.baseUrl}/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.toJSON())});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();return g.fromData(r)}catch(t){throw console.error(`Failed to update todo ${e.id}:`,t),new Error("Failed to update todo on server")}}async delete(e){try{const t=await this.fetchWithTimeout(`${this.baseUrl}/${e}`,{method:"DELETE"});if(!t.ok&&t.status!==404)throw new Error(`HTTP error! status: ${t.status}`)}catch(t){throw console.error(`Failed to delete todo ${e}:`,t),new Error("Failed to delete todo from server")}}async clear(){try{const e=await this.fetchWithTimeout(`${this.baseUrl}`,{method:"DELETE"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`)}catch(e){throw console.error("Failed to clear todos:",e),new Error("Failed to clear todos from server")}}async fetchWithTimeout(e,t){const r=new AbortController,a=setTimeout(()=>r.abort(),this.timeout);try{const i=await fetch(e,{...t,signal:r.signal});return clearTimeout(a),i}catch(i){throw clearTimeout(a),i instanceof Error&&i.name==="AbortError"?new Error("Request timeout"):i}}}class Ce{constructor(e,t=!1){l(this,"measurementId");l(this,"debug");this.measurementId=e,this.debug=t,this.initializeGA()}initializeGA(){if(!(typeof window>"u")){if(window.gtag){this.log("Google Analytics already initialized");return}window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date().toISOString()),window.gtag("config",this.measurementId,{send_page_view:!1}),this.log("Google Analytics initialized")}}async trackEvent(e){var t;if(typeof window>"u"||!window.gtag){this.log("Google Analytics not available");return}try{window.gtag("event",e.name,{event_category:e.category,event_timestamp:((t=e.timestamp)==null?void 0:t.getTime())||Date.now(),...e.properties}),this.log(`Event tracked: ${e.name}`,e)}catch(r){console.error("Failed to track event:",r)}}async trackPageView(e){if(typeof window>"u"||!window.gtag){this.log("Google Analytics not available");return}try{window.gtag("event","page_view",{page_path:e,page_location:window.location.href,page_title:document.title}),this.log(`Page view tracked: ${e}`)}catch(t){console.error("Failed to track page view:",t)}}async setUserProperties(e){if(typeof window>"u"||!window.gtag){this.log("Google Analytics not available");return}try{window.gtag("set","user_properties",e),this.log("User properties set",e)}catch(t){console.error("Failed to set user properties:",t)}}async trackError(e,t){if(typeof window>"u"||!window.gtag){this.log("Google Analytics not available");return}try{window.gtag("event","exception",{description:e.message,fatal:!1,error_name:e.name,error_stack:e.stack,...t}),this.log("Error tracked",{error:e,context:t})}catch(r){console.error("Failed to track error:",r)}}log(e,t){this.debug&&console.log(`[GoogleAnalytics] ${e}`,t||"")}}class D{constructor(e="[Analytics]"){l(this,"prefix");this.prefix=e}async trackEvent(e){console.log(`${this.prefix} Event:`,e.name,e)}async trackPageView(e){console.log(`${this.prefix} Page View:`,e)}async setUserProperties(e){console.log(`${this.prefix} User Properties:`,e)}async trackError(e,t){console.error(`${this.prefix} Error:`,e.message,t)}}class b{async trackEvent(e){}async trackPageView(e){}async setUserProperties(e){}async trackError(e,t){}}const I="FETCH_TODOS_REQUEST",F="FETCH_TODOS_SUCCESS",R="FETCH_TODOS_FAILURE",$="ADD_TODO_REQUEST",P="ADD_TODO_SUCCESS",G="ADD_TODO_FAILURE",B="TOGGLE_TODO_REQUEST",H="TOGGLE_TODO_SUCCESS",z="TOGGLE_TODO_FAILURE",Q="DELETE_TODO_REQUEST",W="DELETE_TODO_SUCCESS",J="DELETE_TODO_FAILURE",V="UPDATE_TODO_REQUEST",K="UPDATE_TODO_SUCCESS",M="UPDATE_TODO_FAILURE",X="CLEAR_TODOS_REQUEST",Y="CLEAR_TODOS_SUCCESS",Z="CLEAR_TODOS_FAILURE",q="SET_FILTER",De={todos:[],loading:!1,error:null,filter:"all"};function L(o=De,e){switch(e.type){case I:return{...o,loading:!0,error:null};case F:return{...o,loading:!1,todos:e.payload,error:null};case R:return{...o,loading:!1,error:e.error};case $:return{...o,loading:!0,error:null};case P:return{...o,loading:!1,todos:[...o.todos,e.payload],error:null};case G:return{...o,loading:!1,error:e.error};case B:return{...o,loading:!0,error:null};case H:return{...o,loading:!1,todos:o.todos.map(t=>t.id===e.payload.id?e.payload:t),error:null};case z:return{...o,loading:!1,error:e.error};case Q:return{...o,loading:!0,error:null};case W:return{...o,loading:!1,todos:o.todos.filter(t=>t.id!==e.payload),error:null};case J:return{...o,loading:!1,error:e.error};case V:return{...o,loading:!0,error:null};case K:return{...o,loading:!1,todos:o.todos.map(t=>t.id===e.payload.id?e.payload:t),error:null};case M:return{...o,loading:!1,error:e.error};case X:return{...o,loading:!0,error:null};case Y:return{...o,loading:!1,todos:[],error:null};case Z:return{...o,loading:!1,error:e.error};case q:return{...o,filter:e.payload};default:return o}}const Ue=o=>e=>t=>{if(typeof t=="function")return e(t);console.group(`ACTION â†’ ${t.type}`),console.log("Payload:",t.payload||t.error||"none");const r=e(t);return console.log("State:",o.getState()),console.groupEnd(),r},Oe=o=>e=>t=>r=>typeof r=="function"?r(e.dispatch,e.getState,o):t(r);function je(o,e=!0){let t=L(void 0,{type:"@@INIT"});const r=new Set,a={getState(){return t},dispatch(i){let n=u=>(t=L(t,u),r.forEach(h=>h()),u);return n=Oe(o)(a)(n),e&&(n=Ue(a)(n)),n(i)},subscribe(i){return r.add(i),()=>{r.delete(i)}}};return a}class be{constructor(){l(this,"_repository",null);l(this,"_store",null);l(this,"_todoService",null);l(this,"_analyticsService",null);l(this,"_todoApplicationService",null);l(this,"_clientLogsApiClient",null);l(this,"_config",null)}get config(){return this._config||(this._config={useHttpRepository:!1,httpApiBaseUrl:"http://localhost:3030",analyticsEnabled:!0,analyticsProvider:"console",googleAnalyticsMeasurementId:void 0,analyticsDebug:!1,clientLogsEnabled:!0,clientLogsApiBaseUrl:"http://localhost:3030/client-logs"}),this._config}get repository(){return this._repository||(this.config.useHttpRepository?(console.log("[DI] Using HttpTodoRepository"),this._repository=new Ae(this.config.httpApiBaseUrl,5e3)):(console.log("[DI] Using LocalTodoRepository"),this._repository=new _e)),this._repository}get todoService(){return this._todoService||(console.log("[DI] Creating TodoService"),this._todoService=new k),this._todoService}get analyticsService(){if(!this._analyticsService)if(!this.config.analyticsEnabled)console.log("[DI] Analytics disabled, using NoOpAnalyticsAdapter"),this._analyticsService=new b;else switch(this.config.analyticsProvider){case"google":this.config.googleAnalyticsMeasurementId?(console.log("[DI] Using GoogleAnalyticsAdapter"),this._analyticsService=new Ce(this.config.googleAnalyticsMeasurementId,this.config.analyticsDebug)):(console.warn("[DI] Google Analytics selected but no measurement ID provided, falling back to console"),this._analyticsService=new D);break;case"console":console.log("[DI] Using ConsoleAnalyticsAdapter"),this._analyticsService=new D;break;case"none":console.log("[DI] Using NoOpAnalyticsAdapter"),this._analyticsService=new b;break;default:console.warn(`[DI] Unknown analytics provider: ${this.config.analyticsProvider}, using console`),this._analyticsService=new D}return this._analyticsService}get clientLogsApiClient(){return this._clientLogsApiClient||(console.log("[DI] Creating ClientLogsApiClient"),this._clientLogsApiClient=new re(this.config.clientLogsApiBaseUrl,5e3)),this._clientLogsApiClient}get todoApplicationService(){return this._todoApplicationService||(console.log("[DI] Creating TodoApplicationService"),this._todoApplicationService=new ve(this.repository,this.analyticsService,this.config.clientLogsEnabled?this.clientLogsApiClient:void 0)),this._todoApplicationService}get store(){return this._store||(console.log("[DI] Creating Store with logger middleware"),this._store=je(this.repository,!0)),this._store}reset(){this._repository=null,this._store=null,this._todoService=null,this._analyticsService=null,this._todoApplicationService=null,this._clientLogsApiClient=null,this._config=null}setRepository(e){this._repository=e,this._store=null,this._todoApplicationService=null}setAnalyticsService(e){this._analyticsService=e,this._todoApplicationService=null}setTodoApplicationService(e){this._todoApplicationService=e}setClientLogsApiClient(e){this._clientLogsApiClient=e}setConfig(e){this._config={...this.config,...e},this._repository=null,this._analyticsService=null,this._todoApplicationService=null,this._clientLogsApiClient=null,this._store=null}}const E=new be,Le=()=>({type:I}),Ne=o=>({type:F,payload:o}),ke=o=>({type:R,error:o}),Ie=o=>({type:q,payload:o}),Fe=()=>async(o,e,t)=>{o(Le());try{const r=await t.getAll();o(Ne(r))}catch(r){o(ke(r instanceof Error?r.message:"Failed to fetch todos"))}},Re=o=>async(e,t,r)=>{e({type:$});const i=await E.todoApplicationService.addTodo({text:o});i.isSuccess?e({type:P,payload:i.value}):e({type:G,error:i.error.message})},$e=o=>async(e,t,r)=>{e({type:B,payload:o});const i=await E.todoApplicationService.toggleTodo({id:o});i.isSuccess?e({type:H,payload:i.value}):e({type:z,error:i.error.message})},Pe=o=>async(e,t,r)=>{e({type:Q,payload:o});const i=await E.todoApplicationService.deleteTodo({id:o});i.isSuccess?e({type:W,payload:o}):e({type:J,error:i.error.message})},Ge=(o,e)=>async(t,r,a)=>{t({type:V,payload:{id:o,text:e}});const n=await E.todoApplicationService.updateTodo({id:o,text:e});n.isSuccess?t({type:K,payload:n.value}):t({type:M,error:n.error.message})},Be=()=>async(o,e,t)=>{o({type:X});const a=await E.todoApplicationService.clearTodos({});a.isSuccess?o({type:Y}):o({type:Z,error:a.error.message})};function He(){const o=E.store,[e,t]=p.useState(o.getState());p.useEffect(()=>{const d=o.subscribe(()=>{t(o.getState())});return o.dispatch(Fe()),d},[o]);const r=p.useCallback(d=>{o.dispatch(Re(d))},[o]),a=p.useCallback(d=>{o.dispatch($e(d))},[o]),i=p.useCallback(d=>{o.dispatch(Pe(d))},[o]),n=p.useCallback((d,ee)=>{o.dispatch(Ge(d,ee))},[o]),u=p.useCallback(()=>{o.dispatch(Be())},[o]),h=p.useCallback(d=>{o.dispatch(Ie(d))},[o]),y=e.todos.filter(d=>e.filter==="active"?d.status==="active":e.filter==="completed"?d.status==="completed":!0),w={total:e.todos.length,active:e.todos.filter(d=>d.status==="active").length,completed:e.todos.filter(d=>d.status==="completed").length};return{todos:y,allTodos:e.todos,loading:e.loading,error:e.error,filter:e.filter,stats:w,addTodo:r,toggleTodo:a,deleteTodo:i,updateTodo:n,clearTodos:u,setFilter:h}}function ze(){return s.jsxs("div",{className:"header-section",children:[s.jsx("h1",{className:"page-title text-3xl font-bold",children:"Action-Driven Todo"}),s.jsx("p",{className:"page-subtitle text-muted-foreground mt-1",children:"Hexagonal architecture with ports & adapters"})]})}function Qe(){return s.jsxs(T,{className:"architecture-info-card bg-primary/5",children:[s.jsx(m,{children:s.jsx(x,{className:"text-sm",children:"Architecture Highlights"})}),s.jsxs(_,{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"highlight-item",children:[s.jsx(S,{variant:"outline",className:"mr-2",children:"Core"}),"Domain models, actions, reducers (100% framework-agnostic)"]}),s.jsxs("div",{className:"highlight-item",children:[s.jsx(S,{variant:"outline",className:"mr-2",children:"Port"}),"ITodoRepository interface (abstract contract)"]}),s.jsxs("div",{className:"highlight-item",children:[s.jsx(S,{variant:"outline",className:"mr-2",children:"Adapter"}),"LocalStorage implementation (swappable with API)"]}),s.jsxs("div",{className:"highlight-item",children:[s.jsx(S,{variant:"outline",className:"mr-2",children:"UI"}),"This component (dispatches actions, renders state)"]})]})]})}function We({stats:o}){return s.jsxs("div",{className:"stats-section grid grid-cols-3 gap-4",children:[s.jsx(T,{children:s.jsxs(m,{className:"pb-3",children:[s.jsx(v,{children:"Total"}),s.jsx(x,{className:"text-3xl",children:o.total})]})}),s.jsx(T,{children:s.jsxs(m,{className:"pb-3",children:[s.jsx(v,{children:"Active"}),s.jsx(x,{className:"text-3xl text-blue-600",children:o.active})]})}),s.jsx(T,{children:s.jsxs(m,{className:"pb-3",children:[s.jsx(v,{children:"Completed"}),s.jsx(x,{className:"text-3xl text-green-600",children:o.completed})]})})]})}function Je({loading:o,onAddTodo:e}){const[t,r]=p.useState(""),a=()=>{t.trim()&&(e(t),r(""))},i=n=>{n.key==="Enter"&&a()};return s.jsxs(T,{className:"add-todo-card",children:[s.jsxs(m,{children:[s.jsx(x,{children:"Add New Todo"}),s.jsx(v,{children:"Actions are logged to console (check DevTools)"})]}),s.jsx(_,{children:s.jsxs("div",{className:"add-todo-input-wrapper flex gap-2",children:[s.jsx(N,{placeholder:"What needs to be done?",value:t,onChange:n=>r(n.target.value),onKeyPress:i,disabled:o,className:"flex-1"}),s.jsxs(f,{onClick:a,disabled:o||!t.trim(),className:"add-todo-button",children:[o?s.jsx(ae,{className:"w-4 h-4 animate-spin"}):s.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add"]})]})})]})}function Ve({filter:o,stats:e,onSetFilter:t,onClearTodos:r}){return s.jsxs("div",{className:"filter-section flex gap-2",children:[s.jsxs(f,{variant:o==="all"?"default":"outline",size:"sm",onClick:()=>t("all"),className:"filter-button-all",children:["All (",e.total,")"]}),s.jsxs(f,{variant:o==="active"?"default":"outline",size:"sm",onClick:()=>t("active"),className:"filter-button-active",children:["Active (",e.active,")"]}),s.jsxs(f,{variant:o==="completed"?"default":"outline",size:"sm",onClick:()=>t("completed"),className:"filter-button-completed",children:["Completed (",e.completed,")"]}),e.total>0&&s.jsx(f,{variant:"destructive",size:"sm",onClick:r,className:"ml-auto clear-all-button",children:"Clear All"})]})}function Ke({todo:o,onToggle:e,onDelete:t,onUpdate:r}){const[a,i]=p.useState(!1),[n,u]=p.useState(o.text),h=()=>{i(!0),u(o.text)},y=()=>{n.trim()&&(r(o.id,n),i(!1))},w=()=>{i(!1),u(o.text)};return s.jsxs("div",{className:"todo-item flex items-center gap-3 p-3 rounded-lg border bg-card hover:bg-accent transition-colors",children:[s.jsx(se,{checked:o.status==="completed",onCheckedChange:()=>e(o.id),className:"todo-checkbox"}),a?s.jsxs("div",{className:"edit-input-wrapper flex-1 flex gap-2",children:[s.jsx(N,{value:n,onChange:d=>u(d.target.value),onKeyPress:d=>{d.key==="Enter"&&y(),d.key==="Escape"&&w()},className:"flex-1",autoFocus:!0}),s.jsx(f,{size:"sm",variant:"ghost",onClick:y,children:s.jsx(ne,{className:"w-4 h-4"})}),s.jsx(f,{size:"sm",variant:"ghost",onClick:w,children:s.jsx(ce,{className:"w-4 h-4"})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"todo-text-wrapper flex-1",children:[s.jsx("p",{className:`todo-text ${o.status==="completed"?"line-through text-muted-foreground":""}`,children:o.text}),s.jsx("p",{className:"todo-timestamp text-xs text-muted-foreground mt-1",children:new Date(o.createdAt).toLocaleString()})]}),s.jsx(f,{size:"sm",variant:"ghost",onClick:h,className:"edit-button",children:s.jsx(le,{className:"w-4 h-4"})}),s.jsx(f,{size:"sm",variant:"ghost",onClick:()=>t(o.id),className:"delete-button text-destructive hover:text-destructive",children:s.jsx(de,{className:"w-4 h-4"})})]})]})}function Me({todos:o,filter:e,error:t,onToggleTodo:r,onDeleteTodo:a,onUpdateTodo:i}){const n=()=>e==="all"?"No todos yet. Add one above!":e==="active"?"No active todos":e==="completed"?"No completed todos":"No todos",u=()=>e==="all"?"All Todos":e==="active"?"Active Todos":e==="completed"?"Completed Todos":"Todos";return s.jsxs(s.Fragment,{children:[t&&s.jsx(T,{className:"error-card border-destructive",children:s.jsx(_,{className:"pt-6",children:s.jsxs("p",{className:"text-destructive text-sm",children:["Error: ",t]})})}),s.jsxs(T,{className:"todo-list-card",children:[s.jsx(m,{children:s.jsx(x,{children:u()})}),s.jsx(_,{children:o.length===0?s.jsx("div",{className:"empty-state text-center py-8 text-muted-foreground",children:n()}):s.jsx("div",{className:"todos-list space-y-2",children:o.map(h=>s.jsx(Ke,{todo:h,onToggle:r,onDelete:a,onUpdate:i},h.id))})})]})]})}function rt(){const{todos:o,loading:e,error:t,filter:r,stats:a,addTodo:i,toggleTodo:n,deleteTodo:u,updateTodo:h,clearTodos:y,setFilter:w}=He();return s.jsxs("div",{className:"action-todo-page-container flex flex-col h-full overflow-y-auto p-6 space-y-6",children:[s.jsx(ze,{}),s.jsx(Qe,{}),s.jsx(We,{stats:a}),s.jsx(Je,{loading:e,onAddTodo:i}),s.jsx(Ve,{filter:r,stats:a,onSetFilter:w,onClearTodos:y}),s.jsx(Me,{todos:o,filter:r,error:t,onToggleTodo:n,onDeleteTodo:u,onUpdateTodo:h})]})}export{rt as ActionTodoPage};
