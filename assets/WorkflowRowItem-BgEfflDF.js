var ue=Object.defineProperty;var pe=(a,e,s)=>e in a?ue(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var P=(a,e,s)=>pe(a,typeof e!="symbol"?e+"":e,s);import{r as z,j as t}from"./react-vendor-CrhW4DYn.js";import{b3 as re,a_ as ae,a$ as oe,b0 as ne,b1 as ie,aE as fe,ao as me,ap as he,aq as ge}from"./index-CgyRe94A.js";import{O as B,a1 as V,aw as le,e as xe}from"./icons-6Gjq1X59.js";import{a as be}from"./string-4WCj7OpV.js";const X=[{value:"title",label:"Title",type:"string"},{value:"content",label:"Content",type:"string"},{value:"tags",label:"Tags",type:"tags"},{value:"x",label:"X Position",type:"number"},{value:"y",label:"Y Position",type:"number"},{value:"width",label:"Width",type:"number"},{value:"height",label:"Height",type:"number"},{value:"styles.backgroundColor",label:"Background Color",type:"string"},{value:"styles.textColor",label:"Text Color",type:"string"},{value:"styles.fontSize",label:"Font Size",type:"string"},{value:"styles.fontWeight",label:"Font Weight",type:"string"},{value:"isPinned",label:"Is Pinned",type:"boolean"}],Pe=({isVisible:a,onClose:e,allNodes:s,currentConfig:r,onSave:o,initialPosition:i,initialSize:n})=>{const[u,b]=z.useState((r==null?void 0:r.mode)||"simple"),[c,h]=z.useState(()=>r!=null&&r.simpleFieldUpdates&&r.simpleFieldUpdates.length>0?r.simpleFieldUpdates:r!=null&&r.simpleConfig?[{field:r.simpleConfig.field,template:r.simpleConfig.template}]:[{field:"content",template:"{{loop.current}}"}]),[w,v]=z.useState(()=>(r==null?void 0:r.mode)==="advanced"&&(r!=null&&r.targets)?r.targets.map(x=>({nodeId:x.nodeId,fields:Object.entries(x.updates).map(([f,d])=>({field:f,value:String(d)}))})):[]),p=()=>{h([...c,{field:"content",template:"{{loop.current}}"}])},g=x=>{c.length!==1&&h(c.filter((f,d)=>d!==x))},k=(x,f)=>{h(c.map((d,j)=>j===x?{...d,field:f}:d))},y=(x,f)=>{h(c.map((d,j)=>j===x?{...d,template:f}:d))},F=()=>{const x=c.filter(d=>d.template.trim());if(x.length===0)return;const f=s.map(d=>({nodeId:d.id,fields:x.map(({field:j,template:T})=>({field:j,value:T}))}));v(f)},U=()=>{v([...w,{nodeId:"",fields:[{field:"title",value:""}]}])},l=x=>{v(w.filter((f,d)=>d!==x))},N=(x,f)=>{const d=[...w];d[x].nodeId=f,v(d)},S=x=>{const f=[...w];f[x].fields.push({field:"title",value:""}),v(f)},O=(x,f)=>{const d=[...w];d[x].fields=d[x].fields.filter((j,T)=>T!==f),v(d)},$=(x,f,d)=>{const j=[...w];j[x].fields[f].field=d,v(j)},W=(x,f,d)=>{const j=[...w];j[x].fields[f].value=d,v(j)},C=()=>{let x=[];if(u==="simple"){const f=c.filter(d=>d.template.trim());if(f.length===0)return;x=s.map(d=>{const j={};return f.forEach(({field:T,template:I})=>{if(T.includes(".")){const m=T.split(".");let E=j;for(let _=0;_<m.length-1;_++)E[m[_]]||(E[m[_]]={}),E=E[m[_]];E[m[m.length-1]]=I}else j[T]=I}),{nodeId:d.id,updates:j}})}else if(x=w.filter(f=>f.nodeId&&f.fields.length>0).map(f=>{const d={};return f.fields.forEach(({field:j,value:T})=>{if(T)if(j.includes(".")){const I=j.split(".");let m=d;for(let E=0;E<I.length-1;E++)m[I[E]]||(m[I[E]]={}),m=m[I[E]];m[I[I.length-1]]=T}else d[j]=T}),{nodeId:f.nodeId,updates:d}}),x.length===0)return;o({mode:u,dataSource:(r==null?void 0:r.dataSource)||"row_1",targets:x,simpleFieldUpdates:u==="simple"?c:void 0}),e()};return t.jsx(re,{isVisible:a,onClose:e,title:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"Configure Node Update"}),t.jsx(ae,{children:t.jsxs(oe,{children:[t.jsx(ne,{asChild:!0,children:t.jsx(le,{size:14,className:"text-muted-foreground cursor-help"})}),t.jsx(ie,{side:"right",className:"max-w-xs",children:t.jsxs("div",{className:"text-xs space-y-1",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Loop:"})," ",t.jsx("code",{children:"{{loop.current}}"}),", ",t.jsx("code",{children:"{{loop.index}}"}),", ",t.jsx("code",{children:"{{loop.total}}"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Node:"})," ",t.jsx("code",{children:"{{node.title}}"}),", ",t.jsx("code",{children:"{{node.content}}"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Lookup:"})," ",t.jsx("code",{children:"{{source[node.title]}}"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Methods:"})," ",t.jsx("code",{children:"{{node.title.toLowerCase()}}"}),", ",t.jsx("code",{children:".toUpperCase()"}),", ",t.jsx("code",{children:".trim()"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Combined:"})," ",t.jsx("code",{children:"{{source[node.title.toLowerCase()]}}"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Tags:"})," Comma-separated values are split into array"]})]})})]})})]}),shouldCloseManually:!0,resizable:!0,initialSize:n||{width:500,height:400},triggerPosition:i,children:t.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[t.jsxs("div",{className:"flex border-b border-border",children:[t.jsx("button",{onClick:()=>b("simple"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors ${u==="simple"?"border-b-2 border-primary text-primary bg-accent/50":"text-muted-foreground hover:text-foreground hover:bg-accent/30"}`,children:"Simple"}),t.jsx("button",{onClick:()=>b("advanced"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors ${u==="advanced"?"border-b-2 border-primary text-primary bg-accent/50":"text-muted-foreground hover:text-foreground hover:bg-accent/30"}`,children:"Advanced"})]}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-4",children:u==="simple"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:["Update the same fields across ",t.jsx("strong",{children:"all nodes"})," (",s.length," nodes)"]}),c.map((x,f)=>t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"flex gap-3 items-end",children:[t.jsxs("div",{className:"w-1/3",children:[f===0&&t.jsx("label",{className:"text-sm font-medium block mb-2",children:"Field to Update"}),t.jsx("select",{value:x.field,onChange:d=>k(f,d.target.value),className:"w-full text-sm border border-border rounded px-3 py-2 bg-background",children:X.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))})]}),t.jsxs("div",{className:"w-2/3",children:[f===0&&t.jsx("label",{className:"text-sm font-medium block mb-2",children:"Template Value"}),t.jsx("input",{type:"text",value:x.template,onChange:d=>y(f,d.target.value),placeholder:"e.g., {{loop.current}} or New: {{loop.current}}",className:"w-full text-sm border border-border rounded px-3 py-2 bg-background"})]}),c.length>1&&t.jsx("button",{onClick:()=>g(f),className:"p-2 rounded hover:bg-destructive/10 text-destructive mb-0.5",title:"Remove field",children:t.jsx(B,{size:16})})]})},f)),t.jsxs("button",{onClick:p,className:"w-full text-sm flex items-center justify-center gap-2 py-2 border border-dashed border-border rounded hover:bg-accent",children:[t.jsx(V,{size:16})," Add Field"]})]}):t.jsxs(t.Fragment,{children:[w.length===0&&c.some(x=>x.template.trim())&&t.jsxs("div",{className:"bg-muted/50 border border-border rounded-lg p-3",children:[t.jsxs("div",{className:"text-sm mb-2",children:[t.jsx("strong",{children:"Start from Simple Mode?"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Import ",c.filter(x=>x.template.trim()).length," field update(s) for all ",s.length," nodes"]})]}),t.jsxs("button",{onClick:F,className:"w-full text-sm flex items-center justify-center gap-2 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:[t.jsx(V,{size:16})," Import from Simple Mode"]})]}),w.map((x,f)=>t.jsxs("div",{className:"border border-border rounded-lg p-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm font-semibold",children:["Target ",f+1]}),t.jsx("button",{onClick:()=>l(f),className:"p-1 rounded hover:bg-destructive/10 text-destructive",title:"Remove target",children:t.jsx(B,{size:14})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium block mb-1",children:"Node"}),t.jsxs("select",{value:x.nodeId,onChange:d=>N(f,d.target.value),className:"w-full text-sm border border-border rounded px-2 py-1 bg-background",children:[t.jsx("option",{value:"",children:"Select node..."}),s.map(d=>t.jsx("option",{value:d.id,children:d.title||d.id},d.id))]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium block",children:"Fields to Update"}),x.fields.map((d,j)=>t.jsxs("div",{className:"flex gap-2",children:[t.jsx("select",{value:d.field,onChange:T=>$(f,j,T.target.value),className:"flex-1 text-xs border border-border rounded px-2 py-1 bg-background",children:X.map(T=>t.jsx("option",{value:T.value,children:T.label},T.value))}),t.jsx("input",{type:"text",value:d.value,onChange:T=>W(f,j,T.target.value),placeholder:"Value or template",className:"flex-1 text-xs border border-border rounded px-2 py-1 bg-background"}),t.jsx("button",{onClick:()=>O(f,j),className:"p-1 rounded hover:bg-destructive/10 text-destructive",title:"Remove field",disabled:x.fields.length===1,children:t.jsx(B,{size:14})})]},j)),t.jsxs("button",{onClick:()=>S(f),className:"text-xs flex items-center gap-1 text-primary hover:underline",children:[t.jsx(V,{size:12})," Add Field"]})]})]},f)),t.jsxs("button",{onClick:U,className:"w-full text-sm flex items-center justify-center gap-2 py-2 border border-dashed border-border rounded hover:bg-accent",children:[t.jsx(V,{size:16})," Add Target Node"]})]})}),t.jsxs("div",{className:"border-t border-border p-3 flex justify-end gap-2",children:[t.jsx("button",{"data-test":"node-update-config-cancel-button",onClick:e,className:"px-3 py-1.5 text-sm border border-border rounded hover:bg-accent",children:"Cancel"}),t.jsx("button",{"data-test":"node-update-config-save-button",onClick:C,className:"px-3 py-1.5 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"Save"})]})]})})},ye=[{value:"title",label:"Title",type:"string"},{value:"content",label:"Content",type:"string"},{value:"x",label:"X Position",type:"number"},{value:"y",label:"Y Position",type:"number"},{value:"width",label:"Width",type:"number"},{value:"height",label:"Height",type:"number"},{value:"isPinned",label:"Is Pinned",type:"boolean"}],Q=[{value:"equals",label:"Equals",description:"Exact match (===)",group:"comparison"},{value:"notEquals",label:"Not Equals",description:"Not an exact match (!==)",group:"comparison"},{value:"contains",label:"Contains",description:"Field includes the value",group:"comparison"},{value:"notContains",label:"Not Contains",description:"Field does not include the value",group:"comparison"},{value:"greaterThan",label:"Greater Than",description:"Numeric comparison (>)",group:"comparison"},{value:"lessThan",label:"Less Than",description:"Numeric comparison (<)",group:"comparison"},{value:"greaterThanOrEqual",label:"Greater Or Equal",description:"Numeric comparison (>=)",group:"comparison"},{value:"lessThanOrEqual",label:"Less Or Equal",description:"Numeric comparison (<=)",group:"comparison"},{value:"matches",label:"Matches",description:"Field matches regex pattern (use /pattern/)",group:"regex"},{value:"notMatches",label:"Not Matches",description:"Field does not match regex pattern",group:"regex"},{value:"matchAndRemove",label:"Match & Remove",description:"Remove regex match, result in {{if.result}}",group:"regex"}],ve=[{id:"comparison",label:"Comparison"},{id:"regex",label:"Regex"}],We=({isVisible:a,onClose:e,currentConfig:s,onSave:r,initialPosition:o,initialSize:i})=>{var p;const[n,u]=z.useState((s==null?void 0:s.field)||"title"),[b,c]=z.useState((s==null?void 0:s.operator)||"equals"),[h,w]=z.useState((s==null?void 0:s.expectedValue)||""),v=()=>{if(!h.trim())return;r({field:n,operator:b,expectedValue:h}),e()};return t.jsx(re,{isVisible:a,onClose:e,title:t.jsxs("div",{"data-test":"if-step-config-title",className:"flex items-center gap-2",children:[t.jsx("span",{children:"Configure If Condition"}),t.jsx(ae,{children:t.jsxs(oe,{children:[t.jsx(ne,{asChild:!0,children:t.jsx(le,{"data-test":"if-step-config-info-icon",size:14,className:"text-muted-foreground cursor-help"})}),t.jsx(ie,{side:"right",className:"max-w-xs","data-test":"if-step-config-tooltip",children:t.jsxs("div",{className:"text-xs space-y-1",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Templates:"})," Use ",t.jsx("code",{children:"{{users}}"}),", ",t.jsx("code",{children:"{{count}}"})," in expected value"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Example:"})," title contains ",t.jsx("code",{children:"{{loop.current}}"})]})]})})]})})]}),shouldCloseManually:!0,resizable:!0,initialSize:i||{width:400,height:320},triggerPosition:o,children:t.jsxs("div",{"data-test":"if-step-config-container",className:"flex flex-col flex-1 h-full overflow-scroll",children:[t.jsxs("div",{"data-test":"if-step-config-content",className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-4",children:[t.jsx("div",{"data-test":"if-step-config-info-banner",className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:"Check if a field meets a specific condition"}),t.jsxs("div",{"data-test":"if-step-config-field-section",children:[t.jsx("label",{"data-test":"if-step-config-field-label",className:"text-sm font-medium block mb-2",children:"Field to Check"}),t.jsx("select",{"data-test":"if-step-config-field-select",value:n,onChange:g=>u(g.target.value),className:"w-full text-sm border border-border rounded px-3 py-2 bg-background",children:ye.map(g=>t.jsx("option",{value:g.value,"data-test":`if-step-config-field-option-${g.value}`,children:g.label},g.value))})]}),t.jsxs("div",{"data-test":"if-step-config-operator-section",children:[t.jsx("label",{"data-test":"if-step-config-operator-label",className:"text-sm font-medium block mb-2",children:"Operator"}),t.jsx("select",{"data-test":"if-step-config-operator-select",value:b,onChange:g=>c(g.target.value),className:"w-full text-sm border border-border rounded px-3 py-2 bg-background",children:ve.map(g=>t.jsx("optgroup",{label:g.label,"data-test":`if-step-config-operator-group-${g.id}`,children:Q.filter(k=>k.group===g.id).map(k=>t.jsx("option",{value:k.value,"data-test":`if-step-config-operator-option-${k.value}`,children:k.label},k.value))},g.id))}),t.jsx("p",{"data-test":"if-step-config-operator-description",className:"text-xs text-muted-foreground mt-1",children:(p=Q.find(g=>g.value===b))==null?void 0:p.description})]}),t.jsxs("div",{"data-test":"if-step-config-value-section",children:[t.jsx("label",{"data-test":"if-step-config-value-label",className:"text-sm font-medium block mb-2",children:"Operator Value"}),t.jsx("input",{"data-test":"if-step-config-value-input",type:"text",value:h,onChange:g=>w(g.target.value),placeholder:"e.g., {{users}}, Alice, or /pattern/",className:"w-full text-sm border border-border rounded px-3 py-2 bg-background"}),t.jsxs("p",{"data-test":"if-step-config-value-hint",className:"text-xs text-muted-foreground mt-1",children:["Supports templates ","{{users}}",", ","{{count}}",", ","{{loop.current}}"," and regex /pattern/"]})]})]}),t.jsxs("div",{"data-test":"if-step-config-footer",className:"border-t border-border p-3 flex justify-end gap-2",children:[t.jsx("button",{"data-test":"if-step-config-cancel-button",onClick:e,className:"px-3 py-1.5 text-sm border border-border rounded hover:bg-accent",children:"Cancel"}),t.jsx("button",{"data-test":"if-step-config-save-button",onClick:v,className:"px-3 py-1.5 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-primary",disabled:!h.trim(),children:"Save"})]})]})})};class J{static toWorkflowNode(e,s){const r=e.data,o=(r==null?void 0:r.nodeType)||this.CANVAS_TYPE_TO_NODE_TYPE[e.type]||"unknown",i={...(r==null?void 0:r.parameters)||{}};e.content&&(i._nodeContent=e.content);let n=(r==null?void 0:r.inputHandles)||[],u=(r==null?void 0:r.outputHandles)||[];if(s){const b=s.get(o);b&&(b.inputs&&(n=b.inputs.map(c=>({id:c.id,name:c.name,type:"input",dataType:c.dataType}))),b.outputs&&(u=b.outputs.map(c=>({id:c.id,name:c.name,type:"output",dataType:c.dataType}))))}return{id:e.id,type:o,parameters:i,inputHandles:n,outputHandles:u,executionState:r==null?void 0:r.executionState,executionData:r==null?void 0:r.executionData}}static toWorkflowNodes(e,s){return e.filter(r=>{const o=r.data,i=o&&o.nodeType&&o.nodeType!=="unknown",n=this.CANVAS_TYPE_TO_NODE_TYPE[r.type]!==void 0;return i||n}).map(r=>this.toWorkflowNode(r,s))}static toWorkflowConnection(e){const s=e.startNodeId||"",r=e.endNodeId||"";let o;if(e.endRowId)o=`input_${e.endRowId}`;else if(e.label){const i=e.label.match(/step\s+(\d+)/i);i?o=`input_row_${i[1]}`:o=`handle-${r}-in`}else o=`handle-${r}-in`;return{id:e.id,sourceNodeId:s,sourceHandleId:`handle-${s}-out`,targetNodeId:r,targetHandleId:o,isValid:!0,dataType:"any"}}static toWorkflowConnections(e){const s=new Map;return e.forEach(r=>{const o=r.endNodeId||"";s.has(o)||s.set(o,[]),s.get(o).push(r)}),e.map(r=>{const o=r.startNodeId||"",i=r.endNodeId||"";let n=`handle-${i}-in`;if(r.endRowId)n=`input_${r.endRowId}`;else if(r.label){const u=r.label.match(/step\s+(\d+)/i);u?n=`input_row_${u[1]}`:n=`handle-${i}-in`}else{const u=s.get(i)||[];if(u.findIndex(c=>c.id===r.id)>=0){const c=new Set;u.forEach(w=>{if(w.label){const v=w.label.match(/step\s+(\d+)/i);v&&c.add(parseInt(v[1]))}});let h=1;for(const w of u)if(!(w.label&&w.label.match(/step\s+(\d+)/i))){for(;c.has(h);)h++;if(w.id===r.id){n=`input_row_${h}`;break}c.add(h),h++}}else n=`handle-${i}-in`}return{id:r.id,sourceNodeId:o,sourceHandleId:`handle-${o}-out`,targetNodeId:i,targetHandleId:n,isValid:!0,dataType:"any"}})}static fromWorkflowNode(e,s){return{id:e.id,x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,type:fe.RECT,data:{nodeType:e.type,parameters:e.parameters,inputHandles:e.inputHandles,outputHandles:e.outputHandles,executionState:e.executionState,executionData:e.executionData}}}static fromWorkflowConnection(e){return{id:e.id,startNodeId:e.sourceNodeId,endNodeId:e.targetNodeId,startPoint:{x:0,y:0},endPoint:{x:0,y:0}}}}P(J,"CANVAS_TYPE_TO_NODE_TYPE",{WORKFLOW_SOURCE:"workflowSource",WORKFLOW_ORCHESTRATION:"workflowOrchestration"});class we{constructor(){P(this,"definitions",new Map)}register(e){this.definitions.set(e.type,e)}get(e){return this.definitions.get(e)}getAll(){return Array.from(this.definitions.values())}getByCategory(e){return this.getAll().filter(s=>s.category===e)}search(e){if(!e||e.trim()==="")return[];const s=e.toLowerCase();return this.getAll().filter(r=>{var o;return!!(r.name.toLowerCase().includes(s)||r.description.toLowerCase().includes(s)||(o=r.tags)!=null&&o.some(i=>i.toLowerCase().includes(s)))})}has(e){return this.definitions.has(e)}unregister(e){this.definitions.delete(e)}clear(){this.definitions.clear()}}class Ne{constructor(e="workflow-executions"){P(this,"storageKey");this.storageKey=e}async save(e){const s=await this.loadAll();s[e.id]=this.serializeExecution(e),this.saveAll(s)}async get(e){const r=(await this.loadAll())[e];return r?this.deserializeExecution(r):null}async listByWorkflow(e,s){const r=await this.loadAll(),o=Object.values(r).filter(i=>i.workflowId===e).map(i=>this.deserializeExecution(i)).sort((i,n)=>new Date(n.startTime).getTime()-new Date(i.startTime).getTime());return s?o.slice(0,s):o}async listRecent(e){const s=await this.loadAll(),r=Object.values(s).map(o=>this.deserializeExecution(o)).sort((o,i)=>new Date(i.startTime).getTime()-new Date(o.startTime).getTime());return e?r.slice(0,e):r}async delete(e){const s=await this.loadAll();delete s[e],this.saveAll(s)}async deleteByWorkflow(e){const s=await this.loadAll(),r=Object.entries(s).filter(([o,i])=>i.workflowId!==e).reduce((o,[i,n])=>({...o,[i]:n}),{});this.saveAll(r)}async clear(){localStorage.removeItem(this.storageKey)}async loadAll(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to load executions from localStorage:",e),{}}}saveAll(e){try{const s=JSON.stringify(e);localStorage.setItem(this.storageKey,s)}catch(s){throw console.error("Failed to save executions to localStorage:",s),new Error("Failed to save executions: localStorage quota may be exceeded")}}serializeExecution(e){return{...e,nodeExecutions:e.nodeExecutions?Array.from(e.nodeExecutions.entries()):[]}}deserializeExecution(e){return{...e,nodeExecutions:new Map(Array.isArray(e.nodeExecutions)?e.nodeExecutions:[])}}}class Se{constructor(e,s){this.nodeRegistry=e,this.executionStore=s}async executeWorkflow(e,s,r,o){const i={workflowId:this.generateId("workflow"),executionId:this.generateId("execution"),startTime:new Date().toISOString(),status:"running",executionData:new Map,errors:[],allCanvasNodes:r};try{if(e.length===0)return i.status="completed",i;const n=this.findTriggerNode(e,o),u=this.computeExecutionOrder(e,s,n);return await this.executeNodesInOrder(u,s,i),i.errors.length===0?i.status="completed":i.status="failed",await this.saveExecutionRecord(i,e),i}catch(n){return i.status="failed",i.errors.push({nodeId:i.currentNodeId||"unknown",message:n instanceof Error?n.message:String(n),timestamp:new Date().toISOString(),stack:n instanceof Error?n.stack:void 0}),i}}findTriggerNode(e,s){if(s){const o=e.find(i=>i.id===s);if(!o)throw new Error(`Specified trigger node '${s}' not found`);return o}const r=e.filter(o=>{const i=this.nodeRegistry.get(o.type);return(i==null?void 0:i.category)==="trigger"});if(r.length===0){const o=e.filter(i=>{const n=this.nodeRegistry.get(i.type);return(n==null?void 0:n.type)==="workflowOrchestration"});if(o.length===0)throw new Error("No trigger node found in workflow");if(o.length>1)throw new Error("Multiple orchestration nodes found - specify which one to execute");return o[0]}if(r.length>1)throw new Error("Multiple trigger nodes found in workflow");return r[0]}computeExecutionOrder(e,s,r){const o=new Map,i=new Map;e.forEach(p=>{o.set(p.id,[]),i.set(p.id,[])}),s.forEach(p=>{const g=o.get(p.sourceNodeId)||[];g.push(p.targetNodeId),o.set(p.sourceNodeId,g);const k=i.get(p.targetNodeId)||[];k.push(p.sourceNodeId),i.set(p.targetNodeId,k)});const n=new Set,u=[r.id],b=new Set;for(;u.length>0;){const p=u.shift();if(b.has(p))continue;b.add(p),n.add(p),(i.get(p)||[]).forEach(k=>{b.has(k)||u.push(k)})}const c=new Map;n.forEach(p=>{c.set(p,0)}),s.forEach(p=>{n.has(p.sourceNodeId)&&n.has(p.targetNodeId)&&c.set(p.targetNodeId,(c.get(p.targetNodeId)||0)+1)});const h=[];n.forEach(p=>{c.get(p)===0&&h.push(p)});const w=[],v=new Set;for(;h.length>0;){const p=h.shift();if(v.has(p))continue;v.add(p);const g=e.find(y=>y.id===p);if(!g)continue;w.push(g),(o.get(p)||[]).forEach(y=>{if(!n.has(y))return;const F=c.get(y)||0;c.set(y,F-1),c.get(y)===0&&!v.has(y)&&h.push(y)})}if(v.size<n.size)throw new Error("Circular dependency detected in workflow");return w}async executeNodesInOrder(e,s,r){var o;for(const i of e){r.currentNodeId=i.id;try{const n=this.nodeRegistry.get(i.type);if(!n)throw new Error(`Node type '${i.type}' not found in registry`);const u=this.getInputDataForNode(i,s,r),b=await n.executor(i,u,r);r.executionData.set(i.id,b)}catch(n){const u={nodeId:i.id,message:n instanceof Error?n.message:String(n),timestamp:new Date().toISOString(),stack:n instanceof Error?n.stack:void 0};if(r.errors.push(u),!((o=i.parameters)!=null&&o.continueOnError))break}}}getInputDataForNode(e,s,r){const o=s.filter(u=>u.targetNodeId===e.id);if(o.length===0)return null;const i=e.inputHandles&&e.inputHandles.length>1;if(o.length===1&&!i){const u=o[0];return r.executionData.get(u.sourceNodeId)}const n=new Map;return o.forEach(u=>{const b=r.executionData.get(u.sourceNodeId);b!==void 0&&n.set(u.targetHandleId,{_sourceNodeId:u.sourceNodeId,_data:b})}),n}async saveExecutionRecord(e,s){const r={id:e.executionId,workflowId:e.workflowId,startTime:e.startTime,endTime:new Date().toISOString(),duration:Date.now()-new Date(e.startTime).getTime(),status:e.status,nodeExecutions:new Map,errors:e.errors};s.forEach(o=>{const i=e.executionData.get(o.id);i!==void 0&&r.nodeExecutions.set(o.id,{nodeId:o.id,nodeType:o.type,startTime:e.startTime,endTime:new Date().toISOString(),status:"success",input:{},output:i})}),await this.executionStore.save(r)}generateId(e){return`${e}-${Date.now()}-${Math.random().toString(36).substring(7)}`}}const je={type:"manualTrigger",category:"trigger",name:"Manual Trigger",description:"Manually start the workflow with a button click",parameters:[{name:"label",displayName:"Button Label",type:"string",required:!1,default:"Execute Workflow",placeholder:"Enter button label",description:"Label for the trigger button"}],inputs:[],outputs:[{id:"output_main",name:"Trigger Output",dataType:"object",required:!1}],executor:async(a,e,s)=>{const o={value:a.parameters._nodeContent||"",timestamp:new Date().toISOString(),executionId:s.executionId,triggeredBy:"manual"};return a.parameters.label&&(o.label=a.parameters.label),o},version:1,author:"System"},Te={type:"textInput",category:"data",name:"Text Input",description:"Collect text input from user",version:1,parameters:[{name:"label",displayName:"Input Label",type:"string",required:!0,default:"Enter text",description:"Label shown to the user"},{name:"placeholder",displayName:"Placeholder",type:"string",required:!1,default:"",description:"Placeholder text in input field"},{name:"defaultValue",displayName:"Default Value",type:"string",required:!1,default:"",description:"Pre-filled value"}],inputs:[{id:"input_main",name:"Trigger",dataType:"any",required:!1}],outputs:[{id:"output_main",name:"User Input",dataType:"string",required:!0}],executor:async(a,e,s)=>({value:a.parameters._nodeContent||a.parameters.defaultValue||"John Doe",label:a.parameters.label,timestamp:new Date().toISOString()})},Ie={type:"textOutput",category:"data",name:"Text Output",description:"Display formatted text output",version:1,parameters:[{name:"template",displayName:"Output Template",type:"string",required:!1,default:"Result: {{input}}",description:"Template for output. Use {{input}} for input data"}],inputs:[{id:"input_main",name:"Data",dataType:"any",required:!0}],outputs:[{id:"output_main",name:"Formatted Output",dataType:"string",required:!0}],executor:async(a,e,s)=>{let o=a.parameters.template||"Result: {{input}}";if(e&&typeof e=="object"){const i=e.value||e.formattedOutput||e.output||e.label||JSON.stringify(e);o=o.replace(/\{\{input\}\}/g,i)}else o=o.replace(/\{\{input\}\}/g,String(e||""));return{output:o,formattedOutput:o,timestamp:new Date().toISOString()}}},Ee={type:"workflowSource",category:"data",name:"Workflow Source",description:"Provide static data as workflow source",version:1,parameters:[{name:"displayFormat",displayName:"Display Format",type:"string",required:!1,default:"json",description:"How to display the data (json, text)"}],inputs:[],outputs:[{id:"output_main",name:"Source Data",dataType:"object",required:!0}],executor:async(a,e,s)=>{const r=a.parameters._nodeContent||"";let o;try{o=JSON.parse(r)}catch{o=r}return{value:r,output:o,timestamp:new Date().toISOString()}}},ee=["workflowOrchestration","workflowSource","WORKFLOW_ORCHESTRATION","WORKFLOW_SOURCE"];function de(a){var r;const e=a.type,s=(r=a.data)==null?void 0:r.nodeType;return ee.includes(e)||ee.includes(s)}function Y(a){return a.filter(e=>!de(e))}const te={toLowerCase:{args:0,fn:a=>a.toLowerCase()},toUpperCase:{args:0,fn:a=>a.toUpperCase()},trim:{args:0,fn:a=>a.trim()},trimStart:{args:0,fn:a=>a.trimStart()},trimEnd:{args:0,fn:a=>a.trimEnd()},toString:{args:0,fn:a=>String(a)},length:{args:0,fn:a=>a.length},capitalize:{args:0,fn:a=>a.charAt(0).toUpperCase()+a.slice(1)},trimSymbolsLight:{args:0,fn:a=>{const e=/^[\s.,!?;:\-_@#$%^&*()[\]{}<>/\\|~`+'"]+|[\s.,!?;:\-_@#$%^&*()[\]{}<>/\\|~`+'"]+$/g;return a.replace(e,"").trim()}},trimSymbolsStrict:{args:0,fn:a=>{const e=/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g;return a.replace(e,"").trim()}},charAt:{args:1,fn:(a,e)=>a.charAt(parseInt(e,10)||0)},split:{args:1,fn:(a,e)=>a.split(e)},startsWith:{args:1,fn:(a,e)=>a.startsWith(e)},endsWith:{args:1,fn:(a,e)=>a.endsWith(e)},includes:{args:1,fn:(a,e)=>a.includes(e)},indexOf:{args:1,fn:(a,e)=>a.indexOf(e)},padStart:{args:1,fn:(a,e)=>a.padStart(parseInt(e,10)||0)},padEnd:{args:1,fn:(a,e)=>a.padEnd(parseInt(e,10)||0)},repeat:{args:1,fn:(a,e)=>a.repeat(parseInt(e,10)||0)},slice:{args:2,fn:(a,e,s)=>a.slice(parseInt(e,10)||0,s?parseInt(s,10):void 0)},substring:{args:2,fn:(a,e,s)=>a.substring(parseInt(e,10)||0,s?parseInt(s,10):void 0)},replace:{args:2,fn:(a,e,s)=>a.replace(e,s||"")},padStartWith:{args:2,fn:(a,e,s)=>a.padStart(parseInt(e,10)||0,s||" ")},padEndWith:{args:2,fn:(a,e,s)=>a.padEnd(parseInt(e,10)||0,s||" ")}};function ce(a,e,s,r,o){a=a.trim();const i={loop:e||{},source:s||{},if:r||{},node:o||{}};try{let n=i,u=a;for(;u.length>0;){const b=u.match(/^\.([a-zA-Z_][a-zA-Z0-9_]*)\(([^)]*)\)/);if(b){const h=b[1],w=b[2];if(te[h]){const v=te[h],p=w?w.split(",").map(k=>k.trim()):[],g=n==null?"":String(n);try{n=v.fn(g,...p)}catch{}}u=u.slice(b[0].length);continue}const c=u.match(/^\.?([a-zA-Z_][a-zA-Z0-9_]*)/);if(c){const h=c[1];n=n==null?void 0:n[h],u=u.slice(c[0].length);continue}if(u.startsWith("[")){let h=0,w=-1;for(let p=0;p<u.length;p++)if(u[p]==="["&&h++,u[p]==="]"&&(h--,h===0)){w=p;break}if(w===-1)break;const v=u.slice(1,w);if(/^\d+$/.test(v)){const p=parseInt(v,10);n=n==null?void 0:n[p]}else{const p=ce(v,e,s,r,o);n=n==null?void 0:n[p]}u=u.slice(w+1);continue}break}return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}catch{return""}}function H(a,e,s,r,o){return a?a.replace(/\{\{([^}]+)\}\}/g,(n,u)=>ce(u,e,s,r,o)):""}function G(a,e,s,r,o){if(typeof a=="string")return H(a,e,s,r,o);if(Array.isArray(a))return a.map(i=>G(i,e,s,r,o));if(a&&typeof a=="object"){const i={};for(const n in a)i[n]=G(a[n],e,s,r,o);return i}return a}function ke(){return`tag_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Oe(a){return!a||typeof a!="string"?[]:a.split(/,\s*/).map(e=>e.trim()).filter(e=>e.length>0).map(e=>({id:ke(),title:e}))}function se(a){const e={};for(const[s,r]of Object.entries(a))s==="tags"&&typeof r=="string"?e[s]=Oe(r):e[s]=r;return e}const _e={type:"workflowOrchestration",category:"logic",name:"Workflow",description:"Orchestrate multiple inputs in a specific order",version:1,parameters:[{name:"rows",displayName:"Workflow Steps",type:"json",required:!1,default:[{id:"row_1",label:"Step 1",order:1},{id:"row_2",label:"Step 2",order:2}],description:"Define workflow steps and their order"}],inputs:[{id:"input_row_1",name:"Step 1 Input",dataType:"any",required:!1},{id:"input_row_2",name:"Step 2 Input",dataType:"any",required:!1}],outputs:[{id:"output_main",name:"Combined Output",dataType:"object",required:!0}],executor:async(a,e,s)=>{const r=a.parameters.rows||[{id:"row_1",label:"Step 1",order:1},{id:"row_2",label:"Step 2",order:2}];let o;e instanceof Map?o=e:e&&typeof e=="object"?o=new Map(Object.entries(e)):o=new Map;function i(l){const N=[];return l.forEach(S=>{N.push(S),S.children&&Array.isArray(S.children)&&N.push(...i(S.children))}),N}const n=i(r),u=[];n.forEach(l=>{const N=`input_${l.id}`,S=o.get(N);if(S!==void 0||["nodeUpdate","if","loop"].includes(l.stepType)){const $=S==null?void 0:S._sourceNodeId,W=(S==null?void 0:S._data)!==void 0?S._data:S;u.push({label:l.label,data:W,order:l.order,sourceNodeId:$,stepType:l.stepType||"empty",config:l.config})}}),u.sort((l,N)=>l.order-N.order);const b=u.find(l=>l.stepType==="source");let c=[],h;if(b){const l=typeof b.data=="object"&&b.data!==null?b.data.value||b.data.output||b.data.formattedOutput||b.data:String(b.data);if(typeof l=="string")try{const N=JSON.parse(l);h=N,Array.isArray(N)?c=N:c=Object.values(N)}catch{l.includes(`
`)?c=l.split(`
`).filter(N=>N.trim()):c=[l]}else Array.isArray(l)?c=l:typeof l=="object"&&l!==null?(h=l,c=Object.values(l)):c=[l]}let w=null,v=null,p=new Map;const g=u.map(l=>{if(w===!1&&l.stepType!=="if")return{...l,skipped:!0,skipReason:"if_condition_false"};if(l.stepType==="source")return{...l,sourceData:c,sourceCount:c.length};if(l.stepType==="loop"){const N=c.length>0?c:[];return N.length===0&&u.forEach(S=>{if(S.order!==l.order&&S.stepType!=="source"){const O=typeof S.data=="object"&&S.data!==null?S.data.value||S.data.output||S.data.formattedOutput||JSON.stringify(S.data):String(S.data);N.push(O)}}),{...l,loopValues:N,loopCount:N.length}}if(l.stepType==="if"){const N=l.config||{},{field:S,operator:O,expectedValue:$}=N,W=c.length>0?{current:c[0],index:1,total:c.length,values:c}:void 0,C=H($||"",W,h);let x=!1,f=[];s.allCanvasNodes&&Array.isArray(s.allCanvasNodes)&&Y(s.allCanvasNodes).forEach(T=>{let I;S&&S.includes(".")?I=S.split(".").reduce((A,D)=>A==null?void 0:A[D],T):I=T[S];let m=!1;const E=String(I??""),_=String(C);switch(O){case"equals":m=E===_;break;case"notEquals":m=E!==_;break;case"contains":m=E.includes(_);break;case"notContains":m=!E.includes(_);break;case"matches":case"notMatches":case"matchAndRemove":const R=C.match(/^\/(.+)\/([gimsuvy]*)$/);if(R)try{const A=R[1],D=R[2],M=new RegExp(A,D),q=E.match(M),K=q!==null;if(O==="matchAndRemove"){if(m=K,m){const Z=E.replace(M,"").trim(),L=p.get(T.id);p.set(T.id,{capture:(L==null?void 0:L.capture)||(q?Array.from(q):[]),result:Z})}}else if(m=O==="matches"?K:!K,m&&q&&/\((?!\?)/.test(A)){const L=p.get(T.id);p.set(T.id,{capture:Array.from(q),result:L==null?void 0:L.result})}}catch{m=!1}else if(O==="matchAndRemove"){if(m=E.includes(C),m){const A=E.split(C).join("").trim(),D=p.get(T.id);p.set(T.id,{capture:(D==null?void 0:D.capture)||[],result:A})}}else{const A=E.includes(C);m=O==="matches"?A:!A}break;case"greaterThan":m=Number(I)>Number(C);break;case"lessThan":m=Number(I)<Number(C);break;case"greaterThanOrEqual":m=Number(I)>=Number(C);break;case"lessThanOrEqual":m=Number(I)<=Number(C);break;default:m=!1}m&&(x=!0),f.push({nodeId:T.id,fieldValue:I,matches:m})}),w=x;const d=f.filter(j=>j.matches);return v=d.length>0?new Set(d.map(j=>j.nodeId)):null,{...l,conditionResult:x,checkedNodes:f,config:{...N,evaluatedExpectedValue:C}}}if(l.stepType==="nodeUpdate"){const N=l.config||{},S=l.order>=10,O=[],C=(N.simpleFieldUpdates||[]).some(f=>f.template&&/\{\{[^}]*node\.[^}]+\}\}/.test(f.template))?Y(s.allCanvasNodes||[]):c.length>0?c:Y(s.allCanvasNodes||[]),x=S&&C.length>0?C.length:1;for(let f=0;f<x;f++){const d=C.length>0?{current:C[f],index:f+1,total:C.length,values:C}:void 0;s.allCanvasNodes&&Array.isArray(s.allCanvasNodes)&&Y(s.allCanvasNodes).forEach(m=>{if(v&&!v.has(m.id))return;const E=p.has(m.id)?p.get(m.id):void 0,_={};let R=!1;if(m.title&&typeof m.title=="string"&&/\{\{[^}]+\}\}/.test(m.title)){const D=H(m.title,d,h,E,m);_.title=D,R=!0}m.content&&typeof m.content=="string"&&/\{\{[^}]+\}\}/.test(m.content)&&(_.content=H(m.content,d,h,E,m),R=!0),R&&O.push({nodeId:m.id,updates:_})});const j=N.simpleFieldUpdates||[];if(j.length>0&&d&&d.current&&d.current.id){const I=p.has(d.current.id)?p.get(d.current.id):void 0,m={};j.forEach(R=>{const{field:A,template:D}=R,M=H(D,d,h,I,d.current);m[A]=M});const E=se(m),_=O.find(R=>R.nodeId===d.current.id);_?Object.assign(_.updates,E):O.push({nodeId:d.current.id,updates:E})}(N.targets||[]).forEach(I=>{var D;if(d&&d.current&&d.current.id&&I.nodeId!==d.current.id||v&&!v.has(I.nodeId))return;const m=p.has(I.nodeId)?p.get(I.nodeId):void 0,E=(D=s.allCanvasNodes)==null?void 0:D.find(M=>M.id===I.nodeId),_=O.find(M=>M.nodeId===I.nodeId),R=G(I.updates,d,h,m,E),A=se(R);_?Object.assign(_.updates,A):O.push({nodeId:I.nodeId,updates:A})})}return{...l,nodeUpdates:O,loopContext:void 0}}return l}),k=[];g.forEach(l=>{if(l.stepType==="nodeUpdate"&&"nodeUpdates"in l&&!("skipped"in l)){const N=l.nodeUpdates.filter(S=>{var $;const O=($=s.allCanvasNodes)==null?void 0:$.find(W=>W.id===S.nodeId);return O?!de(O):!0});k.push(...N)}});const y={steps:g,stepCount:g.length,timestamp:new Date().toISOString(),sourceData:c,hasSource:c.length>0,nodeUpdates:k},F=g.map(l=>{const N=l.sourceNodeId?` ← ${l.sourceNodeId}`:" (not connected)";return`${l.label}${N}`}).join(`
`),U=g.map(l=>l.stepType==="source"&&"sourceData"in l?`Source: ${l.sourceCount} items
${l.sourceData.join(`
`)}`:l.stepType==="loop"&&"loopValues"in l?l.loopValues.map((S,O)=>`[${O+1}] ${S}`).join(`
`):typeof l.data=="object"&&l.data!==null?l.data.value||l.data.output||l.data.formattedOutput||JSON.stringify(l.data):String(l.data)).join(`
`);return{...y,rowConnections:F,formattedOutput:U}}};class Me{constructor(){P(this,"nodes",[]);P(this,"arrows",[]);P(this,"nodeRegistry");P(this,"executionStore");P(this,"executionService");this.nodeRegistry=new we,this.executionStore=new Ne,this.executionService=new Se(this.nodeRegistry,this.executionStore),this.registerDefaultNodes()}registerDefaultNodes(){this.nodeRegistry.register(je),this.nodeRegistry.register(Te),this.nodeRegistry.register(Ie),this.nodeRegistry.register(Ee),this.nodeRegistry.register(_e)}loadWorkflow(e,s){this.nodes=e,this.arrows=s}async executeWorkflow(e){var r;const s=Date.now();try{const o=J.toWorkflowNodes(this.nodes,this.nodeRegistry),i=J.toWorkflowConnections(this.arrows),n=await this.executionService.executeWorkflow(o,i,this.nodes,e),u=this.buildNodeStates(n,o);let b=[];const c=Array.from(u.entries()).find(([h,w])=>{const v=o.find(k=>k.id===h),p=(v==null?void 0:v.type)==="workflowOrchestration",g=!!w.executionData;return p&&(h===e||g)});if(c){const[h,w]=c;b=((r=w.executionData)==null?void 0:r.nodeUpdates)||[]}return{success:n.status==="completed",executionId:n.executionId,duration:Date.now()-s,executedNodeCount:n.executionData.size,errors:n.errors.map(h=>({nodeId:h.nodeId,message:h.message})),nodeStates:u,nodeUpdates:b}}catch(o){return{success:!1,error:o instanceof Error?o.message:String(o),errors:[],duration:Date.now()-s}}}buildNodeStates(e,s){const r=new Map;return s.forEach(o=>{const i=e.errors.some(c=>c.nodeId===o.id),n=e.executionData.has(o.id),u=i?"error":n?"success":"idle",b=e.executionData.get(o.id);r.set(o.id,{executionState:u,executionData:b})}),r}async getExecutionHistory(e=10){return await this.executionStore.listRecent(e)}async getExecution(e){return await this.executionStore.get(e)}async clearHistory(){await this.executionStore.clear()}getRegisteredNodeTypes(){return this.nodeRegistry.getAll().map(e=>e.type)}}const Le=-28,ze=["source"],Ce=["loop","nodeUpdate","transform","condition","if"],Ae=[{id:"source",label:"Source",description:"Provides data for downstream steps"},{id:"loop",label:"Loop",description:"Iterate through source data"},{id:"nodeUpdate",label:"Node Update",description:"Update any node fields with loop data"},{id:"if",label:"If",description:"Conditional check on node fields"},{id:"transform",label:"Transform",description:"Transform input data"},{id:"condition",label:"Condition",description:"Conditional branching"},{id:"empty",label:"Empty",description:"Pass through data unchanged"}],qe=({row:a,node:e,nodes:s,incomingArrows:r,selectedRowId:o,configPopoverOpen:i,rowElementsRef:n,onRowClick:u,onConfigureRow:b,onDeleteRow:c,onSelectedRowIdChange:h})=>{const w=be(a.id,2,2),v=a.stepType||"empty",p=r.find(y=>y.endRowId===a.id);let g="";if(p){const y=s.find(U=>U.id===p.startNodeId);g=`${(y==null?void 0:y.title)||(y==null?void 0:y.content)||p.startNodeId}`}else Ce.includes(v)?g=a.label||`${w}`:v==="source"?g=`${w} (not connected)`:g=a.label||`${w}`;if(v==="nodeUpdate"&&a.config){const y=a.config.targets||[];if(y.length>0){const F=new Set;y.forEach(l=>{l.updates&&Object.keys(l.updates).forEach(N=>{typeof l.updates[N]=="object"&&N==="styles"?Object.keys(l.updates[N]).forEach(S=>{F.add(`${N}.${S}`)}):F.add(N)})});const U=Array.from(F);if(U.length>0){const l=U.slice(0,2).join(", "),N=U.length>2?`, +${U.length-2}`:"";g+=` → ${l}${N}`}}}return g=(a.order!=null?`${a.order}. `:"")+g,a.id,t.jsx("div",{ref:y=>{y&&n.current.set(a.id,y)},"data-workflow-row":`${e.id}:${a.id}`,className:"relative p-1.5 bg-background rounded border transition-all duration-200 hover:shadow-md hover:border-primary hover:-translate-y-0.5",children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"flex-1",children:g}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(me,{onOpenChange:y=>{h(y?a.id:null)},children:[t.jsx(he,{asChild:!0,children:t.jsx("button",{"data-test":"workflow-step-type-button",onClick:y=>{y.stopPropagation()},className:"text-[10px] px-1 py-0.5 bg-primary/10 text-primary rounded hover:bg-primary/20 transition-colors cursor-pointer",title:"Change step type",children:v})}),o===a.id&&t.jsxs(ge,{className:"w-64 p-2",side:"right",align:"start",children:[t.jsx("div",{className:"text-xs font-semibold mb-2 text-muted-foreground",children:"Select Step Type"}),t.jsx("div",{className:"space-y-1",children:Ae.map(y=>t.jsxs("button",{onClick:()=>b(a.id,y.id),className:"w-full text-left p-2 text-xs hover:bg-accent rounded flex flex-col",children:[t.jsx("div",{className:"font-semibold",children:y.label}),t.jsx("div",{className:"text-[10px] text-muted-foreground",children:y.description})]},y.id))})]})]}),(v==="nodeUpdate"||v==="if")&&t.jsx("button",{"data-test":"workflow-row-config-button",onClick:y=>{y.stopPropagation(),y.preventDefault(),u(a.id,y,"gear")},className:"p-1 hover:bg-accent rounded transition-colors",title:"Configure step",children:t.jsx(xe,{size:12,className:"text-muted-foreground"})}),t.jsx("button",{"data-test":"workflow-row-delete-button",onClick:y=>{y.stopPropagation(),y.preventDefault(),c(a.id)},className:"p-1 hover:bg-destructive/10 text-destructive rounded transition-colors",title:"Delete step",children:t.jsx(B,{size:12})})]})]})})};export{Le as C,We as I,Pe as N,ze as S,Me as W,qe as a};
