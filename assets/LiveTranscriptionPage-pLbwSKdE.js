import{r as n,j as t}from"./react-vendor-Byz07MLO.js";import{aN as ie,aO as oe,ar as re,L as O,S as ce,h as le,i as de,j as ue,aP as pe,k as fe,T as xe,aQ as me,A as he,C as ge,b as Ce,c as be,a as $,g as we,l as je,e as Se,aR as ke}from"./index-eHP58yiE.js";import{b2 as Te,r as ve,q as ye,e as Ne,T as Ee}from"./icons-vtiX7BHn.js";import"./utils-DJ2ViQ2u.js";import"./radix-ui-v9Pxfv0s.js";import"./ui-utils-BxIQ3qGg.js";const G=".tsx",Pe=[{type:"camel",patterns:[/\bcamel\s*case\b/i,/\bcamelcase\b/i,/\bchemical\s*case\b/i,/\bcamera\s*case\b/i,/\bcamal\s*case\b/i,/\bcamol\s*case\b/i]},{type:"pascal",patterns:[/\bpascal\s*case\b/i,/\bpascalcase\b/i,/\bpaskel\s*case\b/i,/\bpaskle\s*case\b/i,{regex:/\bfile\b/i,suffix:G},{regex:/\bfire\b/i,suffix:G}]},{type:"snake",patterns:[/\bsnake\s*case\b/i,/\bsnakecase\b/i,/\bsnake_case\b/i,/\bsnak\s*case\b/i]}],X=[/tick\.?\b/i,/take\.?\b/i,/tic\.?\b/i,/tik\.?\b/i,/\.\s*tsx\b/i,/\.\s*ts\b/i,/\.\s*jsx\b/i,/\.\s*js\b/i];function Ae(x,a){let r=-1;for(const d of X){const u=x.slice(a).match(d);if((u==null?void 0:u.index)!==void 0){const i=a+u.index;(r===-1||i<r)&&(r=i)}}return r}function Re(x){return x.replace(/^[\s,;:.]+|[\s,;:.]+$/g,"")}function De(x){const r=/\.(tsx|ts|jsx|js)\b/i.exec(x);return r?r[0].toLowerCase():null}function Le(x,a){const r=x.trim();if(!r)return a;const d=r[0];return d>="a"&&d<="z"?"camel":d>="A"&&d<="Z"?"pascal":a}function Me(x){return`@${x}`}async function V(x){let a=x,r=!0;for(;r;){r=!1;for(const d of Pe){for(const u of d.patterns){const i=u instanceof RegExp?u:u.regex,P=u instanceof RegExp?"":u.suffix??"",p=!!(!(u instanceof RegExp)&&u.suffix),k=a.match(i);if((k==null?void 0:k.index)===void 0)continue;const b=k.index,h=b+k[0].length,w=Ae(a,h);if(w===-1)continue;let m=a.slice(h,w).trim();if(!m||(m=Re(m),!m))continue;let c=w,T=null;for(const g of X){const E=a.slice(w).match(g);if(E&&E.index===0){c=w+E[0].length;const D=/\.(tsx|ts|jsx|js)/i.exec(E[0]);D&&(T=D[0].toLowerCase());break}}const A=/^(?:\.[a-z]{1,3})+/i.exec(a.slice(c));A&&(c+=A[0].length),T??(T=De(m));let j=m;if(T){const g=j.lastIndexOf(T);g!==-1&&(j=j.slice(0,g))}let v=d.type;p&&(v=Le(j,d.type));let C=ie(j,v);const R=T??P;if(R&&!C.endsWith(R)&&(C+=R),p)try{const g=await oe.getFilePath(C);g&&(C=g)}catch(g){console.warn("Failed to lookup file:",C,g)}p&&(C=Me(C)),a=a.slice(0,b)+C+a.slice(c),r=!0;break}if(r)break}}return a}const Ie=`Reformulate the following text to maximize its clarity, coherence, and technical precision. Ensure the rewritten version is well-structured, uses strong and concise language, and replaces any vague or conversational phrasing with clear, actionable terminology, all while preserving the original meaning and content. Do not provide an explanation to the changes. You must only respond with the revised version:

{{TEXT}}`;function Fe({text:x,onTextReformulated:a,variant:r="outline",className:d="",disabled:u=!1}){const[i,P]=n.useState(!1),[p,k]=n.useState("qwen2.5:32b"),[b,h]=n.useState(Ie),w=async()=>{if(x){P(!0);try{const c=b.replace("{{TEXT}}",x),T=await me.generateCompletion(c,p);a(T.response)}catch(c){console.error("Failed to reformulate text:",c)}finally{P(!1)}}},m=t.jsxs("div",{className:"reformulate-config space-y-3 p-2",children:[t.jsxs("div",{className:"model-selection space-y-2",children:[t.jsx(O,{className:"text-xs font-semibold",children:"Model"}),t.jsxs(ce,{value:p,onValueChange:c=>k(c),children:[t.jsx(le,{className:"h-8 text-xs",children:t.jsx(de,{placeholder:"Select model"})}),t.jsx(ue,{children:pe.map(c=>t.jsx(fe,{value:c,children:c},c))})]})]}),t.jsxs("div",{className:"prompt-customization space-y-2",children:[t.jsx(O,{className:"text-xs font-semibold",children:"Reformulate Prompt"}),t.jsx(xe,{value:b,onChange:c=>h(c.target.value),placeholder:"Enter reformulate prompt template (use {{TEXT}} as placeholder)",className:"min-h-[120px] text-xs"}),t.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Use ",t.jsx("code",{className:"bg-muted px-1 rounded",children:"{{TEXT}}"})," as placeholder for input text"]})]})]});return t.jsx(re,{label:t.jsx(Te,{className:"w-4 h-4"}),onAction:w,variant:r,size:"icon",className:d,disabled:!x||i||u,showStaticGear:!0,ariaLabel:"Reformulate text with AI",tooltipText:"Click to reformulate text, or click gear for options",popoverContent:m})}function Ge({className:x=""}){const[a,r]=n.useState([]),[d,u]=n.useState(null),[i,P]=n.useState(""),p=n.useCallback(e=>{const s=typeof e=="function"?e(i):e;console.log("ðŸ“ setTranscription called:",{newLength:s.length,preview:s.substring(0,50)}),P(e)},[i]),[k,b]=n.useState(0),[h,w]=n.useState([]),[m,c]=n.useState(0),[T,y]=n.useState(!1),[A,j]=n.useState([]),[v,C]=n.useState(!1),[R,g]=n.useState(0),[E,I]=n.useState(null),[D,q]=n.useState(!1),z=n.useRef(null);n.useEffect(()=>{z.current=E},[E]);const _=n.useRef(null);n.useEffect(()=>{const e=localStorage.getItem("transcription-sessions");if(e)try{const l=JSON.parse(e).map(f=>({...f,createdAt:new Date(f.createdAt),updatedAt:new Date(f.updatedAt)}));r(l)}catch(s){console.error("Failed to load sessions:",s)}},[]),n.useEffect(()=>{a.length>0&&localStorage.setItem("transcription-sessions",JSON.stringify(a))},[a]),n.useEffect(()=>{d&&i&&r(e=>e.map(s=>s.id===d?{...s,text:i,updatedAt:new Date,chunkCount:k}:s))},[i,d,k]),n.useCallback(()=>{const e={id:`session-${Date.now()}`,title:`Session ${new Date().toLocaleString()}`,text:"",createdAt:new Date,updatedAt:new Date,chunkCount:0};r(s=>[e,...s]),u(e.id),p(""),b(0),y(!1)},[]),n.useCallback(e=>{const s=a.find(l=>l.id===e);s&&(u(e),p(s.text),b(s.chunkCount),y(!1))},[a]),n.useCallback(e=>{r(s=>s.filter(l=>l.id!==e)),d===e&&(u(null),p(""),b(0),y(!1))},[d]);const L=n.useCallback(async(e,s)=>{const l=e.slice(0,s);let f="";for(let S=0;S<l.length;S++){const F=l[S];let o=await V(F.transcription||"");if(S>0&&f){const N=l[S-1],W=F;(W.startTime&&N.endTime?new Date(W.startTime).getTime()-new Date(N.endTime).getTime():0)>=3e4||!/[.!?â€¦]$/.test(f.trim())&&o.length>0&&(o=o.charAt(0).toLowerCase()+o.slice(1)),f=`${f} ${o}`}else f=o}return f},[]),J=n.useCallback(async e=>{var F;if(console.log("ðŸ“ handleManualTranscription:",{id:e.id,status:e.transcriptionStatus,hasTranscription:!!e.transcription,transcriptionLength:(F=e.transcription)==null?void 0:F.length}),e.transcriptionStatus==="completed"&&(console.log("ðŸ“ Clearing streaming state"),C(!1),j([]),g(0),z.current===e.id&&I(null),D&&e.transcription&&navigator.clipboard.writeText(e.transcription).then(()=>console.log("âœ“ Auto-copied transcription to clipboard")).catch(o=>console.error("Failed to auto-copy:",o))),!e.transcription){console.log("ðŸ“ No transcription yet, skipping");return}const s=h.findIndex(o=>o.id===e.id),l=s===-1;console.log("ðŸ“ Chunk exists?",s!==-1,"isNewChunk:",l);const f=l?[...h,e]:h.map(o=>o.id===e.id?e:o);w(f),c(f.length);const S=await V(e.transcription??"");if(console.log("ðŸ“ Processed text:",S),console.log("ðŸ“ isManuallyEdited:",T,"isNewChunk:",l),l)console.log("ðŸ“ Appending new chunk"),p(o=>{if(!o)return S;const N=f[f.length-2],W=e,U=(W.startTime&&(N!=null&&N.endTime)?new Date(W.startTime).getTime()-new Date(N.endTime).getTime():0)>=3e4;let M=S;return U||!/[.!?â€¦]$/.test(o.trim())&&M.length>0&&(M=M.charAt(0).toLowerCase()+M.slice(1)),`${o} ${M}`});else{console.log("ðŸ“ Rebuilding to update existing chunk");const o=await L(f,f.length);p(o)}if(l&&b(o=>o+1),!d){const o={id:`session-${Date.now()}`,title:`Session ${new Date().toLocaleString()}`,text:e.transcription??"",createdAt:new Date,updatedAt:new Date,chunkCount:1};r(N=>[o,...N]),u(o.id)}},[d,L,T,h,D]),K=n.useCallback((e,s)=>{console.log("ðŸ“ Word received:",{word:e.word,chunkId:s}),z.current===s?(j(l=>[...l,e.word]),C(!0)):(I(s),j([e.word]),C(!0),g(0))},[]),Y=n.useCallback((e,s)=>{console.log("ðŸ“Š Progress:",{percentage:e.percentage,chunkId:s}),g(e.percentage)},[]),H=n.useCallback(async e=>{console.log("ðŸ—‘ï¸ Chunk deleted:",e);const s=h.filter(S=>S.id!==e);w(s);const l=Math.min(m,s.length);c(l);const f=await L(s,l);p(f),b(s.length)},[h,m,L]),B=()=>{p(""),w([]),c(0),y(!1),j([]),C(!1),g(0),I(null)},Q=n.useCallback(()=>{B()},[]),Z=async()=>{if(m>0){const e=m-1;c(e);const s=await L(h,e);p(s),y(!1)}},ee=async()=>{if(m<h.length){const e=m+1;c(e);const s=await L(h,e);p(s),y(!1)}},te=e=>{p(e.target.value),y(!0)},se=async()=>{try{await navigator.clipboard.writeText(i),console.log("Transcription copied to clipboard")}catch(e){console.error("Failed to copy to clipboard:",e)}},ne=n.useCallback(e=>{C(!1),j([]),g(0),I(null);const s=_.current;s?(s.focus(),s.setSelectionRange(0,s.value.length),document.execCommand("insertText",!1,e)||p(e)):p(e),y(!0)},[]);return t.jsxs("div",{className:`live-transcription-page min-h-full flex gap-6 p-6 overflow-auto ${x}`,children:[!1,t.jsx("div",{className:"main-content flex-1 flex flex-col gap-6",children:t.jsxs("div",{className:"content-grid grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx(he,{sessionName:"live-transcription",onChunkUpdated:J,onChunkDeleted:H,onClearAndRecord:Q,onWordReceived:K,onTranscriptionProgress:Y,className:"recording-panel"}),t.jsxs(ge,{className:"transcription-display flex flex-col",children:[t.jsx(Ce,{children:t.jsxs(be,{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Transcription"}),t.jsxs("div",{className:"action-buttons flex gap-2",children:[t.jsx($,{variant:"outline",size:"sm",onClick:Z,disabled:m===0,title:"Remove previous chunk",children:t.jsx(ve,{className:"w-4 h-4"})}),t.jsx($,{variant:"outline",size:"sm",onClick:ee,disabled:m>=h.length,title:"Add next chunk",children:t.jsx(ye,{className:"w-4 h-4"})}),t.jsx(Fe,{text:i,onTextReformulated:ne}),t.jsx($,{variant:"outline",size:"sm",onClick:se,disabled:!i,title:"Copy to clipboard",children:t.jsx(Ne,{className:"w-4 h-4"})}),t.jsx(we,{variant:"outline",size:"sm",title:"Transcription Settings",align:"end",storageKey:"live-transcription-config",children:t.jsxs("div",{className:"transcription-settings space-y-4 min-w-[250px]",children:[t.jsxs("div",{className:"auto-copy-toggle flex items-center justify-between",children:[t.jsx(O,{htmlFor:"auto-copy",className:"text-sm cursor-pointer",children:"Auto-copy to clipboard"}),t.jsx(je,{id:"auto-copy",checked:D,onCheckedChange:q})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically copy each chunk's transcription to clipboard when completed"})]})}),t.jsx($,{variant:"outline",size:"sm",onClick:B,disabled:!i,title:"Clear transcription",children:t.jsx(Ee,{className:"w-4 h-4"})})]})]})}),t.jsxs(Se,{className:"flex-1 flex flex-col",children:[v&&t.jsxs("div",{className:"streaming-indicator mb-2 flex items-center gap-2 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"streaming-dot w-2 h-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-green-600 font-medium",children:"Streaming..."})]}),R>0&&t.jsxs("span",{className:"text-muted-foreground",children:[Math.round(R),"%"]})]}),t.jsx(ke,{ref:_,value:v?(i?`${i} `:"")+A.join(" ")+"â–‹":i,onChange:te,placeholder:"Your transcription will appear here...",className:"transcription-text-area flex-1 min-h-[400px] resize-none font-mono text-sm",readOnly:v}),(i||v)&&t.jsxs("div",{className:"stats mt-4 flex gap-4 text-sm text-muted-foreground",children:[t.jsxs("span",{children:["Words: ",v?i.split(/\s+/).filter(Boolean).length+A.length:i.split(/\s+/).filter(Boolean).length]}),t.jsxs("span",{children:["Characters: ",v?i.length+A.join(" ").length+(i?1:0):i.length]}),v&&t.jsx("span",{className:"text-green-600 font-medium",children:"â€¢ Live streaming"})]})]})]})]})})]})}export{Ge as LiveTranscriptionPage};
