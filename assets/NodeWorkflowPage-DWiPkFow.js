var F=Object.defineProperty;var O=(r,t,s)=>t in r?F(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var W=(r,t,s)=>O(r,typeof t!="symbol"?t+"":t,s);import{r as x,j as e}from"./react-vendor-Byz07MLO.js";import{C as h,b as g,c as N,U as j,d as I,e as w,a as b,B as E,m as q,n as L,o as D,p as C}from"./index-BEUYSeX_.js";import{B as P}from"./Breadcrumbs-D-EeNrHD.js";import{ac as B,aN as M,b3 as U,a as G,R as J}from"./icons-Detj0uxE.js";import"./utils-DjFvUtuq.js";import"./radix-ui-B6r6BEmy.js";import"./ui-utils-BxIQ3qGg.js";class V{constructor(){W(this,"executorRegistry",{})}registerNodeExecutor(t,s){this.executorRegistry[t]=s}async executeWorkflow(t){const s={workflowId:t.id,startTime:new Date,status:"running",executionData:{},errors:[]};try{const o=this.findStartNode(t.nodes);if(o===null)throw new Error("No start node found in workflow");const a=[o.id],i=new Set;for(;a.length>0;){const n=a.shift();if(i.has(n))continue;s.currentNodeId=n;const u=t.nodes.find(l=>l.id===n);if(!u){this.addError(s,n,`Node not found: ${n}`);continue}try{const l=this.getInputDataForNode(u,t.connections,s),m=await this.executeNode(u,l,s);s.executionData[n]=m;const v=this.findNextNodes(n,t.connections);for(const f of v)i.has(f)||a.push(f);i.add(n)}catch(l){this.addError(s,n,l instanceof Error?l.message:"Unknown error",l)}}s.status=s.errors.length>0?"failed":"completed"}catch(o){s.status="failed",this.addError(s,"workflow",o instanceof Error?o.message:"Workflow execution failed",o)}return s}findStartNode(t){return t.find(s=>s.type==="startNode"||s.type==="trigger"||s.type==="start")||null}getInputDataForNode(t,s,o){const a=s.filter(n=>n.targetNodeId===t.id);if(a.length===0)return;if(a.length===1){const n=a[0].sourceNodeId;return o.executionData[n]}const i={};for(const n of a){const u=o.executionData[n.sourceNodeId];i[n.sourceHandleId]=u}return i}async executeNode(t,s,o){const a=this.executorRegistry[t.type];if(!a)throw new Error(`No executor registered for node type: ${t.type}`);return await a(t,s,o)}findNextNodes(t,s){return s.filter(o=>o.sourceNodeId===t).map(o=>o.targetNodeId)}addError(t,s,o,a){const i={nodeId:s,message:o,timestamp:new Date,details:a};t.errors.push(i)}getRegisteredNodeTypes(){return Object.keys(this.executorRegistry)}isNodeTypeRegistered(t){return t in this.executorRegistry}}const R=async(r,t,s)=>(console.log(`[${s.workflowId}] Starting workflow at ${s.startTime.toISOString()}`),{trigger:!0,timestamp:new Date().toISOString(),...r.parameters}),Z=async(r,t,s)=>{console.log(`[${s.workflowId}] Fetching user data...`),await new Promise(i=>setTimeout(i,1e3));const o=r.parameters.endpoint||"https://api.example.com/users",a=[{id:1,name:"Alice Johnson",email:"alice@example.com",active:!0,department:"Engineering"},{id:2,name:"Bob Smith",email:"bob@example.com",active:!1,department:"Marketing"},{id:3,name:"Carol Williams",email:"carol@example.com",active:!0,department:"Sales"},{id:4,name:"David Brown",email:"david@example.com",active:!0,department:"Engineering"},{id:5,name:"Eva Davis",email:"eva@example.com",active:!1,department:"HR"}];return console.log(`[${s.workflowId}] Fetched ${a.length} users from ${o}`),{users:a,count:a.length,source:o,fetchedAt:new Date().toISOString()}},z=async(r,t,s)=>{if(console.log(`[${s.workflowId}] Filtering active users...`),!t||typeof t!="object"||!("users"in t))throw new Error("No user data received for filtering");const o=t,a=r.parameters.criteria||"active",i=r.parameters.value!==void 0?r.parameters.value:!0,n=o.users.filter(u=>u[a]===i);return console.log(`[${s.workflowId}] Filtered ${o.users.length} users to ${n.length} active users`),{users:n,originalCount:o.count,filteredCount:n.length,filterCriteria:`${a} = ${i}`,source:o.source,filteredAt:new Date().toISOString(),previousStep:{fetchedAt:o.fetchedAt,totalUsers:o.count}}},K=async(r,t,s)=>{const{url:o,method:a="GET"}=r.parameters;if(!o)throw new Error("HTTP Request node requires a URL parameter");console.log(`[${s.workflowId}] Making ${a} request to ${o}`);try{await new Promise(n=>setTimeout(n,500));let i={message:"Request completed",url:o,method:a};return o.includes("/users")&&(i={users:[{id:1,name:"API User 1",active:!0},{id:2,name:"API User 2",active:!1}]}),{response:i,status:200,url:o,method:a,requestedAt:new Date().toISOString()}}catch(i){throw new Error(`HTTP Request failed: ${i instanceof Error?i.message:"Unknown error"}`)}},Q=async(r,t,s)=>{if(console.log(`[${s.workflowId}] Transforming data...`),!t)throw new Error("No input data to transform");const{transformation:o="passthrough",mapping:a={}}=r.parameters;let i=t;switch(o){case"map_fields":if(typeof t=="object"&&"users"in t){const n=t.users;i={...t,users:n.map(u=>{const l={};for(const[m,v]of Object.entries(a))l[v]=u[m];return l})}}break;case"count":typeof t=="object"&&"users"in t&&(i={count:t.users.length,originalData:t});break;case"passthrough":default:i=t;break}return{...i,transformedAt:new Date().toISOString(),transformation:o}},X=async(r,t,s)=>{const o=r.parameters.level||"info",a=r.parameters.message||"Log output";return console.log(`[${s.workflowId}] ${o.toUpperCase()}: ${a}`,t),{loggedAt:new Date().toISOString(),logLevel:o,message:a,data:t}};function Y(){const r=new V;return r.registerNodeExecutor("startNode",R),r.registerNodeExecutor("start",R),r.registerNodeExecutor("trigger",R),r.registerNodeExecutor("fetchUserData",Z),r.registerNodeExecutor("filterActiveUsers",z),r.registerNodeExecutor("httpRequest",K),r.registerNodeExecutor("transformData",Q),r.registerNodeExecutor("log",X),r}function ee(){return{id:"example-workflow-1",name:"User Data Processing Workflow",nodes:[{id:"start-1",type:"startNode",position:{x:100,y:200},parameters:{name:"Workflow Start",description:"Initiates the user data processing workflow"},inputs:[],outputs:[{id:"output_main",name:"Start Signal"}]},{id:"fetch-users-1",type:"fetchUserData",position:{x:350,y:200},parameters:{endpoint:"https://api.company.com/users",timeout:3e4,retries:3},inputs:[{id:"input_trigger",name:"Trigger"}],outputs:[{id:"output_users",name:"User Data"},{id:"output_error",name:"Error"}]},{id:"filter-active-1",type:"filterActiveUsers",position:{x:600,y:200},parameters:{criteria:"active",value:!0,includeInactive:!1},inputs:[{id:"input_users",name:"User Data"}],outputs:[{id:"output_filtered",name:"Active Users"},{id:"output_stats",name:"Filter Statistics"}]},{id:"log-results-1",type:"log",position:{x:850,y:200},parameters:{level:"info",message:"Active users filtered successfully"},inputs:[{id:"input_data",name:"Data to Log"}],outputs:[{id:"output_logged",name:"Log Result"}]}],connections:[{id:"connection-1",sourceNodeId:"start-1",sourceHandleId:"output_main",targetNodeId:"fetch-users-1",targetHandleId:"input_trigger"},{id:"connection-2",sourceNodeId:"fetch-users-1",sourceHandleId:"output_users",targetNodeId:"filter-active-1",targetHandleId:"input_users"},{id:"connection-3",sourceNodeId:"filter-active-1",sourceHandleId:"output_filtered",targetNodeId:"log-results-1",targetHandleId:"input_data"}]}}function te(){return{id:"complex-workflow-1",name:"Complex Multi-Branch Workflow",nodes:[{id:"start-complex",type:"startNode",position:{x:50,y:300},parameters:{name:"Complex Workflow Start"},inputs:[],outputs:[{id:"output_main",name:"Start"}]},{id:"http-users",type:"httpRequest",position:{x:250,y:200},parameters:{url:"https://api.example.com/users",method:"GET"},inputs:[{id:"input_trigger",name:"Trigger"}],outputs:[{id:"output_response",name:"Response"}]},{id:"http-departments",type:"httpRequest",position:{x:250,y:400},parameters:{url:"https://api.example.com/departments",method:"GET"},inputs:[{id:"input_trigger",name:"Trigger"}],outputs:[{id:"output_response",name:"Response"}]},{id:"transform-users",type:"transformData",position:{x:450,y:200},parameters:{transformation:"map_fields",mapping:{id:"userId",name:"fullName",email:"emailAddress"}},inputs:[{id:"input_data",name:"Raw Data"}],outputs:[{id:"output_transformed",name:"Transformed"}]},{id:"filter-users",type:"filterActiveUsers",position:{x:650,y:200},parameters:{criteria:"active",value:!0},inputs:[{id:"input_users",name:"Users"}],outputs:[{id:"output_filtered",name:"Active Users"}]},{id:"combine-results",type:"transformData",position:{x:850,y:300},parameters:{transformation:"combine",combineStrategy:"merge"},inputs:[{id:"input_users",name:"Users"},{id:"input_departments",name:"Departments"}],outputs:[{id:"output_combined",name:"Combined Data"}]},{id:"final-log",type:"log",position:{x:1050,y:300},parameters:{level:"info",message:"Complex workflow completed"},inputs:[{id:"input_data",name:"Final Data"}],outputs:[{id:"output_logged",name:"Logged"}]}],connections:[{id:"start-to-users",sourceNodeId:"start-complex",sourceHandleId:"output_main",targetNodeId:"http-users",targetHandleId:"input_trigger"},{id:"start-to-departments",sourceNodeId:"start-complex",sourceHandleId:"output_main",targetNodeId:"http-departments",targetHandleId:"input_trigger"},{id:"users-to-transform",sourceNodeId:"http-users",sourceHandleId:"output_response",targetNodeId:"transform-users",targetHandleId:"input_data"},{id:"transform-to-filter",sourceNodeId:"transform-users",sourceHandleId:"output_transformed",targetNodeId:"filter-users",targetHandleId:"input_users"},{id:"filtered-to-combine",sourceNodeId:"filter-users",sourceHandleId:"output_filtered",targetNodeId:"combine-results",targetHandleId:"input_users"},{id:"departments-to-combine",sourceNodeId:"http-departments",sourceHandleId:"output_response",targetNodeId:"combine-results",targetHandleId:"input_departments"},{id:"combine-to-log",sourceNodeId:"combine-results",sourceHandleId:"output_combined",targetNodeId:"final-log",targetHandleId:"input_data"}]}}function le({logger:r}){const[t]=x.useState(()=>Y()),[s]=x.useState(()=>ee()),[o]=x.useState(()=>te()),[a,i]=x.useState(s),[n,u]=x.useState(null),[l,m]=x.useState(!1),[v,f]=x.useState([]),$=[{label:"Home",href:"/"},{label:"Demo",href:"/demo"},{label:"Node Workflow"}],y=c=>{const d=new Date().toLocaleTimeString();f(p=>[...p,`[${d}] ${c}`])},T=async c=>{m(!0),f([]),u(null),y(`Starting execution of workflow: ${c.name}`),r==null||r.info(`Executing workflow: ${c.name}`);try{const d=await t.executeWorkflow(c);u(d),d.status==="completed"?(y(`‚úÖ Workflow completed successfully with ${Object.keys(d.executionData).length} nodes processed`),r==null||r.info("Workflow execution completed")):d.status==="failed"&&(y(`‚ùå Workflow failed with ${d.errors.length} errors`),r==null||r.error("Workflow execution failed"))}catch(d){y(`üí• Execution error: ${d instanceof Error?d.message:"Unknown error"}`),r==null||r.error(`Workflow execution error: ${d}`)}finally{m(!1)}},k=()=>{u(null),f([]),m(!1)},H=c=>e.jsxs("div",{className:"workflow-info-section space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",c.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",children:[c.nodes.length," Nodes"]}),e.jsxs(E,{variant:"outline",children:[c.connections.length," Connections"]})]})]}),e.jsxs("div",{className:"workflow-nodes grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"üì¶ Nodes"})}),e.jsx(w,{className:"space-y-2",children:c.nodes.map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-sm",children:[p+1,". ",d.type]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.inputs.length," inputs, ",d.outputs.length," outputs"]})]}),e.jsx(E,{variant:"secondary",className:"text-xs",children:d.id.split("-")[0]})]},d.id))})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm",children:"üîó Data Flow"})}),e.jsx(w,{className:"space-y-2",children:c.connections.map(d=>{const p=c.nodes.find(_=>_.id===d.sourceNodeId),S=c.nodes.find(_=>_.id===d.targetNodeId);return e.jsxs("div",{className:"flex items-center p-2 bg-gray-50 rounded text-sm",children:[e.jsx("span",{className:"font-medium text-blue-600",children:p==null?void 0:p.type}),e.jsx("span",{className:"mx-2 text-gray-400",children:"‚Üí"}),e.jsx("span",{className:"font-medium text-green-600",children:S==null?void 0:S.type})]},d.id)})})]})]})]}),A=()=>n?e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(U,{className:j.md}),"Execution Results"]}),e.jsxs(I,{children:["Status: ",e.jsx(E,{variant:n.status==="completed"?"default":"destructive",children:n.status})]})]}),e.jsx(w,{children:e.jsxs(q,{defaultValue:"data",className:"w-full",children:[e.jsxs(L,{className:"grid w-full grid-cols-3",children:[e.jsx(D,{value:"data",children:"Output Data"}),e.jsxs(D,{value:"errors",children:["Errors (",n.errors.length,")"]}),e.jsx(D,{value:"timeline",children:"Execution Log"})]}),e.jsx(C,{value:"data",className:"space-y-4",children:e.jsx("div",{className:"h-[300px] w-full overflow-y-auto border rounded-md",children:Object.entries(n.executionData).map(([c,d])=>e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2",children:["Node: ",c]}),e.jsx("pre",{className:"text-xs bg-card p-2 rounded border overflow-x-auto",children:JSON.stringify(d,null,2)})]},c))})}),e.jsx(C,{value:"errors",className:"space-y-2",children:n.errors.length===0?e.jsx("div",{className:"text-green-600 text-center py-4",children:"‚úÖ No errors occurred"}):n.errors.map((c,d)=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded",children:[e.jsxs("div",{className:"font-semibold text-red-800",children:["Node: ",c.nodeId]}),e.jsx("div",{className:"text-red-700",children:c.message}),e.jsx("div",{className:"text-xs text-red-600",children:c.timestamp.toLocaleString()})]},d))}),e.jsx(C,{value:"timeline",children:e.jsx("div",{className:"h-[300px] w-full overflow-y-auto border rounded-md",children:e.jsx("div",{className:"space-y-1 p-2",children:v.map((c,d)=>e.jsx("div",{className:"text-sm font-mono p-2 bg-gray-100 rounded",children:c},d))})})})]})})]}):null;return e.jsxs("div",{className:"node-workflow-page flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"page-header p-6 pb-0 flex-shrink-0",children:[e.jsx("div",{className:"breadcrumb-section mb-4",children:e.jsx(P,{items:$})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Node Workflow Engine"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Execute automated workflows with visual node-based processing chains. See data flow between nodes in real-time."})]}),e.jsxs("div",{className:"page-content flex-1 p-6 space-y-6 overflow-y-auto min-h-0",children:[e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(B,{className:j.md}),"Workflow Selection & Execution"]}),e.jsx(I,{children:"Choose a workflow to execute and see the step-by-step data processing"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(b,{variant:a.id===s.id?"default":"outline",onClick:()=>{i(s),k()},className:"flex items-center gap-2",children:[e.jsx(M,{className:j.sm}),"Simple: User Processing"]}),e.jsxs(b,{variant:a.id===o.id?"default":"outline",onClick:()=>{i(o),k()},className:"flex items-center gap-2",children:[e.jsx(U,{className:j.sm}),"Complex: Multi-Branch"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:()=>T(a),disabled:l,className:"flex items-center gap-2",children:[e.jsx(G,{className:j.sm}),l?"Executing...":"Execute Workflow"]}),e.jsxs(b,{variant:"outline",onClick:k,disabled:l,className:"flex items-center gap-2",children:[e.jsx(J,{className:j.sm}),"Reset"]})]})]})]}),e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs(N,{children:["Current Workflow: ",a.name]}),e.jsx(I,{children:"Workflow structure and node configuration"})]}),e.jsx(w,{children:H(a)})]}),A(),e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"üèóÔ∏è Architecture Overview"}),e.jsx(I,{children:"How the workflow execution engine processes nodes and data flow"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"architecture-section",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"üìã Execution Steps"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-gray-700",children:[e.jsx("li",{children:"Find and trigger the start node"}),e.jsx("li",{children:"Initialize execution queue with start node"}),e.jsx("li",{children:"For each node in queue:"}),e.jsx("li",{className:"ml-4",children:"‚Ä¢ Retrieve input data from connected parent nodes"}),e.jsx("li",{className:"ml-4",children:"‚Ä¢ Execute node logic using registered executor"}),e.jsx("li",{className:"ml-4",children:"‚Ä¢ Store output data in execution context"}),e.jsx("li",{className:"ml-4",children:"‚Ä¢ Find and enqueue next connected nodes"}),e.jsx("li",{children:"Continue until queue is empty"}),e.jsx("li",{children:"Return final execution context with all results"})]})]}),e.jsxs("div",{className:"data-structure-section",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"üóÇÔ∏è Key Data Structures"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Workflow:"})," Nodes + Connections + Metadata"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Node:"})," ID, Type, Position, Parameters, I/O Handles"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Connection:"})," Source‚ÜíTarget mapping with handle IDs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ExecutionContext:"})," Runtime state and results"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"NodeExecutor:"})," Function that processes node logic"]})]})]})]}),e.jsxs("div",{className:"example-flow bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"üí° Example: Simple User Processing Flow"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"1. Start Node:"})," Triggers workflow ‚Üí outputs trigger signal"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"2. Fetch User Data:"})," Receives trigger ‚Üí makes API call ‚Üí outputs user array"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"3. Filter Active Users:"})," Receives user array ‚Üí applies filter ‚Üí outputs filtered users"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"4. Log Results:"})," Receives filtered users ‚Üí logs data ‚Üí workflow complete"]})]})]})]})]})]})]})}export{le as NodeWorkflowPage};
