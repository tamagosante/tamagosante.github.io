import{r as n,j as e}from"./react-vendor-Byz07MLO.js";import{bq as re,br as xe,bs as fe,bt as pe,bu as ge,bv as je,bw as be,bx as ve,by as Ne,bz as we,bA as ye,bB as Ce,bC as Pe,bD as Se,bE as ke,bF as Ue,bG as Ee,C as O,b as _,c as K,d as oe,e as z,L as q,I as W,a as j,bH as Ae,bI as Ie,bJ as Me,bK as ee,bL as se,B as X,bM as Le,T as Oe}from"./index-eHP58yiE.js";import{aG as $e,i as De,e as ze,aX as ie,T as ce,by as Q,w as le,ba as J,h as Re,bu as Te,f as Fe,P as Ge,a as Be,X as de,N as _e}from"./icons-vtiX7BHn.js";import"./utils-DJ2ViQ2u.js";import"./radix-ui-v9Pxfv0s.js";import"./ui-utils-BxIQ3qGg.js";function Ke(){const s=re.store,[t,m]=n.useState(s.getState());n.useEffect(()=>{const o=s.subscribe(()=>{m(s.getState())});return s.dispatch(xe()),o},[s]);const i=n.useCallback((o,b)=>{s.dispatch(fe(o,b))},[s]),r=n.useCallback((o,b,a)=>{s.dispatch(pe(o,b,a))},[s]),d=n.useCallback((o,b)=>{s.dispatch(ge(o,b))},[s]),f=n.useCallback(o=>{s.dispatch(je(o))},[s]),c=n.useCallback(()=>{s.dispatch(be())},[s]),u=n.useCallback(()=>{s.dispatch(ve())},[s]),g=n.useCallback((o,b,a,x,v)=>{s.dispatch(Ne(o,b,a,x,v))},[s]),p=n.useCallback(o=>{s.dispatch(we(o))},[s]),l=n.useCallback(o=>{s.dispatch(ye(o))},[s]),S=n.useCallback((o,b,a,x)=>{s.dispatch(Ce(o,b,a,x))},[s]),N=n.useCallback(o=>{s.dispatch(Pe(o))},[s]),P=n.useCallback((o,b)=>{s.dispatch(Se(o,b))},[s]),R=n.useCallback(o=>{s.dispatch(ke(o))},[s]),A=n.useCallback(o=>{s.dispatch(Ue(o))},[s]),T=n.useCallback(o=>{s.dispatch(Ee(o))},[s]),F=t.games.find(o=>o.id===t.selectedGameId),I=t.games.filter(o=>o.status==="waiting"),k=t.games.filter(o=>o.status==="in_progress"),y=t.currentUser?t.games.filter(o=>o.players.includes(t.currentUser.id)):[],M=t.users.filter(o=>o.isOnline),U=Object.values(t.personas.byId),E=U.filter(o=>o.isActive),$={totalGames:t.games.length,availableGames:I.length,activeGames:k.length,onlineUsers:M.length};return{isConnected:t.isConnected,connectionState:t.connectionState,currentUser:t.currentUser,users:t.users,onlineUsers:M,usersLoading:t.usersLoading,usersError:t.usersError,games:t.games,gamesLoading:t.gamesLoading,gamesError:t.gamesError,selectedGame:F,selectedGameId:t.selectedGameId,availableGames:I,activeGames:k,myGames:y,chatMessages:t.chatMessages,chatLoading:t.chatLoading,chatError:t.chatError,personas:U,activePersonas:E,personasLoading:t.personas.loading,personasError:t.personas.error,loading:t.loading,error:t.error,stats:$,connectWebSocket:c,disconnectWebSocket:u,createUser:i,updateUser:r,setUserOnline:d,selectAccount:f,sendMessage:g,fetchMessages:p,clearMessages:l,createPersona:S,fetchPersonas:N,updatePersona:P,deletePersona:R,activatePersona:A,deactivatePersona:T}}function me(){return re.clientLogsService}const D="global-lobby";function Je({onCreateUser:s,loading:t,error:m}){const i=me(),[r,d]=n.useState(""),f=u=>{d(u)},c=async()=>{r.trim()&&(i.log("form_submission",{action:"create_user",username:r.trim(),timestamp:new Date().toISOString()}),await s(r.trim()))};return e.jsx("div",{className:"user-creation-container flex items-center justify-center min-h-screen p-4",children:e.jsxs(O,{className:"user-creation-card w-full max-w-md",children:[e.jsxs(_,{children:[e.jsxs(K,{className:"user-creation-title flex items-center gap-2",children:[e.jsx($e,{className:"user-creation-icon h-6 w-6"}),"Join Multiplayer"]}),e.jsx(oe,{className:"user-creation-description",children:"Create your player profile to start playing"})]}),e.jsxs(z,{className:"user-creation-content space-y-4",children:[e.jsxs("div",{className:"username-input-container space-y-2",children:[e.jsx(q,{htmlFor:"username",className:"username-label",children:"Username"}),e.jsx(W,{id:"username",className:"username-input",placeholder:"Enter your username",value:r,onChange:u=>f(u.target.value),onKeyDown:u=>u.key==="Enter"&&c()})]}),e.jsx(j,{className:"create-user-button w-full",onClick:c,disabled:!r.trim()||t,children:t?"Creating...":"Create Player"}),m&&e.jsx("p",{className:"error-message text-sm text-red-500",children:m})]})]})})}const Y="game-saved-accounts";function V(){try{const s=localStorage.getItem(Y);return s?JSON.parse(s):[]}catch(s){return console.error("[accountStorage] Failed to load saved accounts:",s),[]}}function te(s){try{const m=V().filter(r=>r.id!==s.id);m.unshift(s);const i=m.slice(0,10);localStorage.setItem(Y,JSON.stringify(i))}catch(t){console.error("[accountStorage] Failed to save account:",t)}}function He(s){try{const m=V().filter(i=>i.id!==s);m.length===0?localStorage.removeItem(Y):localStorage.setItem(Y,JSON.stringify(m))}catch(t){console.error("[accountStorage] Failed to remove account:",t)}}const qe={"copy-button":e.jsx(ze,{}),mail:e.jsx(De,{})},We=s=>{const{src:t,icon:m,iconKey:i,size:r="24px",width:d,height:f,color:c="currentColor",style:u,...g}=s;if(m)return e.jsx("span",{className:g.className,children:m});const p=qe[s.iconKey??""];return typeof t=="object"?e.jsx("span",{className:g.className,children:t}):e.jsx("div",{className:g.className,style:{...u,width:d??r,height:f??r,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx("img",{src:t??p,alt:"Copy",style:{width:"100%",height:"100%",filter:`${c!=="currentColor"?`color: ${c}`:""}`,borderRadius:s.round?"50%":"0%"}})})},L=s=>{const{src:t,style:m,size:i,emoji:r}=s;let{customSrc:d}=s;return d&&(d=`/fam/${d}.jpeg`),r?e.jsx("div",{style:{...m,width:i||64,height:i||64,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"var(--color-primary-10, #f0f0f0)",fontSize:Math.floor((i||64)*.6)},className:"flex",children:r}):e.jsx("div",{style:{...m},className:"flex",children:e.jsx(We,{src:d||t,size:i||64,round:!0})})};function Qe({onSelectAccount:s,onCreateNew:t,loading:m,users:i}){const[r,d]=n.useState([]);n.useEffect(()=>{d(V())},[]);const f=(c,u)=>{u.stopPropagation(),He(c),d(V())};return e.jsx("div",{className:"account-selector-container flex items-center justify-center min-h-screen p-4",children:e.jsxs(O,{className:"account-selector-card w-full max-w-md max-h-[90vh] flex flex-col",children:[e.jsxs(_,{className:"flex-shrink-0",children:[e.jsxs(K,{className:"account-selector-title flex items-center gap-2",children:[e.jsx(ie,{className:"account-selector-icon h-6 w-6"}),"Select Player"]}),e.jsx(oe,{className:"account-selector-description",children:"Choose a saved account or join online"})]}),e.jsxs(z,{className:"account-selector-content space-y-4 flex-1 min-h-0 overflow-y-auto",children:[r.length>0&&e.jsxs("div",{className:"saved-accounts-section",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-2",children:"Saved Accounts"}),e.jsx("div",{className:"saved-accounts-list space-y-2",children:r.map(c=>e.jsxs("div",{onClick:()=>s(c),className:"account-item flex items-center justify-between p-3 rounded-lg border border-border hover:bg-accent cursor-pointer transition-colors",children:[e.jsx("p",{className:"account-username font-medium text-sm flex-1",children:c.username}),e.jsxs("div",{className:"account-avatar-container flex items-center gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",className:"account-remove-button h-8 w-8 p-0",onClick:u=>f(c.id,u),children:e.jsx(ce,{className:"account-remove-icon h-4 w-4"})}),c.profilePicture?e.jsx(L,{customSrc:c.profilePicture,size:40}):e.jsx("div",{className:"account-avatar h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"account-avatar-icon h-6 w-6"})})]})]},c.id))})]}),i.length>0&&e.jsxs("div",{className:"online-users-section",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground mb-2",children:["Online Players (",i.length,")"]}),e.jsx("div",{className:"online-users-list space-y-2",children:i.map(c=>e.jsxs("div",{onClick:()=>s(c),className:"online-user-item flex items-center justify-between p-3 rounded-lg border border-border bg-muted/50 hover:bg-accent cursor-pointer transition-colors",children:[e.jsx("p",{className:"user-username font-medium text-sm flex-1",children:c.username}),c.profilePicture?e.jsx(L,{customSrc:c.profilePicture,size:40}):e.jsx("div",{className:"user-avatar h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"user-avatar-icon h-6 w-6"})})]},c.id))})]}),i.length===0&&r.length===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-6",children:"No saved accounts. Create a new player to get started!"})]}),e.jsx("div",{className:"flex-shrink-0 border-t p-4",children:e.jsxs(j,{className:"create-new-account-button w-full",variant:"outline",onClick:t,disabled:m,children:[e.jsx(le,{className:"button-icon h-4 w-4 mr-2"}),"Create New Player"]})})]})})}function Ye({isOpen:s,users:t,personas:m,searchQuery:i,selectedIndex:r,onSelect:d,position:f}){const c=t.filter(l=>l.username.toLowerCase().includes(i.toLowerCase())),u=m.filter(l=>l.username.toLowerCase().includes(i.toLowerCase())),g=c.length>0||u.length>0,p=[...c.map(l=>({...l,type:"user"})),...u.map(l=>({...l,type:"persona"}))];return s?e.jsx(O,{className:"mention-popover-container absolute z-50 p-0 w-64 shadow-lg border bg-background",style:{top:`${f.top}px`,left:`${f.left}px`},children:e.jsx(Ae,{className:"mention-command",children:e.jsxs(Ie,{className:"mention-command-list max-h-36",children:[!g&&e.jsx(Me,{className:"mention-command-empty py-6 text-center text-sm",children:"No users or personas found."}),p.length>0&&e.jsxs(e.Fragment,{children:[p.filter(l=>l.type==="persona").length>0&&e.jsx(ee,{heading:"Personas",className:"mention-personas-group",children:p.filter(l=>l.type==="persona").map((l,S)=>{const N=p.findIndex(P=>P.id===l.id)===r;return e.jsxs(se,{value:l.username,onSelect:()=>d(l.username),className:`mention-persona-item cursor-pointer ${N?"bg-accent":""}`,children:[e.jsx(J,{className:"mention-persona-icon mr-2 h-4 w-4"}),e.jsx("span",{className:"mention-persona-name",children:l.username}),e.jsx(X,{variant:"secondary",className:"mention-persona-badge ml-auto text-xs",children:"Persona"})]},l.id)})}),p.filter(l=>l.type==="user").length>0&&e.jsx(ee,{heading:"Users",className:"mention-users-group",children:p.filter(l=>l.type==="user").map((l,S)=>{const N=S===r;return e.jsxs(se,{value:l.username,onSelect:()=>d(l.username),className:`mention-user-item cursor-pointer ${N?"bg-accent":""}`,children:[e.jsx(Re,{className:"mention-user-icon mr-2 h-4 w-4"}),e.jsx("span",{className:"mention-user-name",children:l.username})]},l.id)})})]})]})})}):null}function Ve({messages:s,currentUserId:t,onSendMessage:m,onClearMessages:i,loading:r=!1,users:d=[],personas:f=[]}){const[c,u]=n.useState(""),g=n.useRef(null),p=n.useRef(null),l=n.useRef(null),[S,N]=n.useState(!1),[P,R]=n.useState(""),[A,T]=n.useState(0),[F,I]=n.useState({top:0,left:0}),[k,y]=n.useState(0),M=a=>{var x;return(x=f.find(v=>v.name===a))==null?void 0:x.emoji},U=a=>{var x;return(x=d.find(v=>v.id===a))==null?void 0:x.profilePicture};n.useEffect(()=>{var a;(a=g.current)==null||a.scrollIntoView({behavior:"smooth"})},[s]);const E=()=>{c.trim()&&(m(c),u(""),N(!1))},$=a=>{if(S){const x=d.filter(h=>h.username.toLowerCase().includes(P.toLowerCase())),v=f.filter(h=>h.isActive).filter(h=>h.name.toLowerCase().includes(P.toLowerCase())),C=[...x.map(h=>h.username),...v.map(h=>h.name)];a.key==="ArrowDown"?(a.preventDefault(),y(h=>h<C.length-1?h+1:h)):a.key==="ArrowUp"?(a.preventDefault(),y(h=>h>0?h-1:0)):a.key==="Enter"?(a.preventDefault(),C[k]&&b(C[k])):a.key==="Escape"&&(a.preventDefault(),N(!1),y(0))}else a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),E())},o=a=>{const x=a.target.value,v=a.target.selectionStart||0;u(x);const C=x.slice(0,v),h=C.lastIndexOf("@");if(h!==-1&&((h>0?C[h-1]:" ")===" "||h===0)){const G=C.slice(h+1);if(!G.includes(" ")){if(R(G),T(h),N(!0),y(0),p.current&&l.current){const B=p.current.getBoundingClientRect(),H=l.current.getBoundingClientRect(),ue=B.top-H.top-140,he=B.left-H.left;I({top:ue,left:he})}return}}console.log("Hiding mention popover"),N(!1),y(0)},b=a=>{var h;const x=c.slice(0,A),v=c.slice(A).replace(/^@\w*/,`@${a} `),C=x+v;u(C),N(!1),y(0),(h=p.current)==null||h.focus()};return e.jsxs(O,{className:"chat-container flex flex-col h-full rounded-none top-[-10px]",children:[e.jsx(_,{className:"chat-header p-2 md:p-4 flex-shrink-0 flex items-star justify-start border",children:e.jsxs(K,{className:"chat-title text-lg md:text-xl flex justify-between",children:[e.jsxs("div",{className:"flex",children:[e.jsx(L,{src:"/fam/all.jpeg",size:32}),e.jsx("div",{className:"ml-2",children:" QuÃª Frankfurter Allee "})]}),i&&s.length>0&&e.jsx(j,{variant:"ghost",size:"sm",onClick:i,disabled:r,className:"clear-chat-button h-8 w-8 p-0",title:"Clear all messages",children:e.jsx(ce,{className:"clear-chat-icon h-4 w-4"})})]})}),e.jsxs(z,{className:"chat-content flex flex-col flex-1 min-h-0 p-0 rounded-none",children:[e.jsx("div",{className:"messages-area flex-1 min-h-0 overflow-y-auto space-y-3 px-3 pt-3 pb-2 md:px-4 md:pt-4 md:pb-3",children:s.length===0?e.jsx("p",{className:"no-messages text-center text-muted-foreground py-8 text-sm md:text-base",children:"No messages yet. Start a conversation!"}):e.jsxs(e.Fragment,{children:[s.map(a=>{const x=a.senderId===t,v=a.senderProfilePicture||U(a.senderId);return e.jsxs("div",{className:`message-group mb-2 flex items-end gap-2 ${x?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"message-avatar flex-shrink-0",children:a.isPersona?e.jsx(L,{emoji:M(a.senderUsername),size:32}):v?e.jsx(L,{customSrc:v,size:32}):e.jsx("div",{className:"user-avatar h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Q,{className:"user-avatar-icon h-5 w-5"})})}),e.jsxs("div",{className:"message-content flex flex-col relative",children:[e.jsxs("div",{className:`message-sender-container flex items-center gap-2 mb-1 ${x?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"message-sender text-xs md:text-sm font-semibold",children:a.senderUsername}),a.isPersona&&e.jsxs(X,{className:"persona-badge text-xs",style:{backgroundColor:"hsl(var(--persona-background))",borderColor:"hsl(var(--persona-border))",color:"hsl(var(--persona-border))",border:"1px solid hsl(var(--persona-border))"},children:[e.jsx(J,{className:"persona-badge-icon h-3 w-3 mr-1"}),"Persona"]})]}),e.jsx("div",{className:`message-bubble-wrapper relative w-fit ${x?"ml-auto":""}`,children:e.jsx("div",{className:`message-item p-3 rounded-2xl max-w-2xl w-fit break-words ${a.isPersona?"message-persona bg-persona-bg dark:bg-persona-bg/30 border-l-4 border-persona-bg":x?"message-own bg-primary/10":"message-other bg-muted"}`,children:e.jsx("div",{className:"message-text text-sm md:text-base",children:a.text})})})]})]},a.id)}),e.jsx("div",{ref:g})]})}),e.jsxs("div",{ref:l,className:"chat-input-area flex gap-2 flex-shrink-0 px-3 pb-4 pt-2 md:px-4 md:pb-4 md:pt-3 border-t bg-background relative overflow-visible",children:[e.jsx(W,{ref:p,className:"chat-input flex-1 h-11 md:h-10 text-base md:text-sm",placeholder:"Type a message... (use @ to mention)",value:c,onChange:o,onKeyDown:$,disabled:r}),e.jsx(j,{className:"send-message-button h-11 w-11 md:h-10 md:w-10 flex-shrink-0",onClick:E,disabled:r||!c.trim(),children:e.jsx(Te,{className:"send-icon h-5 w-5 md:h-4 md:w-4"})}),e.jsx(Ye,{isOpen:S,users:d.map(a=>({id:a.id,username:a.username})),personas:f.filter(a=>a.isActive).map(a=>({id:a.id,username:a.name,isPersona:!0})),searchQuery:P,selectedIndex:k,onSelect:b,anchorEl:p.current,position:F})]})]})]})}function ae({users:s,currentUserId:t}){const[m,i]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"online-users-card",children:[e.jsxs(_,{className:"p-3 md:p-4 flex flex-row items-center justify-between",children:[e.jsx(K,{className:"online-users-title text-lg md:text-xl",children:"Online Players"}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"theme-settings-button h-8 w-8 p-0",title:"Theme settings",children:e.jsx(Fe,{className:"theme-settings-icon h-4 w-4"})})]}),e.jsx(z,{className:"online-users-content space-y-2 p-3 md:p-3",children:s.map(r=>e.jsxs("div",{className:"user-item flex items-center justify-between p-4 md:p-3 rounded-lg border min-h-[60px] md:min-h-0",children:[e.jsxs("div",{className:"user-info flex items-center gap-3",children:[r.profilePicture?e.jsx(L,{customSrc:r.profilePicture,size:40}):e.jsx("div",{className:"user-avatar h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Q,{className:"user-avatar-icon h-6 w-6"})}),e.jsxs("div",{className:"user-details",children:[e.jsx("p",{className:"user-name font-medium text-base md:text-sm",children:r.username}),e.jsx("p",{className:"user-status text-sm md:text-xs text-muted-foreground",children:r.id===t?"You":"Online"})]})]}),e.jsx(X,{className:"user-status-badge text-xs",variant:"outline",children:r.isOnline?"Online":"Offline"})]},r.id))})]}),e.jsx(Le,{isOpen:m,onOpenChange:i})]})}function Xe({persona:s,onActivate:t,onDeactivate:m,onDelete:i}){return e.jsxs("div",{className:"persona-card flex items-start justify-between p-4 md:p-3 rounded-lg border",children:[e.jsxs("div",{className:"persona-info flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"persona-avatar flex-shrink-0",children:s.emoji?e.jsx(L,{emoji:s.emoji,size:48}):e.jsx("div",{className:"h-12 w-12 md:h-10 md:w-10 rounded-full bg-purple-500/10 flex items-center justify-center",children:e.jsx(J,{className:"persona-avatar-icon h-6 w-6 md:h-5 md:w-5 text-purple-500"})})}),e.jsxs("div",{className:"persona-details flex-1 min-w-0",children:[e.jsxs("div",{className:"persona-header flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"persona-name font-medium text-base md:text-sm truncate",children:s.name}),e.jsx(X,{className:"persona-status-badge text-xs flex-shrink-0",variant:s.isActive?"default":"outline",children:s.isActive?"Active":"Inactive"})]}),e.jsx("p",{className:"persona-description text-sm md:text-xs text-muted-foreground line-clamp-2",children:s.description})]})]}),e.jsx("div",{className:"persona-actions flex gap-2 ml-2 flex-shrink-0",children:s.isActive?e.jsx(j,{variant:"ghost",size:"icon",className:"persona-deactivate h-8 w-8",onClick:()=>m(s.id),title:"Deactivate persona",children:e.jsx(Ge,{className:"h-4 w-4"})}):e.jsx(j,{variant:"ghost",size:"icon",className:"persona-activate h-8 w-8",onClick:()=>t(s.id),title:"Activate persona",children:e.jsx(Be,{className:"h-4 w-4"})})})]})}const Ze=["ðŸ¤–","ðŸŽ­","ðŸŽª","ðŸŽ¨","ðŸŽ¬","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ¥","ðŸŽ¯","ðŸŽ²","ðŸŽ°","ðŸŽ®","ðŸŽ³","ðŸŽ´","ðŸ§©","ðŸŽ€","ðŸŽ","ðŸŽŠ","ðŸŽ‰","ðŸŽˆ","ðŸŽ‚","ðŸ°","ðŸ§","ðŸª","ðŸ«","ðŸ¬","ðŸ­","ðŸ®","ðŸ¯","ðŸŽ","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸ’","ðŸ‘","ðŸ¥­","ðŸ","ðŸ¥¥","ðŸ¥‘","ðŸ…","ðŸ†","ðŸ¥’","ðŸ¥¬","ðŸŒ½","ðŸ¥•","ðŸ§„","ðŸ§…","ðŸ¥”","ðŸ ","ðŸ¥","ðŸ¥¯","ðŸž","ðŸ¥–","ðŸ¥¨","ðŸ§€","ðŸ¥š","ðŸ³","ðŸ§ˆ","ðŸ¥ž","ðŸ¥“","ðŸ¥ž","ðŸ¥©","ðŸ—","ðŸ–","ðŸŒ­","ðŸ”","ðŸŸ","ðŸ•","ðŸ¥ª","ðŸ¥™","ðŸ§†","ðŸŒ®","ðŸŒ¯","ðŸ¥—","ðŸ¥˜","ðŸ¥«","ðŸ","ðŸœ","ðŸ²","ðŸ›","ðŸ£","ðŸ±","ðŸ¥Ÿ","ðŸ¦ª","ðŸ¤","ðŸ™","ðŸš","ðŸ˜","ðŸ¥","ðŸ¥ ","ðŸ¥®","ðŸ¢","ðŸ¡","ðŸ§","ðŸ¨","ðŸ¦","ðŸ°","ðŸŽ‚","ðŸ§","â­","âœ¨","ðŸŒŸ","ðŸ’«","âš¡","ðŸ”¥","ðŸ’§","â„ï¸","â˜€ï¸","ðŸŒ™","â­","ðŸŒˆ","â˜ï¸","ðŸŒ¤ï¸","â›…","ðŸŒ¥ï¸","ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ¥²","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜Œ","ðŸ˜”","ðŸ˜‘","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜","ðŸ˜’","ðŸ™","ðŸ˜²","â˜¹ï¸","ðŸ¥±","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ˜ˆ","ðŸ‘¿","ðŸ’€","â˜ ï¸","ðŸ’©","ðŸ¤¡","ðŸ‘¹","ðŸ‘º","ðŸ‘»","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾","â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ","ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ«°","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘","ðŸ‘Ž","ðŸ‘Š","ðŸ‘Š","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ«²","ðŸ«³","ðŸ¤²","ðŸ¤","ðŸ¤œ","ðŸ¤›","ðŸ¦¾","ðŸ¦¿","ðŸ‘‚","ðŸ‘ƒ","ðŸ§ "];function es({onSelectEmoji:s,selectedEmoji:t}){const[m,i]=n.useState(!1),r=d=>{s(d),i(!1)};return m?e.jsxs("div",{className:"emoji-selector-container w-full min-w-0 space-y-3 p-3 border rounded-lg bg-card overflow-hidden",children:[e.jsxs("div",{className:"emoji-selector-header flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Choose an Emoji"}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>i(!1),type:"button",children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"emoji-selector-grid-wrapper w-full min-w-0 overflow-hidden",children:e.jsx("div",{className:"emoji-selector-grid grid grid-cols-5 gap-1 max-h-52 overflow-y-auto w-full",children:Ze.map(d=>e.jsx("button",{className:`emoji-selector-item h-8 w-8 flex items-center justify-center text-lg rounded hover:bg-secondary transition-colors flex-shrink-0 ${t===d?"bg-secondary ring-2 ring-primary":""}`,onClick:()=>r(d),type:"button",title:d,children:d},d))})}),e.jsx(j,{className:"emoji-selector-close-button w-full h-9 text-sm",onClick:()=>i(!1),variant:"outline",type:"button",children:"Close"})]}):e.jsx(j,{className:"emoji-selector-button w-full",onClick:()=>i(!0),variant:"outline",type:"button",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg mr-2",children:t}),"Change Emoji"]}):"Select Emoji"})}function ss({onCreatePersona:s,onCancel:t,loading:m}){const[i,r]=n.useState(""),[d,f]=n.useState(""),[c,u]=n.useState(""),g=()=>{i.trim()&&d.trim()&&c.trim()&&(s(i.trim(),d.trim(),c.trim()),r(""),f(""),u(""),t())},p=()=>{r(""),f(""),u(""),t()};return e.jsxs("div",{className:"persona-creator-form space-y-3 p-4 border rounded-lg bg-card",children:[e.jsxs("div",{className:"persona-creator-header flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Create New Persona"}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:p,children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"persona-name-input space-y-1.5",children:[e.jsx(q,{htmlFor:"persona-name",className:"text-xs",children:"Name"}),e.jsx(W,{id:"persona-name",className:"persona-name-field h-9 text-sm",placeholder:"e.g., Helpful Assistant",value:i,onChange:l=>r(l.target.value),maxLength:50})]}),e.jsxs("div",{className:"persona-description-input space-y-1.5",children:[e.jsx(q,{htmlFor:"persona-description",className:"text-xs",children:"Description"}),e.jsx(Oe,{id:"persona-description",className:"persona-description-field min-h-[120px] text-sm",placeholder:"Describe this persona's role and behavior...",value:d,onChange:l=>f(l.target.value),maxLength:500})]}),e.jsxs("div",{className:"persona-emoji-input space-y-1.5",children:[e.jsx(q,{htmlFor:"persona-emoji",className:"text-xs",children:"Emoji Avatar"}),e.jsx(W,{id:"persona-emoji",className:"persona-emoji-field h-9 text-lg text-center",placeholder:"ðŸ˜€",value:c,onChange:l=>u(l.target.value),maxLength:2}),e.jsx(es,{onSelectEmoji:l=>u(l),selectedEmoji:c})]}),e.jsxs("div",{className:"persona-creator-actions flex gap-2",children:[e.jsx(j,{className:"persona-submit-button flex-1 h-9 text-sm",onClick:g,disabled:!i.trim()||!d.trim()||!c.trim()||m,children:m?"Creating...":"Create"}),e.jsx(j,{className:"persona-cancel-button h-9 text-sm",onClick:p,variant:"outline",children:"Cancel"})]})]})}function ne({personas:s,loading:t,error:m,onCreatePersona:i,onActivatePersona:r,onDeactivatePersona:d,onDeletePersona:f}){const[c,u]=n.useState(!1);return e.jsxs(O,{className:"persona-list-card h-full flex flex-col",children:[e.jsxs(_,{className:"p-3 md:p-3 flex flex-row items-center justify-between flex-shrink-0",children:[e.jsxs(K,{className:"persona-list-title text-lg md:text-xl flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"AI Personas"]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",onClick:()=>u(!0),title:"Create new persona",children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsxs(z,{className:"persona-list-content flex-1 min-h-0 overflow-y-auto space-y-3 p-3 md:p-3",children:[c&&e.jsx(ss,{onCreatePersona:i,onCancel:()=>u(!1),loading:t}),m&&e.jsx("div",{className:"persona-error p-3 rounded-lg bg-destructive/10 text-destructive text-sm",children:m}),s.length===0?e.jsx("div",{className:"persona-empty p-6 text-center text-muted-foreground text-sm",children:"No personas yet. Create one to get started!"}):e.jsx("div",{className:"persona-items space-y-2",children:s.map(g=>e.jsx(Xe,{persona:g,onActivate:r,onDeactivate:d,onDelete:f},g.id))})]})]})}function ms(){const{currentUser:s,onlineUsers:t,isConnected:m,loading:i,error:r,usersLoading:d,usersError:f,chatMessages:c,personas:u,personasLoading:g,personasError:p,createUser:l,selectAccount:S,connectWebSocket:N,disconnectWebSocket:P,sendMessage:R,fetchMessages:A,clearMessages:T,createPersona:F,activatePersona:I,deactivatePersona:k,deletePersona:y,fetchPersonas:M}=Ke(),U=me(),[E,$]=n.useState(!!s),[o,b]=n.useState(!1),[a,x]=n.useState("chat");n.useEffect(()=>{s&&!E&&$(!0)},[s,E]),n.useEffect(()=>{U.log("page_navigation",{page:"/game",timestamp:new Date().toISOString(),userCreated:!!s})},[]),n.useEffect(()=>{if(!s)return;const w=B=>{P()};return window.addEventListener("beforeunload",w),()=>{window.removeEventListener("beforeunload",w)}},[s,U,P]),n.useEffect(()=>{s&&!m&&N()},[s,m,N]),n.useEffect(()=>{s&&A(D)},[s,A]),n.useEffect(()=>{s&&M(D)},[s,M]);const v=w=>{localStorage.setItem("game_current_user",JSON.stringify(w)),S(w),te(w)},C=async w=>{l(w),$(!0),b(!1),s&&(te(s),U.log("user_profile_created",{userId:s.id,username:s.username,profilePicture:s.profilePicture||void 0,hasProfilePicture:!!s.profilePicture,isOnline:s.isOnline}))},h=w=>{s&&R(D,s.id,s.username,s.profilePicture,w)},Z=()=>{T(D)},G=(w,B,H)=>{F(D,w,B,H)};return!E||!s?o?e.jsx(Je,{onCreateUser:C,loading:d,error:f}):e.jsx(Qe,{users:t,onSelectAccount:v,onCreateNew:()=>b(!0),loading:d}):e.jsxs("div",{className:"game-page flex flex-col h-[100dvh] md:h-screen overflow-hidden",children:[r&&e.jsx("div",{className:"error-section p-3 md:p-4 flex-shrink-0",children:e.jsx(O,{className:"error-card border-red-500",children:e.jsx(z,{className:"error-content pt-6",children:e.jsx("p",{className:"error-text text-red-500",children:r})})})}),e.jsxs("div",{className:"mobile-tabs flex md:hidden border-b border-border bg-tab flex-shrink-0",children:[e.jsxs(j,{variant:"ghost",className:`mobile-tab-chat flex-1 rounded-none h-10 text-sm ${a==="chat"?"bg-active text-foreground font-semibold":""}`,onClick:()=>x("chat"),children:[e.jsx(_e,{className:"tab-icon mr-2 h-4 w-4"}),"Chat"]}),e.jsxs(j,{variant:"ghost",className:`mobile-tab-users flex-1 rounded-none h-10 text-sm ${a==="users"?"bg-active text-foreground font-semibold":""}`,onClick:()=>x("users"),children:[e.jsx(ie,{className:"tab-icon mr-2 h-4 w-4"}),"Users (",t.length,")"]}),e.jsxs(j,{variant:"ghost",className:`mobile-tab-personas flex-1 rounded-none h-10 text-sm ${a==="personas"?"bg-active text-foreground font-semibold":""}`,onClick:()=>x("personas"),children:[e.jsx(J,{className:"tab-icon mr-2 h-4 w-4"}),"Personas (",u.length,")"]})]}),e.jsxs("div",{className:"main-content-grid flex-1 min-h-0 px-0 pt-0 pb-0 md:p-3 md:grid md:grid-cols-3 md:gap-3",children:[e.jsx("div",{className:`chat-section h-full min-h-0 md:col-span-2 ${a==="chat"?"block":"hidden"} md:block rounded-none`,children:e.jsx(Ve,{messages:c[D]||[],currentUserId:s.id,onSendMessage:h,onClearMessages:Z,loading:i,users:t,personas:u})}),e.jsxs("div",{className:"right-panel h-full min-h-0 hidden md:flex md:flex-col md:gap-4",children:[e.jsx("div",{className:"users-section flex-1 min-h-0 overflow-y-auto",children:e.jsx(ae,{users:t,currentUserId:s.id})}),e.jsx("div",{className:"persona-section flex-1 min-h-0 overflow-y-auto",children:e.jsx(ne,{personas:u,loading:g,error:p,onCreatePersona:G,onActivatePersona:I,onDeactivatePersona:k,onDeletePersona:y})})]}),e.jsx("div",{className:`users-section-mobile h-full min-h-0 overflow-y-auto ${a==="users"?"block":"hidden"} md:hidden`,children:e.jsx(ae,{users:t,currentUserId:s.id})}),e.jsx("div",{className:`persona-section-mobile h-full min-h-0 overflow-y-auto ${a==="personas"?"block":"hidden"} md:hidden`,children:e.jsx(ne,{personas:u,loading:g,error:p,onCreatePersona:G,onActivatePersona:I,onDeactivatePersona:k,onDeletePersona:y})})]})]})}export{ms as GamePage};
