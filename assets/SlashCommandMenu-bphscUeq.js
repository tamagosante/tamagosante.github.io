import{r as o,j as m,b as R}from"./react-vendor-Byz07MLO.js";import{g as $}from"./cursorPosition-otMhJ5rZ.js";import{ap as q,aq as z,H as E}from"./index-hTFRJyrx.js";function I(u,i){const a=u.toLowerCase(),l=i.toLowerCase();let c=0;for(let n=0;n<l.length&&c<a.length;n++)l[n]===a[c]&&c++;return c===a.length}function G({commands:u,inputRef:i,onCommandExecute:a}){const[l,c]=o.useState(!1),[n,x]=o.useState(""),[y,e]=o.useState(0),[r,k]=o.useState(null),[L,M]=o.useState({top:0,left:0}),g=o.useMemo(()=>{if(!n)return u;const t=n.toLowerCase();return u.filter(s=>s.trigger.toLowerCase().startsWith(t)||s.name.toLowerCase().includes(t)||I(n,s.trigger)||I(n,s.name))},[u,n]);o.useMemo(()=>{e(0)},[g.length]);const p=o.useCallback(()=>{c(!1),x(""),k(null),e(0)},[]),C=o.useCallback(t=>{var D,N;const s=i.current;if(!s||r===null)return;const f=s.selectionStart??0,h=s.value,d={query:n,fullText:h,cursorPosition:f,slashPosition:r},w=t.onSelect(d),b=w??"",v=h.substring(0,r),S=h.substring(f),H=v+b+S,P=((D=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:D.set)||((N=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:N.set);P&&(P.call(s,H),s.dispatchEvent(new Event("input",{bubbles:!0})));const j=r+b.length;s.setSelectionRange(j,j),a==null||a(t,w),p()},[i,r,n,a,p]),T=o.useCallback(t=>{const s=t.currentTarget,f=s.selectionStart??0,h=s.value;if(t.key==="/"&&!l){const d=f>0?h[f-1]:"";if(f===0||/\s/.test(d)){const w=$(s);if(w){const b=s.getBoundingClientRect(),v=window.getComputedStyle(s),S=parseInt(v.lineHeight||v.fontSize)||20;M({top:b.top+w.top-S-q.slashCommand.menuGapAboveInput,left:b.left+w.left})}k(f),c(!0),x(""),e(0)}return}l&&(t.key==="ArrowDown"?(t.preventDefault(),e(d=>d<g.length-1?d+1:0)):t.key==="ArrowUp"?(t.preventDefault(),e(d=>d>0?d-1:g.length-1)):t.key==="Enter"||t.key==="Tab"?g.length>0&&(t.preventDefault(),C(g[y])):t.key==="Escape"&&(t.preventDefault(),p()))},[l,g,y,C,p]),O=o.useCallback(t=>{if(!l||r===null)return;if(r>=t.length||t[r]!=="/"){p();return}const s=i.current,f=(s==null?void 0:s.selectionStart)??t.length,h=t.substring(r+1,f);if(h.includes(" ")){p();return}x(h)},[l,r,i,p]);return{isOpen:l,query:n,filteredCommands:g,selectedIndex:y,handleKeyDown:T,handleChange:O,selectCommand:C,close:p,menuPosition:L}}const A=({commands:u,selectedIndex:i,position:a,onSelect:l,onClose:c})=>{const n=o.useRef(null),x=o.useRef(null);o.useEffect(()=>{var e;(e=x.current)==null||e.scrollIntoView({block:"nearest"})},[i]),o.useEffect(()=>{const e=r=>{n.current&&!n.current.contains(r.target)&&c()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]);const y=m.jsx("div",{ref:n,"data-test":"slash-command-menu",className:E("fixed min-w-[200px] max-w-[300px]","rounded-md border bg-popover p-1 shadow-md",u.length>0&&"max-h-[200px] overflow-y-auto"),style:{top:a.top,left:a.left,zIndex:z.slashCommandMenu,transform:"translateY(-100%)"},children:u.length===0?m.jsx("div",{"data-test":"slash-command-empty",className:"py-2 px-2 text-sm text-muted-foreground text-center",children:"No commands found"}):u.map((e,r)=>m.jsxs("div",{ref:r===i?x:void 0,"data-test":`slash-command-item-${e.id}`,className:E("flex items-center gap-2 rounded-sm px-2 py-1.5 text-sm cursor-pointer","select-none outline-none",r===i?"bg-accent text-accent-foreground":"hover:bg-accent/50"),onClick:()=>l(e),children:[e.icon&&m.jsx("span",{"data-test":`slash-command-icon-${e.id}`,className:"flex-shrink-0 w-4 h-4",children:e.icon}),m.jsxs("div",{"data-test":`slash-command-content-${e.id}`,className:"flex flex-col flex-1 min-w-0",children:[m.jsxs("span",{"data-test":`slash-command-name-${e.id}`,className:"font-medium truncate",children:["/",e.trigger]}),e.description&&m.jsx("span",{"data-test":`slash-command-description-${e.id}`,className:"text-xs text-muted-foreground truncate",children:e.description})]})]},e.id))});return R.createPortal(y,document.body)};A.displayName="SlashCommandMenu";export{A as S,G as u};
