var A=Object.defineProperty;var D=(i,t,s)=>t in i?A(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var b=(i,t,s)=>D(i,typeof t!="symbol"?t+"":t,s);import{r as c,j as o}from"./react-vendor-BOZDwKwV.js";import{B as h,as as F}from"./index-Cmkaodfg.js";import{t as d}from"./utils-CGefl9Xh.js";import{j as M,O as I,E as R,D as V,am as z,F as U}from"./icons-Cf9puwNc.js";class J{constructor(){b(this,"logs",[]);b(this,"logsByGroup",new Map);b(this,"maxLogs",200);b(this,"enabled",!0)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setMaxLogs(t){this.maxLogs=t,this.trimLogs()}debug(t,s,a,l){this.addLog("debug",t,s,a,l)}info(t,s,a,l){this.addLog("info",t,s,a,l)}warn(t,s,a,l){this.addLog("warn",t,s,a,l)}error(t,s,a,l){this.addLog("error",t,s,a,l)}addLog(t,s,a,l,g){if(!this.enabled)return;const x={timestamp:Date.now(),level:t,category:s,message:a,data:l,group:g};if(this.logs.push(x),this.trimLogs(),g){this.logsByGroup.has(g)||this.logsByGroup.set(g,[]);const m=this.logsByGroup.get(g);m.push(x),m.length>this.maxLogs&&this.logsByGroup.set(g,m.slice(-this.maxLogs))}}trimLogs(){this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs))}getLogs(){return[...this.logs]}getLogsByCategory(t){return this.logs.filter(s=>s.category===t)}getLogsByLevel(t){return this.logs.filter(s=>s.level===t)}getLogsByGroup(t){return this.logsByGroup.get(t)||[]}getLogGroups(){return Array.from(this.logsByGroup.keys()).sort()}getLogsAsString(){return this.logs.map(t=>{const s=new Date(t.timestamp).toISOString().substr(11,12),a=t.data?` ${JSON.stringify(t.data)}`:"";return`[${s}] [${t.level.toUpperCase()}] [${t.category}] ${t.message}${a}`}).join(`
`)}getLogsAsJSON(){return JSON.stringify(this.logs,null,2)}clear(){this.logs=[],this.logsByGroup.forEach((t,s)=>{this.logsByGroup.set(s,[])})}count(){return this.logs.length}async copyToClipboard(){try{return await navigator.clipboard.writeText(this.getLogsAsString()),!0}catch(t){return console.error("Failed to copy logs to clipboard:",t),!1}}downloadLogs(t="mobile-logs.txt"){const s=new Blob([this.getLogsAsString()],{type:"text/plain"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}}const u=new J,L="mobile-log-viewer-group",H=({defaultVisible:i=!1,autoRefresh:t=!0,refreshInterval:s=500,onClose:a})=>{const[l,g]=c.useState(i),[x,m]=c.useState(""),[f,j]=c.useState("all"),[v,S]=c.useState("all"),[p,C]=c.useState(()=>{try{return localStorage.getItem(L)||"all"}catch{return"all"}}),r=c.useRef(null);c.useEffect(()=>{try{localStorage.setItem(L,p)}catch{}},[p]),c.useEffect(()=>{if(!t||!l)return;const e=setInterval(()=>{y()},s);return()=>clearInterval(e)},[t,l,s,f,v,p]);const y=()=>{let e=p!=="all"?u.getLogsByGroup(p):u.getLogs();f!=="all"&&(e=e.filter(n=>n.level===f)),v!=="all"&&(e=e.filter(n=>n.category===v));const w=e.map(n=>{const O=new Date(n.timestamp).toISOString().substr(11,12),P=n.data?` ${JSON.stringify(n.data)}`:"";return`[${O}] [${n.level.toUpperCase()}] [${n.category}] ${n.message}${P}`}).join(`
`);m(w)},N=async()=>{let e=await u.copyToClipboard();if(!e&&r.current)try{r.current.focus(),r.current.select(),r.current.setSelectionRange(0,r.current.value.length),e=document.execCommand("copy"),setTimeout(()=>{e?d.success("Logs copied to clipboard!"):d.error("Failed to copy. Please use Select Text button and copy manually.")},100)}catch(w){console.error("Copy fallback failed:",w),setTimeout(()=>{d.error("Failed to copy. Please use Select Text button and copy manually.")},100)}else setTimeout(e?()=>{d.success("Logs copied to clipboard!")}:()=>{d.error("Failed to copy. Please use Select Text button and copy manually.")},100)},T=()=>{u.clear(),m(""),d.success("Logs cleared!")},k=()=>{u.downloadLogs(`mobile-logs-${Date.now()}.txt`),d.success("Logs downloaded!")},B=()=>{r.current&&(r.current.focus(),r.current.select(),r.current.setSelectionRange(0,r.current.value.length),setTimeout(()=>{d.success("Text selected! Long-press to copy.")},100))},G=()=>{a?a():(g(!l),l||y())},$=["all",...new Set(u.getLogs().map(e=>e.category))],E=["all",...u.getLogGroups()];return l?o.jsxs("div",{className:"fixed bottom-4 left-4 z-50 bg-background border rounded-lg shadow-lg p-4 w-[90vw] max-w-[600px] max-h-[500px] flex flex-col","data-prevent-canvas-click":!0,"data-ui-panel":!0,"data-test":"mobile-log-viewer-container",onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),style:{touchAction:"auto"},children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-sm font-semibold","data-test":"mobile-log-viewer-title",children:"Mobile Debug Logs"}),o.jsxs("div",{className:"flex gap-2","data-test":"mobile-log-viewer-actions",children:[o.jsx(h,{onClick:B,variant:"ghost",size:"sm",title:"Select all text","data-test":"mobile-log-viewer-select-text",children:o.jsx(M,{className:"h-4 w-4"})}),o.jsx(h,{onClick:N,variant:"ghost",size:"sm",title:"Copy to clipboard","data-test":"mobile-log-viewer-copy",children:o.jsx(I,{className:"h-4 w-4"})}),o.jsx(h,{onClick:k,variant:"ghost",size:"sm",title:"Download logs","data-test":"mobile-log-viewer-download",children:o.jsx(R,{className:"h-4 w-4"})}),o.jsx(h,{onClick:T,variant:"ghost",size:"sm",title:"Clear logs","data-test":"mobile-log-viewer-clear",children:o.jsx(V,{className:"h-4 w-4"})}),o.jsx(h,{onClick:G,variant:"ghost",size:"sm",title:"Hide","data-test":"mobile-log-viewer-hide",children:o.jsx(z,{className:"h-4 w-4"})})]})]}),o.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap","data-test":"mobile-log-viewer-filters",children:[o.jsx("select",{value:p,onChange:e=>C(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background font-semibold","data-test":"mobile-log-viewer-filter-group",children:E.map(e=>o.jsx("option",{value:e,"data-test":`mobile-log-viewer-filter-group-option-${e}`,children:e==="all"?"All Groups":e},e))}),o.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-level",children:[o.jsx("option",{value:"all","data-test":"mobile-log-viewer-filter-level-option-all",children:"All Levels"}),o.jsx("option",{value:"debug","data-test":"mobile-log-viewer-filter-level-option-debug",children:"Debug"}),o.jsx("option",{value:"info","data-test":"mobile-log-viewer-filter-level-option-info",children:"Info"}),o.jsx("option",{value:"warn","data-test":"mobile-log-viewer-filter-level-option-warn",children:"Warn"}),o.jsx("option",{value:"error","data-test":"mobile-log-viewer-filter-level-option-error",children:"Error"})]}),o.jsx("select",{value:v,onChange:e=>S(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-category",children:$.map(e=>o.jsx("option",{value:e,"data-test":`mobile-log-viewer-filter-category-option-${e}`,children:e==="all"?"All Categories":e},e))})]}),o.jsx("div",{className:"flex-1 overflow-auto",onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),style:{touchAction:"auto"},"data-test":"mobile-log-viewer-logs-container",children:o.jsx("textarea",{ref:r,readOnly:!0,value:x||"No logs yet. Logs will appear here as events occur.",className:"w-full h-full text-xs font-mono bg-muted p-2 rounded border-none resize-none",style:{minHeight:"300px",touchAction:"auto"},onClick:e=>{e.target.select()},onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),"data-test":"mobile-log-viewer-logs-textarea"})}),o.jsxs("div",{className:"mt-2 text-xs text-muted-foreground flex justify-between","data-test":"mobile-log-viewer-footer",children:[o.jsxs("span",{"data-test":"mobile-log-viewer-total-count",children:["Total: ",u.count()," logs"]}),o.jsxs("span",{"data-test":"mobile-log-viewer-auto-refresh",children:["Auto-refresh: ",t?"ON":"OFF"]})]})]}):null},Q=({defaultVisible:i=!1,className:t=""})=>{const[s,a]=c.useState(i);return F()?o.jsxs(o.Fragment,{children:[o.jsx(h,{variant:"outline",size:"icon",onClick:()=>a(!s),className:`h-7 w-7 bg-background/90 backdrop-blur-sm shadow-md ${t}`,"data-prevent-canvas-click":!0,"data-ui-panel":!0,title:s?"Hide Mobile Logs":"Show Mobile Logs","data-test":"mobile-log-viewer-toggle-button",children:o.jsx(U,{className:"h-4 w-4","data-test":"mobile-log-viewer-icon"})}),s&&o.jsx(H,{defaultVisible:!0,autoRefresh:!0,refreshInterval:500,onClose:()=>a(!1),"data-test":"mobile-log-viewer"})]}):null};export{Q as M};
