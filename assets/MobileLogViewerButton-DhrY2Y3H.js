var P=Object.defineProperty;var M=(a,t,s)=>t in a?P(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var f=(a,t,s)=>M(a,typeof t!="symbol"?t+"":t,s);import{r as c,b as F,j as o}from"./react-vendor-CrhW4DYn.js";import{aL as I,B as h,aM as V}from"./index-CgyRe94A.js";import{t as u}from"./utils-DPdF7W5J.js";import{n as R,_ as z,Q as U,O as J,au as _,F as H}from"./icons-6Gjq1X59.js";const y=a=>{if(a==null)return a;if(typeof a=="number")return Math.round(a*10)/10;if(Array.isArray(a))return a.map(y);if(typeof a=="object"){const t={};for(const[s,r]of Object.entries(a))t[s]=y(r);return t}return a};class W{constructor(){f(this,"logs",[]);f(this,"logsByGroup",new Map);f(this,"maxLogs",200);f(this,"enabled",!0)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setMaxLogs(t){this.maxLogs=t,this.trimLogs()}debug(t,s,r,l){this.addLog("debug",t,s,r,l)}info(t,s,r,l){this.addLog("info",t,s,r,l)}warn(t,s,r,l){this.addLog("warn",t,s,r,l)}error(t,s,r,l){this.addLog("error",t,s,r,l)}addLog(t,s,r,l,g){if(!this.enabled)return;const w=l?y(l):void 0,b={timestamp:Date.now(),level:t,category:s,message:r,data:w,group:g};if(this.logs.push(b),this.trimLogs(),g){this.logsByGroup.has(g)||this.logsByGroup.set(g,[]);const d=this.logsByGroup.get(g);d.push(b),d.length>this.maxLogs&&this.logsByGroup.set(g,d.slice(-this.maxLogs))}}trimLogs(){this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs))}getLogs(){return[...this.logs]}getLogsByCategory(t){return this.logs.filter(s=>s.category===t)}getLogsByLevel(t){return this.logs.filter(s=>s.level===t)}getLogsByGroup(t){return this.logsByGroup.get(t)||[]}getLogGroups(){return Array.from(this.logsByGroup.keys()).sort()}getLogsAsString(){return this.logs.map(t=>{const s=new Date(t.timestamp).toISOString().substr(11,12),r=t.data?` ${JSON.stringify(t.data)}`:"";return`[${s}] [${t.level.toUpperCase()}] [${t.category}] ${t.message}${r}`}).join(`
`)}getLogsAsJSON(){return JSON.stringify(this.logs,null,2)}clear(){this.logs=[],this.logsByGroup.forEach((t,s)=>{this.logsByGroup.set(s,[])})}count(){return this.logs.length}async copyToClipboard(){try{return await navigator.clipboard.writeText(this.getLogsAsString()),!0}catch(t){return console.error("Failed to copy logs to clipboard:",t),!1}}downloadLogs(t="mobile-logs.txt"){const s=new Blob([this.getLogsAsString()],{type:"text/plain"}),r=URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)}}const m=new W,j="mobile-log-viewer-group",K=({defaultVisible:a=!1,autoRefresh:t=!0,refreshInterval:s=500,onClose:r})=>{const[l,g]=c.useState(a),[w,b]=c.useState(""),[d,S]=c.useState("all"),[x,C]=c.useState("all"),[p,N]=c.useState(()=>{try{return localStorage.getItem(j)||"all"}catch{return"all"}}),i=c.useRef(null);c.useEffect(()=>{try{localStorage.setItem(j,p)}catch{}},[p]),c.useEffect(()=>{if(!t||!l)return;const e=setInterval(()=>{L()},s);return()=>clearInterval(e)},[t,l,s,d,x,p]);const L=()=>{let e=p!=="all"?m.getLogsByGroup(p):m.getLogs();d!=="all"&&(e=e.filter(n=>n.level===d)),x!=="all"&&(e=e.filter(n=>n.category===x));const v=e.map(n=>{const E=new Date(n.timestamp).toISOString().substr(11,12),O=n.data?` ${JSON.stringify(n.data)}`:"";return`[${E}] [${n.level.toUpperCase()}] [${n.category}] ${n.message}${O}`}).join(`
`);b(v)},T=async()=>{let e=await m.copyToClipboard();if(!e&&i.current)try{i.current.focus(),i.current.select(),i.current.setSelectionRange(0,i.current.value.length),e=document.execCommand("copy"),setTimeout(()=>{e?u.success("Logs copied to clipboard!"):u.error("Failed to copy. Please use Select Text button and copy manually.")},100)}catch(v){console.error("Copy fallback failed:",v),setTimeout(()=>{u.error("Failed to copy. Please use Select Text button and copy manually.")},100)}else setTimeout(e?()=>{u.success("Logs copied to clipboard!")}:()=>{u.error("Failed to copy. Please use Select Text button and copy manually.")},100)},k=()=>{m.clear(),b(""),u.success("Logs cleared!")},B=()=>{m.downloadLogs(`mobile-logs-${Date.now()}.txt`),u.success("Logs downloaded!")},G=()=>{i.current&&(i.current.focus(),i.current.select(),i.current.setSelectionRange(0,i.current.value.length),setTimeout(()=>{u.success("Text selected! Long-press to copy.")},100))},$=()=>{r?r():(g(!l),l||L())},A=["all",...new Set(m.getLogs().map(e=>e.category))],D=["all",...m.getLogGroups()];return l?F.createPortal(o.jsxs("div",{className:"fixed bottom-4 left-4 bg-background border rounded-lg shadow-lg p-4 w-[90vw] max-w-[600px] max-h-[500px] flex flex-col",style:{zIndex:I.mobileLogViewer,touchAction:"auto"},"data-prevent-canvas-click":!0,"data-ui-panel":!0,"data-test":"mobile-log-viewer-container",onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-sm font-semibold","data-test":"mobile-log-viewer-title",children:"Mobile Debug Logs"}),o.jsxs("div",{className:"flex gap-2","data-test":"mobile-log-viewer-actions",children:[o.jsx(h,{onClick:G,variant:"ghost",size:"sm",title:"Select all text","data-test":"mobile-log-viewer-select-text",children:o.jsx(R,{className:"h-4 w-4"})}),o.jsx(h,{onClick:T,variant:"ghost",size:"sm",title:"Copy to clipboard","data-test":"mobile-log-viewer-copy",children:o.jsx(z,{className:"h-4 w-4"})}),o.jsx(h,{onClick:B,variant:"ghost",size:"sm",title:"Download logs","data-test":"mobile-log-viewer-download",children:o.jsx(U,{className:"h-4 w-4"})}),o.jsx(h,{onClick:k,variant:"ghost",size:"sm",title:"Clear logs","data-test":"mobile-log-viewer-clear",children:o.jsx(J,{className:"h-4 w-4"})}),o.jsx(h,{onClick:$,variant:"ghost",size:"sm",title:"Hide","data-test":"mobile-log-viewer-hide",children:o.jsx(_,{className:"h-4 w-4"})})]})]}),o.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap","data-test":"mobile-log-viewer-filters",children:[o.jsx("select",{value:p,onChange:e=>N(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background font-semibold","data-test":"mobile-log-viewer-filter-group",children:D.map(e=>o.jsx("option",{value:e,"data-test":`mobile-log-viewer-filter-group-option-${e}`,children:e==="all"?"All Groups":e},e))}),o.jsxs("select",{value:d,onChange:e=>S(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-level",children:[o.jsx("option",{value:"all","data-test":"mobile-log-viewer-filter-level-option-all",children:"All Levels"}),o.jsx("option",{value:"debug","data-test":"mobile-log-viewer-filter-level-option-debug",children:"Debug"}),o.jsx("option",{value:"info","data-test":"mobile-log-viewer-filter-level-option-info",children:"Info"}),o.jsx("option",{value:"warn","data-test":"mobile-log-viewer-filter-level-option-warn",children:"Warn"}),o.jsx("option",{value:"error","data-test":"mobile-log-viewer-filter-level-option-error",children:"Error"})]}),o.jsx("select",{value:x,onChange:e=>C(e.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-category",children:A.map(e=>o.jsx("option",{value:e,"data-test":`mobile-log-viewer-filter-category-option-${e}`,children:e==="all"?"All Categories":e},e))})]}),o.jsx("div",{className:"flex-1 overflow-auto",onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),style:{touchAction:"auto"},"data-test":"mobile-log-viewer-logs-container",children:o.jsx("textarea",{ref:i,readOnly:!0,value:w||"No logs yet. Logs will appear here as events occur.",className:"w-full h-full text-xs font-mono bg-muted p-2 rounded border-none resize-none",style:{minHeight:"300px",touchAction:"auto"},onClick:e=>{e.target.select()},onPointerDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),"data-test":"mobile-log-viewer-logs-textarea"})}),o.jsxs("div",{className:"mt-2 text-xs text-muted-foreground flex justify-between","data-test":"mobile-log-viewer-footer",children:[o.jsxs("span",{"data-test":"mobile-log-viewer-total-count",children:["Total: ",m.count()," logs"]}),o.jsxs("span",{"data-test":"mobile-log-viewer-auto-refresh",children:["Auto-refresh: ",t?"ON":"OFF"]})]})]}),document.body):null},ee=({defaultVisible:a=!1,className:t=""})=>{const[s,r]=c.useState(a);return V()?o.jsxs(o.Fragment,{children:[o.jsx(h,{variant:"outline",size:"icon",onClick:()=>r(!s),className:`h-7 w-7 bg-background/90 backdrop-blur-sm shadow-md ${t}`,"data-prevent-canvas-click":!0,"data-ui-panel":!0,title:s?"Hide Mobile Logs":"Show Mobile Logs","data-test":"mobile-log-viewer-toggle-button",children:o.jsx(H,{className:"h-4 w-4","data-test":"mobile-log-viewer-icon"})}),s&&o.jsx(K,{defaultVisible:!0,autoRefresh:!0,refreshInterval:500,onClose:()=>r(!1),"data-test":"mobile-log-viewer"})]}):null};export{ee as M};
