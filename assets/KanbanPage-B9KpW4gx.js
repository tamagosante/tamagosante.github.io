const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TodoTable-EEh22aZ-.js","assets/react-vendor-CrhW4DYn.js","assets/table-GtDJTbaS.js","assets/index-CgyRe94A.js","assets/utils-DPdF7W5J.js","assets/radix-ui-BcQf1l4u.js","assets/ui-utils-BxIQ3qGg.js","assets/icons-6Gjq1X59.js","assets/index-BxdBf7Gf.css"])))=>i.map(i=>d[i]);
var et=Object.defineProperty;var tt=(t,n,a)=>n in t?et(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;var V=(t,n,a)=>tt(t,typeof n!="symbol"?n+"":n,a);import{as as ue,V as _,bs as Oe,aj as P,C as Ae,W as te,M as at,B as F,aP as st,bt as Se,ak as G,bu as nt,q as T,ah as rt,aW as it,bv as ct,Q as K,bw as je,bx as lt,by as ot,w as he,z as ae,S as q,a as Y,b as X,c as ee,d as J,E as Re,at as dt,a8 as Le,bz as Be,bA as ut,bB as We,bC as Me,bD as ze,bE as Ve,bF as _e,bG as se,bH as fe,bI as Pe,bJ as ht,T as pt,F as mt,G as we,H as Ie,y as gt,bK as ft,_ as xt}from"./index-CgyRe94A.js";import{r as C,j as e}from"./react-vendor-CrhW4DYn.js";import{D as bt}from"./DemoLayout-t6R5WvcA.js";import{a as vt,b as jt,u as kt}from"./react-hooks-B0JzEvCg.js";import{aV as Ct,aA as Nt,O as Ke,a9 as yt,as as St,ah as He,X as z,a1 as pe,a2 as Pt,aH as wt,e as It,Q as Dt,V as Et,am as de,E as Tt,a$ as Ft,y as xe}from"./icons-6Gjq1X59.js";import{C as $t,j as Ot}from"./radix-ui-BcQf1l4u.js";import{t as W}from"./utils-DPdF7W5J.js";import"./ui-utils-BxIQ3qGg.js";import"./Breadcrumbs-DwpmWO_t.js";import"./DragDropManager-BCQ9eUTy.js";const At=[{value:G.LOW,label:"Low",variant:"secondary",className:"bg-gray-100 text-gray-800 border-gray-200"},{value:G.MEDIUM,label:"Medium",variant:"secondary",className:"bg-blue-100 text-blue-800 border-blue-200"},{value:G.HIGH,label:"High",variant:"secondary",className:"bg-orange-100 text-orange-800 border-orange-200"},{value:G.URGENT,label:"Urgent",variant:"destructive",className:"bg-red-100 text-red-800 border-red-200"}],Rt=t=>{var n,a,r;return((r=(a=(n=t.app)==null?void 0:n.claude)==null?void 0:a.data)==null?void 0:r.projects)??[]},Lt=t=>{var n,a,r;return((r=(a=(n=t.app)==null?void 0:n.claude)==null?void 0:a.ui)==null?void 0:r.loadingProjects)??!1};function Bt({todo:t,isDragging:n,kanbanManager:a,onDelete:r,onUpdate:s,isDetailsPanelOpen:c,onOpenDetailsPanel:o,onCloseDetailsPanel:l}){var H,re,ie,ce,le;const u=vt(a,t.id.value,{todoId:t.id.value}),f=ue(Rt),p=ue(Lt),b=JSON.stringify(((H=t.customProps)==null?void 0:H.sessionIds)??[]),x=C.useMemo(()=>{var N;return((N=t.customProps)==null?void 0:N.sessionIds)??[]},[b]),v=C.useCallback(N=>{const I=[];if(N.description?(I.push(`## ${N.title}`),I.push(""),I.push(N.description)):I.push(`${N.title}`),N.dueDate){const O=new Date(N.dueDate.value);I.push(`- Due: ${O.toLocaleDateString()}`)}return N.tags.length>0&&I.push(`- Tags: ${N.tags.join(", ")}`),N.subtasks.length>0&&(I.push(""),I.push("**Subtasks:**"),N.subtasks.forEach(O=>{const M=O.isCompleted?"[x]":"[ ]";I.push(`${M} ${O.title}`)})),I.push(`
`),I.push("I permit and approve all file changes in this session."),I.join(`
`)},[]),k=C.useCallback(async N=>{try{await _.updateTodo(t.id,{priority:N}),s==null||s()}catch(I){console.error("Failed to update priority:",I)}},[t.id,s]),i=C.useCallback(async N=>{try{await _.updateTodo(t.id,{category:N}),s==null||s()}catch(I){console.error("Failed to update category:",I)}},[t.id,t.title,t.category,s]),h=C.useCallback(async N=>{try{await _.updateTodo(t.id,{customProps:{claudeProjectPath:N}}),s==null||s()}catch(I){console.error("Failed to update Claude project:",I)}},[t.id,s]),d=C.useCallback(async(N,I)=>{try{await Oe.claude.linkSessionToTodo(t.id,N),await _.updateTodo(t.id,{status:P.DOING,description:I}),s==null||s()}catch(O){console.error("Failed to update todo status:",O)}},[t.id,s]),m=C.useMemo(()=>f.map(N=>({value:N.path,label:N.name,variant:"outline",className:"bg-purple-50 text-purple-800 border-purple-200"})),[f]),w=C.useMemo(()=>[{value:"__no_project__",label:"No Project",variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200"},...m],[m]),g=C.useCallback(N=>{if(!N)return null;const I=new Date(N.value),O=new Date,M=Math.ceil((I.getTime()-O.getTime())/(1e3*60*60*24));return M<0?e.jsx("span",{className:"text-red-500 text-xs",children:"Overdue"}):M===0?e.jsx("span",{className:"text-orange-500 text-xs",children:"Today"}):M===1?e.jsx("span",{className:"text-blue-500 text-xs",children:"Tomorrow"}):e.jsx("span",{className:"text-gray-500 text-xs",children:I.toLocaleDateString()})},[]),j=C.useCallback(N=>{console.log("Todo: ",t),N.stopPropagation(),o()},[o]),S=C.useCallback(N=>{var O;N.stopPropagation(),(((O=t.customProps)==null?void 0:O.sessionIds)??[]).forEach(M=>{window.open(`/claude/${M}`,"_blank")})},[(re=t.customProps)==null?void 0:re.sessionIds]),A=C.useCallback(N=>{N.stopPropagation(),r(t.id)},[t.id,r]);return e.jsxs(Ae,{ref:u,"data-test":`kanban-card-${t.id.value}`,className:te("kanban-card p-3 cursor-move hover:shadow-md transition-all bg-white dark:bg-gray-800 relative group",n&&"opacity-50"),children:[e.jsx(at,{"data-test":"kanban-card-session-activity",sessionIds:x,className:"absolute top-1 left-1",showCount:!0}),e.jsxs("div",{className:"action-buttons absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity","data-test":"kanban-card-action-buttons",children:[((ie=t.customProps)==null?void 0:ie.sessionIds)&&t.customProps.sessionIds.length>0&&e.jsx(F,{"data-test":"kanban-card-session-link-button",variant:"ghost",size:"icon",onClick:S,className:"session-link-button h-6 w-6 hover:bg-transparent",title:`Open ${t.customProps.sessionIds.length} Claude session${t.customProps.sessionIds.length>1?"s":""} in new tab${t.customProps.sessionIds.length>1?"s":""}`,children:e.jsx(Ct,{className:"h-3 w-3 text-black hover:text-blue-500 transition-colors","data-test":"kanban-card-external-link-icon"})}),e.jsx("div",{onClick:N=>N.stopPropagation(),"data-test":"kanban-card-create-session-wrapper",children:e.jsx(st,{"data-test":"kanban-card-create-session-button",variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-transparent",icon:e.jsx(Nt,{className:"h-3 w-3 text-black hover:text-purple-500 transition-colors","data-test":"kanban-card-wand-icon"}),initialMessage:v(t),buttonTitle:"Ask Claude for help with this task",projectPath:(ce=t.customProps)!=null&&ce.claudeProjectPath&&t.customProps.claudeProjectPath!=="__no_project__"?t.customProps.claudeProjectPath:void 0,onSessionCreated:d})}),e.jsx(F,{"data-test":"kanban-card-delete-button",variant:"ghost",size:"icon",onClick:A,className:"delete-button h-6 w-6 hover:bg-transparent",children:e.jsx(Ke,{className:"h-3 w-3 text-black hover:text-red-500 transition-colors","data-test":"kanban-card-delete-icon"})})]}),e.jsxs("div",{className:"drag-handle flex items-start gap-2","data-test":"kanban-card-drag-handle",children:[e.jsx(yt,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1","data-test":"kanban-card-grip-icon"}),e.jsxs("div",{className:"card-content flex-1 space-y-2","data-test":"kanban-card-content",children:[e.jsx("h4",{"data-test":"kanban-card-title",className:"card-title font-medium text-sm line-clamp-2 pr-6 cursor-pointer hover:underline",onClick:j,children:t.title||"Untitled"}),e.jsxs("div",{className:"card-metadata flex flex-wrap gap-1","data-test":"kanban-card-metadata",children:[e.jsx(Se,{"data-test":"kanban-card-priority-selector",value:t.priority,options:At,onChange:k,placeholder:"Search priorities..."}),e.jsx(nt,{"data-test":"kanban-card-category-selector",value:t.category,onChange:i,placeholder:"Search categories..."}),!p&&w.length>1&&e.jsx(Se,{"data-test":"kanban-card-project-selector",value:((le=t.customProps)==null?void 0:le.claudeProjectPath)??"__no_project__",options:w,onChange:h,placeholder:"Search projects..."})]}),t.dueDate&&e.jsxs("div",{className:"card-due-date flex items-center gap-1","data-test":"kanban-card-due-date",children:[e.jsx(St,{className:"w-3 h-3 text-gray-400","data-test":"kanban-card-clock-icon"}),g(t.dueDate)]}),t.subtasks.length>0&&e.jsxs("div",{className:"card-subtasks flex items-center gap-1 text-xs text-gray-600","data-test":"kanban-card-subtasks",children:[e.jsx(He,{className:"w-3 h-3","data-test":"kanban-card-alert-icon"}),e.jsxs("span",{children:[t.subtasks.filter(N=>N.isCompleted).length,"/",t.subtasks.length," subtasks"]})]}),t.tags.length>0&&e.jsxs("div",{className:"card-tags flex flex-wrap gap-1","data-test":"kanban-card-tags",children:[t.tags.slice(0,3).map(N=>e.jsx(T,{variant:"outline",className:"text-xs","data-test":`kanban-card-tag-${N}`,children:N},N)),t.tags.length>3&&e.jsxs(T,{variant:"outline",className:"text-xs","data-test":"kanban-card-tags-overflow",children:["+",t.tags.length-3]})]})]})]})]})}function Wt({column:t,todos:n,isDropTarget:a,draggedTodoId:r,currentDropZone:s,insertionIndex:c,kanbanManager:o,isAddingTodo:l,newTodoTitle:u,onDeleteTodo:f,onAddClick:p,onCancelAdd:b,onTodoTitleChange:x,onKeyDown:v,onTodoUpdate:k,openDetailsPanelTodoId:i,onOpenDetailsPanel:h,onCloseDetailsPanel:d}){const m=C.useRef(null),w=jt(o,`${t.id}-zone`,void 0,{status:t.id});return C.useEffect(()=>{var g;if(l){const j=(g=m.current)==null?void 0:g.getTextArea();j&&j.focus()}},[l]),e.jsxs("div",{ref:w,"data-test":`kanban-column-${t.id}`,className:"kanban-column flex-shrink-0 w-80 h-full flex flex-col min-h-0",children:[e.jsx("div",{className:te("column-footer rounded-b-lg px-4 py-2 border-t-2 flex-shrink-0",t.className),"data-test":`kanban-column-footer-${t.id}`,children:l?e.jsxs("div",{className:"add-todo-input flex gap-2","data-test":`kanban-column-add-todo-input-${t.id}`,children:[e.jsx(rt,{ref:m,"data-test":`kanban-column-new-todo-textarea-${t.id}`,value:u,onChange:g=>x(g.target.value),placeholder:"Enter task title...",onKeyDown:g=>v(g,t.id),className:"flex-1 text-sm bg-white resize-none min-h-[32px]",rows:1}),e.jsx(F,{"data-test":`kanban-column-cancel-add-button-${t.id}`,size:"sm",variant:"ghost",onClick:b,className:"h-8 w-8 p-0",children:e.jsx(z,{className:"h-4 w-4","data-test":"kanban-column-cancel-icon"})})]}):e.jsxs(F,{"data-test":`kanban-column-add-button-${t.id}`,variant:"ghost",size:"sm",onClick:()=>p(t.id),className:"add-todo-button w-full h-8 text-sm",children:[e.jsx(pe,{className:"h-4 w-4 mr-1","data-test":"kanban-column-plus-icon"}),"Add task"]})}),e.jsx("div",{className:te("column-header rounded-t-lg px-4 py-3 border-b-2 flex-shrink-0",t.className),"data-test":`kanban-column-header-${t.id}`,children:e.jsxs("div",{className:"flex items-center justify-between","data-test":`kanban-column-header-content-${t.id}`,children:[e.jsx("h3",{className:"column-title font-semibold text-sm","data-test":`kanban-column-title-${t.id}`,children:t.title}),e.jsx(T,{variant:"secondary",className:"count-badge","data-test":`kanban-column-count-badge-${t.id}`,children:n.length})]})}),e.jsxs("div",{"data-test":`kanban-column-content-${t.id}`,className:te("column-content flex-1 min-h-0 p-2 space-y-2 border overflow-y-auto transition-colors",t.className,a&&"ring-2 ring-primary ring-offset-2"),children:[n.map((g,j)=>{const S=s===t.id&&c===j,A=s===t.id&&c===j+1&&j===n.length-1;return e.jsxs("div",{"data-test":`kanban-column-card-wrapper-${g.id.value}`,children:[S&&e.jsx("div",{className:"insertion-indicator h-1 bg-primary rounded mb-2","data-test":"kanban-column-insertion-indicator-before"}),e.jsx(Bt,{todo:g,isDragging:r===g.id.value,kanbanManager:o,onDelete:f,onUpdate:k,isDetailsPanelOpen:i===g.id.value,onOpenDetailsPanel:()=>h(g.id.value),onCloseDetailsPanel:d}),A&&e.jsx("div",{className:"insertion-indicator h-1 bg-primary rounded mt-2","data-test":"kanban-column-insertion-indicator-after"})]},g.id.value)}),n.length===0&&e.jsx("div",{className:"empty-column-state flex items-center justify-center h-32 text-gray-400 text-sm","data-test":`kanban-column-empty-state-${t.id}`,children:"Drop tasks here"})]})]})}function Mt({todo:t,isOpen:n,onClose:a,onUpdate:r,currentCardIndex:s,totalCardsInColumn:c,onNavigatePrevious:o,onNavigateNext:l}){return e.jsx(it,{open:n,onOpenChange:u=>!u&&a(),children:e.jsxs($t,{"data-test":"kanban-card-details-content",className:te("fixed inset-y-0 right-0 z-50 h-full w-3/4 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-[900px]","flex flex-col overflow-hidden"),children:[e.jsxs(Ot,{"data-test":"kanban-card-details-close-button",className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsx(ct,{todo:t,isOpen:n,onClose:a,onUpdate:r,currentCardIndex:s,totalCardsInColumn:c,onNavigatePrevious:o,onNavigateNext:l})]})})}const Ge={all:{id:"all",name:"All",description:"Show all todos across all statuses",statuses:[],visibleColumns:[P.FREEZER,P.BACKLOG,P.SELECTED,P.DOING,P.DONE,P.ARCHIVE]},planning:{id:"planning",name:"Planning",description:"Show todos in planning stages (Freezer, Backlog, Selected)",statuses:[P.FREEZER,P.BACKLOG,P.SELECTED],visibleColumns:[P.FREEZER,P.BACKLOG,P.SELECTED]},doing:{id:"doing",name:"Doing",description:"Show todos in doing stages (Selected, Doing)",statuses:[P.SELECTED,P.DOING],visibleColumns:[P.SELECTED,P.DOING]},done:{id:"done",name:"Done",description:"Show completed and archived todos",statuses:[P.DONE,P.ARCHIVE],visibleColumns:[P.DONE,P.ARCHIVE]}};function Qe(t){return t==="all"||t==="planning"||t==="doing"||t==="done"}function zt(t){return Ge[t]}function Vt(t,n){const a=Ge[n];return a?{...t,statuses:a.statuses,priorities:[],categories:[],visibleColumns:a.visibleColumns}:t}function _t(t){return`Filter ${t+1}`}const Z="all";function Kt(t){return{id:Date.now().toString(),name:t,filters:{searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:[],priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:[]}}}function Ht(t,n,a,r){const s={};let c=null;if(Qe(t)){const o=zt(t);o&&(c={searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:o.statuses,priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:o.visibleColumns})}else{const o=n.find(l=>l.id===t);o&&(c=o.filters)}if(c){c.priorities.length===1&&(s.priority=c.priorities[0]),c.categories.length===1&&(s.category=c.categories[0]);const o=c.claudeProjectPaths||(c.claudeProjectPath?[c.claudeProjectPath]:[]);o.length===1&&(s.claudeProjectPath=o[0])}if(r!==Z){const o=a.find(l=>l.id===r);if(o){const l=o.filters;l.priorities.length===1&&(s.priority=l.priorities[0]),l.categories.length===1&&(s.category=l.categories[0]);const u=l.claudeProjectPaths||(l.claudeProjectPath?[l.claudeProjectPath]:[]);u.length===1&&(s.claudeProjectPath=u[0])}}return s}const Gt=[{id:P.FREEZER,title:"Freezer",className:"bg-blue-50 dark:bg-blue-950"},{id:P.BACKLOG,title:"Backlog",className:"bg-gray-50 dark:bg-gray-900"},{id:P.SELECTED,title:"Selected",className:"bg-purple-50 dark:bg-purple-950"},{id:P.DOING,title:"Doing",className:"bg-yellow-50 dark:bg-yellow-950"},{id:P.DONE,title:"Done",className:"bg-green-50 dark:bg-green-950"},{id:P.ARCHIVE,title:"Archive",className:"bg-slate-50 dark:bg-slate-900"}];function Qt({todos:t,onTodosUpdate:n,onTodoStatusUpdate:a,visibleColumns:r,activePresetId:s,customPresets:c,spaces:o,activeSpaceId:l}){const[u,f]=C.useState(null),[p,b]=C.useState(null),[x,v]=C.useState(null),[k,i]=C.useState(null),[h,d]=C.useState(""),[m,w]=C.useState(null),g=C.useMemo(()=>({onDragStart:y=>{var E;const D=(E=y.item.data)==null?void 0:E.todoId;f(D)},onDragMove:y=>{var E,R;const D=((R=(E=y.dropZone)==null?void 0:E.data)==null?void 0:R.status)||null;b(D),v(y.sortIndex)},onDrop:async y=>{var Ne,ye;const D=(Ne=y.item.data)==null?void 0:Ne.todoId,E=(ye=y.dropZone.data)==null?void 0:ye.status,R=y.sortIndex??0;if(!D||!E)return;const L=t.find($=>$.id.value===D);if(!L)return;const B=t.filter($=>$.status===E),Q=L.status===E,U=Q?B.findIndex($=>$.id.value===D):-1;let oe=R;Q&&U!==-1&&U<R&&(oe=R-1);const me=t.filter($=>$.status===E&&$.id.value!==D).sort(($,ge)=>($.sortOrder??0)-(ge.sortOrder??0)),Ye=Q?oe:R;me.splice(Ye,0,{...L,status:E,sortOrder:0});try{for(let $=0;$<me.length;$++){const ge=me[$],Xe=$;await _.updateTodo(ge.id,{status:E,sortOrder:Xe})}n()}catch($){console.error("Failed to update todo:",$)}},onDragEnd:()=>{f(null),b(null),v(null)}}),[t,n]),{manager:j}=kt({snap:{enabled:!1,threshold:10},sort:{enabled:!0,orientation:"vertical",threshold:.5},dragThreshold:5},g),S=y=>t.filter(E=>E.status===y),A=y=>{i(y),d("")},H=()=>{i(null),d("")},re=async y=>{var D,E,R;if(!h.trim()){H();return}try{const L=Ht(s,c,o,l),B=(R=(E=(D=K.getState().app)==null?void 0:D.claude)==null?void 0:E.ui)==null?void 0:R.selectedProjectPath,Q=B&&B!==je?B:void 0,U=L.claudeProjectPath??Q,oe={title:h.trim(),priority:L.priority??G.LOW,category:L.category??lt.OTHER,customProps:U?{claudeProjectPath:U}:void 0};await Oe.column.createTicket(y,oe),n(),H()}catch(L){console.error("Failed to create todo:",L)}},ie=(y,D)=>{y.key==="Enter"?re(D):y.key==="Escape"&&H()},ce=async y=>{try{await _.deleteTodo(y),n()}catch(D){console.error("Failed to delete todo:",D)}},le=y=>{w(y)},N=()=>{w(null)},I=y=>{if(!m)return;const D=t.find(B=>B.id.value===m);if(!D)return;const E=t.filter(B=>B.status===D.status).sort((B,Q)=>(B.sortOrder??0)-(Q.sortOrder??0)),R=E.findIndex(B=>B.id.value===m);if(R===-1)return;const L=y==="previous"?R-1:R+1;L<0||L>=E.length||w(E[L].id.value)},O=m?t.find(y=>y.id.value===m)??null:null,M=O?t.filter(y=>y.status===O.status).sort((y,D)=>(y.sortOrder??0)-(D.sortOrder??0)):[],Ue=O&&M.length>0?M.findIndex(y=>y.id.value===m):void 0,qe=M.length;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"kanban-board-container flex gap-4 h-full py-2",style:{width:"2000px"},"data-test":"kanban-board-container",children:Gt.filter(y=>r.includes(y.id)).map(y=>{const D=S(y.id),E=p===y.id;return e.jsx(Wt,{column:y,todos:D,isDropTarget:E,draggedTodoId:u,currentDropZone:p,insertionIndex:x,kanbanManager:j,isAddingTodo:k===y.id,newTodoTitle:h,onDeleteTodo:ce,onAddClick:A,onCancelAdd:H,onTodoTitleChange:d,onKeyDown:ie,onTodoUpdate:n,openDetailsPanelTodoId:m,onOpenDetailsPanel:le,onCloseDetailsPanel:N},y.id)})}),e.jsx(Mt,{"data-test":"kanban-card-details-panel",todo:O,isOpen:!!m,onClose:N,onUpdate:n,currentCardIndex:Ue,totalCardsInColumn:qe,onNavigatePrevious:()=>I("previous"),onNavigateNext:()=>I("next")})]})}const De=new ot,Ee=[{value:"title",label:"Title"},{value:"description",label:"Description"},{value:"id",label:"ID"}],Te=[{value:"contains",label:"Contains",description:"Text contains substring"},{value:"exact",label:"Exact Match",description:"Exact text match"},{value:"startsWith",label:"Starts With",description:"Text starts with substring"},{value:"endsWith",label:"Ends With",description:"Text ends with substring"},{value:"fuzzy",label:"Fuzzy Match",description:"Approximate string matching (typo-tolerant)"},{value:"regex",label:"Regex",description:"Regular expression match"}],be=[{value:P.FREEZER,label:"Freezer"},{value:P.BACKLOG,label:"Backlog"},{value:P.SELECTED,label:"Selected"},{value:P.DOING,label:"Doing"},{value:P.DONE,label:"Done"},{value:P.ARCHIVE,label:"Archive"}],Fe=[{value:G.LOW,label:"Low"},{value:G.MEDIUM,label:"Medium"},{value:G.HIGH,label:"High"},{value:G.URGENT,label:"Urgent"}],Jt=[{value:"createdAt",label:"Created Date"},{value:"updatedAt",label:"Updated Date"},{value:"title",label:"Title"},{value:"priority",label:"Priority"}];function Je({filters:t,onFiltersChange:n,onReset:a,showAdvanced:r}){var k;const[s,c]=C.useState(r??!1),[o,l]=C.useState(()=>De.getAllCategories());C.useEffect(()=>{if(s){const i=De.getAllCategories();l(i)}},[s]);const u=(i,h)=>{n({...t,[i]:h})},f=(i,h)=>{const d=t[i],m=d.includes(h)?d.filter(w=>w!==h):[...d,h];u(i,m)},p=()=>{const i={id:Math.random().toString(36).substring(7),field:"title",operator:"contains",value:"",caseSensitive:!1};u("fieldConditions",[...t.fieldConditions,i])},b=(i,h)=>{u("fieldConditions",t.fieldConditions.map(d=>d.id===i?{...d,...h}:d))},x=i=>{u("fieldConditions",t.fieldConditions.filter(h=>h.id!==i))},v=t.searchQuery||t.fieldConditions.length>0||t.statuses.length>0||t.priorities.length>0||t.categories.length>0||t.claudeProjectPaths&&t.claudeProjectPaths.length>0;return e.jsxs(Ae,{className:"kanban-filters-advanced p-4 space-y-4","data-test":"kanban-filters-advanced-container",children:[e.jsxs("div",{className:"search-section flex gap-2","data-test":"kanban-filters-advanced-search-section",children:[e.jsxs("div",{className:"search-input-wrapper relative flex-1","data-test":"kanban-filters-advanced-search-wrapper",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground","data-test":"kanban-filters-advanced-search-icon"}),e.jsx(he,{"data-test":"kanban-filters-advanced-search-input",placeholder:"Quick search...",value:t.searchQuery,onChange:i=>u("searchQuery",i.target.value),className:"pl-9"})]}),e.jsx(F,{"data-test":"kanban-filters-advanced-toggle-button",variant:"outline",size:"icon",onClick:()=>c(!s),className:s?"bg-accent":"",children:e.jsx(wt,{className:"h-4 w-4","data-test":"kanban-filters-advanced-toggle-icon"})}),v&&e.jsx(F,{"data-test":"kanban-filters-advanced-reset-button",variant:"outline",size:"icon",onClick:a,children:e.jsx(z,{className:"h-4 w-4","data-test":"kanban-filters-advanced-reset-icon"})})]}),s&&e.jsxs("div",{className:"advanced-filters space-y-4","data-test":"kanban-filters-advanced-section",children:[e.jsxs("div",{className:"field-conditions-section space-y-2 p-3 border rounded-md bg-muted/30","data-test":"kanban-filters-advanced-field-conditions",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"kanban-filters-advanced-field-conditions-header",children:[e.jsx(ae,{className:"text-sm font-medium","data-test":"kanban-filters-advanced-field-conditions-label",children:"Field Conditions"}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"kanban-filters-advanced-field-conditions-controls",children:[e.jsxs(q,{value:t.conditionLogic,onValueChange:i=>u("conditionLogic",i),children:[e.jsx(Y,{className:"h-7 w-20 text-xs","data-test":"kanban-filters-advanced-condition-logic-trigger",children:e.jsx(X,{})}),e.jsxs(ee,{"data-test":"kanban-filters-advanced-condition-logic-content",children:[e.jsx(J,{value:"OR","data-test":"kanban-filters-advanced-condition-logic-or",children:"OR"}),e.jsx(J,{value:"AND","data-test":"kanban-filters-advanced-condition-logic-and",children:"AND"})]})]}),e.jsxs(F,{"data-test":"kanban-filters-advanced-add-condition-button",variant:"outline",size:"sm",onClick:p,className:"h-7 text-xs",children:[e.jsx(pe,{className:"h-3 w-3 mr-1","data-test":"kanban-filters-advanced-add-condition-icon"}),"Add"]})]})]}),t.fieldConditions.length>0?e.jsx("div",{className:"conditions-list space-y-2 mt-2","data-test":"kanban-filters-advanced-conditions-list",children:t.fieldConditions.map((i,h)=>{var d;return e.jsxs("div",{className:"condition-item p-2 border rounded-md space-y-2 bg-background","data-test":`kanban-filters-advanced-condition-item-${i.id}`,children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":`kanban-filters-advanced-condition-row-${i.id}`,children:[e.jsx(T,{variant:"outline",className:"text-xs shrink-0","data-test":`kanban-filters-advanced-condition-number-${i.id}`,children:h+1}),e.jsxs(q,{value:i.field,onValueChange:m=>b(i.id,{field:m}),children:[e.jsx(Y,{className:"h-7 flex-1 text-xs","data-test":`kanban-filters-advanced-condition-field-trigger-${i.id}`,children:e.jsx(X,{})}),e.jsx(ee,{"data-test":`kanban-filters-advanced-condition-field-content-${i.id}`,children:Ee.map(m=>e.jsx(J,{value:m.value,"data-test":`kanban-filters-advanced-condition-field-${m.value}-${i.id}`,children:m.label},m.value))})]}),e.jsx(F,{"data-test":`kanban-filters-advanced-condition-remove-${i.id}`,variant:"ghost",size:"icon",onClick:()=>x(i.id),className:"h-7 w-7 shrink-0",children:e.jsx(Ke,{className:"h-3 w-3","data-test":`kanban-filters-advanced-condition-remove-icon-${i.id}`})})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":`kanban-filters-advanced-condition-operator-row-${i.id}`,children:[e.jsxs(q,{value:i.operator,onValueChange:m=>b(i.id,{operator:m}),children:[e.jsx(Y,{className:"h-7 w-32 text-xs","data-test":`kanban-filters-advanced-condition-operator-trigger-${i.id}`,children:e.jsx(X,{})}),e.jsx(ee,{"data-test":`kanban-filters-advanced-condition-operator-content-${i.id}`,children:Te.map(m=>e.jsx(J,{value:m.value,"data-test":`kanban-filters-advanced-condition-operator-${m.value}-${i.id}`,children:m.label},m.value))})]}),e.jsx(he,{"data-test":`kanban-filters-advanced-condition-value-${i.id}`,placeholder:"Search value...",value:i.value,onChange:m=>b(i.id,{value:m.target.value}),className:"h-7 text-xs flex-1"})]}),e.jsxs("div",{className:"flex items-center justify-between","data-test":`kanban-filters-advanced-condition-options-${i.id}`,children:[e.jsx("span",{className:"text-xs text-muted-foreground","data-test":`kanban-filters-advanced-condition-description-${i.id}`,children:(d=Te.find(m=>m.value===i.operator))==null?void 0:d.description}),e.jsxs("div",{className:"flex items-center gap-2","data-test":`kanban-filters-advanced-condition-case-sensitive-${i.id}`,children:[e.jsx(ae,{htmlFor:`case-${i.id}`,className:"text-xs cursor-pointer","data-test":`kanban-filters-advanced-condition-case-label-${i.id}`,children:"Case sensitive"}),e.jsx(Re,{"data-test":`kanban-filters-advanced-condition-case-switch-${i.id}`,id:`case-${i.id}`,checked:i.caseSensitive??!1,onCheckedChange:m=>b(i.id,{caseSensitive:m}),className:"scale-75"})]})]})]},i.id)})}):e.jsx("div",{className:"empty-state text-xs text-muted-foreground text-center py-3 border rounded-md","data-test":"kanban-filters-advanced-conditions-empty",children:'No field conditions. Click "Add" to create one.'})]}),e.jsxs("div",{className:"sort-section grid grid-cols-2 gap-3","data-test":"kanban-filters-advanced-sort-section",children:[e.jsxs("div",{className:"sort-by","data-test":"kanban-filters-advanced-sort-by-wrapper",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-sort-by-label",children:"Sort By"}),e.jsxs(q,{value:t.sortBy,onValueChange:i=>u("sortBy",i),children:[e.jsx(Y,{"data-test":"kanban-filters-advanced-sort-by-trigger",children:e.jsx(X,{})}),e.jsx(ee,{"data-test":"kanban-filters-advanced-sort-by-content",children:Jt.map(i=>e.jsx(J,{value:i.value,"data-test":`kanban-filters-advanced-sort-by-${i.value}`,children:i.label},i.value))})]})]}),e.jsxs("div",{className:"sort-order","data-test":"kanban-filters-advanced-sort-order-wrapper",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-sort-order-label",children:"Order"}),e.jsxs(q,{value:t.sortOrder,onValueChange:i=>u("sortOrder",i),children:[e.jsx(Y,{"data-test":"kanban-filters-advanced-sort-order-trigger",children:e.jsx(X,{})}),e.jsxs(ee,{"data-test":"kanban-filters-advanced-sort-order-content",children:[e.jsx(J,{value:"asc","data-test":"kanban-filters-advanced-sort-order-asc",children:"Ascending"}),e.jsx(J,{value:"desc","data-test":"kanban-filters-advanced-sort-order-desc",children:"Descending"})]})]})]})]}),e.jsxs("div",{className:"status-filter","data-test":"kanban-filters-advanced-status-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-status-label",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-status-badges",children:be.map(i=>e.jsx(T,{"data-test":`kanban-filters-advanced-status-badge-${i.value}`,variant:t.statuses.includes(i.value)?"default":"outline",className:"cursor-pointer",onClick:()=>f("statuses",i.value),children:i.label},i.value))})]}),e.jsxs("div",{className:"priority-filter","data-test":"kanban-filters-advanced-priority-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-priority-label",children:"Priority"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-priority-badges",children:Fe.map(i=>e.jsx(T,{"data-test":`kanban-filters-advanced-priority-badge-${i.value}`,variant:t.priorities.includes(i.value)?"default":"outline",className:"cursor-pointer",onClick:()=>f("priorities",i.value),children:i.label},i.value))})]}),e.jsxs("div",{className:"category-filter","data-test":"kanban-filters-advanced-category-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-category-label",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-category-badges",children:o.map(i=>e.jsx(T,{"data-test":`kanban-filters-advanced-category-badge-${i.value}`,variant:t.categories.includes(i.value)?i.variant??"default":"outline",className:`cursor-pointer ${t.categories.includes(i.value)?i.className??"":""}`,onClick:()=>f("categories",i.value),children:i.label},i.value))})]}),e.jsxs("div",{className:"claude-project-filter","data-test":"kanban-filters-advanced-claude-project-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-claude-project-label",children:"Claude Projects"}),e.jsx(dt,{"data-test":"kanban-filters-advanced-claude-project-selector",multiSelect:!0,value:t.claudeProjectPaths||[],onChange:i=>u("claudeProjectPaths",i)})]}),e.jsxs("div",{className:"show-columns-section space-y-2 p-3 border rounded-md bg-muted/30","data-test":"kanban-filters-advanced-show-columns-section",children:[e.jsx(ae,{className:"text-sm font-medium","data-test":"kanban-filters-advanced-show-columns-label",children:"Show Columns"}),e.jsx("div",{className:"columns-grid grid grid-cols-2 gap-2","data-test":"kanban-filters-advanced-show-columns-grid",children:be.map(i=>e.jsxs("div",{className:"column-item flex items-center space-x-2","data-test":`kanban-filters-advanced-show-column-item-${i.value}`,children:[e.jsx(Le,{"data-test":`kanban-filters-advanced-show-column-checkbox-${i.value}`,id:`column-${i.value}`,checked:t.visibleColumns.includes(i.value),onCheckedChange:()=>f("visibleColumns",i.value)}),e.jsx("label",{htmlFor:`column-${i.value}`,className:"text-sm cursor-pointer","data-test":`kanban-filters-advanced-show-column-label-${i.value}`,children:i.label})]},i.value))})]})]}),v&&e.jsxs("div",{className:"active-filters flex flex-wrap gap-2 pt-2 border-t","data-test":"kanban-filters-advanced-active-filters",children:[t.searchQuery&&e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-search-badge",children:["Search: ",t.searchQuery,e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-search-remove",onClick:()=>u("searchQuery","")})]}),t.fieldConditions.map(i=>{var h;return e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":`kanban-filters-advanced-active-condition-${i.id}`,children:[(h=Ee.find(d=>d.value===i.field))==null?void 0:h.label,":"," ",i.operator,' "',i.value,'"',e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":`kanban-filters-advanced-active-condition-remove-${i.id}`,onClick:()=>x(i.id)})]},i.id)}),t.statuses.map(i=>{var h;return e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":`kanban-filters-advanced-active-status-${i}`,children:[(h=be.find(d=>d.value===i))==null?void 0:h.label,e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":`kanban-filters-advanced-active-status-remove-${i}`,onClick:()=>f("statuses",i)})]},i)}),t.priorities.map(i=>{var h;return e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":`kanban-filters-advanced-active-priority-${i}`,children:[(h=Fe.find(d=>d.value===i))==null?void 0:h.label,e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":`kanban-filters-advanced-active-priority-remove-${i}`,onClick:()=>f("priorities",i)})]},i)}),t.categories.map(i=>{var h;return e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":`kanban-filters-advanced-active-category-${i}`,children:[(h=o.find(d=>d.value===i))==null?void 0:h.label,e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":`kanban-filters-advanced-active-category-remove-${i}`,onClick:()=>f("categories",i)})]},i)}),(k=t.claudeProjectPaths)==null?void 0:k.map(i=>e.jsxs(T,{variant:"secondary",className:"gap-1","data-test":`kanban-filters-advanced-active-project-${i}`,children:["Project: ",i,e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":`kanban-filters-advanced-active-project-remove-${i}`,onClick:()=>{var h;return u("claudeProjectPaths",((h=t.claudeProjectPaths)==null?void 0:h.filter(d=>d!==i))||[])}})]},i))]})]})}function Zt({spaces:t,activeSpaceId:n,onSpaceSelect:a,onSpaceCreate:r,onSpaceUpdate:s,onSpaceDelete:c,onSpaceConfigOpen:o}){const[l,u]=C.useState(null),[f,p]=C.useState(""),b=(h,d)=>{u(h),p(d)},x=()=>{if(!l||!f.trim()){u(null);return}s(l,f.trim()),u(null),p(""),W.success("Space renamed")},v=()=>{u(null),p("")},k=()=>{const h=t.length+1;r(`Space ${h}`)},i=h=>{const d=t.find(m=>m.id===h);d&&window.confirm(`Delete space "${d.name}"?`)&&(c(h),W.success(`Space "${d.name}" deleted`))};return e.jsxs("div",{className:"kanban-spaces flex items-center gap-2 flex-wrap","data-test":"kanban-spaces-container",children:[e.jsx("span",{className:"text-sm text-muted-foreground mr-1","data-test":"kanban-spaces-label",children:"Spaces:"}),e.jsx(T,{"data-test":"kanban-spaces-all-badge",variant:n===Z?"default":"outline",className:"cursor-pointer",onClick:()=>a(Z),children:"All Spaces"}),t.map(h=>l===h.id?e.jsx("div",{className:"inline-flex items-center gap-1","data-test":`kanban-spaces-editing-${h.id}`,children:e.jsx(he,{"data-test":`kanban-spaces-edit-input-${h.id}`,value:f,onChange:d=>p(d.target.value),onKeyDown:d=>{d.key==="Enter"&&x(),d.key==="Escape"&&v()},onBlur:x,autoFocus:!0,className:"h-6 w-32 text-xs px-2"})},h.id):e.jsxs(T,{"data-test":`kanban-spaces-badge-${h.id}`,variant:n===h.id?"default":"outline",className:"cursor-pointer gap-1 group relative pr-12",onClick:()=>a(h.id),onDoubleClick:()=>b(h.id,h.name),children:[h.name,e.jsxs("div",{className:"absolute right-1 flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity","data-test":`kanban-spaces-actions-${h.id}`,children:[e.jsx(F,{"data-test":`kanban-spaces-config-button-${h.id}`,variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:d=>{d.stopPropagation(),o(h.id)},title:"Configure space filters",children:e.jsx(It,{className:"h-3 w-3","data-test":"kanban-spaces-settings-icon"})}),e.jsx("button",{"data-test":`kanban-spaces-delete-button-${h.id}`,className:"p-0 border-0 bg-transparent",onClick:d=>{d.stopPropagation(),i(h.id)},title:"Delete space",children:e.jsx(z,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-spaces-delete-icon"})})]})]},h.id)),e.jsx(F,{"data-test":"kanban-spaces-create-button",variant:"outline",size:"icon",onClick:k,className:"h-6 w-6",title:"Create new space",children:e.jsx(pe,{className:"h-3 w-3","data-test":"kanban-spaces-plus-icon"})})]})}function Ut({onImportComplete:t}){const[n,a]=C.useState(!1),[r,s]=C.useState(!1),[c,o]=C.useState(!1),[l,u]=C.useState(null),f=C.useRef(null),p=async()=>{try{const k=await _.exportTodos(),i=new Blob([k],{type:"application/json"}),h=URL.createObjectURL(i),d=document.createElement("a");d.href=h,d.download=`todos-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h),W.success("Todos exported successfully")}catch(k){console.error("Export failed:",k),W.error("Failed to export todos")}},b=()=>{var k;(k=f.current)==null||k.click()},x=async k=>{var h;const i=(h=k.target.files)==null?void 0:h[0];if(i){s(!0),u(null);try{const d=await i.text(),m=await _.importTodos(d,{replace:c});if(u(m),m.imported>0||m.presetsImported&&m.presetsImported>0||m.spacesImported&&m.spacesImported>0||m.categoriesImported&&m.categoriesImported>0){const w=[];m.imported>0&&w.push(`${m.imported} todo${m.imported>1?"s":""}`),m.presetsImported&&m.presetsImported>0&&w.push(`${m.presetsImported} preset${m.presetsImported>1?"s":""}`),m.spacesImported&&m.spacesImported>0&&w.push(`${m.spacesImported} space${m.spacesImported>1?"s":""}`),m.categoriesImported&&m.categoriesImported>0&&w.push(`${m.categoriesImported} categor${m.categoriesImported>1?"ies":"y"}`),W.success(`Successfully imported ${w.join(", ")}`),t==null||t()}m.skipped>0&&W.warning(`Skipped ${m.skipped} todo${m.skipped>1?"s":""}`),m.errors.length>0&&W.error(`${m.errors.length} error${m.errors.length>1?"s":""} occurred`)}catch(d){console.error("Import failed:",d),W.error(d instanceof Error?d.message:"Failed to import todos"),u({imported:0,skipped:0,errors:[d instanceof Error?d.message:"Unknown error"]})}finally{s(!1),f.current&&(f.current.value="")}}},v=()=>{a(!1),u(null),o(!1)};return e.jsxs("div",{className:"export-import-controls flex items-center gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:p,className:"export-button",children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(Be,{open:n,onOpenChange:a,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"sm",className:"import-button",children:[e.jsx(Et,{className:"h-4 w-4 mr-2"}),"Import"]})}),e.jsxs(We,{className:"import-dialog sm:max-w-[500px]",children:[e.jsxs(Me,{children:[e.jsx(ze,{children:"Import Todos, Presets, Spaces & Categories"}),e.jsx(Ve,{children:"Import todos, custom filter presets, spaces, and custom categories from a JSON file. You can choose to merge with existing data or replace it entirely."})]}),e.jsxs("div",{className:"import-options space-y-4 py-4",children:[e.jsxs("div",{className:"replace-mode-control flex items-center justify-between",children:[e.jsxs("div",{className:"replace-mode-label",children:[e.jsx(ae,{htmlFor:"replace-mode",className:"text-sm font-medium",children:"Replace existing data"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"When enabled, all existing todos, presets, spaces, and custom categories will be deleted before importing"})]}),e.jsx(Re,{id:"replace-mode",checked:c,onCheckedChange:o,disabled:r})]}),l&&e.jsxs("div",{className:"import-result space-y-2 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{className:"result-summary space-y-1",children:[l.imported>0&&e.jsxs("div",{className:"imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["Todos imported: ",l.imported]})]}),l.presetsImported!==void 0&&l.presetsImported>0&&e.jsxs("div",{className:"presets-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["Presets imported: ",l.presetsImported]})]}),l.spacesImported!==void 0&&l.spacesImported>0&&e.jsxs("div",{className:"spaces-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["Spaces imported: ",l.spacesImported]})]}),l.categoriesImported!==void 0&&l.categoriesImported>0&&e.jsxs("div",{className:"categories-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["Categories imported: ",l.categoriesImported]})]}),l.skipped>0&&e.jsxs("div",{className:"skipped-count flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsxs("span",{children:["Todos skipped: ",l.skipped]})]})]}),l.errors.length>0&&e.jsxs("div",{className:"error-list space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-red-600",children:"Errors:"}),e.jsxs("ul",{className:"error-items text-xs text-muted-foreground space-y-1",children:[l.errors.slice(0,5).map((k,i)=>e.jsx("li",{className:"error-item",children:k},i)),l.errors.length>5&&e.jsxs("li",{className:"more-errors text-xs italic",children:["... and ",l.errors.length-5," more errors"]})]})]})]})]}),e.jsxs(_e,{children:[e.jsx(F,{variant:"outline",onClick:v,disabled:r,className:"close-button",children:"Close"}),e.jsx(F,{onClick:b,disabled:r,className:"select-file-button",children:r?"Importing...":"Select File"})]}),e.jsx("input",{ref:f,type:"file",accept:".json,application/json",onChange:x,className:"hidden"})]})]})]})}function qt({activePreset:t,customPresets:n,editingPresetId:a,editingPresetName:r,onPresetSelect:s,onPresetUpdate:c,onPresetCreate:o,onPresetDelete:l,onStartEditingPreset:u,onSavePresetName:f,onCancelEditingPreset:p,onEditingPresetNameChange:b}){return e.jsxs("div",{className:"filter-presets flex items-center gap-2","data-test":"kanban-preset-badges-container",children:[e.jsx("span",{className:"text-sm text-muted-foreground mr-1","data-test":"kanban-preset-badges-label",children:"Presets:"}),e.jsx(T,{"data-test":"kanban-preset-badge-all",variant:t==="all"?"default":"outline",className:"cursor-pointer",onClick:()=>s("all"),children:"All"}),e.jsx(T,{"data-test":"kanban-preset-badge-planning",variant:t==="planning"?"default":"outline",className:"cursor-pointer",onClick:()=>s("planning"),children:"Planning"}),e.jsx(T,{"data-test":"kanban-preset-badge-doing",variant:t==="doing"?"default":"outline",className:"cursor-pointer",onClick:()=>s("doing"),children:"Doing"}),e.jsx(T,{"data-test":"kanban-preset-badge-done",variant:t==="done"?"default":"outline",className:"cursor-pointer",onClick:()=>s("done"),children:"Done"}),n.map(x=>a===x.id?e.jsx("div",{className:"inline-flex items-center gap-1","data-test":`kanban-preset-editing-${x.id}`,children:e.jsx(he,{"data-test":`kanban-preset-edit-input-${x.id}`,value:r,onChange:v=>b(v.target.value),onKeyDown:v=>{v.key==="Enter"&&f(),v.key==="Escape"&&p()},onBlur:f,autoFocus:!0,className:"h-6 w-32 text-xs px-2"})},x.id):e.jsxs(T,{"data-test":`kanban-preset-badge-${x.id}`,variant:t===x.id?"default":"outline",className:"cursor-pointer gap-1 group",onClick:()=>s(x.id),onDoubleClick:()=>u(x.id,x.name),children:[x.name,e.jsx(z,{"data-test":`kanban-preset-delete-icon-${x.id}`,className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity",onClick:v=>{v.stopPropagation(),l(x.id)}})]},x.id)),n.some(x=>x.id===t)&&e.jsx(F,{"data-test":"kanban-preset-update-button",variant:"outline",size:"icon",onClick:c,className:"h-6 w-6",title:"Update current preset",children:e.jsx(Tt,{className:"h-3 w-3","data-test":"kanban-preset-save-icon"})}),e.jsx(F,{"data-test":"kanban-preset-create-button",variant:"outline",size:"icon",onClick:o,className:"h-6 w-6",title:"Create new preset",children:e.jsx(pe,{className:"h-3 w-3","data-test":"kanban-preset-plus-icon"})})]})}function Yt({spaces:t,activeSpaceId:n,onImportComplete:a,onSpaceSelect:r,onSpaceCreate:s,onSpaceUpdate:c,onSpaceDelete:o,onSpaceConfigOpen:l,presetBadgesProps:u}){return e.jsxs("div",{className:"section-header flex items-center justify-between mb-4 flex-shrink-0","data-test":"kanban-board-header",children:[e.jsxs("div",{className:"section-title-area flex items-center gap-4","data-test":"kanban-board-header-title-area",children:[e.jsx("h2",{className:"section-title text-2xl font-bold","data-test":"kanban-board-header-title",children:"Board"}),e.jsx(Ut,{"data-test":"kanban-board-header-export-import",onImportComplete:a})]}),e.jsxs("div",{className:"filter-controls flex flex-col gap-2 items-end","data-test":"kanban-board-header-filter-controls",children:[e.jsx(Zt,{"data-test":"kanban-board-header-spaces",spaces:t,activeSpaceId:n,onSpaceSelect:r,onSpaceCreate:s,onSpaceUpdate:c,onSpaceDelete:o,onSpaceConfigOpen:l}),e.jsx(qt,{"data-test":"kanban-board-header-presets",...u})]})]})}function Xt({open:t,editingSpace:n,editingSpaceFilters:a,onOpenChange:r,onFiltersChange:s,onSave:c,onReset:o}){return e.jsx(Be,{open:t,onOpenChange:r,"data-test":"kanban-space-config-dialog",children:e.jsxs(We,{className:"max-w-4xl max-h-[90vh] overflow-y-auto","data-test":"kanban-space-config-dialog-content",children:[e.jsxs(Me,{"data-test":"kanban-space-config-dialog-header",children:[e.jsxs(ze,{"data-test":"kanban-space-config-dialog-title",children:["Configure Space: ",n==null?void 0:n.name]}),e.jsx(Ve,{"data-test":"kanban-space-config-dialog-description",children:"Define filters for this space. These filters will be applied as the base layer, with presets layered on top when selected."})]}),a&&e.jsx("div",{className:"space-filter-content py-4","data-test":"kanban-space-config-dialog-filter-content",children:e.jsx(Je,{"data-test":"kanban-space-config-dialog-filters",filters:a,onFiltersChange:s,onReset:o,showAdvanced:!0})}),e.jsxs(_e,{className:"flex gap-2","data-test":"kanban-space-config-dialog-footer",children:[e.jsx(F,{variant:"outline",onClick:()=>r(!1),"data-test":"kanban-space-config-dialog-cancel-button",children:"Cancel"}),e.jsx(F,{onClick:c,"data-test":"kanban-space-config-dialog-save-button",children:"Save Space Configuration"})]})]})})}function ea(){const[t,n]=C.useState([]),[a,r]=C.useState(!0),[s,c]=C.useState(!1),o=C.useRef(null),l=C.useRef(0),u=async(x=!1)=>{try{x&&o.current&&(l.current=o.current.scrollLeft),s||r(!0);const v=await _.getAllTodos({sort:{field:"sortOrder",direction:"asc"}});n(v),s||c(!0)}catch(v){console.error("Failed to load todos:",v)}finally{r(!1)}},f=async(x,v)=>{o.current&&(l.current=o.current.scrollLeft),n(k=>k.map(i=>i.id.value===x.value?{...i,status:v}:i));try{await _.updateTodo(x,{status:v})}catch(k){console.error("Failed to update todo status:",k),await u(!0)}},p=()=>{o.current&&(l.current=o.current.scrollLeft)},b=x=>{o.current&&l.current>0&&(o.current.scrollLeft=l.current)};return C.useEffect(()=>{u()},[]),{todos:t,loading:a,loadTodos:u,handleTodoStatusUpdate:f,scrollContainerRef:o,saveScrollPosition:p,restoreScrollPosition:b}}function ke(){var n,a;const t=((a=(n=K.getState().app)==null?void 0:n.kanban)==null?void 0:a.spaces)||[];return Array.isArray(t)?t:[]}function ta(t){var r;const n=K.getState(),a=(r=n.app)==null?void 0:r.kanban;K.updateState({app:{...n.app,kanban:{spaces:(a==null?void 0:a.spaces)??[],activeSpaceId:t,customPresets:(a==null?void 0:a.customPresets)??[],activePresetId:(a==null?void 0:a.activePresetId)??"all",currentFilters:(a==null?void 0:a.currentFilters)??se,customCategories:(a==null?void 0:a.customCategories)??[],loading:(a==null?void 0:a.loading)??!1,error:a==null?void 0:a.error}}})}function aa(t){var o;const n=Kt(t),r=[...ke(),n],s=K.getState(),c=(o=s.app)==null?void 0:o.kanban;return K.updateState({app:{...s.app,kanban:{spaces:r,activeSpaceId:(c==null?void 0:c.activeSpaceId)??"all",customPresets:(c==null?void 0:c.customPresets)??[],activePresetId:(c==null?void 0:c.activePresetId)??"all",currentFilters:(c==null?void 0:c.currentFilters)??se,customCategories:(c==null?void 0:c.customCategories)??[],loading:(c==null?void 0:c.loading)??!1,error:c==null?void 0:c.error}}}),n}function ve(t,n){var u;const a=ke(),r=a.findIndex(f=>f.id===t);if(r===-1)return null;const s={...a[r],...n},c=[...a.slice(0,r),s,...a.slice(r+1)],o=K.getState(),l=(u=o.app)==null?void 0:u.kanban;return K.updateState({app:{...o.app,kanban:{spaces:c,activeSpaceId:(l==null?void 0:l.activeSpaceId)??"all",customPresets:(l==null?void 0:l.customPresets)??[],activePresetId:(l==null?void 0:l.activePresetId)??"all",currentFilters:(l==null?void 0:l.currentFilters)??se,customCategories:(l==null?void 0:l.customCategories)??[],loading:(l==null?void 0:l.loading)??!1,error:l==null?void 0:l.error}}}),s}function sa(t){var o;const n=ke(),a=n.filter(l=>l.id!==t);if(a.length===n.length)return!1;const r=K.getState(),s=(o=r.app)==null?void 0:o.kanban,c=(s==null?void 0:s.activeSpaceId)??"all";return K.updateState({app:{...r.app,kanban:{spaces:a,activeSpaceId:c===t?"all":c,customPresets:(s==null?void 0:s.customPresets)??[],activePresetId:(s==null?void 0:s.activePresetId)??"all",currentFilters:(s==null?void 0:s.currentFilters)??se,customCategories:(s==null?void 0:s.customCategories)??[],loading:(s==null?void 0:s.loading)??!1,error:s==null?void 0:s.error}}}),!0}function na({filters:t,onFiltersChange:n,activeSpace:a}){const[r,s]=C.useState("all"),[c,o]=C.useState([]),[l,u]=C.useState(null),[f,p]=C.useState(""),b=()=>{try{const g=fe();g!=null&&g.customPresets&&o(g.customPresets),g!=null&&g.activePresetId&&s(g.activePresetId),g!=null&&g.currentFilters&&n(g.currentFilters)}catch(g){console.error("Failed to load persisted state:",g)}},x=g=>{try{const j=fe();Pe({spaces:(j==null?void 0:j.spaces)??[],activeSpaceId:(j==null?void 0:j.activeSpaceId)??a,customPresets:g,activePresetId:r,currentFilters:t,customCategories:(j==null?void 0:j.customCategories)??[]})}catch(j){console.error("Failed to save persisted state:",j)}},v=g=>{s(g),a!==Z&&ve(a,{lastActivePreset:g});let j=t;if(Qe(g))j=Vt(t,g),n(j);else{const S=c.find(A=>A.id===g);S&&(j=S.filters,n(S.filters))}try{const S=fe();Pe({spaces:(S==null?void 0:S.spaces)??[],activeSpaceId:(S==null?void 0:S.activeSpaceId)??a,customPresets:c,activePresetId:g,currentFilters:j,customCategories:(S==null?void 0:S.customCategories)??[]})}catch(S){console.error("Failed to persist active preset:",S)}},k=()=>{const g=c.find(S=>S.id===r);if(!g)return;const j=c.map(S=>S.id===r?{...S,filters:{...t}}:S);o(j),x(j),W.success(`Preset "${g.name}" updated`)},i=()=>{const g={id:Date.now().toString(),name:_t(c.length),filters:{...t}},j=[...c,g];o(j),x(j),s(g.id),W.success(`Preset "${g.name}" created`)},h=g=>{const j=c.filter(S=>S.id!==g);o(j),x(j),r===g&&(s("all"),v("all"))},d=(g,j)=>{u(g),p(j)},m=()=>{if(!l||!f.trim()){u(null);return}const g=c.map(j=>j.id===l?{...j,name:f.trim()}:j);o(g),x(g),W.success("Preset renamed"),u(null)},w=()=>{u(null),p("")};return C.useEffect(()=>{b()},[]),{activePreset:r,customPresets:c,editingPresetId:l,editingPresetName:f,applyPreset:v,createNewPreset:i,updatePreset:k,deletePreset:h,startEditingPreset:d,savePresetName:m,cancelEditingPreset:w,setEditingPresetName:p,loadPresets:b}}function ra({spaces:t,activeSpace:n,onPresetRestore:a}){const[r,s]=C.useState(!1),[c,o]=C.useState(null),[l,u]=C.useState(null);return{spaceDialogOpen:r,editingSpace:c,editingSpaceFilters:l,setSpaceDialogOpen:s,setEditingSpaceFilters:u,handleSpaceSelect:h=>{if(ta(h),h!==Z){const d=t.find(m=>m.id===h);d!=null&&d.lastActivePreset&&a(d.lastActivePreset)}},handleSpaceCreate:h=>{aa(h),W.success(`Space "${h}" created`)},handleSpaceUpdate:(h,d)=>{ve(h,{name:d})},handleSpaceDelete:h=>{sa(h)},handleSpaceConfigOpen:h=>{const d=t.find(m=>m.id===h);d&&(o(d),u(d.filters),s(!0))},handleSpaceConfigSave:()=>{!c||!l||(ve(c.id,{filters:l}),s(!1),W.success("Space configuration updated"))},handleSpaceConfigReset:()=>{u({searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:[],priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:[]})}}}class ne{constructor(n){V(this,"items",[]);V(this,"linkedCrudService",null);V(this,"linkedItemsFn",null);V(this,"cache",{});n!=null&&n.source&&(Array.isArray(n.source)?this.items=structuredClone(n.source):n.source instanceof ht&&(this.linkedCrudService=n.source,this.items=n.source.readAll())),n!=null&&n.linkedItems&&(this.linkedItemsFn=n.linkedItems)}refreshFromLinkedSource(){this.linkedCrudService?this.items=this.linkedCrudService.readAll():this.linkedItemsFn&&(this.items=this.linkedItemsFn())}getItems(){return(this.linkedCrudService||this.linkedItemsFn)&&this.refreshFromLinkedSource(),structuredClone(this.items)}setItems(n){if(this.linkedCrudService||this.linkedItemsFn)throw new Error("Cannot set items when linked to a source");this.items=structuredClone(n),this.clearCache()}forceSetItems(n){this.items=structuredClone(n),this.clearCache()}getCachedResult(n,a=5e3){const r=this.cache[n];return r&&Date.now()-r.timestamp<a?r.result:null}cacheResult(n,a){this.cache[n]={timestamp:Date.now(),result:structuredClone(a)}}clearCache(){this.cache={}}getNestedValue(n,a){return a.includes(".")?a.split(".").reduce((s,c)=>s==null?void 0:s[c],n):n[a]}}class ia extends ne{constructor(a){super(a);V(this,"indices",{})}clearCache(){super.clearCache(),this.indices={}}updateItems(a){this.forceSetItems(a),this.indices={}}createIndex(a){const r=this.getItems(),s=new Map;r.forEach(c=>{const o=c[a];s.has(o)||s.set(o,[]),s.get(o).push(c)}),this.indices[a]=s}hasIndex(a){return a in this.indices}searchByIndex(a,r){this.hasIndex(a)||this.createIndex(a);const s=this.indices[a];return s.has(r)?structuredClone(s.get(r)):[]}search(a,r={}){const{caseSensitive:s=!1,exactMatch:c=!1,searchableFields:o}=r,l=this.getItems();if(!a)return l;const u=s?a:a.toLowerCase();return l.filter(f=>(o??Object.keys(f)).some(b=>{if(f[b]===void 0||f[b]===null)return!1;const x=String(f[b]),v=s?x:x.toLowerCase();return c?v===u:v.includes(u)}))}advancedSearch(a,r={logic:"AND"}){const s=`advancedSearch:${JSON.stringify(a)}:${JSON.stringify(r)}`,c=this.getCachedResult(s);if(c)return c;const o=this.getItems(),{logic:l,nestedSearch:u=!1}=r,f=o.filter(p=>{const b=a.map(x=>{const{field:v,value:k,match:i,caseSensitive:h=!1,threshold:d=.7}=x;return Array.isArray(v)?v.map(w=>this.matchItem(p,w,k,i,h,d,u)).some(w=>w):this.matchItem(p,v,k,i,h,d,u)});return l==="AND"?b.every(x=>x):l==="OR"?b.some(x=>x):l==="NOT"?!b.some(x=>x):!1});return this.cacheResult(s,f),f}matchItem(a,r,s,c,o,l,u){let f;if(u&&typeof r=="string"&&r.includes(".")?f=this.getNestedValue(a,r):f=a[r],f==null)return!1;const p=String(f),b=String(s),x=o?p:p.toLowerCase(),v=o?b:b.toLowerCase();switch(c){case"exact":return x===v;case"contains":return x.includes(v);case"startsWith":return x.startsWith(v);case"endsWith":return x.endsWith(v);case"regex":try{return new RegExp(v,o?"":"i").test(x)}catch{return!1}case"fuzzy":return this.fuzzyMatch(x,v,l);default:return!1}}fuzzyMatch(a,r,s){if(r.length===0)return!0;if(a.length===0)return!1;if(a.toLowerCase().includes(r.toLowerCase()))return!0;let c=0,o=0;const l=a.toLowerCase(),u=r.toLowerCase();for(let p=0;p<l.length&&o<u.length;p++)l[p]===u[o]&&(c++,o++);return c/r.length>=s}}class ca extends ne{constructor(n){super(n)}updateItems(n){this.forceSetItems(n)}filter(n){const a=this.getItems();return typeof n=="function"?a.filter(n):this.multiFilter([n])}multiFilter(n,a={combineWith:"AND"}){const r=this.getItems(),{combineWith:s}=a;return n.length===0?r:r.filter(c=>{const o=n.map(l=>{if(typeof l=="function")return l(c);const{field:u,operator:f,value:p}=l,b=c[u];switch(f){case"eq":return b===p;case"neq":return b!==p;case"gt":return b>p;case"gte":return b>=p;case"lt":return b<p;case"lte":return b<=p;case"contains":return String(b).includes(String(p));case"startsWith":return String(b).startsWith(String(p));case"endsWith":return String(b).endsWith(String(p));default:return!1}});return s==="AND"?o.every(l=>l):o.some(l=>l)})}advancedFilter(n){const a=`advancedFilter:${JSON.stringify(n)}`,r=this.getCachedResult(a);if(r)return r;const c=this.getItems().filter(o=>this.evaluateFilter(o,n));return this.cacheResult(a,c),c}evaluateFilter(n,a){if("conditions"in a){const{conditions:b,logic:x}=a,v=b.map(k=>this.evaluateFilter(n,k));return x==="AND"?v.every(k=>k):x==="OR"?v.some(k=>k):x==="NOT"?!v.some(k=>k):!1}const r=a,{field:s,operator:c,value:o,valueRange:l,valueList:u,caseSensitive:f=!1}=r,p=this.getNestedValue(n,s);if(p==null&&c!=="exists")return!1;if(typeof p=="string"&&["contains","startsWith","endsWith","regex"].includes(c)){const b=String(o),x=f?p:p.toLowerCase(),v=f?b:b.toLowerCase();switch(c){case"contains":return x.includes(v);case"startsWith":return x.startsWith(v);case"endsWith":return x.endsWith(v);case"regex":try{return new RegExp(v,f?"":"i").test(x)}catch{return!1}}}switch(c){case"eq":return p===o;case"neq":return p!==o;case"gt":return p>o;case"gte":return p>=o;case"lt":return p<o;case"lte":return p<=o;case"in":return Array.isArray(u)&&u.includes(p);case"nin":return Array.isArray(u)&&!u.includes(p);case"between":return Array.isArray(l)&&p>=l[0]&&p<=l[1];case"exists":return p!=null;default:return!1}}}class la extends ne{constructor(n){super(n)}updateItems(n){this.forceSetItems(n)}sort(n){return this.multiSort([n])}multiSort(n){return n.length===0?this.getItems():[...this.getItems()].sort((r,s)=>{for(const c of n){const{field:o,direction:l}=c,u=r[o],f=s[o];if(u===f)continue;const p=u<f?-1:1;return l==="asc"?p:-p}return 0})}}class oa extends ne{constructor(n){super(n)}updateItems(n){this.forceSetItems(n)}paginate(n,a){const{page:r,pageSize:s}=a,c=n.length,o=Math.ceil(c/s),l=Math.max(1,Math.min(r,o)),u=(l-1)*s,f=Math.min(u+s,c);return r>10?{items:[],totalItems:c,totalPages:o,currentPage:l}:{items:n.slice(u,f),totalItems:c,totalPages:o,currentPage:l}}paginateWithCursor(n,a){const{cursor:r,limit:s,direction:c="next",sortField:o="id",sortDirection:l="asc"}=a,u=`cursorPagination:${r??"start"}:${s}:${c}:${o}:${l}:${n.length}`,f=this.getCachedResult(u);if(f)return f;const p=[...n].sort((d,m)=>{const w=d[o],g=m[o];if(w===g)return 0;const j=w<g?-1:1;return l==="asc"?j:-j});let b=0;if(r)try{const d=JSON.parse(atob(r)),m=d.value,w=d.id;b=p.findIndex(g=>g[o]!==m?!1:g.id===w),c==="next"&&b!==-1?b+=1:c==="prev"&&(b=Math.max(0,b-s))}catch{b=0}else c==="prev"&&(b=Math.max(0,p.length-s));const x=Math.min(b+s,p.length),v=p.slice(b,x);let k=null;if(x<p.length){const d=p[x-1],m=d[o];k=btoa(JSON.stringify({value:m,id:d.id}))}let i=null;if(b>0){const d=Math.max(0,b-1),m=p[d],w=m[o];i=btoa(JSON.stringify({value:w,id:m.id}))}const h={items:v,nextCursor:k,prevCursor:i,hasMore:x<p.length};return this.cacheResult(u,h),h}}class Ce extends ne{constructor(a){super({source:a??null});V(this,"searchService");V(this,"filterService");V(this,"sortService");V(this,"paginationService");const s={linkedItems:()=>super.getItems()};this.searchService=new ia(s),this.filterService=new ca(s),this.sortService=new la(s),this.paginationService=new oa(s)}setItems(a){this.items=structuredClone(a),this.clearCache(),this.searchService.updateItems(a),this.filterService.updateItems(a),this.sortService.updateItems(a),this.paginationService.updateItems(a)}createIndex(a){this.searchService.createIndex(a)}hasIndex(a){return this.searchService.hasIndex(a)}searchByIndex(a,r){return this.searchService.searchByIndex(a,r)}search(a,r={}){return this.searchService.search(a,r)}advancedSearch(a,r={logic:"AND"}){return this.searchService.advancedSearch(a,r)}filter(a){return this.filterService.filter(a)}multiFilter(a,r={combineWith:"AND"}){return this.filterService.multiFilter(a,r)}advancedFilter(a){return this.filterService.advancedFilter(a)}sort(a){return this.sortService.sort(a)}multiSort(a){return this.sortService.multiSort(a)}paginate(a,r){return this.paginationService.paginate(a,r)}paginateWithCursor(a,r){return this.paginationService.paginateWithCursor(a,r)}chain(){const a=this,r=[];let s=null;const c=()=>{const o=`chain:${JSON.stringify(r)}`,l=this.getCachedResult(o);if(l)return l;let u=a.getItems();for(const f of r){const p=new Ce(u);switch(f.type){case"search":u=p.search(...f.args);break;case"advancedSearch":u=p.advancedSearch(...f.args);break;case"advancedFilter":u=p.advancedFilter(f.args[0]);break;case"filter":u=p.filter(f.args[0]);break;case"multiFilter":u=p.multiFilter(...f.args);break;case"sort":u=p.sort(f.args[0]);break;case"multiSort":u=p.multiSort(f.args[0]);break}}return this.cacheResult(o,u),u};return{search(o,l){return r.push({type:"search",args:[o,l]}),s=null,this},advancedSearch(o,l){return r.push({type:"advancedSearch",args:[o,l]}),s=null,this},filter(o){return r.push({type:"filter",args:[o]}),s=null,this},multiFilter(o,l){return r.push({type:"multiFilter",args:[o,l]}),s=null,this},advancedFilter(o){return r.push({type:"advancedFilter",args:[o]}),s=null,this},sort(o){return r.push({type:"sort",args:[o]}),s=null,this},multiSort(o){return r.push({type:"multiSort",args:[o]}),s=null,this},paginate(o){return s??(s=c()),a.paginate(s,o)},paginateWithCursor(o){return s??(s=c()),a.paginateWithCursor(s,o)},getItems(){return s??(s=c()),structuredClone(s)}}}}function da(t,n){const a=[];for(let r=0;r<=n.length;r++)a[r]=[r];for(let r=0;r<=t.length;r++)a[0][r]=r;for(let r=1;r<=n.length;r++)for(let s=1;s<=t.length;s++)n.charAt(r-1)===t.charAt(s-1)?a[r][s]=a[r-1][s-1]:a[r][s]=Math.min(a[r-1][s-1]+1,a[r][s-1]+1,a[r-1][s]+1);return a[n.length][t.length]}function ua(t,n,a=!1){const r=a?t:t.toLowerCase(),s=a?n:n.toLowerCase(),c=Math.floor(s.length*.2);return da(r,s)<=c}function Ze(t,n,a,r=!1){const s=r?t:t.toLowerCase(),c=r?n:n.toLowerCase();switch(a){case"exact":return s===c;case"contains":return s.includes(c);case"startsWith":return s.startsWith(c);case"endsWith":return s.endsWith(c);case"fuzzy":return ua(t,n,r);case"regex":try{return new RegExp(n,r?"":"i").test(t)}catch{return!1}default:return!0}}function ha(t,n){const a=n.filters,r=a.claudeProjectPaths||(a.claudeProjectPath?[a.claudeProjectPath]:[]);if(r.length>0&&(t=t.filter(s=>r.some(c=>{var o,l,u;return c===je?!((o=s.customProps)!=null&&o.claudeProjectPath)||((l=s.customProps)==null?void 0:l.claudeProjectPath)!=="NO_PROJECT_ID":((u=s.customProps)==null?void 0:u.claudeProjectPath)===c}))),a.fieldConditions.length>0){const s=a.fieldConditions.map(c=>o=>{const l=String(o[c.field]||"");return Ze(l,c.value,c.operator,c.caseSensitive)});t=t.multiFilter(s,{combineWith:a.conditionLogic})}if(a.searchQuery&&(t=t.search(a.searchQuery,{searchableFields:["title","description"],caseSensitive:!1})),a.statuses.length>0||a.priorities.length>0||a.categories.length>0){const s=[];a.statuses.length>0&&s.push(c=>a.statuses.includes(c.status)),a.priorities.length>0&&s.push(c=>a.priorities.includes(c.priority)),a.categories.length>0&&s.push(c=>a.categories.includes(c.category)),t=t.multiFilter(s,{combineWith:"AND"})}return t}function pa(t,n){const a=n.claudeProjectPaths||(n.claudeProjectPath?[n.claudeProjectPath]:[]);if(a.length>0&&(t=t.filter(r=>a.some(s=>{var c,o,l;return s===je?!((c=r.customProps)!=null&&c.claudeProjectPath)||((o=r.customProps)==null?void 0:o.claudeProjectPath)!=="NO_PROJECT_ID":((l=r.customProps)==null?void 0:l.claudeProjectPath)===s}))),n.fieldConditions.length>0){const r=n.fieldConditions.map(s=>c=>{const o=String(c[s.field]||"");return Ze(o,s.value,s.operator,s.caseSensitive)});t=t.multiFilter(r,{combineWith:n.conditionLogic})}if(n.searchQuery&&(t=t.search(n.searchQuery,{searchableFields:["title","description"],caseSensitive:!1})),n.statuses.length>0||n.priorities.length>0||n.categories.length>0){const r=[];n.statuses.length>0&&r.push(s=>n.statuses.includes(s.status)),n.priorities.length>0&&r.push(s=>n.priorities.includes(s.priority)),n.categories.length>0&&r.push(s=>n.categories.includes(s.category)),t=t.multiFilter(r,{combineWith:"AND"})}return t}function ma({todos:t,filters:n,spaces:a,activeSpace:r,onScrollRestore:s}){const c=C.useMemo(()=>{let l=new Ce(t).chain();if(r!==Z){const f=a.find(p=>p.id===r);f&&(l=ha(l,f))}return l=pa(l,n),l=l.sort({field:n.sortBy,direction:n.sortOrder}),l.getItems()},[t,n,a,r]);return C.useEffect(()=>{s(c)},[c,s]),{filteredTodos:c}}const ga=C.lazy(()=>xt(()=>import("./TodoTable-EEh22aZ-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(t=>({default:t.TodoTable}))),fa=[{id:"kanban-data",title:"Data",description:"View kanban data in JSON format",href:"/todo/kanban/data",icon:Ft},{id:"kanban-stats",title:"Statistics",description:"Board statistics and metrics"},{id:"kanban-board",title:"Board",description:"Kanban board view"},{id:"kanban-todo",title:"Todo",description:"Todo section"}],xa=[{label:"Home",href:"/"},{label:"Todo",href:"/todo"},{label:"Kanban"}],$e=se,ba=[];function Ea(){const{todos:t,loading:n,loadTodos:a,handleTodoStatusUpdate:r,scrollContainerRef:s,saveScrollPosition:c,restoreScrollPosition:o}=ea(),[l,u]=C.useState($e),f=g=>{c(),u(g)},p=C.useMemo(()=>g=>{var j,S;return((S=(j=g.app)==null?void 0:j.kanban)==null?void 0:S.spaces)??ba},[]),b=C.useMemo(()=>g=>{var j,S;return((S=(j=g.app)==null?void 0:j.kanban)==null?void 0:S.activeSpaceId)??Z},[]),x=ue(p),v=ue(b),k=na({filters:l,onFiltersChange:f,activeSpace:v}),i={...k,applyPreset:g=>{c(),k.applyPreset(g)},createNewPreset:()=>{c(),k.createNewPreset()},updatePreset:()=>{c(),k.updatePreset()},deletePreset:g=>{c(),k.deletePreset(g)}},h=ra({spaces:x,activeSpace:v,onPresetRestore:i.applyPreset}),d={...h,handleSpaceSelect:g=>{c(),h.handleSpaceSelect(g)},handleSpaceCreate:g=>{c(),h.handleSpaceCreate(g)},handleSpaceUpdate:(g,j)=>{c(),h.handleSpaceUpdate(g,j)},handleSpaceDelete:g=>{c(),h.handleSpaceDelete(g)},handleSpaceConfigSave:()=>{c(),h.handleSpaceConfigSave()}},{filteredTodos:m}=ma({todos:t,filters:l,spaces:x,activeSpace:v,onScrollRestore:o}),w=()=>{a(),i.loadPresets()};return e.jsxs(bt,{title:"Kanban Board",description:"Visual board for managing todos with drag-and-drop",sections:fa,headerOffset:80,breadcrumbs:xa,"data-test":"kanban-page-layout",children:[e.jsx("div",{className:"kanban-page-container flex flex-col gap-6","data-test":"kanban-page-container",children:e.jsxs("section",{id:"kanban-board",className:"kanban-board-section flex-shrink-0 min-w-0 flex flex-col",style:{height:"600px"},"data-test":"kanban-board-section",children:[e.jsx(Yt,{"data-test":"kanban-page-board-header",spaces:x,activeSpaceId:v,onImportComplete:w,onSpaceSelect:d.handleSpaceSelect,onSpaceCreate:d.handleSpaceCreate,onSpaceUpdate:d.handleSpaceUpdate,onSpaceDelete:d.handleSpaceDelete,onSpaceConfigOpen:d.handleSpaceConfigOpen,presetBadgesProps:{activePreset:i.activePreset,customPresets:i.customPresets,editingPresetId:i.editingPresetId,editingPresetName:i.editingPresetName,onPresetSelect:i.applyPreset,onPresetUpdate:i.updatePreset,onPresetCreate:i.createNewPreset,onPresetDelete:i.deletePreset,onStartEditingPreset:i.startEditingPreset,onSavePresetName:i.savePresetName,onCancelEditingPreset:i.cancelEditingPreset,onEditingPresetNameChange:i.setEditingPresetName}}),e.jsx("div",{className:"filters-wrapper mb-4 flex-shrink-0","data-test":"kanban-page-filters-wrapper",children:e.jsx(Je,{"data-test":"kanban-page-filters",filters:l,onFiltersChange:f,onReset:()=>f($e)})}),e.jsxs(pt,{defaultValue:"kanban",className:"tabs-container flex-1 min-w-0 flex flex-col","data-test":"kanban-page-tabs",children:[e.jsxs(mt,{className:"tabs-list flex-shrink-0 mb-2","data-test":"kanban-page-tabs-list",children:[e.jsx(we,{value:"kanban","data-test":"kanban-page-tab-kanban",children:"Kanban Board"}),e.jsx(we,{value:"table","data-test":"kanban-page-tab-table",children:"Table View"})]}),e.jsx(Ie,{value:"kanban",className:"tab-content-kanban flex-1 h-[60vh] min-w-0 m-0","data-test":"kanban-page-kanban-content",children:e.jsx("div",{ref:s,className:"board-content h-full overflow-x-auto overflow-y-hidden","data-test":"kanban-page-board-content",children:n?e.jsxs("div",{className:"loading-container flex items-center justify-center h-full","data-test":"kanban-page-loading",children:[e.jsx(xe,{className:"w-8 h-8 animate-spin text-gray-400","data-test":"kanban-page-loading-spinner"}),e.jsx("span",{className:"loading-text ml-3 text-gray-600","data-test":"kanban-page-loading-text",children:"Loading kanban board..."})]}):e.jsx(Qt,{"data-test":"kanban-page-board-instance",todos:m,onTodosUpdate:()=>a(!0),onTodoStatusUpdate:r,visibleColumns:l.visibleColumns,activePresetId:i.activePreset,customPresets:i.customPresets,spaces:x,activeSpaceId:v},"kanban-board-instance")})}),e.jsx(Ie,{value:"table",className:"tab-content-table flex-1 min-w-0 overflow-hidden m-0 flex flex-col","data-test":"kanban-page-table-content",children:e.jsx(gt,{storageKey:"kanban-table-column-visibility",initialConfig:ft,children:(g,j,S)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-controls flex justify-end mb-2 flex-shrink-0",children:e.jsx(S,{title:"Table Column Visibility",contentClassName:"w-80",children:e.jsx("div",{className:"column-visibility-config space-y-3",children:e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{className:"text-xs font-semibold mb-2 text-muted-foreground",children:"Column Visibility"}),e.jsx("div",{className:"space-y-2",children:Object.keys(g).map(A=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:`column-${A}`,checked:g[A],onCheckedChange:H=>{j({...g,[A]:H===!0})}}),e.jsx(ae,{htmlFor:`column-${A}`,className:"text-sm font-normal cursor-pointer",children:A.charAt(0).toUpperCase()+A.slice(1).replace(/([A-Z])/g," $1")})]},A))})]})})})}),e.jsx("div",{className:"table-wrapper flex-1 overflow-auto",children:n?e.jsxs("div",{className:"loading-container flex items-center justify-center h-full",children:[e.jsx(xe,{className:"w-8 h-8 animate-spin text-gray-400"}),e.jsx("span",{className:"loading-text ml-3 text-gray-600",children:"Loading table..."})]}):e.jsx(C.Suspense,{fallback:e.jsx("div",{className:"loading-container flex items-center justify-center h-full",children:e.jsx(xe,{className:"w-8 h-8 animate-spin text-gray-400"})}),children:e.jsx(ga,{todos:m,columnVisibility:g})})})]})})})]})]})}),e.jsx(Xt,{open:d.spaceDialogOpen,editingSpace:d.editingSpace,editingSpaceFilters:d.editingSpaceFilters,onOpenChange:d.setSpaceDialogOpen,onFiltersChange:d.setEditingSpaceFilters,onSave:d.handleSpaceConfigSave,onReset:d.handleSpaceConfigReset})]})}export{Ea as KanbanPage};
