import{d as K,r as a,j as e}from"./react-vendor-Byz07MLO.js";import{S as U}from"./SessionSidebar-CXGqFCn_.js";import{u as V,r as J,s as Q,M as W,C as X,e as Y,a as Z,t as ee,w as se}from"./index-BEUYSeX_.js";import{u as ae}from"./useSessionKeyboardNavigation-lTEDYtsm.js";import{G as te}from"./icons-Detj0uxE.js";import"./tree-C8ktHrpj.js";import"./utils-DjFvUtuq.js";import"./radix-ui-B6r6BEmy.js";import"./ui-utils-BxIQ3qGg.js";function fe(){const i=K(),[t,u]=a.useState(null),[r,l]=a.useState(!1),S=a.useRef(null),v=a.useRef(null),{sessions:d,loadingSessions:M,sessionsError:b,pagination:j,currentPage:C,excludeAgents:N,searchSessions:k,refreshSessions:g,handlePageChange:w,handleLoadMore:y,toggleExcludeAgents:I}=V({loadOnMount:!1,subscribeToSSE:!1}),{messages:m,sessionDetails:P,metadata:R,loading:O,pagination:c,currentPage:L,loadOlderMessages:A,searchMessages:E,refreshSession:h,addOptimisticMessage:B,removeOptimisticMessage:F}=J(t??void 0,{onSessionDeleted:()=>{u(null),l(!1)}}),[oe,f]=a.useState(null),[ne,p]=a.useState(!1),$=a.useMemo(()=>d.map(s=>s.id),[d]),x=a.useCallback(s=>{u(s),l(!0),i(`/claude/${s}`)},[i]),T=a.useCallback(()=>{l(!1)},[]),q=a.useCallback(()=>{const s=document.querySelector('[data-test="message-input-container"]'),o=s==null?void 0:s.querySelector("textarea");o==null||o.focus()},[]),{focusedIndex:z,sidebarHasFocus:D,focusSidebar:G,sidebarRef:_}=ae({sessionIds:$,selectedSessionId:t,onSessionSelect:x,onFocusMessageInput:t?q:void 0,enabled:!0}),H=async(s,o)=>{try{p(!0);const n=await se.searchMessages(s,o);f(n.results),console.log("Message search results:",n)}catch(n){console.error("Message search failed:",n),f([])}finally{p(!1)}};return e.jsx("div",{className:"claude-page-container h-full overflow-hidden md:p-4","data-test":"claude-page-container",children:e.jsxs("div",{className:"claude-layout relative h-full overflow-hidden md:grid md:grid-cols-[350px_1fr] md:gap-4","data-test":"claude-page-layout",children:[e.jsx("div",{ref:S,className:`sessions-sidebar h-full overflow-hidden
            md:relative md:translate-x-0
            ${r?"absolute inset-0 -translate-x-full md:translate-x-0":"relative translate-x-0"}
            transition-transform duration-300 ease-in-out
          `,"data-test":"claude-page-sessions-sidebar",children:e.jsx(U,{sessions:d,loading:M,error:b,onSessionSelect:x,selectedSessionId:t,onRefresh:g,pagination:j,currentPage:C,onPageChange:w,onLoadMore:y,onSearch:k,onMessageSearch:H,excludeAgents:N,onToggleExcludeAgents:I,focusedIndex:D?z:-1,sidebarRef:_,onSidebarClick:G})}),e.jsx("div",{ref:v,className:`chat-area flex flex-col gap-4 min-h-0 overflow-hidden bg-background
            absolute inset-0 z-10 md:relative md:inset-auto md:z-auto
            ${r?"translate-x-0":"translate-x-full md:translate-x-0"}
            ${r?"":"pointer-events-none md:pointer-events-auto"}
            transition-transform duration-300 ease-in-out
          `,"data-test":"chat-area-panel",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"chat-messages flex-1 min-h-0 overflow-hidden",children:e.jsx(Q,{messages:m,sessionDetails:P,metadata:R,loading:O,pagination:c,onLoadOlder:c&&L<c.totalPages?A:void 0,onSearch:E,onNameUpdated:()=>{h(),g()},onBackClick:T,showBackButton:!0})}),e.jsx("div",{className:"chat-input flex-shrink-0",children:e.jsx(W,{sessionId:t,onSendSuccess:()=>{h()},onAddOptimisticMessage:B,onRemoveOptimisticMessage:F,userMessages:m.filter(s=>s.role==="user"&&!s._isOptimistic)})})]}):e.jsx(X,{className:"h-full flex items-center justify-center","data-test":"claude-page-welcome-card",children:e.jsxs(Y,{className:"text-center p-8","data-test":"claude-page-welcome-content",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Select a Session"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a session from the sidebar to view its conversation"}),e.jsxs(Z,{variant:"outline",className:"mt-4",onClick:()=>i("/claude/forks"),"data-test":"claude-page-forks-button",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"View Forks"]}),e.jsx("div",{className:"session-activity-display mt-4","data-test":"claude-page-session-activity",children:e.jsx(ee,{sessionIds:[]})})]})})})]})})}export{fe as ClaudePage};
