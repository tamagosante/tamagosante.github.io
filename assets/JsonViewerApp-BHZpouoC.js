import{r as f,j as r}from"./react-vendor-Byz07MLO.js";const L=(e,t,n)=>{if(!t||t.length===0)return n;const s=t[0],l=t.slice(1);typeof s=="number"&&Array.isArray(e)&&s>=e.length;const d=Array.isArray(e)?[...e]:{...e};return l.length===0?d[s]=n:d[s]=L(e[s],l,n),d},E=(e,t,n)=>{if(!t||t.length===0)return Array.isArray(e)?[...e,n]:(console.error("Cannot add value: target is not an array or path is invalid."),e);const s=t[0],l=t.slice(1),d=Array.isArray(e)?[...e]:{...e};return l.length===0?Array.isArray(d[s])?d[s]=[...d[s],n]:console.error("Cannot add value: target at path is not an array.",t,s):d[s]=E(e[s],l,n),d},F=(e,t,n,s)=>{if(!t||t.length===0)return typeof e=="object"&&e!==null&&!Array.isArray(e)?{...e,[n]:s}:(console.error("Cannot add property: target is not an object or path is invalid."),e);const l=t[0]??"",d=t.slice(1),i=Array.isArray(e)?[...e]:{...e};return d.length===0?typeof i[l]=="object"&&i[l]!==null&&!Array.isArray(i[l])?i[l]={...i[l],[n]:s}:console.error("Cannot add property: target at path is not an object.",t,l):i[l]=F(e[l],d,n,s),i},P=(e,t)=>{let n=e;for(const s of t){if(n===null||typeof n!="object")return;n=n[s]}return n},T=(e,t,n,s)=>{if(n===s)return e;if(!t||t.length===0){if(typeof e=="object"&&e!==null&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,n)){if(Object.prototype.hasOwnProperty.call(e,s))return console.warn(`New key "${s}" already exists. Rename aborted.`),e;const{[n]:o,...b}=e;return{...b,[s]:o}}return console.error("Cannot rename property: target is not the root object or old key not found."),e}const l=t[0],d=t.slice(1),i=Array.isArray(e)?[...e]:{...e};if(d.length===0){const o=i[l];if(typeof o=="object"&&o!==null&&!Array.isArray(o)&&Object.prototype.hasOwnProperty.call(o,n)){if(Object.prototype.hasOwnProperty.call(o,s))return console.warn(`New key "${s}" already exists in object. Rename aborted.`),e;const{[n]:b,...k}=o;i[l]={...k,[s]:b}}else console.error("Cannot rename property: target at path is not an object or old key not found.",t,l,n)}else i[l]=T(e[l],d,n,s);return i},R=({data:e,path:t=[],onValueChange:n,onAddItem:s,onAddProperty:l,onRenameProperty:d,currentlyEditingKeyPath:i,nodeKey:o})=>{const b=typeof e,[k,m]=f.useState(!1),[w,y]=f.useState(typeof o=="string"?o:""),[S,A]=f.useState(!1);f.useEffect(()=>{const p=!!(i&&t.length===i.length&&t.every((x,j)=>x===i[j]));A(p),p&&typeof o=="string"&&y(o)},[i,t,o]);const O=()=>{s(t,null)},N=()=>{l(t)},c=p=>{let x;switch(p.target.type){case"checkbox":x=p.target.checked;break;case"number":x=parseFloat(p.target.value);break;default:x=p.target.value}n(t,x)},u=p=>{const x=p.target.value;let j;switch(x){case"string":j="";break;case"number":j=0;break;case"boolean":j=!1;break;case"array":j=[];break;case"object":j={};break;default:m(!1);return}n(t,j),m(!1)},a=p=>{y(p.target.value)},g=()=>{typeof o=="string"&&w&&w!==o||A(!1)},h=p=>{p.key==="Enter"?g():p.key==="Escape"&&(A(!1),y(typeof o=="string"?o:""))},v=()=>{if(e===null)return k?r.jsxs("select",{onChange:u,onBlur:()=>m(!1),style:{marginLeft:"5px"},defaultValue:"",children:[r.jsx("option",{value:"",disabled:!0,children:"Select Type"}),r.jsx("option",{value:"string",children:"String"}),r.jsx("option",{value:"number",children:"Number"}),r.jsx("option",{value:"boolean",children:"Boolean"}),r.jsx("option",{value:"array",children:"Array"}),r.jsx("option",{value:"object",children:"Object"})]}):r.jsx("span",{style:{color:"grey",cursor:"pointer",textDecoration:"underline"},onClick:()=>m(!0),children:"null"});switch(b){case"string":return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",value:e,onChange:c,style:{marginLeft:"5px",border:"1px solid #ccc"}}),","]});case"number":return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"number",value:e,onChange:c,style:{marginLeft:"5px",border:"1px solid #ccc"}}),","]});case"boolean":return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"checkbox",checked:e,onChange:c,style:{marginLeft:"5px"}}),","]});case"object":return Array.isArray(e)?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"["}),e.length===0&&r.jsx("button",{style:{marginLeft:"5px",cursor:"pointer",border:"1px solid green",color:"green",background:"lightgreen",borderRadius:"3px",padding:"0 3px"},onClick:O,children:"+"}),e.length===0&&r.jsx("span",{children:"],"}),r.jsx("div",{style:{marginLeft:"20px"},children:e.map((p,x)=>r.jsx("div",{style:{display:"flex",alignItems:"baseline"},children:r.jsx(R,{data:p,path:[...t,x],onValueChange:n,onAddItem:s,onAddProperty:l,onRenameProperty:d,currentlyEditingKeyPath:i})},x))}),e.length>0&&r.jsxs("span",{children:["]",r.jsx("button",{style:{marginLeft:"5px",cursor:"pointer",border:"1px solid green",color:"green",background:"lightgreen",borderRadius:"3px",padding:"0 3px"},onClick:O,children:"+"}),r.jsx("span",{children:","})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"{"}),Object.keys(e).length===0&&r.jsx("button",{style:{marginLeft:"5px",cursor:"pointer",border:"1px solid blue",color:"blue",background:"lightblue",borderRadius:"3px",padding:"0 3px"},onClick:N,children:"+"}),Object.keys(e).length===0&&r.jsx("span",{children:"},"}),r.jsx("div",{style:{marginLeft:"20px"},children:Object.entries(e).map(([p,x])=>r.jsx("div",{className:"flex",children:r.jsx(R,{nodeKey:p,data:x,path:[...t,p],onValueChange:n,onAddItem:s,onAddProperty:l,onRenameProperty:d,currentlyEditingKeyPath:i})},p))}),Object.keys(e).length>0&&r.jsxs("span",{children:["}",r.jsx("button",{style:{marginLeft:"5px",cursor:"pointer",border:"1px solid blue",color:"blue",background:"lightblue",borderRadius:"3px",padding:"0 3px"},onClick:N,children:"+"}),","]})]});default:return r.jsxs("span",{style:{color:"red"},children:["Unsupported type: ",b]})}},C={color:"purple",marginRight:"5px"},I=()=>o!==void 0&&typeof o=="string"?S?r.jsx("input",{type:"text",value:w,onChange:a,onBlur:g,onKeyDown:h,style:{...C,border:"1px solid blue",outline:"none"}}):r.jsxs("span",{style:C,children:['"',o,'":']}):null;return r.jsxs("div",{id:"row",style:{display:"flex",fontSize:16,marginBottom:0},children:[I(),r.jsx("div",{style:{marginLeft:o!==void 0&&typeof o=="string"?"5px":"0"},children:v()})]})},V=e=>{const{data:t,onDataChange:n}=e,[s,l]=f.useState(t??[]),[d,i]=f.useState(null),o=f.useRef(!1),b=f.useRef(null),k=f.useRef(null),m=f.useRef(!1),w=f.useCallback(c=>{if(m.current)return;m.current=!0;const u=c==="left"?b:k,a=c==="left"?k:b;u.current&&a.current&&(a.current.scrollTop=u.current.scrollTop),requestAnimationFrame(()=>{m.current=!1})},[]);f.useEffect(()=>{if(t){if(o.current){o.current=!1;return}l(t)}},[t]);const y=f.useCallback(c=>{l(u=>{const a=c(u);return a!==u&&n&&(o.current=!0,setTimeout(()=>n(a),0)),a})},[n]),S=f.useCallback((c,u)=>{y(a=>L(a,c,u))},[y]),A=f.useCallback((c,u)=>{y(a=>E(a,c,u))},[y]),O=f.useCallback(c=>{let u="newKey";y(a=>{let g=0;const h=P(a,c);if(h&&typeof h=="object"&&!Array.isArray(h))for(;Object.prototype.hasOwnProperty.call(h,u);)g++,u=`newKey_${g}`;else if(c.length===0&&typeof a=="object"&&!Array.isArray(a))for(;Object.prototype.hasOwnProperty.call(a,u);)g++,u=`newKey_${g}`;else return console.error("Target for adding property is not an object at path:",c),a;const v=F(a,c,u,null);return i([...c,u]),v})},[y]),N=f.useCallback((c,u,a)=>{if(!a||u===a)return i(null),!1;let g=!1;return y(h=>{const v=P(h,c);if(v&&typeof v=="object"&&Object.prototype.hasOwnProperty.call(v,a))return console.warn(`New key "${a}" already exists. Rename aborted.`),g=!1,h;const C=T(h,c,u,a);return g=C!==h,C}),i(null),g},[y]);return r.jsxs("div",{className:"flex h-full w-full gap-4 overflow-hidden",style:{fontFamily:"monospace",padding:"10px"},"data-test":"json-viewer-app-container",children:[r.jsxs("section",{className:"flex-1 min-w-0 flex flex-col overflow-hidden","data-test":"json-viewer-preview-section",children:[r.jsx("h4",{className:"flex-shrink-0 mb-2",children:"Current State Preview:"}),r.jsx("pre",{ref:b,className:"flex-1 overflow-auto",style:{whiteSpace:"pre-wrap",wordBreak:"break-all",padding:"10px",border:"1px solid #ccc"},onScroll:()=>w("left"),"data-test":"json-viewer-preview-content",children:JSON.stringify(s,null,2)})]}),r.jsx("div",{className:"w-px bg-border flex-shrink-0"}),r.jsxs("section",{className:"flex-1 min-w-0 flex flex-col overflow-hidden","data-test":"json-viewer-editor-section",children:[r.jsx("h4",{className:"flex-shrink-0 mb-2",children:"Editable JSON Viewer"}),r.jsx("div",{ref:k,className:"flex-1 overflow-auto",onScroll:()=>w("right"),"data-test":"json-viewer-editor-content",children:r.jsx(R,{data:s,onValueChange:S,onAddItem:A,onAddProperty:O,onRenameProperty:N,currentlyEditingKeyPath:d})})]})]})};export{V as J};
