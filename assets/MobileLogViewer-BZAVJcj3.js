var V=Object.defineProperty;var Y=(l,e,s)=>e in l?V(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s;var f=(l,e,s)=>Y(l,typeof e!="symbol"?e+"":e,s);import{r as n,j as o}from"./react-vendor-Byz07MLO.js";import{ac as Z,a as b}from"./index-BbgB-sev.js";import{t as u}from"./utils-DjFvUtuq.js";import{af as H,e as W,D as q,T as Q}from"./icons-Detj0uxE.js";const w=l=>{if(l==null)return l;if(typeof l=="number")return Math.round(l*10)/10;if(Array.isArray(l))return l.map(w);if(typeof l=="object"){const e={};for(const[s,a]of Object.entries(l))e[s]=w(a);return e}return l};class X{constructor(){f(this,"logs",[]);f(this,"logsByGroup",new Map);f(this,"maxLogs",200);f(this,"enabled",!0)}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}setMaxLogs(e){this.maxLogs=e,this.trimLogs()}debug(e,s,a,r){this.addLog("debug",e,s,a,r)}info(e,s,a,r){this.addLog("info",e,s,a,r)}warn(e,s,a,r){this.addLog("warn",e,s,a,r)}error(e,s,a,r){this.addLog("error",e,s,a,r)}addLog(e,s,a,r,g){if(!this.enabled)return;const v=r?w(r):void 0,p={timestamp:Date.now(),level:e,category:s,message:a,data:v,group:g};if(this.logs.push(p),this.trimLogs(),g){this.logsByGroup.has(g)||this.logsByGroup.set(g,[]);const d=this.logsByGroup.get(g);d.push(p),d.length>this.maxLogs&&this.logsByGroup.set(g,d.slice(-this.maxLogs))}}trimLogs(){this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs))}getLogs(){return[...this.logs]}getLogsByCategory(e){return this.logs.filter(s=>s.category===e)}getLogsByLevel(e){return this.logs.filter(s=>s.level===e)}getLogsByGroup(e){return this.logsByGroup.get(e)||[]}getLogGroups(){return Array.from(this.logsByGroup.keys()).sort()}getLogsAsString(){return this.logs.map(e=>{const s=new Date(e.timestamp).toISOString().substr(11,12),a=e.data?` ${JSON.stringify(e.data)}`:"";return`[${s}] [${e.level.toUpperCase()}] [${e.category}] ${e.message}${a}`}).join(`
`)}getLogsAsJSON(){return JSON.stringify(this.logs,null,2)}clear(){this.logs=[],this.logsByGroup.forEach((e,s)=>{this.logsByGroup.set(s,[])})}count(){return this.logs.length}async copyToClipboard(){try{return await navigator.clipboard.writeText(this.getLogsAsString()),!0}catch(e){return console.error("Failed to copy logs to clipboard:",e),!1}}downloadLogs(e="mobile-logs.txt"){const s=new Blob([this.getLogsAsString()],{type:"text/plain"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}}const h=new X,C="mobile-log-viewer-group",N="mobile-log-viewer-position",j="mobile-log-viewer-size",T={width:500,height:400},le=({defaultVisible:l=!1,autoRefresh:e=!0,refreshInterval:s=500,onClose:a})=>{const[r,g]=n.useState(l),[v,p]=n.useState(""),[d,O]=n.useState("all"),[x,E]=n.useState("all"),[m,G]=n.useState(()=>{try{return localStorage.getItem(C)||"all"}catch{return"all"}}),[A,B]=n.useState(()=>{try{const t=localStorage.getItem(N);return t?JSON.parse(t):void 0}catch{return}}),[L,I]=n.useState(()=>{try{const t=localStorage.getItem(j);return t?JSON.parse(t):T}catch{return T}}),i=n.useRef(null);n.useEffect(()=>{try{localStorage.setItem(C,m)}catch{}},[m]),n.useEffect(()=>{if(!e||!r)return;const t=setInterval(()=>{S()},s);return()=>clearInterval(t)},[e,r,s,d,x,m]),n.useEffect(()=>{r&&S()},[r]);const S=()=>{let t=m!=="all"?h.getLogsByGroup(m):h.getLogs();d!=="all"&&(t=t.filter(c=>c.level===d)),x!=="all"&&(t=t.filter(c=>c.category===x));const y=t.map(c=>{const _=new Date(c.timestamp).toISOString().substr(11,12),K=c.data?` ${JSON.stringify(c.data)}`:"";return`[${_}] [${c.level.toUpperCase()}] [${c.category}] ${c.message}${K}`}).join(`
`);p(y)},k=async()=>{let t=await h.copyToClipboard();if(!t&&i.current)try{i.current.focus(),i.current.select(),i.current.setSelectionRange(0,i.current.value.length),t=document.execCommand("copy"),setTimeout(()=>{t?u.success("Logs copied to clipboard!"):u.error("Failed to copy. Please use Select Text button and copy manually.")},100)}catch(y){console.error("Copy fallback failed:",y),setTimeout(()=>{u.error("Failed to copy. Please use Select Text button and copy manually.")},100)}else setTimeout(t?()=>{u.success("Logs copied to clipboard!")}:()=>{u.error("Failed to copy. Please use Select Text button and copy manually.")},100)},D=()=>{h.clear(),p(""),u.success("Logs cleared!")},$=()=>{h.downloadLogs(`mobile-logs-${Date.now()}.txt`),u.success("Logs downloaded!")},z=()=>{i.current&&(i.current.focus(),i.current.select(),i.current.setSelectionRange(0,i.current.value.length),setTimeout(()=>{u.success("Text selected! Long-press to copy.")},100))},F=()=>{a?a():g(!1)},P=t=>{B(t);try{localStorage.setItem(N,JSON.stringify(t))}catch{}},R=t=>{I(t);try{localStorage.setItem(j,JSON.stringify(t))}catch{}},J=["all",...new Set(h.getLogs().map(t=>t.category))],M=["all",...h.getLogGroups()],U=o.jsxs(o.Fragment,{children:[o.jsx(b,{onClick:z,variant:"ghost",size:"sm",className:"h-6 w-6 p-0",title:"Select all text","data-test":"mobile-log-viewer-select-text",children:o.jsx(H,{className:"h-3.5 w-3.5"})}),o.jsx(b,{onClick:k,variant:"ghost",size:"sm",className:"h-6 w-6 p-0",title:"Copy to clipboard","data-test":"mobile-log-viewer-copy",children:o.jsx(W,{className:"h-3.5 w-3.5"})}),o.jsx(b,{onClick:$,variant:"ghost",size:"sm",className:"h-6 w-6 p-0",title:"Download logs","data-test":"mobile-log-viewer-download",children:o.jsx(q,{className:"h-3.5 w-3.5"})}),o.jsx(b,{onClick:D,variant:"ghost",size:"sm",className:"h-6 w-6 p-0",title:"Clear logs","data-test":"mobile-log-viewer-clear",children:o.jsx(Q,{className:"h-3.5 w-3.5"})})]});return o.jsx(Z,{isVisible:r||l,onClose:F,title:"Mobile Debug Logs",initialPosition:A||{x:16,y:window.innerHeight-L.height-16},initialSize:L,resizable:!0,shouldCloseManually:!0,onPositionChange:P,onSizeChange:R,headerActions:U,className:"flex flex-col",children:o.jsxs("div",{className:"flex flex-col h-full","data-test":"mobile-log-viewer-container",children:[o.jsxs("div",{className:"flex gap-2 p-2 border-b flex-wrap","data-test":"mobile-log-viewer-filters",children:[o.jsx("select",{value:m,onChange:t=>G(t.target.value),className:"text-xs px-2 py-1 border rounded bg-background font-semibold","data-test":"mobile-log-viewer-filter-group",children:M.map(t=>o.jsx("option",{value:t,children:t==="all"?"All Groups":t},t))}),o.jsxs("select",{value:d,onChange:t=>O(t.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-level",children:[o.jsx("option",{value:"all",children:"All Levels"}),o.jsx("option",{value:"debug",children:"Debug"}),o.jsx("option",{value:"info",children:"Info"}),o.jsx("option",{value:"warn",children:"Warn"}),o.jsx("option",{value:"error",children:"Error"})]}),o.jsx("select",{value:x,onChange:t=>E(t.target.value),className:"text-xs px-2 py-1 border rounded bg-background","data-test":"mobile-log-viewer-filter-category",children:J.map(t=>o.jsx("option",{value:t,children:t==="all"?"All Categories":t},t))})]}),o.jsx("div",{className:"flex-1 overflow-auto p-2","data-test":"mobile-log-viewer-logs-container",children:o.jsx("textarea",{ref:i,readOnly:!0,value:v||"No logs yet. Logs will appear here as events occur.",className:"w-full h-full text-xs font-mono bg-muted p-2 rounded border-none resize-none min-h-[200px]",onClick:t=>{t.target.select()},"data-test":"mobile-log-viewer-logs-textarea"})}),o.jsxs("div",{className:"p-2 text-xs text-muted-foreground flex justify-between border-t","data-test":"mobile-log-viewer-footer",children:[o.jsxs("span",{"data-test":"mobile-log-viewer-total-count",children:["Total: ",h.count()," logs"]}),o.jsxs("span",{"data-test":"mobile-log-viewer-auto-refresh",children:["Auto-refresh: ",e?"ON":"OFF"]})]})]})})};export{le as M,h as m};
