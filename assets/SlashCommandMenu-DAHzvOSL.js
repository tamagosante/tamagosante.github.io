import{r,j as g,b as V}from"./react-vendor-Byz07MLO.js";import{g as z}from"./cursorPosition-otMhJ5rZ.js";import{ai as A,ab as H,V as E}from"./index-eHP58yiE.js";function I(u,c){const a=u.toLowerCase(),l=c.toLowerCase();let i=0;for(let n=0;n<l.length&&i<a.length;n++)l[n]===a[i]&&i++;return i===a.length}function K({commands:u,inputRef:c,onCommandExecute:a}){const[l,i]=r.useState(!1),[n,x]=r.useState(""),[y,s]=r.useState(0),[o,k]=r.useState(null),[L,M]=r.useState({top:0,left:0}),m=r.useMemo(()=>{if(!n)return u;const e=n.toLowerCase();return u.filter(t=>t.trigger.toLowerCase().startsWith(e)||t.name.toLowerCase().includes(e)||I(n,t.trigger)||I(n,t.name))},[u,n]);r.useMemo(()=>{s(0)},[m.length]);const p=r.useCallback(()=>{i(!1),x(""),k(null),s(0)},[]),C=r.useCallback(e=>{var D,N;const t=c.current;if(!t||o===null)return;const f=t.selectionStart??0,h=t.value,d={query:n,fullText:h,cursorPosition:f,slashPosition:o},w=e.onSelect(d),b=w??"",v=h.substring(0,o),S=h.substring(f),R=v+b+S,P=((D=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:D.set)||((N=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:N.set);P&&(P.call(t,R),t.dispatchEvent(new Event("input",{bubbles:!0})));const j=o+b.length;t.setSelectionRange(j,j),a==null||a(e,w),p()},[c,o,n,a,p]),T=r.useCallback(e=>{const t=e.currentTarget,f=t.selectionStart??0,h=t.value;if(e.key==="/"&&!l){const d=f>0?h[f-1]:"";if(f===0||/\s/.test(d)){const w=z(t);if(w){const b=t.getBoundingClientRect(),v=window.getComputedStyle(t),S=parseInt(v.lineHeight||v.fontSize)||20;M({top:b.top+w.top-S-A.slashCommand.menuGapAboveInput,left:b.left+w.left})}k(f),i(!0),x(""),s(0)}return}l&&(e.key==="ArrowDown"?(e.preventDefault(),s(d=>d<m.length-1?d+1:0)):e.key==="ArrowUp"?(e.preventDefault(),s(d=>d>0?d-1:m.length-1)):e.key==="Enter"||e.key==="Tab"?m.length>0&&(e.preventDefault(),C(m[y])):e.key==="Escape"&&(e.preventDefault(),p()))},[l,m,y,C,p]),O=r.useCallback(e=>{if(!l||o===null)return;if(o>=e.length||e[o]!=="/"){p();return}const t=c.current,f=(t==null?void 0:t.selectionStart)??e.length,h=e.substring(o+1,f);if(h.includes(" ")){p();return}x(h)},[l,o,c,p]);return{isOpen:l,query:n,filteredCommands:m,selectedIndex:y,handleKeyDown:T,handleChange:O,selectCommand:C,close:p,menuPosition:L}}const q=({commands:u,selectedIndex:c,position:a,onSelect:l,onClose:i})=>{const n=r.useRef(null),x=r.useRef(null);r.useEffect(()=>{var s;(s=x.current)==null||s.scrollIntoView({block:"nearest"})},[c]),r.useEffect(()=>{const s=o=>{n.current&&!n.current.contains(o.target)&&i()};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[i]);const y=g.jsx("div",{ref:n,"data-test":"slash-command-menu",className:E("fixed min-w-[200px] max-w-[300px]","rounded-md border bg-popover p-1 shadow-md",u.length>0&&"max-h-[200px] overflow-y-auto"),style:{top:a.top,left:a.left,zIndex:H.slashCommandMenu,transform:"translateY(-100%)"},children:u.length===0?g.jsx("div",{"data-test":"slash-command-empty",className:"py-2 px-2 text-sm text-muted-foreground text-center",children:"No commands found"}):u.map((s,o)=>g.jsxs("div",{ref:o===c?x:void 0,"data-test":"slash-command-item",className:E("flex items-center gap-2 rounded-sm px-2 py-1.5 text-sm cursor-pointer","select-none outline-none",o===c?"bg-accent text-accent-foreground":"hover:bg-accent/50"),onClick:()=>l(s),children:[s.icon&&g.jsx("span",{"data-test":"slash-command-icon",className:"flex-shrink-0 w-4 h-4",children:s.icon}),g.jsxs("div",{"data-test":"slash-command-content",className:"flex flex-col flex-1 min-w-0",children:[g.jsxs("span",{"data-test":"slash-command-name",className:"font-medium truncate",children:["/",s.trigger]}),s.description&&g.jsx("span",{"data-test":"slash-command-description",className:"text-xs text-muted-foreground truncate",children:s.description})]})]},s.id))});return V.createPortal(y,document.body)};q.displayName="SlashCommandMenu";export{q as S,K as u};
