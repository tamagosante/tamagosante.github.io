import{j as e,r as d}from"./react-vendor-Byz07MLO.js";import{t as K}from"./utils-DjFvUtuq.js";import{S as ke,h as Se,i as Ot,j as Ae,k as ae,ac as be,L as he,I as ve,a as te,l as Ss,aQ as ja,ay as ut,aj as ya,b1 as va,b2 as Na,b_ as Ca,b$ as wa,bb as ka,aY as Sa,aZ as Aa,a_ as Ia,V as Te,az as _a,c7 as Ea,aB as Ta,aJ as Oa,m as Fa,n as Ba,o as As,p as Is}from"./index-CJ-Awmlc.js";import{ag as cs,bz as Rs,bA as Da,S as Ma,bt as Wt,b1 as Pa,D as Ra,T as tt,ab as Va,U as Vs,C as $e,X as st,q as $a,c as La,af as os,Q as ds,bL as za,aB as qa,as as Ft,$ as $s,a2 as ht,aM as St,i as Ua,bs as Ha,E as Ls,z as Gt,bu as Wa,aa as Ga,R as zs,f as Ka,g as et,b2 as Bt,O as ot,a4 as Ja,W as Xa,_ as Ya,e as Qa,l as Za,bi as el,bM as tl}from"./icons-Detj0uxE.js";import{D as qs}from"./DraggableCrudTree-C1-qpnFJ.js";import{T as pt}from"./TftCardTabs-DP2w7Gz4.js";import"./radix-ui-B6r6BEmy.js";import"./ui-utils-BxIQ3qGg.js";import"./DragDropManager-CacIWg_Z.js";import"./treeHelpers-DUv_6quS.js";const U={50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",800:"#1f2937"},fe={100:"#dbeafe",500:"#3b82f6",600:"#2563eb",800:"#1e40af"},Lt={100:"#e0e7ff",600:"#4f46e5"},je={100:"#dcfce7",200:"#bbf7d0",300:"#86efac",500:"#22c55e",600:"#16a34a",800:"#166534"},Ie={50:"#fef2f2",100:"#fee2e2",500:"#ef4444",600:"#dc2626"},Nt={100:"#fef9c3",300:"#fde047",400:"#facc15",700:"#a16207"},sl={500:"#06b6d4"},nl={highlight:"#f800dd80"},B={primary:U[800],secondary:U[600],muted:U[500],placeholder:U[400],white:"#ffffff",danger:Ie[600]},q={white:"#ffffff",paper:U[50],subtle:U[100],muted:U[200],primary:fe[500],primaryLight:"rgba(59, 130, 246, 0.15)",whiteAlpha:"rgba(255, 255, 255, 0.8)",success:je[100],secondary:U[200]},me={default:U[300],light:U[200],primary:fe[500],error:Ie[500]},Ge={includedBg:je[100],includedBorder:je[500],excludedBg:Ie[100],excludedBorder:Ie[500],checkBg:je[500]},ye={selectedBg:Lt[100],checkBorder:Lt[600],checkBg:Lt[600],attrBg:fe[100],attrColor:fe[800]},Ve={errorBg:Ie[50],errorText:Ie[500],successBg:je[100],successText:je[600],neutralBg:U[100],neutralText:U[500]},zt={selector:{bg:Nt[100],bgHover:Nt[300],border:Nt[400],text:Nt[700]},selectorEmpty:{bg:"hsl(var(--background))",bgHover:"hsl(var(--muted))",border:"hsl(var(--border))",text:"hsl(var(--muted-foreground))"},content:{bg:je[100],bgHover:je[200],border:je[300],text:je[800]}},Kt={outline:sl[500],background:nl.highlight},ie={fieldName:fe[600],fieldNameUnderscore:fe[500],punctuation:U[800],collapsedLabel:U[400],nullValue:U[400],genericValue:U[500],arrayIndex:U[400]},Y={primary:fe[600],tabActiveBg:q.white,tabInactiveBg:U[100],tabActiveText:fe[600],tabInactiveText:U[500],tabActiveBorder:fe[600]},$={bg:q.white,text:U[800],border:U[300],itemText:U[800],dangerText:Ie[600]},le={muted:U[500],secondary:U[600],primary:fe[500],success:je[600],danger:Ie[600]},de={bg:q.white,headerText:U[500],sectionBorder:U[200],emptyText:U[400]},Xe={bg:U[50],border:U[300],borderError:Ie[500],text:U[800]},we={outline:`2px solid ${Kt.outline}`,outlineOffset:"2px",background:Kt.background},Jt={collapsed:12,expanded:50},al=[{id:"champions",name:"champions",type:"array",order:0,parentId:null,mapping:null},{id:"cost",name:"cost",type:"string",order:0,parentId:"champions",mapping:null},{id:"traits",name:"traits",type:"string",order:1,parentId:"champions",mapping:null},{id:"type",name:"type",type:"string",order:2,parentId:"champions",mapping:null},{id:"ability",name:"ability",type:"object",order:3,parentId:"champions",mapping:null},{id:"manaCost",name:"manaCost",type:"string",order:0,parentId:"ability",mapping:null},{id:"description",name:"description",type:"string",order:1,parentId:"ability",mapping:null},{id:"activation",name:"activation",type:"array",order:2,parentId:"ability",mapping:null},{id:"kind",name:"kind",type:"string",order:0,parentId:"activation",mapping:null},{id:"value",name:"value",type:"string",order:1,parentId:"activation",mapping:null},{id:"calculation",name:"calculation",type:"string",order:2,parentId:"activation",mapping:null},{id:"valuePerLevel",name:"valuePerLevel",type:"string",order:3,parentId:"activation",mapping:null}],ll={champions:{_container:"",_item:"",cost:"",traits:"",type:"",ability:{manaCost:"",description:"",activation:{_container:"",_item:"",kind:"",value:"",calculation:"",valuePerLevel:""}}}},rl={champions:{_container:".mb-8",_item:".rounded.text-white1.w-\\[291px\\].flex.flex-col.h-full.bg-bg",_if:{selector:".leading-snug.pb-3",condition:"exists"},_branches:{1:{match:"/true/",unlockCondition:".leading-snug.pb-3 .leading-tight"},2:{match:"/./"}},name:{selector:".relative.flex.justify-between.p-\\[9px\\].bg-bg.text-\\[18px\\].font-montserrat.font-semibold.rounded-\\[3px\\]",index:null,excludeChildren:[".flex.items-end"]},cost:".flex.items-end.text-\\[16px\\]",traits:".absolute.text-lg.leading-snug.bottom-\\[6px\\].left-\\[6px\\]",type:".mb-2.bg-bg2.rounded-lg.px-2.py-1.font-montserrat.font-medium.self-start",unlockCondition:"",ability:{_container:".p-3.flex.flex-col.text-sm",name:".font-medium.text-sm",manaCost:".pt-\\[1px\\]",description:".leading-tight:not(.inline)",activation:{_container:".flex.flex-col.gap-\\[2px\\]",_item:".flex.flex-wrap.justify-between",kind:".leading-tight > span:first-child",type:"img@alt",value:".text-sky-11, .text-yellow-11, .text-tomato-11",calculation:".text-yellow-11",valuePerLevel:".text-white2"}}}};function il({mode:t,moreActionsOpen:n,onModeChange:s,onMoreActionsOpenChange:a,onSave:l,onManage:r,onAdvancedSettings:i,onDownload:o,onClear:c,portalContainer:u}){return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{value:t,onValueChange:h=>s(h),children:[e.jsx(Se,{className:"h-6 w-20 text-xs",style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"capture-mode-select-v2",children:e.jsx(Ot,{})}),e.jsxs(Ae,{style:{backgroundColor:$.bg,color:$.text},"data-test":"capture-mode-options-v2",container:u,children:[e.jsx(ae,{value:"mapped",style:{color:$.itemText},"data-test":"capture-mode-mapped-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3"}),"Mapped"]})}),e.jsx(ae,{value:"list",style:{color:$.itemText},"data-test":"capture-mode-list-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-3 h-3"}),"List"]})})]})]}),e.jsxs(ke,{open:n,onOpenChange:a,value:"",onValueChange:h=>{a(!1),h==="save"?l():h==="manage"?r():h==="advanced"?i():h==="download"?o():h==="clear"&&c()},children:[e.jsx(Se,{className:"h-6 w-6 px-0 border-0 shadow-none bg-transparent","data-test":"more-actions-select-v2",hideChevron:!0,children:e.jsx(Da,{className:"w-4 h-4",style:{color:le.muted}})}),e.jsxs(Ae,{style:{backgroundColor:$.bg,color:$.text},"data-test":"more-actions-options-v2",container:u,children:[e.jsx(ae,{value:"save",style:{color:$.itemText},"data-test":"action-save-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"w-3 h-3"}),"Quick Save"]})}),e.jsx(ae,{value:"manage",style:{color:$.itemText},"data-test":"action-manage-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"w-3 h-3"}),"Manage Saved Data"]})}),e.jsx(ae,{value:"advanced",style:{color:$.itemText},"data-test":"action-advanced-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"w-3 h-3"}),"Advanced Settings"]})}),e.jsx(ae,{value:"download",style:{color:$.itemText},"data-test":"action-download-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"w-3 h-3"}),"Download JSON"]})}),e.jsx(ae,{value:"clear",style:{color:$.dangerText},"data-test":"action-clear-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-3 h-3"}),"Clear Data"]})})]})]})]})}const cl=[{value:"string",label:"Text",icon:"T"},{value:"number",label:"Number",icon:"#"},{value:"boolean",label:"Boolean",icon:"?"},{value:"array",label:"Array",icon:"[]"},{value:"parentSelector",label:"Parent",icon:"{1}"},{value:"object",label:"Object",icon:"{}"}];function ol({isOpen:t,suggestedName:n,editingField:s,onSubmit:a,onCancel:l,portalContainer:r}){const[i,o]=d.useState(""),[c,u]=d.useState("string"),[h,m]=d.useState(""),[y,j]=d.useState(""),C=d.useRef(null),N=!!s;d.useEffect(()=>{t&&(s?(o(s.name),u(s.type),m(s.containerSelector||""),j(s.itemSelector||"")):(o(n),u("string"),m(""),j("")),setTimeout(()=>{var x;return(x=C.current)==null?void 0:x.focus()},100))},[t,n,s]);const f=()=>{const x={name:i.trim(),type:c};return c==="array"&&(h.trim()&&(x.containerSelector=h.trim()),y.trim()&&(x.itemSelector=y.trim())),x};d.useEffect(()=>{if(!t)return;const x=b=>{b.key==="Escape"?l():b.key==="Enter"&&i.trim()&&a(f())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[t,i,c,h,y,a,l]);const g=()=>{i.trim()&&a(f())};return e.jsx(be,{isVisible:t,onClose:l,title:N?"Update Field":"Add Field",shouldCloseManually:!0,initialPosition:{x:window.innerWidth/2-175,y:window.innerHeight/3},className:"!w-[350px]",portalContainer:r,children:e.jsxs("div",{className:"p-3","data-test":"field-dialog",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(he,{htmlFor:"field-name",className:"text-xs text-foreground font-medium",children:"Field Name"}),e.jsx(ve,{ref:C,id:"field-name",value:i,onChange:x=>o(x.target.value),placeholder:"e.g., title, author, description",className:"mt-1 text-foreground","data-test":"field-name-input"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(he,{className:"text-xs text-foreground font-medium",children:"Field Type"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-1","data-test":"field-type-selector",children:cl.map(x=>e.jsxs("button",{type:"button",onClick:()=>u(x.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.stopPropagation(),u(x.value))},className:"flex flex-col items-center p-2 rounded border text-xs transition-colors",style:{borderColor:c===x.value?fe[500]:void 0,backgroundColor:c===x.value?q.primaryLight:void 0,color:c===x.value?fe[500]:void 0,fontWeight:c===x.value?500:void 0},title:x.label,"data-test":"field-type","data-selected":c===x.value,children:[e.jsx("span",{className:"font-mono text-sm",children:x.icon}),e.jsx("span",{className:"text-[10px] mt-0.5",children:x.label})]},x.value))})]}),c==="array"&&e.jsxs("div",{className:"mb-4 space-y-3","data-test":"array-selectors",children:[e.jsxs("div",{children:[e.jsx(he,{htmlFor:"container-selector",className:"text-xs text-foreground font-medium",children:"Container Selector"}),e.jsx(ve,{id:"container-selector",value:h,onChange:x=>m(x.target.value),placeholder:"e.g., .item-list, #products",className:"mt-1 text-foreground font-mono text-xs","data-test":"container-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Parent element containing all items"})]}),e.jsxs("div",{children:[e.jsx(he,{htmlFor:"item-selector",className:"text-xs text-foreground font-medium",children:"Item Selector"}),e.jsx(ve,{id:"item-selector",value:y,onChange:x=>j(x.target.value),placeholder:"e.g., .item, > div",className:"mt-1 text-foreground font-mono text-xs","data-test":"item-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Selector for each item (relative to container)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:l,"data-test":"field-dialog-cancel",children:"Cancel"}),e.jsx(te,{size:"sm",onClick:g,disabled:!i.trim(),"data-test":"field-dialog-submit",children:N?"Update Field":"Add Field"})]})]})})}function dl({isOpen:t,fieldName:n,values:s,onClose:a,onItemHover:l,onItemClick:r,portalContainer:i}){if(!t)return null;const o=c=>{if(c===null)return"null";if(c===void 0)return"undefined";if(typeof c=="string")return c;if(typeof c=="number"||typeof c=="boolean")return String(c);if(typeof c=="object")try{return JSON.stringify(c,null,2)}catch{return"[Object]"}return String(c)};return e.jsx(be,{isVisible:t,onClose:a,title:`Content: ${n}`,initialPosition:{x:window.innerWidth/2-200,y:100},initialSize:{width:400,height:300},portalContainer:i,resizable:!0,showPinButton:!1,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"content-popover-body-v2",style:{backgroundColor:de.bg},children:s.length===0?e.jsx("div",{className:"text-sm italic",style:{color:de.emptyText},"data-test":"content-popover-empty-v2",children:"No values extracted"}):s.length===1?e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words font-mono",style:{color:B.primary,backgroundColor:q.paper,padding:"8px",borderRadius:"4px"},"data-test":"content-popover-single-value-v2",children:o(s[0])}):e.jsxs("div",{className:"space-y-2","data-test":"content-popover-values-list-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2",style:{color:B.muted},"data-test":"content-popover-count-v2",children:[s.length," values extracted"]}),s.map((c,u)=>e.jsxs("div",{className:"text-sm whitespace-pre-wrap break-words font-mono cursor-pointer transition-colors",style:{color:B.primary,backgroundColor:q.paper,padding:"8px",borderRadius:"4px",borderLeft:`3px solid ${me.primary}`},onMouseEnter:()=>l==null?void 0:l(u),onMouseLeave:()=>l==null?void 0:l(null),onClick:()=>r==null?void 0:r(u),"data-test":"content-popover-value-v2",children:[e.jsxs("span",{className:"text-xs font-medium mr-2",style:{color:B.muted},children:["[",u,"]"]}),o(c)]},u))]})})})}const ul=`{
  "champions": {
    "_container": "[data-test='tft-cards-v2']",
    "_item": ".rounded.text-white1",
    "cost": ".flex.items-end",
    "traits": ".absolute.text-lg",
    "type": ".bg-bg2.rounded-lg"
  }
}`;function hl({isOpen:t,onImport:n,onClose:s,portalContainer:a}){const[l,r]=d.useState(""),[i,o]=d.useState(null),c=()=>{if(o(null),!l.trim()){o("Please enter JSON");return}try{const m=JSON.parse(l);n(m),r(""),s()}catch(m){o(m instanceof Error?m.message:"Invalid JSON")}},u=()=>{r(""),o(null),s()},h=()=>{r(ul),o(null)};return t?e.jsx(be,{isVisible:t,onClose:u,title:"Import Schema",shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth/2-200,y:window.innerHeight/4},initialSize:{width:400,height:350},portalContainer:a,children:e.jsxs("div",{className:"flex flex-col h-full p-3 gap-3","data-test":"import-dialog-content-v2",children:[e.jsx("div",{className:"flex gap-2","data-test":"import-example-buttons-v2",children:e.jsx("button",{onClick:h,className:"text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:q.subtle,color:B.secondary},"data-test":"import-example-v2",children:"Load Example"})}),e.jsx("textarea",{autoFocus:!0,value:l,onChange:m=>{r(m.target.value),o(null)},placeholder:"Paste JSON selectors here...",className:"flex-1 min-h-0 p-2 text-xs font-mono rounded border resize-none",style:{backgroundColor:Xe.bg,borderColor:i?Xe.borderError:Xe.border,color:Xe.text},"data-test":"import-json-input-v2"}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded text-xs",style:{backgroundColor:Ve.errorBg,color:B.danger},"data-test":"import-error-v2",children:[e.jsx(Va,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex justify-end gap-2","data-test":"import-actions-v2",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:u,"data-test":"import-cancel-button-v2",children:"Cancel"}),e.jsxs(te,{size:"sm",onClick:c,className:"gap-1","data-test":"import-confirm-button-v2",children:[e.jsx(Vs,{className:"w-3 h-3"}),"Import"]})]})]})}):null}function pl({isOpen:t,savedCaptures:n,onLoad:s,onRename:a,onDelete:l,onClose:r,portalContainer:i}){const[o,c]=d.useState(null),[u,h]=d.useState("");if(!t)return null;const m=f=>new Date(f).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=f=>{c(f.id),h(f.name)},j=()=>{o&&u.trim()&&(a(o,u.trim()),c(null),h(""))},C=()=>{c(null),h("")},N=f=>{f.key==="Enter"?j():f.key==="Escape"&&C()};return e.jsx(be,{isVisible:t,onClose:r,title:"Manage Saved Data",initialPosition:{x:window.innerWidth/2-225,y:100},initialSize:{width:450,height:400},resizable:!0,showPinButton:!1,portalContainer:i,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"saved-data-manager-body",style:{backgroundColor:de.bg},children:n.length===0?e.jsx("div",{className:"text-sm italic text-center py-8",style:{color:de.emptyText},"data-test":"saved-data-manager-empty",children:"No saved captures yet"}):e.jsx("div",{className:"space-y-2","data-test":"saved-data-manager-list",children:n.map(f=>e.jsx("div",{className:"flex items-center gap-2 p-2 rounded border",style:{backgroundColor:q.paper,borderColor:me.light},"data-test":"saved-capture-item",children:o===f.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(ve,{value:u,onChange:g=>h(g.target.value),onKeyDown:N,className:"h-7 text-sm",autoFocus:!0,"data-test":"saved-capture-edit-input"}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:j,"data-test":"saved-capture-edit-save",children:e.jsx($e,{className:"w-4 h-4",style:{color:le.success}})}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:C,"data-test":"saved-capture-edit-cancel",children:e.jsx(st,{className:"w-4 h-4",style:{color:le.muted}})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",style:{color:B.primary},"data-test":"saved-capture-name",children:f.name}),e.jsx("div",{className:"text-xs",style:{color:B.placeholder},"data-test":"saved-capture-date",children:m(f.capturedAt)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>s(f.id),title:"Load","data-test":"saved-capture-load",children:e.jsx($a,{className:"w-4 h-4",style:{color:le.primary}})}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>y(f),title:"Rename","data-test":"saved-capture-rename",children:e.jsx(La,{className:"w-4 h-4",style:{color:le.muted}})}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>l(f.id),title:"Delete","data-test":"saved-capture-delete",children:e.jsx(tt,{className:"w-4 h-4",style:{color:le.danger}})})]})]})},f.id))})})})}function xl({isOpen:t,preventDefaultOnInteraction:n,onPreventDefaultChange:s,continuousMode:a,onContinuousModeChange:l,onClose:r,portalContainer:i}){return t?e.jsx(be,{isVisible:t,onClose:r,title:"Advanced Settings",initialPosition:{x:window.innerWidth/2-175,y:150},initialSize:{width:350,height:260},resizable:!0,showPinButton:!1,portalContainer:i,children:e.jsxs("div",{className:"p-4 space-y-4","data-test":"advanced-settings-body",style:{backgroundColor:de.bg},children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-prevent-default",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(he,{htmlFor:"prevent-default",className:"text-sm font-medium",style:{color:B.primary},children:"Prevent default on interaction"}),e.jsx("p",{className:"text-xs",style:{color:B.muted},children:"Prevents clicks from triggering page actions during capture mode"})]}),e.jsx(Ss,{id:"prevent-default",checked:n,onCheckedChange:s,"data-test":"prevent-default-switch"})]}),e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-continuous-mode",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(he,{htmlFor:"continuous-mode",className:"text-sm font-medium",style:{color:B.primary},children:"Continuous capture mode"}),e.jsx("p",{className:"text-xs",style:{color:B.muted},children:"Auto-advance to next empty field after capturing a selector"})]}),e.jsx(Ss,{id:"continuous-mode",checked:a,onCheckedChange:l,"data-test":"continuous-mode-switch"})]})]})}):null}const ml=/\[(\d*)(:)?(\d*)?\]$/;function Oe(t){const n=t.trim(),s=n.match(ml);if(!s)return{selector:n,indexSpec:null};const[a,l,r,i]=s,o=r===":",c=n.slice(0,-a.length);if(c==="")return{selector:n,indexSpec:null};const u=a.slice(1,-1);if(!/^(\d*):?(\d*)$/.test(u))return{selector:n,indexSpec:null};const h=c;let m;if(o)if(l&&i)m={type:"range",start:parseInt(l,10),end:parseInt(i,10)};else if(l)m={type:"from",start:parseInt(l,10)};else if(i)m={type:"to",end:parseInt(i,10)};else return{selector:n,indexSpec:null};else{if(l==="")return{selector:n,indexSpec:null};m={type:"single",index:parseInt(l,10)}}return{selector:h,indexSpec:m}}function Qe(t,n){if(!n)return t;switch(n.type){case"single":return`${t}[${n.index}]`;case"from":return`${t}[${n.start}:]`;case"to":return`${t}[:${n.end}]`;case"range":return`${t}[${n.start}:${n.end}]`}}function Us(t,n){if(!n)return t;switch(n.type){case"single":{const s=t[n.index];return s?[s]:[]}case"from":return t.slice(n.start);case"to":return t.slice(0,n.end);case"range":return t.slice(n.start,n.end)}}function Xt(t,n,s){const[a,l]=t<=n?[t,n]:[n,t];return a===0&&l===s-1?null:a===l?{type:"single",index:a}:a===0?{type:"to",end:l+1}:l===s-1?{type:"from",start:a}:{type:"range",start:a,end:l+1}}function us(t){if(!t)return"all";switch(t.type){case"single":return`[${t.index}]`;case"from":return`[${t.start}:]`;case"to":return`[:${t.end}]`;case"range":return`[${t.start}:${t.end}]`}}function Hs(t,n,s){if(!n)return!1;switch(n.type){case"single":return t===n.index;case"from":return t>=n.start&&t<s;case"to":return t>=0&&t<n.end;case"range":return t>=n.start&&t<n.end}}function Ws(t){return t?t.type!=="single":!1}function W(t){return typeof t=="object"&&t!==null&&"selector"in t&&typeof t.selector=="string"}function xt(t){let n=t,s,a;const l=n.match(/@text\[(\d+)\]$/);if(l)a=parseInt(l[1],10),n=n.slice(0,-l[0].length);else{const i=n.match(/@([a-zA-Z0-9-_]+)$/);i&&(s=i[1],n=n.slice(0,-i[0].length))}const r=Oe(n);return{selector:r.selector,index:r.indexSpec,extractAttribute:s,textNodeIndex:a}}function hs(t){let n=Qe(t.selector,t.index);return t.textNodeIndex!==void 0?n+=`@text[${t.textNodeIndex}]`:t.extractAttribute&&(n+=`@${t.extractAttribute}`),n}function Dt(t){return W(t)?t:xt(t)}function ge(t){return typeof t=="string"?t:hs(t)}function mt(t){if(typeof t=="string"){let n=t.replace(/@text\[\d+\]$/,"");const s=n.lastIndexOf("@");return s>0?n.substring(0,s):n}return Qe(t.selector,t.index)}function dt(t){return typeof t=="string"&&t.length>0?!0:typeof t=="object"&&t!==null&&"selector"in t&&"condition"in t&&typeof t.selector=="string"&&["exists","text","html"].includes(t.condition)}function Gs(t){return typeof t=="string"?{selector:t,condition:"exists"}:t}function Mt(t){if(typeof t!="object"||t===null)return!1;for(const n of Object.values(t))if(typeof n!="object"||n===null||!("match"in n)||typeof n.match!="string")return!1;return!0}function ps(t,n){var l;const s=Gs(t),a=n.querySelector(s.selector);switch(s.condition){case"exists":return a?"true":"false";case"text":return((l=a==null?void 0:a.textContent)==null?void 0:l.trim())??"";case"html":return(a==null?void 0:a.innerHTML)??""}}function xs(t,n){for(const[s,a]of Object.entries(t)){const l=a.match;let r=l;l.startsWith("/")&&l.endsWith("/")&&(r=l.slice(1,-1));try{if(new RegExp(r).test(n))return{branchKey:s,branch:a}}catch{console.warn(`[CustomCapture] Invalid regex pattern: ${l}`)}}return null}function Yt(t){return"_branchFields"in t&&Array.isArray(t._branchFields)&&"_activeBranch"in t&&typeof t._activeBranch=="number"&&"_branches"in t&&typeof t._branches=="object"&&t._branches!==null}function fl(t,n,s){var l;const a=((l=t.textContent)==null?void 0:l.trim())??"";switch(s){case"exact":return a===n;case"contains":return a.includes(n);case"regex":try{return new RegExp(n).test(a)}catch{return!1}default:return!1}}function Ke(t,n){if(!t||!t.matches(n.selector))return!1;if(n.textContent&&n.textContent.trim()!==""){const s=n.textMatchMode??"contains";return fl(t,n.textContent,s)}return!0}function gl(t,n){switch(n.type){case"previous-sibling":{const s=t.previousElementSibling;return Ke(s,n)?s:null}case"next-sibling":{const s=t.nextElementSibling;return Ke(s,n)?s:null}case"closest-sibling-before":{let s=t.previousElementSibling;for(;s;){if(Ke(s,n))return s;s=s.previousElementSibling}return null}case"closest-sibling-after":{let s=t.nextElementSibling;for(;s;){if(Ke(s,n))return s;s=s.nextElementSibling}return null}case"closest-sibling":{let s=t.previousElementSibling,a=t.nextElementSibling;for(;s||a;){if(s){if(Ke(s,n))return s;s=s.previousElementSibling}if(a){if(Ke(a,n))return a;a=a.nextElementSibling}}return null}default:return null}}function Ks(t,n){return gl(t,n)!==null}function At(t,n){return n?t.filter(s=>Ks(s,n)):t}function bl(t){const n=t.lastIndexOf("@");return n>0?t.substring(0,n):t}function Ze(t,n=document){const s=bl(t),{selector:a,indexSpec:l}=Oe(s),r=Array.from(n.querySelectorAll(a));return Us(r,l)}function Js(t,n=document){return Ze(t,n)[0]??null}const jl=Object.freeze(Object.defineProperty({__proto__:null,applyIndexSpec:Us,applySiblingFilter:At,buildIndexedSelector:Qe,createRangeIndexSpec:Xt,elementPassesSiblingFilter:Ks,evaluateIfCondition:ps,findMatchingBranch:xs,formatIndexSpec:us,getCssSelectorOnly:mt,getSelectorString:ge,hasBranchingConfig:Yt,isBranches:Mt,isIfCondition:dt,isIndexInSpec:Hs,isRangeSpec:Ws,isSelectorField:W,normalizeIfCondition:Gs,normalizeSelectorValue:Dt,parseIndexedSelector:Oe,querySelectorOneWithIndex:Js,querySelectorWithIndex:Ze,toSelectorField:xt,toSelectorString:hs},Symbol.toStringTag,{value:"Module"}));function ft(t){return t.type==="element"}function Ct(t){return t.type==="text"}function ct(t){var a;const n=((a=t.textContent)==null?void 0:a.trim())??"",s=n.length>97?n.slice(0,97)+"...":n;return{type:"element",tag:t.tagName.toLowerCase(),classes:Array.from(t.classList),id:t.id||null,textContent:s,element:t}}function yl(t,n,s){var r;const a=((r=t.textContent)==null?void 0:r.trim())??"";return{type:"text",textContent:a.length>97?a.slice(0,97)+"...":a,parentElement:n,nodeIndex:s,textNode:t}}function vl(t){var a;const n=[];let s=0;for(const l of t.childNodes)l.nodeType===Node.ELEMENT_NODE?n.push(ct(l)):l.nodeType===Node.TEXT_NODE&&((a=l.textContent)!=null&&a.trim())&&(n.push(yl(l,t,s)),s++);return n}function wt(t,n=document){var s;if(!t||t.trim()==="")return null;try{const a=mt(t),l=Oe(a),r=l.selector,i=((s=l.indexSpec)==null?void 0:s.type)==="single"?l.indexSpec.index:null,o=Array.from(n.querySelectorAll(r));if(o.length===0)return null;const c=i??0,u=o[c]??o[0],h=o.length,m=o.map(ct),y=u.parentElement;if(!y)return{parent:null,siblings:[ct(u)],capturedIndex:0,selector:t,baseSelector:r,matchIndex:c,matchCount:h,matches:m};const j=vl(y),C=j.findIndex(N=>ft(N)&&N.element===u);return{parent:ct(y),siblings:j,capturedIndex:C>=0?C:0,selector:t,baseSelector:r,matchIndex:c,matchCount:h,matches:m}}catch{return null}}function Nl(t,n){const s=t.split("."),a=s[s.length-1];if(a==="_if"||a==="_container"||a==="_item")return[];let l=n,r=null,i=null,o=!1;for(let m=0;m<s.length;m++){const y=s[m];if(typeof l!="object"||l===null)break;const j=l;if(!(y in j))break;if(l=j[y],typeof l=="object"&&l!==null){const C=l;if("_container"in C){const N=C._container,f="_item"in C?C._item:"",g=typeof N=="string"?N:(N==null?void 0:N.selector)??"",x=typeof f=="string"?f:(f==null?void 0:f.selector)??"";g&&(r=g,x?(i=x,o=!1):(i=null,o=!0))}}}if(!r)return[];const c=r.endsWith("[]")?r.slice(0,-2):r,u=Array.from(document.querySelectorAll(c));if(u.length===0)return[];const h=[];for(const m of u)if(o||!i)h.push(m);else{const y=Array.from(m.querySelectorAll(i));h.push(...y)}return h}function Cl({baseSelector:t,totalCount:n,currentIndexSpec:s,onSelectorChange:a}){const[l,r]=d.useState(!1),[i,o]=d.useState(null),c=d.useCallback(()=>{r(j=>!j),o(null)},[]),u=d.useCallback(()=>{o(null)},[]),h=d.useCallback((j,C)=>{if(C&&(s==null?void 0:s.type)==="single"){const g=Xt(s.index,j,n),x=Qe(t,g);a(x,g);return}if(l){if(i===null)o(j);else{const g=Xt(i,j,n),x=Qe(t,g);a(x,g),o(null),r(!1)}return}const N={type:"single",index:j},f=Qe(t,N);a(f,N)},[l,i,t,n,s,a]),m=d.useCallback(j=>{const C=Oe(j);a(j,C.indexSpec)},[a]),y=l&&i!==null?`[${i}:?]`:null;return{isRangeMode:l,toggleRangeMode:c,rangeStartIndex:i,handleMatchClick:h,handleTextInput:m,resetRangeSelection:u,pendingRangeDisplay:y}}function ms(t){const n=[t.tag];if(t.id&&n.push(`#${t.id}`),t.classes.length>0){const s=t.classes.slice(0,3);n.push(`.${s.join(".")}`),t.classes.length>3&&n.push(`+${t.classes.length-3}`)}return n.join("")}function wl(t){return`@text[${t.nodeIndex}]`}function kl(t){return Ct(t)?wl(t):ms(t)}function Xs(t,n=30){return t.length<=n?t:t.slice(0,n)+"..."}function Sl({domContext:t,previousChildIndex:n,onSiblingClick:s,onSiblingHover:a,onAddIndex:l,onChildClick:r,onTextNodeClick:i,onTextNodeHover:o}){const c=()=>{if(n==null)return null;const m=t.siblings[t.capturedIndex];if(!m||!ft(m))return null;const y=m.element.children;return n>=y.length?null:y[n]},u=(m,y)=>{Ct(y)?i==null||i(m,y):s(m,y)},h=m=>{m&&Ct(m)?o==null||o(m):a(m)};return e.jsxs("div",{className:"flex-1 min-h-0 overflow-auto","data-test":"dom-tree-siblings-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Siblings (",t.siblings.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.siblings.map((m,y)=>{const j=y===t.capturedIndex,C=Ct(m),N=j&&!C?c():null,f=N?ct(N):null;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsxs("button",{onClick:()=>u(y,m),onMouseEnter:()=>h(m),onMouseLeave:()=>h(null),className:`flex-1 text-left p-2 rounded text-sm font-mono transition-colors ${C?"bg-purple-50 hover:bg-purple-100 border border-purple-200":j?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100 border border-transparent"}`,"data-test":C?"dom-tree-text-node-v2":j?"dom-tree-sibling-captured-v2":"dom-tree-sibling-v2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:["[",y,"]"]}),C&&e.jsx(os,{className:"w-3.5 h-3.5 text-purple-500"}),e.jsx("span",{className:C?"text-purple-700 italic":j?"text-blue-700":"text-gray-700",children:kl(m)}),j&&!C&&e.jsx("span",{className:"text-xs text-blue-500",children:"← captured"})]}),m.textContent&&e.jsxs("div",{className:`text-xs mt-0.5 truncate ${C?"text-purple-400":"text-gray-400"}`,children:['"',Xs(m.textContent),'"']})]}),j&&l&&t.matchCount>1&&e.jsxs("button",{onClick:g=>l(g,t.matchIndex),className:"shrink-0 mt-2 px-1.5 py-0.5 text-xs bg-amber-100 text-amber-700 hover:bg-amber-200 rounded transition-colors flex items-center gap-0.5",title:`Add [${t.matchIndex}] index to selector (${t.matchCount} matches)`,"data-test":"dom-tree-add-index-v2",children:[e.jsx(ds,{className:"w-3 h-3"}),"[",t.matchIndex,"] of ",t.matchCount]})]}),j&&f&&r&&e.jsxs("div",{className:"ml-4 mt-1 pl-3 border-l-2 border-blue-300","data-test":"dom-tree-previous-child-v2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-400 mb-1",children:"Previous selection - click to go back"}),e.jsxs("button",{onClick:()=>r(n,N),onMouseEnter:()=>a(f),onMouseLeave:()=>a(null),className:"w-full text-left p-2 rounded text-sm font-mono bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-colors flex items-center gap-2","data-test":"dom-tree-previous-child-row-v2",children:[e.jsx(za,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-blue-600",children:ms(f)})]})]})]},y)})})]})}function Al({currentSelector:t,baseSelector:n,currentIndexSpec:s,isRangeMode:a,pendingRangeDisplay:l,onToggleRangeMode:r,onTextInput:i}){const[o,c]=d.useState(!1),[u,h]=d.useState(t),m=d.useRef(!0);d.useEffect(()=>{o||h(t)},[t,o]);const y=d.useCallback(()=>{c(!0),m.current=!0},[]),j=d.useCallback(()=>{c(!1),m.current&&u!==t&&i(u),m.current=!0},[u,t,i]),C=d.useCallback(f=>{h(f.target.value)},[]),N=d.useCallback(f=>{f.key==="Enter"?f.currentTarget.blur():f.key==="Escape"&&(m.current=!1,h(t),f.currentTarget.blur())},[t]);return e.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2 space-y-2","data-test":"index-range-controls",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Current index:"}),e.jsx("span",{className:"font-mono text-amber-600 font-medium",children:l??us(s)})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"selector-text-input",children:[e.jsx(Rs,{className:"w-3.5 h-3.5 text-gray-400 shrink-0"}),e.jsx("input",{type:"text",value:u,onChange:C,onFocus:y,onBlur:j,onKeyDown:N,className:"flex-1 text-xs font-mono px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-amber-400 focus:border-amber-400",placeholder:"e.g., .selector[1:3]","data-test":"selector-input"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:r,className:`flex items-center gap-1.5 px-2 py-1 text-xs rounded transition-colors ${a?"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,"data-test":"range-mode-toggle",children:[e.jsx(qa,{className:"w-3.5 h-3.5"}),a?"Range Mode ON":"Range Mode"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",title:"Hold Shift and click another match to create a range from current selection",children:[e.jsx(Ft,{className:"w-3 h-3"}),e.jsx("span",{children:"Shift+click for range"})]})]}),a&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded","data-test":"range-mode-instructions",children:l?`Click end index to complete range ${l}`:"Click start index, then click end index"})]})}function Il({matches:t,selector:n,baseSelector:s,currentIndexSpec:a,isRangeMode:l,rangeStartIndex:r,pendingRangeDisplay:i,onMatchClick:o,onMatchHover:c,onMatchIndexHover:u,onToggleRangeMode:h,onTextInput:m,onSelectorChange:y}){return t.length<=1?null:e.jsxs("div",{className:"mt-3 pt-3 border-t-2 border-dashed border-amber-300","data-test":"dom-tree-matches-v2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ds,{className:"w-3.5 h-3.5 text-amber-600"}),e.jsxs("span",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:["Switch Index (",t.length," matches)"]}),l&&e.jsx("span",{className:"text-xs bg-amber-500 text-white px-1.5 py-0.5 rounded","data-test":"range-mode-badge",children:"RANGE"}),e.jsx("div",{className:"ml-auto flex items-center text-gray-400 hover:text-gray-600 cursor-help",title:`Index Selection:
• Click: select single index [n]
• Shift+click: select range from current
• Range Mode: click start, then end

Range Syntax:
• [0] - first match only
• [1:] - all except first
• [:2] - first two matches
• [1:3] - second and third`,"data-test":"index-help-icon",children:e.jsx(Ft,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-40 overflow-y-auto",children:t.map((j,C)=>{const N=Hs(C,a,t.length),f=Ws(a),g=l&&r===C;return e.jsxs("button",{onClick:x=>o(C,j,x.shiftKey),onMouseEnter:()=>{u?u(C):c(j)},onMouseLeave:()=>{u?u(null):c(null)},className:`px-2 py-1 rounded text-xs font-mono transition-all ${g?"bg-green-500 text-white font-bold shadow-sm ring-2 ring-green-300":f&&N?"bg-purple-500 text-white font-bold shadow-sm":N?"bg-amber-500 text-white font-bold shadow-sm":"bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200"}`,"data-test":"dom-tree-match-item-v2","data-in-range":N?"true":void 0,"data-range-start":g?"true":void 0,title:g?"Range start - click another to complete":Xs(j.textContent,60),children:["[",C,"]"]},C)})}),y&&e.jsx(Al,{currentSelector:n,baseSelector:s,currentIndexSpec:a,isRangeMode:l,pendingRangeDisplay:i,onToggleRangeMode:h,onTextInput:m})]})}function _l({initialSelector:t,onApply:n,portalContainer:s}){const[a,l]=d.useState(()=>[{id:crypto.randomUUID(),value:t||"",isSelected:!0,matchCount:0,isValid:!0}]),r=d.useRef([]),i=d.useRef(null),[o,c]=d.useState(null),u=d.useCallback(()=>{r.current.forEach(p=>{p.style.outline="",p.style.outlineOffset="",p.style.background=""}),r.current=[]},[]);d.useEffect(()=>()=>{u(),i.current&&clearTimeout(i.current)},[u]);const h=d.useCallback(p=>{if(!p.trim())return{count:0,isValid:!0};if(p.startsWith(":scope"))return{count:0,isValid:!0};try{return{count:document.querySelectorAll(p).length,isValid:!0}}catch{return{count:0,isValid:!1}}},[]);d.useEffect(()=>{l(p=>p.map(v=>{if(v.value.trim()){const w=h(v.value);return{...v,matchCount:w.count,isValid:w.isValid}}return v}))},[h]);const m=d.useCallback(p=>{if(u(),!p.trim())return{count:0,isValid:!0};if(p.startsWith(":scope"))return{count:0,isValid:!0};try{const v=document.querySelectorAll(p);return v.forEach(w=>{const k=w;k.style.outline=we.outline,k.style.outlineOffset=we.outlineOffset,k.style.background=we.background,r.current.push(k)}),{count:v.length,isValid:!0}}catch{return{count:0,isValid:!1}}},[u]),y=d.useCallback((p,v)=>{l(w=>w.map(k=>k.id===p?{...k,value:v}:k)),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{const w=m(v);l(k=>k.map(A=>A.id===p?{...A,matchCount:w.count,isValid:w.isValid}:A))},150)},[m]),j=d.useCallback(p=>{const v=a.find(w=>w.id===p);if(v){const w=m(v.value);l(k=>k.map(A=>A.id===p?{...A,matchCount:w.count,isValid:w.isValid}:A))}},[a,m]),C=d.useCallback(p=>{l(v=>v.map(w=>({...w,isSelected:w.id===p})))},[]),N=d.useCallback(()=>{l(p=>[...p,{id:crypto.randomUUID(),value:"",isSelected:!1,matchCount:0,isValid:!0}])},[]),f=d.useCallback(p=>{l(v=>{var k;if(v.length<=1)return v;const w=v.filter(A=>A.id!==p);return(k=v.find(A=>A.id===p))!=null&&k.isSelected&&w.length>0&&(w[0].isSelected=!0),w})},[]),g=d.useCallback(()=>{const p=a.find(v=>v.isSelected);p!=null&&p.value.trim()&&(u(),n(p.value.trim()))},[a,n,u]),x=d.useCallback(p=>{const v=a.find(w=>w.id===p);if(v!=null&&v.value.trim()){try{const w=document.querySelector(v.value.trim());if(!w)return;const k=[];for(const A of Array.from(w.attributes))if(A.name==="class"){const O=A.value.split(/\s+/).filter(T=>T&&/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(T)).slice(0,6);k.push(O.map(T=>`.${T}`).join(""))}else A.name==="id"&&k.push(`#${A.value}`);if(k.length>0){const A=k.join("");l(O=>O.map(T=>T.id===p?{...T,value:A}:T)),setTimeout(()=>{const O=m(A);l(T=>T.map(I=>I.id===p?{...I,matchCount:O.count,isValid:O.isValid}:I))},50)}}catch{}c(null)}},[a,m]),b=a.find(p=>p.isSelected);return e.jsxs("div",{className:"p-3 h-full flex flex-col",style:{backgroundColor:de.bg},"data-test":"custom-selector-content",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:de.headerText},children:"Custom Selectors - type CSS selectors to test"}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2","data-test":"custom-selector-inputs",children:a.map(p=>e.jsxs("div",{className:"flex items-start gap-2","data-test":"custom-selector-row",children:[e.jsx("button",{onClick:()=>C(p.id),className:"mt-2 w-4 h-4 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors",style:{borderColor:p.isSelected?me.primary:me.default,backgroundColor:p.isSelected?q.primary:"transparent"},title:"Select this selector","data-test":"custom-selector-radio",children:p.isSelected&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:q.white}})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(ja,{value:p.value,onChange:v=>y(p.id,v.target.value),onFocus:()=>j(p.id),placeholder:"Enter CSS selector...",rows:1,className:"text-xs font-mono resize-none p-1",style:{borderColor:p.isValid?p.isSelected?me.primary:me.default:me.error,minHeight:"32px"},"data-test":"custom-selector-input"})}),e.jsx("div",{className:"mt-2 px-2 py-0.5 rounded text-xs shrink-0",style:{backgroundColor:p.isValid?p.matchCount>0?Ve.successBg:Ve.neutralBg:Ve.errorBg,color:p.isValid?p.matchCount>0?Ve.successText:Ve.neutralText:Ve.errorText},"data-test":"custom-selector-count",children:p.isValid?p.matchCount===1?"1 match":`${p.matchCount} matches`:"invalid"}),e.jsxs(ke,{open:o===p.id,onOpenChange:v=>c(v?p.id:null),value:"",onValueChange:v=>{switch(c(null),v){case"delete":f(p.id);break;case"list-attributes":x(p.id);break}},children:[e.jsx(Se,{className:"mt-2 h-6 w-6 px-0 border-0 shadow-none shrink-0",style:{backgroundColor:"transparent",cursor:"pointer"},"data-test":"custom-selector-menu",hideChevron:!0,children:e.jsx($s,{className:"w-3 h-3",style:{color:le.muted}})}),e.jsxs(Ae,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border,cursor:"auto",pointerEvents:"auto"},"data-test":"custom-selector-menu-options",container:s,children:[e.jsx(ae,{value:"list-attributes",style:{color:$.itemText,cursor:"pointer",pointerEvents:"auto"},disabled:!p.value.trim()||!p.isValid||p.matchCount===0,"data-test":"custom-selector-action-list",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(cs,{className:"w-3 h-3"}),"List attributes"]})}),e.jsx(ae,{value:"delete",style:{color:a.length<=1?me.default:$.dangerText,cursor:"pointer",pointerEvents:"auto"},disabled:a.length<=1,"data-test":"custom-selector-action-delete",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(tt,{className:"w-3 h-3"}),"Delete"]})})]})]})]},p.id))}),e.jsxs("button",{onClick:N,className:"mt-2 flex items-center gap-1 text-xs py-1 px-2 rounded transition-colors self-start",style:{color:le.primary},"data-test":"custom-selector-add",children:[e.jsx(ht,{className:"w-3 h-3"}),"Add selector"]}),e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:de.sectionBorder},children:e.jsxs(te,{onClick:g,disabled:!(b!=null&&b.value.trim())||!(b!=null&&b.isValid),className:"w-full",size:"sm","data-test":"custom-selector-apply",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Apply Selected"]})})]})}function El({isOpen:t,fieldPath:n,domContext:s,initialSelector:a,previousChildIndex:l,onSelectParent:r,onSelectSibling:i,onSelectChild:o,onSelectMatch:c,onAddIndex:u,onRevert:h,onClearSelector:m,onClose:y,onSelectorChange:j,onApplyCustomSelector:C,onMatchIndexHover:N,onTextNodeClick:f,portalContainer:g}){const[x,b]=d.useState("tree"),p=d.useRef(null),v=d.useRef(null),w=s!=null&&s.selector?Oe(s.selector).indexSpec:null,{isRangeMode:k,toggleRangeMode:A,rangeStartIndex:O,handleMatchClick:T,handleTextInput:I,pendingRangeDisplay:_}=Cl({baseSelector:(s==null?void 0:s.baseSelector)??"",totalCount:(s==null?void 0:s.matches.length)??0,currentIndexSpec:w,onSelectorChange:j??(()=>{})});d.useEffect(()=>{t&&b("tree")},[t]);const S=d.useCallback(()=>{var M;if(p.current&&(p.current.style.outline="",p.current.style.outlineOffset="",p.current.style.background="",p.current=null),v.current){const{element:D,originalBg:z,originalOutline:ee}=v.current;D.style.background=z,D.style.outline=ee,v.current=null}(M=window.getSelection())==null||M.removeAllRanges()},[]),P=d.useCallback(M=>{M!=null&&M.isConnected&&(S(),p.current=M,M.style.outline=we.outline,M.style.outlineOffset=we.outlineOffset,M.style.background=we.background)},[S]);d.useEffect(()=>{t||S()},[t,S]),d.useEffect(()=>{if(!t)return;const M=D=>{D.key==="Escape"&&y()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[t,y]);const F=d.useCallback(M=>{var D;(D=M==null?void 0:M.element)!=null&&D.isConnected?P(M.element):S()},[P,S]),E=d.useCallback(M=>{var D;S(),M&&ft(M)&&(D=M.element)!=null&&D.isConnected&&P(M.element)},[S,P]),R=d.useCallback(M=>{if(S(),!M)return;const D=window.getSelection();if(D){const z=document.createRange();z.selectNodeContents(M.textNode),D.removeAllRanges(),D.addRange(z)}},[S]),V=d.useCallback(M=>{N&&(s!=null&&s.baseSelector)&&N(s.baseSelector,M)},[N,s==null?void 0:s.baseSelector]),L=d.useCallback(()=>{!(s!=null&&s.parent)||!r||(S(),r(s.parent.element))},[S,r,s==null?void 0:s.parent]),H=d.useCallback((M,D)=>{S(),i(M,D.element)},[S,i]),Q=d.useCallback((M,D)=>{M.stopPropagation(),u==null||u(D)},[u]),se=d.useCallback((M,D,z)=>{S(),j?T(M,z):c==null||c(M)},[S,c,j,T]),pe=d.useCallback((M,D)=>{S(),o==null||o(M,D)},[S,o]);if(!t)return null;const re=a&&(s==null?void 0:s.selector)&&a!==s.selector,Z=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex rounded overflow-hidden border",style:{borderColor:me.default},"data-test":"dom-tree-view-toggle",children:[e.jsx("button",{onClick:()=>b("tree"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:x==="tree"?q.primary:q.white,color:x==="tree"?B.white:B.muted},title:"DOM Tree View","data-test":"dom-tree-view-tree",children:e.jsx(St,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>b("custom"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:x==="custom"?q.primary:q.white,color:x==="custom"?B.white:B.muted},title:"Custom Selector View","data-test":"dom-tree-view-custom",children:e.jsx(Ua,{className:"w-3 h-3"})})]}),x==="tree"&&re&&h&&e.jsx("button",{onClick:h,className:"p-1 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:`Revert to: ${a}`,"data-test":"dom-tree-revert-v2",children:e.jsx(Ha,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m,className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"Clear Selector","data-test":"dom-tree-clear-selector-v2",children:e.jsx(tt,{className:"w-4 h-4"})})]});return e.jsxs(be,{isVisible:t,onClose:y,title:`DOM Tree: ${n}`,shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-490,y:120},initialSize:{width:450,height:600},showPinButton:!1,headerActions:Z,portalContainer:g,children:[x==="tree"&&e.jsx("div",{className:"flex flex-col h-full p-2","data-test":"dom-tree-popover-v2",children:s?e.jsxs(e.Fragment,{children:[s.itemStats&&s.itemStats.totalItems>1&&e.jsxs("div",{className:"mb-3 p-2 rounded text-xs flex items-center gap-2",style:{backgroundColor:s.itemStats.itemsWithMatch<s.itemStats.totalItems?"#fef3c7":"#d1fae5",color:s.itemStats.itemsWithMatch<s.itemStats.totalItems?"#92400e":"#065f46"},"data-test":"dom-tree-item-stats-v2",children:[e.jsxs("span",{className:"font-medium",children:["Found in ",s.itemStats.itemsWithMatch," of ",s.itemStats.totalItems," items"]}),s.itemStats.itemsWithMatch<s.itemStats.totalItems&&e.jsxs("span",{className:"opacity-75",children:["(showing item #",s.itemStats.displayedItemIndex+1,")"]})]}),s.parent&&e.jsxs("div",{className:"mb-3","data-test":"dom-tree-parent-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Parent ",r&&"- click to select"]}),e.jsx("button",{onClick:L,onMouseEnter:()=>F(s.parent),onMouseLeave:()=>F(null),className:"w-full text-left text-sm font-mono bg-gray-100 p-2 rounded cursor-pointer hover:bg-gray-200 transition-colors","data-test":"dom-tree-parent-row-v2",children:ms(s.parent)})]}),e.jsx(Sl,{domContext:s,previousChildIndex:l,onSiblingClick:H,onSiblingHover:E,onAddIndex:u?Q:void 0,onChildClick:o?pe:void 0,onTextNodeClick:f,onTextNodeHover:R}),(c||j)&&e.jsx(Il,{matches:s.matches,selector:s.selector,baseSelector:s.baseSelector,currentIndexSpec:w,isRangeMode:k,rangeStartIndex:O,pendingRangeDisplay:_,onMatchClick:se,onMatchHover:F,onMatchIndexHover:N?V:void 0,onToggleRangeMode:A,onTextInput:I,onSelectorChange:j})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No DOM context available"})}),x==="custom"&&C&&e.jsx(_l,{initialSelector:s==null?void 0:s.selector,onApply:C,portalContainer:g})]})}function Tl({node:t,includeInnerText:n,selected:s,onNodeClick:a,onToggleHidden:l}){var u,h,m;const r=(u=t.data)==null?void 0:u.isInnerText,i=(h=t.data)==null?void 0:h.isAttribute,o=(m=t.data)==null?void 0:m.isValue;let c=!1;return r?c=n:i&&(c=s.has(t.id)),o?e.jsx("div",{className:"flex items-center py-1 px-2 ml-6",style:{color:B.muted},"data-test":"attribute-value-v2",children:e.jsxs("span",{className:"text-xs font-mono truncate",title:t.label,children:['"',t.label,'"']})}):e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100 group",style:{backgroundColor:c?ye.selectedBg:"transparent"},onClick:()=>a(t),"data-test":"attribute-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:c?ye.checkBorder:me.default,backgroundColor:c?ye.checkBg:"transparent"},children:c&&e.jsx($e,{className:"w-3 h-3 text-white"})}),t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:r?q.subtle:ye.attrBg,color:r?B.muted:ye.attrColor},children:t.label}),r&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:q.subtle,color:B.muted},children:"default"}),i&&e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:y=>l(t.id,y),title:"Hide attribute","data-test":"attribute-hide-v2",children:e.jsx(Ls,{className:"w-3 h-3",style:{color:le.muted}})})]})}function Ol({hiddenAttributes:t,onToggleHidden:n}){return t.length===0?null:e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:de.sectionBorder},"data-test":"hidden-section-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2 flex items-center gap-1",style:{color:B.placeholder},children:[e.jsx(Gt,{className:"w-3 h-3"}),"Hidden (",t.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("div",{className:"flex items-center py-1 px-2 rounded hover:bg-gray-100 group",style:{opacity:.6},"data-test":"hidden-attribute-v2",children:[e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:q.subtle,color:B.muted},children:s.name}),e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:a=>n(s.name,a),title:"Show attribute","data-test":"attribute-show-v2",children:e.jsx(Gt,{className:"w-3 h-3",style:{color:le.muted}})})]},s.name))})]})}function Fl(t,n){return n?t==="class"?n.split(/\s+/).filter(Boolean):[n]:[]}function Bl(t,n){const s=[];s.push({id:"innerText",label:"innerText",icon:e.jsx(os,{className:"w-3 h-3"}),data:{isInnerText:!0,isSelected:n}});for(const a of t){const r=Fl(a.name,a.value).map((i,o)=>({id:`${a.name}:${o}`,label:i,data:{isValue:!0,parentAttr:a.name}}));s.push({id:a.name,label:a.name,children:r.length>0?r:void 0,data:{isAttribute:!0,fullValue:a.value}})}return s}function Dl({isOpen:t,fieldPath:n,currentAttributes:s=[],attributes:a,onSelectAttributes:l,onClose:r,portalContainer:i,position:o}){const[c,u]=d.useState(new Set(s)),[h,m]=d.useState(s.length===0||s.includes("innerText")),[y,j]=d.useState(new Set),[C,N]=d.useState(!1),f=d.useRef(!1);d.useEffect(()=>{if(t&&!f.current){f.current=!0;const S=new Set(s.filter(P=>P!=="innerText"));u(S),m(s.length===0||s.includes("innerText")),j(new Set)}else t||(f.current=!1)},[t,s]);const g=d.useCallback((S,P)=>{P.stopPropagation(),j(F=>{const E=new Set(F);return E.has(S)?E.delete(S):E.add(S),E})},[]),{visibleAttributes:x,hiddenAttributes:b}=d.useMemo(()=>{const S=[],P=[];for(const F of a)y.has(F.name)?P.push(F):S.push(F);return{visibleAttributes:S,hiddenAttributes:P}},[a,y]),p=d.useMemo(()=>Bl(x,h),[x,h]),v=d.useMemo(()=>new Set(x.map(S=>S.name)),[x]),w=d.useCallback(S=>{var P,F;(P=S.data)!=null&&P.isInnerText?m(E=>!E):(F=S.data)!=null&&F.isAttribute&&u(E=>{const R=new Set(E);return R.has(S.id)?R.delete(S.id):R.add(S.id),R})},[]),k=d.useCallback(()=>{const S=[];h&&S.push("innerText"),S.push(...Array.from(c)),l(S),r()},[h,c,l,r]),A=d.useCallback(()=>{const S=new Set(x.map(P=>P.name));u(S),m(!0)},[x]),O=d.useCallback(()=>{u(new Set),m(!1)},[]),T=d.useCallback(()=>{const S=new Set(s.filter(P=>P!=="innerText"));u(S),m(s.length===0||s.includes("innerText")),j(new Set)},[s]),I=d.useCallback(S=>e.jsx(Tl,{node:S,includeInnerText:h,selected:c,onNodeClick:w,onToggleHidden:g}),[h,c,w,g]);if(!t)return null;const _=n.split(".").pop()??n;return e.jsx(be,{isVisible:t,onClose:r,title:`Configure: ${_}`,initialPosition:o??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:i,showPinButton:!1,zIndex:ut.draggablePopoverDropdown,headerActions:e.jsxs(ke,{open:C,onOpenChange:N,value:"",onValueChange:S=>{switch(N(!1),S){case"select-all":A();break;case"clear-all":O();break;case"reset":T();break}},children:[e.jsx(Se,{className:"h-6 w-6 px-0 border-0 shadow-none",style:{backgroundColor:"transparent"},"data-test":"attr-more-actions-v2",hideChevron:!0,children:e.jsx($s,{className:"w-4 h-4",style:{color:le.muted}})}),e.jsxs(Ae,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"attr-more-actions-options-v2",container:i,children:[e.jsx(ae,{value:"select-all",style:{color:$.itemText},"data-test":"attr-action-select-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Wa,{className:"w-3 h-3"}),"Select All"]})}),e.jsx(ae,{value:"clear-all",style:{color:$.itemText},"data-test":"attr-action-clear-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ga,{className:"w-3 h-3"}),"Clear All"]})}),e.jsx(ae,{value:"reset",style:{color:$.itemText},"data-test":"attr-action-reset-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"w-3 h-3"}),"Reset"]})})]})]}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:de.bg,minWidth:"280px"},"data-test":"attribute-popover-content-v2",children:[e.jsxs("div",{className:"max-h-[300px] overflow-auto",children:[a.length===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100",style:{backgroundColor:h?ye.selectedBg:"transparent"},onClick:()=>m(!h),"data-test":"attribute-option-innerText-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2",style:{borderColor:h?ye.checkBorder:me.default,backgroundColor:h?ye.checkBg:"transparent"},children:h&&e.jsx($e,{className:"w-3 h-3 text-white"})}),e.jsx(os,{className:"w-3 h-3 mr-2"}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:q.subtle,color:B.muted},children:"innerText"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:q.subtle,color:B.muted},children:"default"})]}),e.jsx("div",{className:"text-sm text-center py-4",style:{color:de.emptyText},"data-test":"no-attributes-message-v2",children:"No other attributes found"})]}):e.jsx(qs,{data:p,defaultExpandedIds:v,enableEdit:!1,enableDelete:!1,enableDrag:!1,renderNode:I,onItemClick:w}),e.jsx(Ol,{hiddenAttributes:b,onToggleHidden:g})]}),e.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:de.sectionBorder},children:e.jsxs(te,{onClick:k,className:"w-full",size:"sm","data-test":"attribute-confirm-button-v2",children:["Confirm (",h?1:0," + ",c.size," selected)"]})})]})})}function Ml({isOpen:t,fieldPath:n,childElements:s,excludedChildren:a=[],onConfirm:l,onClose:r,portalContainer:i,position:o}){const[c,u]=d.useState(new Set(a)),h=d.useRef(!1);d.useEffect(()=>{t&&!h.current?(h.current=!0,u(new Set(a))):t||(h.current=!1)},[t,a]);const m=d.useCallback(g=>{u(x=>{const b=new Set(x);return b.has(g)?b.delete(g):b.add(g),b})},[]),y=d.useCallback(()=>{l(Array.from(c)),r()},[c,l,r]),j=d.useCallback(()=>{u(new Set)},[]),C=s.length-c.size,N=c.size;if(!t)return null;const f=n.split(".").pop()??n;return e.jsx(be,{isVisible:t,onClose:r,title:`Filter Children: ${f}`,initialPosition:o??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:i,showPinButton:!1,zIndex:ut.draggablePopoverDropdown,headerActions:e.jsx("button",{onClick:j,className:"p-1 rounded hover:bg-gray-200 transition-colors",title:"Reset - Include all","data-test":"child-filter-reset-v2",children:e.jsx(zs,{className:"w-4 h-4",style:{color:le.muted}})}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:de.bg,minWidth:"280px"},"data-test":"child-filter-popover-content-v2",children:[e.jsx("div",{className:"text-xs mb-2 px-1",style:{color:de.headerText},"data-test":"child-filter-instructions-v2",children:"Uncheck children to exclude them from extraction."}),e.jsx("div",{className:"max-h-[300px] overflow-auto space-y-1",children:s.length===0?e.jsx("div",{className:"text-sm text-center py-4",style:{color:de.emptyText},"data-test":"no-children-message-v2",children:"No child elements found"}):s.map(g=>{const b=!c.has(g.id);return e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:b?Ge.includedBg:Ge.excludedBg,border:`1px solid ${b?Ge.includedBorder:Ge.excludedBorder}`},onClick:()=>m(g.id),"data-test":"child-filter-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:b?Ge.checkBg:me.default,backgroundColor:b?Ge.checkBg:"transparent"},children:b&&e.jsx($e,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:ye.attrBg,color:ye.attrColor},children:g.label})}),g.textPreview&&e.jsxs("div",{className:"text-xs mt-0.5 truncate",style:{color:B.muted},title:g.textPreview,children:['"',g.textPreview.slice(0,40),g.textPreview.length>40?"...":"",'"']})]})]},g.id)})}),e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:de.sectionBorder},children:[e.jsxs("div",{className:"text-xs mb-2 flex justify-between",style:{color:B.muted},"data-test":"child-filter-summary-v2",children:[e.jsxs("span",{className:"text-green-600",children:[C," included"]}),N>0&&e.jsxs("span",{className:"text-red-600",children:[N," excluded"]})]}),e.jsx(te,{onClick:y,className:"w-full",size:"sm","data-test":"child-filter-confirm-button-v2",children:"Confirm"})]})]})})}function Pl({availableFields:t,selectedBranchFields:n,onToggleBranchField:s}){return t.length===0?null:e.jsxs("div",{className:"space-y-2","data-test":"branch-field-selection-v2",children:[e.jsx("div",{className:"text-xs font-medium",style:{color:B.primary},children:"Select fields to branch"}),e.jsx("div",{className:"flex flex-wrap gap-x-3 gap-y-2 p-2 rounded",style:{backgroundColor:q.muted},children:t.map(a=>e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer hover:opacity-80","data-test":"branch-field-item",children:[e.jsx(ya,{checked:n.includes(a),onCheckedChange:l=>{s==null||s(a,!!l)},className:"h-3.5 w-3.5","data-test":"branch-field-checkbox"}),e.jsx("span",{className:"text-xs",style:{color:B.primary},children:a})]},a))}),e.jsx("p",{className:"text-[10px]",style:{color:B.muted},children:"Checked fields will have separate selectors per branch variant."})]})}function Rl({isIfEnabled:t,conditionSelector:n,conditionType:s,onConditionSelectorChange:a,onConditionTypeChange:l,portalContainer:r}){if(!t)return e.jsxs("div",{className:"text-xs p-3 rounded border border-dashed",style:{color:B.muted,borderColor:B.muted},"data-test":"if-disabled-hint-v2",children:["Enable the ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:q.secondary},children:"_if"})," toggle above to configure conditional branching based on element existence or content."]});const i=()=>s==="exists"?"Evaluates to 'true' if element exists, 'false' otherwise":s==="text"?"Evaluates to the element's text content":"Evaluates to the element's innerHTML";return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium",style:{color:B.primary},children:"Condition (_if)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ve,{value:n,onChange:o=>a(o.target.value),placeholder:"CSS selector to evaluate",className:"text-xs h-8","data-test":"condition-selector-input-v2"})}),e.jsxs(ke,{value:s,onValueChange:o=>l(o),children:[e.jsx(Se,{className:"w-[100px] h-8 text-xs","data-test":"condition-type-select-v2",children:e.jsx(Ot,{})}),e.jsxs(Ae,{container:r,style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},children:[e.jsx(ae,{value:"exists",style:{color:$.itemText},"data-test":"condition-type-exists-v2",children:"exists"}),e.jsx(ae,{value:"text",style:{color:$.itemText},"data-test":"condition-type-text-v2",children:"text"}),e.jsx(ae,{value:"html",style:{color:$.itemText},"data-test":"condition-type-html-v2",children:"html"})]})]})]}),e.jsx("p",{className:"text-[10px]",style:{color:B.muted},children:i()})]})}function Vl({branch:t,index:n,canRemove:s,availableFieldsForOverride:a,onMatchChange:l,onRemoveBranch:r,onAddOverride:i,onOverrideChange:o,onRemoveOverride:c,portalContainer:u}){return e.jsxs("div",{className:"border rounded p-3 space-y-2",style:{borderColor:Y.primary+"40"},"data-test":"branch-config-item",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:Y.primary,color:B.white},children:["Branch ",t.key]})}),s&&e.jsx("button",{onClick:()=>r(n),className:"p-1 rounded hover:bg-red-100 transition-colors",style:{color:"#ef4444"},"data-test":"remove-branch-button",children:e.jsx(tt,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs shrink-0",style:{color:B.muted},children:"match:"}),e.jsx(ve,{value:t.match,onChange:h=>l(n,h.target.value),placeholder:"/regex pattern/",className:"text-xs h-7 font-mono flex-1","data-test":"branch-match-input"})]}),Object.entries(t.overrides).length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px]",style:{color:B.muted},children:"Field overrides:"}),Object.entries(t.overrides).map(([h,m])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-xs shrink-0 px-1 rounded",style:{backgroundColor:q.secondary},children:[h,":"]}),e.jsx(ve,{value:m,onChange:y=>o(n,h,y.target.value),placeholder:"selector",className:"text-xs h-6 font-mono flex-1","data-test":"branch-override-input"}),e.jsx("button",{onClick:()=>c(n,h),className:"p-0.5 rounded hover:bg-red-100 transition-colors",style:{color:B.muted},children:e.jsx(st,{className:"w-3 h-3"})})]},h))]}),a.length>0&&e.jsxs(ke,{onValueChange:h=>i(n,h),children:[e.jsxs(Se,{className:"h-6 text-xs w-[150px]","data-test":"add-override-select",children:[e.jsx(ht,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"Add override"})]}),e.jsx(Ae,{container:u,style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},children:a.map(h=>e.jsx(ae,{value:h,style:{color:$.itemText},children:h},h))})]})]})}function $l({isOpen:t,fieldPath:n,existingIf:s,existingBranches:a,availableFields:l=[],selectedBranchFields:r=[],onSave:i,onRemove:o,onClose:c,onToggleIf:u,onToggleBranchField:h,portalContainer:m}){const[y,j]=d.useState(!1),[C,N]=d.useState(""),[f,g]=d.useState("exists"),[x,b]=d.useState([]);d.useEffect(()=>{if(t)if(s?(j(!0),N(s.selector),g(s.condition)):(j(!1),N(""),g("exists")),a){const F=Object.entries(a).map(([E,R])=>{const V={};for(const[L,H]of Object.entries(R))L!=="match"&&typeof H=="string"&&(V[L]=H);return{key:E,match:R.match,overrides:V}});b(F)}else b([{key:"1",match:"/true/",overrides:{}},{key:"2",match:"/./",overrides:{}}])},[t,s,a]);const p=d.useCallback(()=>{const F=String(x.length+1);b(E=>[...E,{key:F,match:"/./",overrides:{}}])},[x.length]),v=d.useCallback(F=>{b(E=>E.filter((V,L)=>L!==F).map((V,L)=>({...V,key:String(L+1)})))},[]),w=d.useCallback((F,E)=>{b(R=>R.map((V,L)=>L===F?{...V,match:E}:V))},[]),k=d.useCallback((F,E)=>{b(R=>R.map((V,L)=>L===F?{...V,overrides:{...V.overrides,[E]:""}}:V))},[]),A=d.useCallback((F,E,R)=>{b(V=>V.map((L,H)=>H===F?{...L,overrides:{...L.overrides,[E]:R}}:L))},[]),O=d.useCallback((F,E)=>{b(R=>R.map((V,L)=>{if(L!==F)return V;const{[E]:H,...Q}=V.overrides;return{...V,overrides:Q}}))},[]),T=d.useCallback(()=>{const F={};for(const E of x)F[E.key]={match:E.match||"/./",...E.overrides};if(C.trim()){const E={selector:C.trim(),condition:f};i(E,F)}else i({selector:"",condition:f},F);c()},[C,f,x,i,c]),I=F=>{const E=x[F],R=Object.keys(E.overrides);return l.filter(V=>!R.includes(V))},_=d.useCallback(()=>{const F=!y;j(F),u(F)},[y,u]);if(!t)return null;const S=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"w-4 h-4",style:{color:Y.primary}}),e.jsx("span",{children:"Conditional Branching"})]}),P=e.jsxs("button",{onClick:_,className:"flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-colors",style:{backgroundColor:y?Y.primary:q.muted,color:y?B.white:B.muted},title:y?"Hide _if condition section":"Show _if condition section","data-test":"toggle-if-enabled-v2",children:[y?e.jsx($e,{className:"w-3 h-3"}):e.jsx(st,{className:"w-3 h-3"}),e.jsx("span",{children:"_if"})]});return e.jsx(be,{isVisible:t,onClose:c,title:S,shouldCloseManually:!0,initialPosition:{x:Math.max(16,(window.innerWidth-480)/2),y:100},initialSize:{width:480,height:500},resizable:!0,showPinButton:!1,showInspectorButton:!1,portalContainer:m,zIndex:ut.draggablePopoverDropdown,headerActions:P,children:e.jsxs("div",{className:"flex flex-col h-full",style:{backgroundColor:q.white},"data-test":"branch-editor-popover-v2",children:[e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsx(Pl,{availableFields:l,selectedBranchFields:r,onToggleBranchField:h}),e.jsxs("div",{className:"text-xs",style:{color:B.muted},children:["Configuring branching for:"," ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:q.secondary},children:n})]}),e.jsx(Rl,{isIfEnabled:y,conditionSelector:C,conditionType:f,onConditionSelectorChange:N,onConditionTypeChange:g,portalContainer:m}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:B.primary},children:"Branches (_branches)"}),e.jsxs(te,{variant:"ghost",size:"sm",onClick:p,className:"h-6 text-xs","data-test":"add-branch-button-v2",children:[e.jsx(ht,{className:"w-3 h-3 mr-1"}),"Add Branch"]})]}),x.map((F,E)=>e.jsx(Vl,{branch:F,index:E,canRemove:x.length>1,availableFieldsForOverride:I(E),onMatchChange:w,onRemoveBranch:v,onAddOverride:k,onOverrideChange:A,onRemoveOverride:O,portalContainer:m},F.key)),e.jsxs("p",{className:"text-[10px]",style:{color:B.muted},children:["Branches are evaluated in order. First match wins. Use"," ",e.jsx("code",{className:"px-0.5 rounded",style:{backgroundColor:q.secondary},children:"/./"})," ","as a catch-all pattern."]})]})]}),e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-t",style:{backgroundColor:q.muted},children:[s?e.jsxs(te,{variant:"ghost",size:"sm",onClick:()=>{o(),c()},className:"text-red-500 hover:text-red-600 hover:bg-red-50","data-test":"remove-branching-button-v2",children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),"Remove Branching"]}):e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:c,"data-test":"branch-editor-cancel-v2",children:"Cancel"}),e.jsx(te,{size:"sm",onClick:T,"data-test":"branch-editor-save-v2",children:"Save"})]})]})]})})}const Ll=250;function rt({value:t,isSelector:n,truncateLength:s=Jt.expanded,onClick:a,onHover:l,onClear:r,onConfigClick:i,onFilterChildrenClick:o,onNavigateUp:c,onNavigateDown:u,canNavigateDown:h=!1,isActive:m=!1,className:y,portalContainer:j}){const[C,N]=d.useState(!1),[f,g]=d.useState(!1),x=d.useRef(null),b=d.useRef({x:0,y:0}),v=n&&t===""?zt.selectorEmpty:n?zt.selector:zt.content,w=!!a,{baseSelector:k,indexDisplay:A,attributeDisplay:O,displayValue:T}=d.useMemo(()=>{if(!n||!t){const Q=t.length>s?`${t.slice(0,s)}...`:t;return{baseSelector:t,indexDisplay:null,attributeDisplay:null,displayValue:Q}}let E=t,R=null;const V=t.lastIndexOf("@");V>0&&(E=t.substring(0,V),R=t.substring(V+1));const L=Oe(E);if(!L.indexSpec){const Q=E.length>s?`${E.slice(0,s)}...`:E;return{baseSelector:E,indexDisplay:null,attributeDisplay:R,displayValue:Q}}const H=L.selector.length>s?`${L.selector.slice(0,s)}...`:L.selector;return{baseSelector:L.selector,indexDisplay:us(L.indexSpec),attributeDisplay:R,displayValue:H}},[t,n,s]),I=()=>{N(!0),l==null||l(!0)},_=()=>{N(!1),l==null||l(!1)},S=E=>{E.stopPropagation(),r==null||r()},P=d.useCallback(()=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{x.current=null,a==null||a()},Ll)},[a]),F=d.useCallback(async()=>{x.current&&(clearTimeout(x.current),x.current=null);try{await navigator.clipboard.writeText(t),g(!0),setTimeout(()=>g(!1),1500)}catch(E){console.error("Failed to copy:",E)}},[t]);return e.jsxs("span",{className:`inline-flex items-center group/value ${y??""}`,"data-test":"field-value-v2",children:[n&&t!==""&&c&&e.jsxs("span",{className:"inline-flex items-center mr-0.5","data-test":"nav-buttons-v2",children:[e.jsx("button",{onClick:E=>{E.stopPropagation(),c()},className:"p-0.5 hover:bg-gray-200 rounded transition-colors",style:{color:le.secondary},title:"Go to parent element","data-test":"nav-up-v2",children:e.jsx(Ka,{className:"w-3 h-3"})}),e.jsx("button",{onClick:E=>{E.stopPropagation(),u==null||u()},disabled:!h,className:"p-0.5 hover:bg-gray-200 rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",style:{color:le.secondary},title:h?"Go back to child element":"Navigate up first to enable","data-test":"nav-down-v2",children:e.jsx(et,{className:"w-3 h-3"})})]}),e.jsxs("span",{className:`inline-flex items-center min-w-0 ${m?"animate-pulse":""}`,style:{backgroundColor:C?v.bgHover:v.bg,border:`1px solid ${m?"#3b82f6":v.border}`,borderRadius:"4px",padding:"1px 6px",boxShadow:m?"0 0 0 2px rgba(59, 130, 246, 0.4)":void 0},"data-test-active":m?"true":void 0,children:[e.jsx("span",{onClick:P,onDoubleClick:F,onMouseEnter:I,onMouseLeave:_,style:{color:v.text,cursor:w?"pointer":"default"},title:t.length>s?t:"Double-click to copy","data-test":"field-value-text",children:f?e.jsx("span",{className:"text-green-600 font-medium",children:"Copied!"}):`"${T}"`}),A&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-amber-100 text-amber-700 border border-amber-300",title:`Index filter: ${A}`,"data-test":"field-value-index",children:A}),r&&n&&t!==""&&e.jsx("button",{onClick:S,className:"ml-1 opacity-0 group-hover/value:opacity-100 hover:text-red-600 transition-opacity",style:{color:v.text},title:"Clear selector","data-test":"clear-selector-v2",children:e.jsx(st,{className:"w-3 h-3"})})]}),O&&e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-orange-100 text-orange-700 border border-orange-300",title:`Extract attribute: ${O}`,"data-test":"field-value-attribute",children:["@",O]}),(i||o)&&n&&t!==""&&e.jsxs(ke,{value:"",onValueChange:E=>{E==="configure"?i==null||i(b.current):E==="filter-children"&&(o==null||o(b.current))},children:[e.jsx(Se,{className:"shrink-0 ml-1 p-1 h-auto w-auto border-0 shadow-none rounded",style:{backgroundColor:q.muted},hideChevron:!0,"data-test":"config-button-v2",children:e.jsx(Wt,{className:"w-3 h-3",style:{color:le.secondary}})}),e.jsxs(Ae,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"config-menu-v2",container:j,children:[i&&e.jsx(ae,{value:"configure",style:{color:$.itemText},"data-test":"config-extraction-v2",onPointerDown:E=>{b.current={x:E.clientX,y:E.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"w-3 h-3"}),"Configure extraction"]})}),o&&e.jsx(ae,{value:"filter-children",style:{color:$.itemText},"data-test":"config-filter-children-v2",onPointerDown:E=>{b.current={x:E.clientX,y:E.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"w-3 h-3"}),"Filter out children"]})})]})]})]})}const _s=[{value:"previous-sibling",label:"Previous Sibling",description:"Immediate previous element"},{value:"next-sibling",label:"Next Sibling",description:"Immediate next element"},{value:"closest-sibling",label:"Closest Sibling",description:"Nearest matching sibling (any direction)"},{value:"closest-sibling-before",label:"Closest Before",description:"Nearest matching sibling before"},{value:"closest-sibling-after",label:"Closest After",description:"Nearest matching sibling after"}],zl=[{value:"exact",label:"Exact Match"},{value:"contains",label:"Contains"},{value:"regex",label:"Regex"}],Ys=d.forwardRef(function({onApply:n,onCancel:s,currentFilter:a,onStartSelectorCapture:l,isCapturing:r=!1,capturedSelector:i,onNavigateUp:o,onNavigateDown:c,canNavigateDown:u=!1,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y,portalContainer:j},C){var I;const[N,f]=d.useState((a==null?void 0:a.type)??"previous-sibling"),[g,x]=d.useState((a==null?void 0:a.selector)??""),[b,p]=d.useState((a==null?void 0:a.textContent)??""),[v,w]=d.useState((a==null?void 0:a.textMatchMode)??"contains"),[k,A]=d.useState(!!(a!=null&&a.textContent&&a.textContent.trim()!==""));d.useEffect(()=>{i!==void 0&&i!==""&&x(i)},[i]);const O=d.useCallback(()=>{const _={type:N,selector:g,...k&&b.trim()!==""&&{textContent:b,textMatchMode:v}};n(_)},[N,g,b,v,k,n]),T=g.trim()!=="";return d.useImperativeHandle(C,()=>({apply:O,isValid:T}),[O,T]),e.jsxs("div",{className:"p-4 space-y-4","data-test":"sibling-filter-form",children:[e.jsxs("div",{className:"space-y-2","data-test":"filter-type-section",children:[e.jsx(he,{htmlFor:"filter-type","data-test":"filter-type-label",children:"Filter Type"}),e.jsxs(ke,{value:N,onValueChange:_=>f(_),children:[e.jsx(Se,{id:"filter-type","data-test":"filter-type-select",children:e.jsx(Ot,{placeholder:"Select filter type"})}),e.jsx(Ae,{children:_s.map(_=>e.jsx(ae,{value:_.value,"data-test":"filter-type-option",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:_.label})})},_.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground","data-test":"filter-type-description",children:(I=_s.find(_=>_.value===N))==null?void 0:I.description})]}),e.jsxs("div",{className:"space-y-2","data-test":"selector-input-section",children:[e.jsx(he,{"data-test":"selector-input-label",children:"CSS Selector"}),e.jsx("div",{className:"flex items-center","data-test":"selector-input",children:e.jsx(rt,{value:g,isSelector:!0,onClick:l,onClear:y,onNavigateUp:o,onNavigateDown:c,canNavigateDown:u,onConfigClick:h,onFilterChildrenClick:m,isActive:r,portalContainer:j})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"Click any element on the page to capture its selector":"Click the field above to select an element from the page"})]}),e.jsxs("div",{className:"space-y-2","data-test":"text-filter-section",children:[e.jsxs("button",{type:"button",onClick:()=>A(!k),className:"flex items-center gap-1 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors","data-test":"text-filter-toggle",children:[k?e.jsx(et,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"}),"Text Content Filter (Optional)"]}),k&&e.jsxs("div",{className:"pl-5 space-y-3 border-l-2 border-border","data-test":"text-filter-content",children:[e.jsxs("div",{className:"space-y-1.5","data-test":"text-content-section",children:[e.jsx(he,{htmlFor:"text-input",className:"text-xs","data-test":"text-input-label",children:"Match Text"}),e.jsx(ve,{id:"text-input",value:b,onChange:_=>p(_.target.value),placeholder:"e.g., Username, Submit",className:"h-8 text-sm","data-test":"text-content-input"})]}),e.jsxs("div",{className:"space-y-1.5","data-test":"text-match-mode-section",children:[e.jsx(he,{className:"text-xs","data-test":"text-match-mode-label",children:"Match Mode"}),e.jsx(va,{value:v,onValueChange:_=>w(_),className:"flex gap-3","data-test":"text-match-mode-radio-group",children:zl.map(_=>e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(Na,{value:_.value,id:`text-mode-${_.value}`,className:"w-3.5 h-3.5","data-test":"text-match-mode-option"}),e.jsx(he,{htmlFor:`text-mode-${_.value}`,className:"text-xs cursor-pointer",children:_.label})]},_.value))})]})]})]})]})});function ql({state:t,onApply:n,onClose:s,portalContainer:a,onStartSelectorCapture:l,isCapturing:r=!1,capturedSelector:i,onNavigateUp:o,onNavigateDown:c,canNavigateDown:u=!1,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y}){const j=d.useRef(null),[C,N]=d.useState(!1);d.useEffect(()=>{const b=()=>{var v;N(((v=j.current)==null?void 0:v.isValid)??!1)};b();const p=setInterval(b,100);return()=>clearInterval(p)},[t.isOpen]);const f=b=>{n(t.fieldPath,b)},g=()=>{var b;(b=j.current)==null||b.apply()},x=e.jsxs("div",{className:"flex justify-end gap-2 px-3 py-2","data-test":"action-buttons",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:s,"data-test":"cancel-button",children:"Cancel"}),e.jsx(te,{size:"sm",onClick:g,disabled:!C,"data-test":"apply-button",children:"Apply"})]});return e.jsx(be,{isVisible:t.isOpen,onClose:s,title:`Filter: ${t.fieldPath}`,initialPosition:t.position,initialSize:{width:380,height:420},resizable:!0,shouldCloseManually:!0,portalContainer:a,footer:x,children:e.jsx(Ys,{ref:j,onApply:f,onCancel:s,currentFilter:t.currentFilter,onStartSelectorCapture:l,isCapturing:r,capturedSelector:i,onNavigateUp:o,onNavigateDown:c,canNavigateDown:u,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y,portalContainer:a})})}function Ul({portalContainer:t,isFieldDialogOpen:n,editingField:s,onFieldDialogSubmit:a,onFieldDialogCancel:l,contentPopover:r,onCloseContentPopover:i,onContentPopoverItemHover:o,onContentPopoverItemClick:c,importDialogOpen:u,onImportSchema:h,onCloseImportDialog:m,managerPopoverOpen:y,savedCaptures:j,onLoad:C,onRenameCapture:N,onDeleteCapture:f,onCloseManagerPopover:g,advancedSettingsOpen:x,preventDefaultOnInteraction:b,continuousMode:p,onPreventDefaultChange:v,onContinuousModeChange:w,onCloseAdvancedSettings:k,isDomTreePopoverOpen:A,domTreeFieldPath:O,domContext:T,domTreeInitialSelector:I,domTreePreviousChildIndex:_,onDomTreeParentSelect:S,onDomTreeSiblingSelect:P,onDomTreeChildSelect:F,onAddIndex:E,onRevertSelector:R,onClearSelector:V,onCloseDomTreePopover:L,onSelectorChange:H,onApplyCustomSelector:Q,attributePopover:se,onAttributeSelect:pe,onAttributePopoverClose:re,childFilterPopover:Z,onChildFilterConfirm:M,onChildFilterPopoverClose:D,branchEditorState:z,onSaveBranching:ee,onRemoveBranching:ne,onCloseBranchEditor:J,onToggleIf:Ne,onPopoverToggleBranchField:_e,onDomTreeMatchIndexHover:ue,onTextNodeClick:Ce,siblingFilterPopover:Fe,onSiblingFilterApply:Ee,onSiblingFilterClose:nt,onSiblingFilterStartCapture:Le,isSiblingFilterCapturing:ze=!1,siblingFilterCapturedSelector:qe,onSiblingFilterNavigateUp:Be,onSiblingFilterNavigateDown:Ue,siblingFilterCanNavigateDown:He=!1,onSiblingFilterConfigClick:We,onSiblingFilterFilterChildrenClick:ce,onSiblingFilterClearSelector:De}){return e.jsxs(e.Fragment,{children:[e.jsx(ol,{isOpen:n,suggestedName:"",editingField:s,onSubmit:a,onCancel:l,portalContainer:t,"data-test":"field-dialog"}),e.jsx(dl,{isOpen:r!==null,fieldName:(r==null?void 0:r.fieldName)??"",values:(r==null?void 0:r.values)??[],onClose:i,onItemHover:o,onItemClick:c,portalContainer:t,"data-test":"content-popover"}),e.jsx(hl,{isOpen:u,onImport:h,onClose:m,portalContainer:t,"data-test":"import-dialog"}),e.jsx(pl,{isOpen:y,savedCaptures:j,onLoad:C,onRename:N,onDelete:f,onClose:g,portalContainer:t,"data-test":"manager-popover"}),e.jsx(xl,{isOpen:x,preventDefaultOnInteraction:b,onPreventDefaultChange:v,continuousMode:p,onContinuousModeChange:w,onClose:k,portalContainer:t,"data-test":"advanced-settings"}),e.jsx(El,{isOpen:A,fieldPath:O??"",domContext:T,initialSelector:I,previousChildIndex:_,onSelectParent:S,onSelectSibling:P,onSelectChild:F,onSelectMatch:E,onAddIndex:E,onRevert:R,onClearSelector:V,onClose:L,onSelectorChange:H,onApplyCustomSelector:Q,onMatchIndexHover:ue,onTextNodeClick:Ce,portalContainer:t,"data-test":"dom-tree-popover"}),e.jsx(Dl,{isOpen:se.isOpen,fieldPath:se.fieldPath,attributes:se.attributes,currentAttributes:se.currentAttributes,onSelectAttributes:Me=>pe(se.fieldPath,Me),onClose:re,portalContainer:t,position:se.position,"data-test":"attribute-popover"}),e.jsx(Ml,{isOpen:Z.isOpen,fieldPath:Z.fieldPath,childElements:Z.children,excludedChildren:Z.excludedChildren,onConfirm:Me=>M(Z.fieldPath,Me,Z.children),onClose:D,portalContainer:t,position:Z.position,"data-test":"child-filter-popover"}),e.jsx($l,{isOpen:z.isOpen,fieldPath:z.fieldPath,existingIf:z.existingIf,existingBranches:z.existingBranches,availableFields:z.availableFields,selectedBranchFields:z.selectedBranchFields,onSave:ee,onRemove:ne,onClose:J,onToggleIf:Ne,onToggleBranchField:_e,portalContainer:t,"data-test":"branch-editor"}),e.jsx(ql,{state:Fe,onApply:Ee,onClose:nt,portalContainer:t,onStartSelectorCapture:Le,isCapturing:ze,capturedSelector:qe,onNavigateUp:Be,onNavigateDown:Ue,canNavigateDown:He,onConfigClick:We,onFilterChildrenClick:ce,onClearSelector:De})]})}function Hl(t){switch(t){case"string":return"T";case"number":return"#";case"boolean":return"?";case"array":return"[]";case"parentSelector":return"{1}";case"object":return"{}";default:return"·"}}function Wl({fields:t,selectedFieldId:n,mode:s,onFieldSelect:a,onFieldUpdate:l,onFieldEdit:r,onFieldDelete:i,onReorder:o,onAddChild:c,onAddSiblingBefore:u,onAddSiblingAfter:h}){const m=d.useMemo(()=>{const f=g=>t.filter(x=>x.parentId===g).sort((x,b)=>x.order-b.order).map(x=>({id:x.id,label:x.name,children:f(x.id),data:x}));return f(null)},[t]),y=d.useMemo(()=>new Set(t.map(f=>f.id)),[t]),j=d.useCallback(f=>{s==="mapped"&&a(f.id)},[s,a]),C=d.useCallback((f,g,x,b)=>{var k;const p=f.data,v=(p==null?void 0:p.mapping)!=null,w=s==="mapped"&&f.id===n;return e.jsxs("div",{className:`flex items-center gap-2 w-full group ${w?"bg-primary/10 -mx-2 px-2 rounded":""}`,"data-test":"schema-field-v2",children:[e.jsx("span",{className:"flex-shrink-0","data-test":"field-status-icon-v2",children:v?e.jsx(Ja,{className:"w-3 h-3 text-green-500"}):e.jsx(Xa,{className:"w-3 h-3 text-muted-foreground"})}),e.jsx("span",{className:"flex-shrink-0 text-xs text-muted-foreground font-mono w-4",title:p==null?void 0:p.type,"data-test":"field-type-indicator-v2",children:Hl(p==null?void 0:p.type)}),e.jsx("span",{className:"flex-1 truncate",children:b}),((k=p==null?void 0:p.mapping)==null?void 0:k.sampleValue)&&e.jsxs("span",{className:"text-xs text-muted-foreground truncate max-w-[100px]",title:p.mapping.sampleValue,"data-test":"field-sample-value-v2",children:['"',p.mapping.sampleValue.slice(0,20),p.mapping.sampleValue.length>20?"...":"",'"']}),p&&e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(Ca,{onClick:()=>c(p.id),label:"",icon:ht,variant:"ghost",size:"sm",compact:!0,options:[{label:"Add sibling before",onClick:()=>u(p.id)},{label:"Add sibling after",onClick:()=>h(p.id)}],contentStyle:{zIndex:ut.draggablePopoverDropdown},"data-test":"add-field-v2"})})]})},[s,n,c,u,h]),N=d.useCallback(f=>{const g=f.data;return g?[{id:"edit",icon:e.jsx(Ya,{className:"h-3 w-3"}),title:"Edit field",onClick:()=>r(g.id,g.name,g.type)}]:null},[r]);return t.length===0?e.jsxs("div",{className:"p-4 text-sm text-muted-foreground text-center","data-test":"empty-schema-message-v2",children:[e.jsx("p",{className:"mb-2",children:"No fields defined yet."}),e.jsx("p",{className:"text-xs",children:"Use + to add fields, then click elements to map."})]}):e.jsx("div",{className:"p-2","data-test":"schema-tree-container-v2",children:e.jsx(qs,{data:m,onUpdate:l,onDelete:i,onReorder:o,onItemClick:j,defaultExpandedIds:y,enableEdit:!1,enableDelete:!0,enableDrag:!0,renderNode:C,quickActions:N})})}function Gl(t){if(t.length===0)return"";const n=r=>{switch(r){case"array":return"[]";case"object":return"{}";case"parentSelector":return"{1}";case"number":return"#";case"boolean":return"?";default:return""}},s=[],a=(r,i)=>{const o="  ".repeat(i),c=n(r.type);s.push(`${o}${r.name}${c}`);const u=t.filter(h=>h.parentId===r.id).sort((h,m)=>h.order-m.order);for(const h of u)a(h,i+1)},l=t.filter(r=>r.parentId===null).sort((r,i)=>r.order-i.order);for(const r of l)a(r,0);return s.join(`
`)}function Es(t){var a;const n=t.split(`
`),s=[];for(const l of n){if(l.trim()==="")continue;const r=((a=l.match(/^(\s*)/))==null?void 0:a[1])||"",i=(r.match(/\t/g)||[]).length,o=r.replace(/\t/g,"").length,c=i+Math.floor(o/2);let u=l.trim();if(!u)continue;let h="string";u.endsWith("[]")?(h="array",u=u.slice(0,-2)):u.endsWith("{}")?(h="object",u=u.slice(0,-2)):u.endsWith("{1}")?(h="parentSelector",u=u.slice(0,-3)):u.endsWith("#")?(h="number",u=u.slice(0,-1)):u.endsWith("?")&&(h="boolean",u=u.slice(0,-1)),s.push({name:u,depth:c,type:h})}return s}function Kl(t){const n=[],s=[];for(let a=0;a<t.length;a++){const l=t[a];for(;s.length>0&&s[s.length-1].depth>=l.depth;)s.pop();const r=s.length>0?s[s.length-1].id:null,i=`field-${Date.now()}-${a}`;n.push({id:i,name:l.name,type:l.type,order:a,parentId:r,mapping:null}),s.push({depth:l.depth,id:i})}return n}const Jl=`products[]
  name
  price#
author
  firstName
  lastName`,Xl=[{id:"array",label:"Array",icon:"[]",value:"[]"},{id:"parentSelector",label:"Parent Selector",icon:"{1}",value:"{1}"},{id:"object",label:"Object",icon:"{}",value:"{}"},{id:"number",label:"Number",icon:"#",value:"#"},{id:"boolean",label:"Boolean",icon:"?",value:"?"}];function Yl({fields:t,onApply:n,onCancel:s}){const[a,l]=d.useState(()=>Gl(t)),r=d.useCallback(()=>{const c=Es(a),u=Kl(c);n(u)},[a,n]),i=a.trim()?Es(a).length:0,o={triggerChar:"/",items:Xl,header:"Field Type",emptyMessage:"No matching types",zIndex:ut.draggablePopoverDropdown};return e.jsxs("div",{className:"flex flex-col h-full p-2","data-test":"list-mode-panel-v2",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx(wa,{value:a,onChange:c=>l(c.target.value),placeholder:Jl,className:"w-full h-full resize-none font-mono text-sm p-2 border rounded",style:{backgroundColor:Xe.bg,color:Xe.text},triggerPopover:o,showBuiltInPopover:!1,"data-test":"list-mode-textarea-v2"}),e.jsx("div",{className:"absolute top-1 right-1","data-test":"list-mode-info-v2",children:e.jsx(ka,{children:e.jsxs(Sa,{children:[e.jsx(Aa,{asChild:!0,children:e.jsx("button",{type:"button",className:"p-1 rounded hover:bg-gray-200 transition-colors",style:{color:B.muted},"data-test":"list-mode-info-button-v2",children:e.jsx(Ft,{className:"w-3.5 h-3.5"})})}),e.jsx(Ia,{side:"left",className:"max-w-xs","data-test":"list-mode-info-tooltip-v2",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("p",{className:"font-medium",children:'Type "/" to select field type:'}),e.jsxs("div",{className:"font-mono text-[10px] space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"[]"})," = array"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{1}"})," = parent selector"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{}"})," = object"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"#"})," = number"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"?"})," = boolean"]})]}),e.jsx("p",{className:"text-gray-500 pt-1",children:"Indentation = nesting"})]})})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t","data-test":"list-mode-actions-v2",children:[e.jsxs("span",{className:"text-xs",style:{color:B.muted},"data-test":"field-count-v2",children:[i," field",i!==1?"s":""," detected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:"ghost",size:"sm",onClick:s,className:"h-7","data-test":"list-mode-cancel-v2",children:[e.jsx(st,{className:"w-3 h-3 mr-1"}),"Cancel"]}),e.jsxs(te,{size:"sm",onClick:r,disabled:i===0,className:"h-7","data-test":"list-mode-apply-v2",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Apply"]})]})]})]})}function Ql({activeBranch:t,branchCount:n,parentPath:s,onBranchSwitch:a,onBranchChange:l,onAddBranch:r,className:i}){const o=Array.from({length:n},(c,u)=>u+1);return e.jsxs("div",{className:Te("flex items-center gap-0.5",i),"data-test":"inline-branch-tabs-v2",children:[o.map(c=>e.jsxs("button",{onClick:u=>{u.stopPropagation(),a&&s!==void 0?a(s,c):l&&l(c)},className:Te("px-1 py-px text-[9px] rounded font-mono transition-colors",t===c?"text-white":"bg-muted hover:bg-muted/80 text-muted-foreground"),style:t===c?{backgroundColor:Y.primary}:void 0,"data-test":"branch-tab",children:["[",c,"]"]},c)),e.jsx("button",{onClick:c=>{c.stopPropagation(),r&&s!==void 0&&r(s)},className:"px-1 py-px text-[9px] rounded font-mono bg-muted hover:bg-muted/80 text-muted-foreground transition-colors","data-test":"branch-add-tab-v2",title:"Add new branch",children:"[+]"})]})}function Zl({node:t,indent:n,isSelector:s,hasChildren:a,hasBranching:l,branchCount:r,branchDetailsExpanded:i,onEditBranching:o,onToggleBranchDetails:c,onToggleIfDirect:u,onToggleBranchField:h,availableBranchFields:m}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:t.isArrayItem?ie.arrayIndex:t.name.startsWith("_")?ie.fieldNameUnderscore:ie.fieldName,cursor:l&&o?"pointer":void 0},onDoubleClick:()=>{var f,g;const y=((f=t.branchingMetadata)==null?void 0:f.isBranchParent)??l,j=((g=t.branchingMetadata)==null?void 0:g.isBranchField)??!1;if((y||a)&&s&&u&&t.name!=="_if"){u(t.path);return}if((j||((m==null?void 0:m.includes(t.name))??!1)||s&&!a)&&h&&t.name!=="_if"){const x=t.path.split("."),b=x.pop(),p=x.join(".");h(p,b,!j)}},"data-test":"field-name",children:[n,t.isArrayItem?t.name:`"${t.name}"`]}),t.name==="_if"&&t.conditionalBranching&&o&&e.jsx("button",{onClick:()=>{var j;const y=t.path.replace(/\._if$/,"");o(y,((j=t.conditionalBranching)==null?void 0:j.ifCondition)??null,null)},className:"ml-1 px-1 py-0.5 rounded text-[10px] hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:Y.primary+"20",color:Y.primary},title:"Click to edit condition type","data-test":"if-condition-type-badge-v2",children:t.conditionalBranching.ifCondition.condition}),t.name==="_if"&&t.conditionalBranching&&!o&&e.jsx("span",{className:"ml-1 px-1 py-0.5 rounded text-[10px]",style:{backgroundColor:Y.primary+"20",color:Y.primary},title:`Condition type: ${t.conditionalBranching.ifCondition.condition}`,"data-test":"if-condition-type-badge-v2",children:t.conditionalBranching.ifCondition.condition}),l&&t.name!=="_if"&&e.jsxs("button",{onClick:()=>{var y,j;o?o(t.path,((y=t.conditionalBranching)==null?void 0:y.ifCondition)??null,((j=t.conditionalBranching)==null?void 0:j.branches)??null):c()},className:Te("inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors",i?"ring-1 ring-offset-1":"hover:opacity-80"),style:{backgroundColor:Y.primary+"20",color:Y.primary,boxShadow:i?`0 0 0 2px ${Y.primary}`:void 0},title:o?"Click to edit branching":"Click to view branch details","data-test":"branch-indicator-v2",children:[e.jsx(St,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:r}),e.jsx(Ft,{className:"w-2 h-2 opacity-60"})]}),s&&a&&!l&&o&&e.jsxs("button",{onClick:()=>o(t.path,null,null),className:"inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors opacity-0 group-hover:opacity-100 hover:opacity-100",style:{backgroundColor:q.secondary,color:B.muted},title:"Add conditional branching","data-test":"add-condition-button-v2",children:[e.jsx(ht,{className:"w-2.5 h-2.5"}),e.jsx(St,{className:"w-2.5 h-2.5"})]})]})}function qt({fieldPath:t,selector:n,onClick:s,onDoubleClick:a}){const l=r=>{const i=r.currentTarget.getBoundingClientRect();s==null||s(t,n,{x:i.right+8,y:i.top})};return e.jsx("button",{onClick:l,onDoubleClick:()=>a==null?void 0:a(t),className:"p-1 rounded mr-1 hover:opacity-80 transition-opacity",style:{backgroundColor:q.success},title:"Click: add sibling filter | Double-click: auto-add classes","data-test":"selector-filter-v2",children:e.jsx(Bt,{className:"w-3 h-3",style:{color:le.success}})})}function er({node:t,isSelector:n,truncateLength:s,activeFieldPath:a,portalContainer:l,onFieldValueClick:r,onFieldValueHover:i,onClearSelector:o,onConfigClick:c,onFilterChildrenClick:u,onNavigateUp:h,onNavigateDown:m,canNavigateDown:y,onSelectorFilterClick:j,onSelectorFilterDoubleClick:C,onArrayBadgeClick:N,onSchemaCountClick:f}){const g=()=>{if(n&&r){const p=W(t.value)?ge(t.value):typeof t.value=="string"?t.value:null;(p!==null||t.name==="_if")&&r(t.path,p??"")}},x=t.value;if(x==null)return t.name==="_if"&&n?e.jsxs("span",{className:"inline-flex items-center","data-test":"if-field-value",children:[e.jsx(qt,{fieldPath:t.path,selector:"",onClick:j,onDoubleClick:C}),e.jsx(rt,{value:"",isSelector:!0,truncateLength:s,onClick:g,onHover:i,onClear:o,isActive:t.path===a,portalContainer:l})]}):e.jsx("span",{style:{color:ie.nullValue},children:"null"});if(W(x)){const p=ge(x);return e.jsxs("span",{className:"inline-flex items-center","data-test":"selector-field-value",children:[n&&e.jsx(qt,{fieldPath:t.path,selector:p,onClick:j,onDoubleClick:C}),e.jsx(rt,{value:p,isSelector:n,truncateLength:s,onClick:n?g:void 0,onHover:i,onClear:n?o:void 0,onConfigClick:n?c:void 0,onFilterChildrenClick:n?u:void 0,onNavigateUp:n?h:void 0,onNavigateDown:n?m:void 0,canNavigateDown:n?y:!1,isActive:n&&t.path===a,portalContainer:l})]})}if(typeof x=="string"){const p=!n&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"string-field-value",children:[n&&e.jsx(qt,{fieldPath:t.path,selector:x,onClick:j,onDoubleClick:C}),e.jsx(rt,{value:x,isSelector:n,truncateLength:s,onClick:n?g:void 0,onHover:i,onClear:n?o:void 0,onConfigClick:n?c:void 0,onFilterChildrenClick:n?u:void 0,onNavigateUp:n?h:void 0,onNavigateDown:n?m:void 0,canNavigateDown:n?y:!1,isActive:n&&t.path===a,portalContainer:l}),p&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}if(typeof x=="object"&&!Array.isArray(x)&&Object.keys(x).length===0)return e.jsx("span",{style:{color:ie.genericValue},children:"{}"});if(Array.isArray(x)){if(!n&&x.length>0){const p=typeof x[0]=="string"?x[0]:String(x[0]),v=x.length-1,w=p.length>s?`${p.slice(0,s)}...`:p;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"array-field-value",children:[e.jsx(rt,{value:w,isSelector:!1,truncateLength:s}),v>0&&e.jsxs("button",{onClick:()=>N==null?void 0:N(t.path,x),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:q.primary,color:B.white},"data-test":"content-array-badge-v2",children:["+",v]})]})}return e.jsxs("span",{style:{color:ie.genericValue},children:["[",x.length," items]"]})}const b=!n&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"primitive-field-value",children:[e.jsx("span",{style:{color:ie.genericValue},children:String(x)}),b&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}function tr({ifCondition:t,branches:n}){return e.jsxs("div",{className:"ml-4 mt-1 mb-1 p-2 rounded text-[10px] border",style:{backgroundColor:q.muted,borderColor:Y.primary+"40"},"data-test":"branch-details-v2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1.5","data-test":"branch-condition",children:[e.jsx("span",{style:{color:B.muted},children:"if"}),e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:q.secondary,color:B.primary},"data-test":"condition-selector",children:t.selector}),e.jsx("span",{className:"px-1 rounded",style:{backgroundColor:Y.primary+"20",color:Y.primary},"data-test":"condition-type",children:t.condition})]}),Object.entries(n).map(([s,a])=>{const l=Object.keys(a).filter(r=>r!=="match");return e.jsxs("div",{className:"flex items-start gap-1 py-0.5 border-t",style:{borderColor:Y.primary+"20"},"data-test":"branch-item",children:[e.jsx("span",{className:"px-1 rounded shrink-0",style:{backgroundColor:Y.primary,color:B.white},"data-test":"branch-key",children:s}),e.jsx("span",{style:{color:B.muted},children:"match:"}),e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:q.secondary,color:B.primary},"data-test":"branch-match",children:a.match}),l.length>0&&e.jsxs("span",{style:{color:B.muted},"data-test":"branch-overrides",children:["(+",l.length," override",l.length>1?"s":"",")"]})]},s)})]})}function Qs({node:t,level:n,isLast:s,isSelector:a,valuesCollapsed:l,onFieldValueClick:r,onFieldValueHover:i,onClearSelector:o,onSelectorFilterClick:c,onSelectorFilterDoubleClick:u,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:j,onNavigateUp:C,onNavigateDown:N,canNavigateDown:f,onEditBranching:g,truncateLength:x,activeFieldPath:b,portalContainer:p,isBranchField:v,activeBranch:w,branchCount:k,availableBranchFields:A,branchFields:O,onBranchSwitch:T,onToggleBranchField:I,onToggleIfDirect:_,onAddBranch:S}){var Le,ze,qe,Be,Ue,He,We;const P=v??((Le=t.branchingMetadata)==null?void 0:Le.isBranchField)??!1,F=w??((ze=t.branchingMetadata)==null?void 0:ze.activeBranch),E=k??((qe=t.branchingMetadata)==null?void 0:qe.branchCount)??0,R=A??((Be=t.branchingMetadata)==null?void 0:Be.availableBranchFields)??[],V=O??((Ue=t.branchingMetadata)==null?void 0:Ue.branchFields)??[],L=((He=t.branchingMetadata)==null?void 0:He.isBranchParent)??!1,[H,Q]=d.useState(!0),[se,pe]=d.useState(!1),re=!!(t.children&&t.children.length>0),Z="  ".repeat(n),M=Array.isArray(t.value)&&re,D=M?"[":"{",z=M?"]":"}",ee=!!t.conditionalBranching,ne=ee?Object.keys(t.conditionalBranching.branches).length:0,J=ce=>{if(i)if(a){const De=typeof t.value=="object"&&t.value!==null&&"selector"in t.value?ge(t.value):typeof t.value=="string"?t.value:null;i(ce?De:null,ce?t.path:null)}else i(null,ce?t.path:null)},Ne=()=>{o==null||o(t.path)},_e=ce=>{h==null||h(t.path,ce)},ue=ce=>{m==null||m(t.path,ce)},Ce=()=>{C==null||C(t.path)},Fe=()=>{N==null||N(t.path)},Ee=((We=t.children)==null?void 0:We.length)??0,nt=M?`${Ee} item${Ee!==1?"s":""}`:`${Ee} field${Ee!==1?"s":""}`;return e.jsxs("div",{"data-test":"field-node-v2",children:[e.jsxs("div",{className:"flex items-center group","data-test":"field-node-line",children:[e.jsx(Zl,{node:t,indent:Z,isSelector:a,hasChildren:re,hasBranching:ee,branchCount:ne,branchDetailsExpanded:se,onEditBranching:g,onToggleBranchDetails:()=>pe(!se),onToggleIfDirect:_,onToggleBranchField:I,availableBranchFields:R}),e.jsxs("span",{style:{color:ie.punctuation},"data-test":"colon",children:[":"," "]}),re?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Q(!H),className:"inline-flex items-center hover:bg-gray-100 rounded px-0.5 transition-colors","data-test":"toggle-v2",children:[H?e.jsx(et,{className:"w-3 h-3",style:{color:le.muted}}):e.jsx(ot,{className:"w-3 h-3",style:{color:le.muted}}),e.jsx("span",{style:{color:ie.punctuation},children:D}),!H&&e.jsxs("span",{style:{color:ie.collapsedLabel},children:[" ",nt," "]}),!H&&e.jsx("span",{style:{color:ie.punctuation},children:z})]}),!H&&!s&&e.jsx("span",{style:{color:ie.punctuation},children:","})]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{node:t,isSelector:a,truncateLength:x,activeFieldPath:b,portalContainer:p,onFieldValueClick:r,onFieldValueHover:J,onClearSelector:Ne,onConfigClick:_e,onFilterChildrenClick:ue,onNavigateUp:Ce,onNavigateDown:Fe,canNavigateDown:f==null?void 0:f(t.path),onSelectorFilterClick:c,onSelectorFilterDoubleClick:u,onArrayBadgeClick:y,onSchemaCountClick:j}),!s&&e.jsx("span",{style:{color:ie.punctuation},children:","})]})]}),P&&F!==void 0&&E>0&&e.jsxs("span",{className:"font-mono whitespace-pre","data-test":"branch-tabs-line",children:[Z,"  ",e.jsx(Ql,{activeBranch:F,branchCount:E,parentPath:t.path.split(".").slice(0,-1).join("."),onBranchSwitch:T,onAddBranch:S,className:"inline-flex"})]}),ee&&se&&e.jsx(tr,{ifCondition:t.conditionalBranching.ifCondition,branches:t.conditionalBranching.branches}),re&&H&&e.jsxs(e.Fragment,{children:[t.children.map((ce,De)=>{var at;const Me=!!((at=ce.branchingMetadata)!=null&&at.isBranchParent),Pe=L&&!Me;return e.jsx(Qs,{node:ce,level:n+1,isLast:De===t.children.length-1,isSelector:a,valuesCollapsed:l,onFieldValueClick:r,onFieldValueHover:i,onClearSelector:o,onSelectorFilterClick:c,onSelectorFilterDoubleClick:u,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:j,onNavigateUp:C,onNavigateDown:N,canNavigateDown:f,onEditBranching:g,truncateLength:x,activeFieldPath:b,portalContainer:p,isBranchField:Pe?V.includes(ce.name):void 0,activeBranch:Pe?F:void 0,branchCount:Pe?E:void 0,availableBranchFields:Pe?R:void 0,branchFields:Pe?V:void 0,onBranchSwitch:T,onToggleBranchField:I,onToggleIfDirect:_,onAddBranch:S},ce.name)}),e.jsxs("div",{"data-test":"closing-bracket",children:[e.jsxs("span",{style:{color:ie.punctuation},children:[Z,z]}),!s&&e.jsx("span",{style:{color:ie.punctuation},children:","})]})]})]})}function Zs(t,n=""){const s=[];for(const a of Object.keys(t)){const l=n?`${n}.${a}`:a;s.push(l);const r=t[a];r&&typeof r=="object"&&!Array.isArray(r)&&s.push(...Zs(r,l))}return s}function en(t,n){const s=n.split(".");let a=t;for(const l of s){if(a==null)return[];if(typeof a!="object")return[];a=a[l]}return a==null?[]:Array.isArray(a)?a.map(l=>String(l??"")):typeof a=="object"?[]:[String(a)]}function sr(t,n,s,a){const l=en(t,n),r=[];return l.forEach((i,o)=>{nr(i,s,a)&&r.push({path:`${n}[${o}]`,value:i,index:o})}),r}function nr(t,n,s){const a=t.toLowerCase(),l=s.toLowerCase();switch(n){case"equals":return a===l;case"contains":return a.includes(l);case"startsWith":return a.startsWith(l);case"endsWith":return a.endsWith(l);case"regex":try{return new RegExp(s,"i").test(t)}catch{return!1}case"notEquals":return a!==l;case"notContains":return!a.includes(l);default:return!1}}function It(t,n){const s=t.filter(l=>l.toLowerCase().startsWith(n.toLowerCase()));if(s.length===0)return n;if(s.length===1)return s[0];let a=s[0];for(let l=1;l<s.length;l++){let r=0;for(;r<a.length&&r<s[l].length&&a[r].toLowerCase()===s[l][r].toLowerCase();)r++;if(a=a.slice(0,r),a.length===0)return n}return a.length>n.length?a:n}function ar(t,n){const s=en(t,n);return[...new Set(s)].filter(a=>a.trim()!=="")}function tn(t,n){if(!n)return t;const s=n.toLowerCase();return t.filter(a=>a.toLowerCase().includes(s))}function lr({value:t,onChange:n,onSelect:s,items:a,placeholder:l="Type to filter...",className:r,disabled:i}){const[o,c]=d.useState(!1),[u,h]=d.useState(0),m=d.useRef(null),y=d.useRef(null),j=d.useMemo(()=>t.trim()?tn(a,t).slice(0,10):a.slice(0,10),[a,t]);d.useEffect(()=>{h(0)},[j.length]);const C=d.useCallback(p=>{n(p.target.value),c(!0)},[n]),N=d.useCallback(p=>{var v;n(p),s==null||s(p),c(!1),(v=m.current)==null||v.focus()},[n,s]),f=d.useCallback(()=>{if(j.length===0)return!1;const p=It(j,t);return p.length>t.length?(n(p),!0):j.length===1?(N(j[0]),!0):!1},[j,t,n,N]),g=d.useCallback(p=>{if(!o){(p.key==="ArrowDown"||p.key==="ArrowUp")&&(c(!0),p.preventDefault());return}switch(p.key){case"Escape":p.preventDefault(),c(!1);break;case"ArrowDown":p.preventDefault(),h(v=>v<j.length-1?v+1:0);break;case"ArrowUp":p.preventDefault(),h(v=>v>0?v-1:j.length-1);break;case"Tab":p.preventDefault(),f();break;case"Enter":j.length>0&&(p.preventDefault(),N(j[u]));break}},[o,j,u,f,N]),x=d.useCallback(()=>{setTimeout(()=>c(!1),150)},[]),b=d.useCallback(()=>{a.length>0&&c(!0)},[a.length]);return e.jsx("div",{ref:y,className:"relative","data-test":"fuzzy-value-input",children:e.jsxs(_a,{open:o&&j.length>0,children:[e.jsx(Ea,{asChild:!0,children:e.jsx(ve,{ref:m,value:t,onChange:C,onKeyDown:g,onBlur:x,onFocus:b,placeholder:l,disabled:i,className:Te("font-mono text-xs",r),"data-test":"fuzzy-value-input-field"})}),e.jsx(Ta,{side:"bottom",align:"start",className:"w-[var(--radix-popover-trigger-width)] p-1",onOpenAutoFocus:p=>p.preventDefault(),"data-test":"fuzzy-value-input-dropdown",children:e.jsx("div",{className:"max-h-[150px] overflow-auto","data-test":"fuzzy-value-input-list",children:j.map(p=>e.jsx("div",{className:Te("px-2 py-1 text-xs cursor-pointer rounded transition-colors truncate",j.indexOf(p)===u?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:v=>{v.preventDefault(),N(p)},onMouseEnter:()=>h(j.indexOf(p)),"data-test":"fuzzy-value-input-item",children:p},p))})})]})})}const rr=[{value:"equals",label:"equals"},{value:"contains",label:"contains"},{value:"startsWith",label:"starts with"},{value:"endsWith",label:"ends with"},{value:"regex",label:"regex"},{value:"notEquals",label:"not equals"},{value:"notContains",label:"not contains"}];function ir({fieldPath:t,onFieldPathChange:n,availableFieldPaths:s,operator:a,onOperatorChange:l,compareValue:r,onCompareValueChange:i,availableValues:o,filteredItems:c,selectedMatchIndex:u,onSelectedMatchIndexChange:h,isExpanded:m,onExpandedChange:y,onClear:j,portalContainer:C}){const[N,f]=d.useState(!1),[g,x]=d.useState(!1),[b,p]=d.useState(0),v=t?tn(s,t).slice(0,10):s.slice(0,10),w=d.useCallback(I=>{n(I.target.value),x(!0),p(0)},[n]),k=d.useCallback(I=>{n(I),x(!1)},[n]),A=d.useCallback(I=>{if(!g&&v.length>0&&(I.key==="ArrowDown"||I.key==="ArrowUp")){x(!0),I.preventDefault();return}if(g)switch(I.key){case"Escape":I.preventDefault(),x(!1);break;case"ArrowDown":I.preventDefault(),p(_=>_<v.length-1?_+1:0);break;case"ArrowUp":I.preventDefault(),p(_=>_>0?_-1:v.length-1);break;case"Tab":if(I.preventDefault(),v.length>0){const _=It(v,t);_.length>t.length?n(_):v.length===1&&k(v[0])}break;case"Enter":v.length>0&&(I.preventDefault(),k(v[b]));break}},[g,v,t,b,n,k]),O=t.trim()!==""&&r.trim()!=="",T=c.length;return e.jsxs("div",{className:"border-t bg-muted/30","data-test":"content-filter-section",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-muted/50",onClick:()=>y(!m),"data-test":"content-filter-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(et,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(ot,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Bt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"Content Filter"}),O&&T>0&&e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-1.5 py-0.5 rounded","data-test":"filter-match-badge",children:[T," match",T!==1?"es":""]})]}),O&&e.jsx(te,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:I=>{I.stopPropagation(),j()},"data-test":"filter-clear-btn",children:e.jsx(st,{className:"w-3 h-3"})})]}),m&&e.jsxs("div",{className:"px-3 pb-3 space-y-2","data-test":"content-filter-controls",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"text-xs text-muted-foreground",children:"Field Path"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{value:t,onChange:w,onKeyDown:A,onFocus:()=>x(!0),onBlur:()=>setTimeout(()=>x(!1),150),placeholder:"e.g., champions._item.cost",className:"font-mono text-xs mt-1","data-test":"filter-field-path-input"}),g&&v.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-[150px] overflow-auto","data-test":"filter-field-path-dropdown",children:v.map((I,_)=>e.jsx("div",{className:Te("px-2 py-1 text-xs font-mono cursor-pointer",_===b?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:S=>{S.preventDefault(),k(I)},onMouseEnter:()=>p(_),"data-test":"filter-field-path-item",children:I},I))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-28",children:[e.jsx(he,{className:"text-xs text-muted-foreground",children:"Operator"}),e.jsxs(ke,{value:a,onValueChange:I=>l(I),children:[e.jsx(Se,{className:"mt-1 text-xs h-8","data-test":"filter-operator-select",children:e.jsx(Ot,{})}),e.jsx(Ae,{container:C,children:rr.map(I=>e.jsx(ae,{value:I.value,className:"text-xs","data-test":"filter-operator-option",children:I.label},I.value))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(he,{className:"text-xs text-muted-foreground",children:"Value"}),e.jsx("div",{className:"mt-1",children:e.jsx(lr,{value:r,onChange:i,items:o,placeholder:"Type value to filter...","data-test":"filter-value-input"})})]})]}),O&&T>1&&e.jsxs("div",{className:"pt-2 border-t border-dashed","data-test":"filter-matches-section",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ds,{className:"w-3.5 h-3.5 text-primary"}),e.jsxs("span",{className:"text-xs font-medium",children:["Navigate Matches (",T,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-20 overflow-y-auto",children:c.map((I,_)=>e.jsxs("button",{onClick:()=>h(_),className:Te("px-2 py-1 rounded text-xs font-mono transition-all",_===u?"bg-primary text-primary-foreground font-bold shadow-sm":"bg-muted text-muted-foreground hover:bg-muted/80 border"),title:I.value,"data-test":"filter-match-item",children:["[",I.index,"]"]},_))})]}),O&&T>0&&e.jsxs("div",{className:"pt-2","data-test":"filter-results-section",children:[e.jsxs("button",{onClick:()=>f(!N),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground","data-test":"filter-results-toggle",children:[N?e.jsx(et,{className:"w-3 h-3"}):e.jsx(ot,{className:"w-3 h-3"}),e.jsxs("span",{children:["Filtered Results (",T,")"]})]}),N&&e.jsx("div",{className:"mt-2 bg-background border rounded p-2 max-h-32 overflow-auto","data-test":"filter-results-list",children:c.map((I,_)=>e.jsxs("div",{className:Te("text-xs font-mono py-0.5 px-1 rounded",_===u&&"bg-primary/10"),"data-test":"filter-result-item",children:[e.jsxs("span",{className:"text-muted-foreground",children:[I.path,":"]})," ",e.jsxs("span",{className:"text-foreground",children:['"',I.value,'"']})]},_))})]}),O&&T===0&&e.jsx("div",{className:"text-xs text-muted-foreground italic py-2","data-test":"filter-no-matches",children:"No matches found"})]})]})}function Ts({mode:t,isActive:n,onModeChange:s,onCopy:a,onImport:l}){const r=t==="selectors"?"Selectors":"Content",i=`preview-tab-${t}-v2`,o=t==="selectors"&&n&&l;return e.jsxs("button",{onClick:()=>s(t),className:"flex-1 px-3 py-2 text-xs font-medium transition-colors flex items-center justify-center gap-1",style:{backgroundColor:n?Y.tabActiveBg:Y.tabInactiveBg,color:n?Y.tabActiveText:Y.tabInactiveText,borderBottom:n?`2px solid ${Y.tabActiveBorder}`:"2px solid transparent"},"data-test":i,children:[r,n&&a&&e.jsx("span",{onClick:c=>{c.stopPropagation(),a()},className:"p-0.5 rounded hover:bg-blue-100 transition-colors",title:`Copy ${t}`,"data-test":"copy-button",children:e.jsx(Qa,{className:"w-3 h-3"})}),o&&e.jsx("span",{onClick:c=>{c.stopPropagation(),l()},className:"p-0.5 rounded hover:bg-blue-100 transition-colors",title:"Import schema","data-test":"import-selectors-button-v2",children:e.jsx(Vs,{className:"w-3 h-3"})})]})}const Os={fieldPath:"",operator:"equals",compareValue:"",isExpanded:!1};function cr(t){const[n,s]=d.useState(Os),[a,l]=d.useState(0),r=d.useMemo(()=>Zs(t),[t]),i=d.useMemo(()=>n.fieldPath?ar(t,n.fieldPath):[],[t,n.fieldPath]),o=d.useMemo(()=>!n.fieldPath||!n.compareValue?[]:sr(t,n.fieldPath,n.operator,n.compareValue),[t,n.fieldPath,n.operator,n.compareValue]),c=o.length,u=d.useCallback((f,g)=>It(f,g),[]),h=d.useCallback((f,g)=>It(f,g),[]),m=d.useCallback(f=>{s(g=>({...g,fieldPath:f,compareValue:""})),l(0)},[]),y=d.useCallback(f=>{s(g=>({...g,operator:f})),l(0)},[]),j=d.useCallback(f=>{s(g=>({...g,compareValue:f})),l(0)},[]),C=d.useCallback(f=>{s(g=>({...g,isExpanded:f}))},[]),N=d.useCallback(()=>{s(Os),l(0)},[]);return{filterState:n,filteredItems:o,matchCount:c,selectedMatchIndex:a,availableFieldPaths:r,findFieldPathLCS:u,availableValues:i,findValueLCS:h,setFieldPath:m,setOperator:y,setCompareValue:j,setSelectedMatchIndex:l,setExpanded:C,clearFilter:N}}function or(t,n){if(!t||!n)return null;const s=t.split(".");if(s.length<2)return null;const a=s[s.length-1],l=s.slice(0,-1);let r=n;for(const j of l){if(typeof r!="object"||r===null)return null;r=r[j]}if(typeof r!="object"||r===null)return null;const i=r,o=i._branchFields;if(!(o!=null&&o.includes(a)))return null;const c=i._if;if(!c)return null;let u;if(typeof c=="string")u=c;else if(typeof c=="object"&&c.selector)u=c.selector;else return null;if(!u)return null;const h=i._activeBranch||1,m=i._branches;if(!m)return null;const y=Object.entries(m).map(([j,C])=>({branchNum:parseInt(j),match:(C==null?void 0:C.match)||"/./"})).sort((j,C)=>j.branchNum-C.branchNum);return{ifSelector:u,activeBranch:h,allBranchPatterns:y}}function dr(t,n){if(!t||!n)return null;const s=t.split(".");if(s.length<2)return null;const a=s[s.length-1],l=s.slice(0,-1);let r=n;for(const j of l){if(typeof r!="object"||r===null)return null;r=r[j]}if(typeof r!="object"||r===null)return null;const i=r,o=i._branchFields;if(!(o!=null&&o.includes(a)))return null;const c=i._if;if(!c)return null;let u;if(typeof c=="string")u=c;else if(typeof c=="object"&&c.selector)u=c.selector;else return null;if(!u)return null;const h=i._branches;if(!h)return null;const m=[],y=Object.keys(h).sort((j,C)=>parseInt(j)-parseInt(C));for(const j of y){const C=h[j];if(!C||typeof C!="object")continue;const N=C.match||"/./",f=C[a];let g="";typeof f=="string"?g=f:W(f)&&(g=ge(f)),m.push({pattern:N,selector:g})}return{ifSelector:u,branchSelectors:m}}function Qt(t,n,s){var i;const a=t.querySelector(n),l=((i=a==null?void 0:a.textContent)==null?void 0:i.trim())||"",r=!!a;if(s==="true")return r;if(s===".")return!0;try{return new RegExp(s).test(l)}catch{return!0}}function ur(t,n){const{ifSelector:s,activeBranch:a,allBranchPatterns:l}=n,r=l.find(c=>c.branchNum===a);if(!r)return t;const i=r.match.replace(/^\/|\/$/g,""),o=l.filter(c=>c.branchNum<a).map(c=>c.match.replace(/^\/|\/$/g,""));return t.filter(c=>{if(c===document)return!0;const u=c;for(const h of o)if(Qt(u,s,h))return!1;return Qt(u,s,i)})}function Ut(t,n){const s=n.split("."),a=s[0],l=t[a];if(!Array.isArray(l))return 0;const r=s.slice(1),i=(c,u)=>{if(u.length===0)return 1;const[h,...m]=u;return Array.isArray(c)?c.reduce((y,j)=>y+i(j==null?void 0:j[h],m),0):c&&typeof c=="object"?i(c[h],m):0};let o=0;for(const c of l)o+=i(c,r);return o}function _t(t,n=""){const s=["_branches","_branchFields","_activeBranch"],a=Object.entries(t).filter(([o])=>!s.includes(o)),l={_container:0,_item:1,_if:2};a.sort(([o],[c])=>{const u=l[o]??3,h=l[c]??3;return u-h});const i=Yt(t)?t:null;if(i){const o=new Set(a.map(([u])=>u)),c=i._branches[String(i._activeBranch)]||{};for(const u of i._branchFields)o.has(u)||a.push([u,c[u]??""])}return a.map(([o,c])=>{const u=n?`${n}${o}`:o;if(o==="_if"){if(dt(c)){const y=typeof c=="string"?{selector:c,condition:"exists"}:c;return{name:"_if",path:u,value:y.selector,conditionalBranching:{ifCondition:{selector:y.selector,condition:y.condition},branches:{}}}}return{name:"_if",path:u,value:null,conditionalBranching:{ifCondition:{selector:"",condition:"exists"},branches:{}}}}let h=c;if(i!=null&&i._branchFields.includes(o)){const y=i._branches[String(i._activeBranch)]||{};o in y&&(h=y[o])}const m={name:o,path:u,value:h};if(i!=null&&i._branchFields.includes(o)&&(m.branchingMetadata={isBranchField:!0,activeBranch:i._activeBranch,branchCount:Object.keys(i._branches).length,branchFields:i._branchFields}),!W(h))if(h&&typeof h=="object"&&!Array.isArray(h)){const y=h,j=y._if,C=y._branches;if(dt(j)&&Mt(C)){const N=typeof j=="string"?{selector:j,condition:"exists"}:j;m.conditionalBranching={ifCondition:{selector:N.selector,condition:N.condition},branches:C}}if(Yt(y)){const N=y,f=Object.keys(y).filter(b=>!b.startsWith("_")),g=N._branchFields,x=[...new Set([...f,...g])];m.branchingMetadata={isBranchParent:!0,activeBranch:N._activeBranch,branchCount:Object.keys(N._branches).length,branchFields:N._branchFields,availableBranchFields:x}}m.children=_t(y,`${u}.`)}else Array.isArray(h)&&h.length>0&&typeof h[0]=="object"&&h[0]!==null&&(m.children=h.map((y,j)=>({name:`[${j}]`,path:`${u}[${j}]`,value:y,isArrayItem:!0,arrayIndex:j,children:typeof y=="object"&&y!==null&&!W(y)?_t(y,`${u}[${j}].`):void 0})));return m})}function Zt(t,n="",s=null,a=null){const l=s??t;return Object.entries(t).map(([r,i])=>{const o=n?`${n}${r}`:r,c={name:r,path:o,value:i};if(a!==null&&(c.schemaArrayCount=Ut(l,o)),Array.isArray(i)&&i.length>0){const u=i[0];typeof u=="object"&&u!==null?(c.schemaArrayCount=Ut(l,o),c.value=u,c.children=Zt(u,`${o}.`,l,i.length)):(c.schemaArrayCount=Ut(l,o),c.value=u)}else i&&typeof i=="object"&&!Array.isArray(i)&&(c.children=Zt(i,`${o}.`,l,a));return c})}function es(t){if(Array.isArray(t))return t.map(es);if(t&&typeof t=="object"){if(W(t))return t;const n={},s=new Set(["_branchFields","_activeBranch"]);for(const[a,l]of Object.entries(t))s.has(a)||(n[a]=es(l));return n}return t}function ts(t){if(Array.isArray(t))return t.map(ts);if(t&&typeof t=="object"){const n={};for(const[s,a]of Object.entries(t))s.startsWith("_")||(n[s]=ts(a));return n}return t}function hr({mode:t,onModeChange:n,selectors:s,content:a,onFieldValueClick:l,onFieldValueHover:r,onClearSelector:i,onSelectorFilterClick:o,onSelectorFilterDoubleClick:c,onConfigClick:u,onFilterChildrenClick:h,onArrayBadgeClick:m,onNavigateUp:y,onNavigateDown:j,canNavigateDown:C,onEditBranching:N,onImportClick:f,contentViewMode:g="schema",onSchemaCountClick:x,activeFieldPath:b,className:p,portalContainer:v,onBranchSwitch:w,onToggleBranchField:k,onToggleIfDirect:A,onAddBranch:O}){const[T,I]=d.useState(!0),_=t==="selectors"?s:a,{filterState:S,filteredItems:P,selectedMatchIndex:F,availableFieldPaths:E,availableValues:R,setFieldPath:V,setOperator:L,setCompareValue:H,setSelectedMatchIndex:Q,setExpanded:se,clearFilter:pe}=cr(_),re=t==="selectors"?_t(s):g==="schema"?Zt(a):_t(a),Z=Object.keys(_).length===0,M=T?Jt.collapsed:Jt.expanded,D=d.useCallback((ne,J)=>{if(r){if(t==="selectors"||ne){r(ne,J);return}if(J){const Ne=dr(J,s);if(Ne){r(null,J,Ne);return}const _e=J.split(".");let ue=s;for(const Fe of _e){if(typeof ue!="object"||ue===null){ue=void 0;break}ue=ue[Fe]}let Ce=null;W(ue)?Ce=ge(ue):typeof ue=="string"&&(Ce=ue),r(Ce,J)}else r(null,null)}},[t,r,s]),z=async()=>{try{const ne=es(s),J=JSON.stringify(ne,null,2);await navigator.clipboard.writeText(J),K.success("Selectors copied to clipboard!")}catch{K.error("Failed to copy to clipboard")}},ee=async()=>{try{const ne=ts(a),J=JSON.stringify(ne,null,2);await navigator.clipboard.writeText(J),K.success("Content copied to clipboard!")}catch{K.error("Failed to copy to clipboard")}};return e.jsxs("div",{className:`flex flex-col h-full ${p??""}`,"data-test":"preview-tabs-v2",children:[e.jsxs("div",{className:"flex border-b shrink-0",style:{backgroundColor:q.white},"data-test":"preview-mode-tabs-v2",children:[e.jsx(Ts,{mode:"selectors",isActive:t==="selectors",onModeChange:n,onCopy:z,onImport:f}),e.jsx(Ts,{mode:"content",isActive:t==="content",onModeChange:n,onCopy:ee})]}),e.jsx("div",{className:"flex-1 overflow-auto p-2","data-test":"preview-content-v2",children:Z?e.jsx("div",{className:"text-sm text-center py-8",style:{color:B.placeholder},"data-test":"empty-preview-v2",children:t==="selectors"?"No selectors defined":"No content extracted"}):e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>I(!T),className:"absolute top-1 right-1 flex items-center gap-1 text-xs px-1.5 py-0.5 rounded hover:bg-gray-200 transition-colors",style:{color:B.muted,backgroundColor:q.whiteAlpha},title:T?"Expand values":"Collapse values","data-test":"toggle-values-collapse-v2",children:[T?e.jsx(ot,{className:"w-3 h-3"}):e.jsx(et,{className:"w-3 h-3"}),e.jsx("span",{children:T?"Expand":"Collapse"})]}),e.jsxs("pre",{className:"text-xs font-mono m-0 p-0",style:{background:"transparent"},"data-test":"json-tree-v2",children:[e.jsx("span",{style:{color:ie.punctuation},children:"{"}),re.map((ne,J)=>e.jsx(Qs,{node:ne,level:1,isLast:J===re.length-1,isSelector:t==="selectors",valuesCollapsed:T,onFieldValueClick:l,onFieldValueHover:D,onClearSelector:i,onSelectorFilterClick:o,onSelectorFilterDoubleClick:c,onConfigClick:u,onFilterChildrenClick:h,onArrayBadgeClick:m,onSchemaCountClick:x,onNavigateUp:y,onNavigateDown:j,canNavigateDown:C,onEditBranching:t==="selectors"?N:void 0,truncateLength:M,activeFieldPath:t==="selectors"?b:null,portalContainer:v,onBranchSwitch:w,onToggleBranchField:k,onToggleIfDirect:A,onAddBranch:O},ne.name)),e.jsx("span",{style:{color:ie.punctuation},children:"}"})]})]})}),e.jsx(ir,{fieldPath:S.fieldPath,onFieldPathChange:V,availableFieldPaths:E,operator:S.operator,onOperatorChange:L,compareValue:S.compareValue,onCompareValueChange:H,availableValues:R,filteredItems:P,selectedMatchIndex:F,onSelectedMatchIndexChange:Q,isExpanded:S.isExpanded,onExpandedChange:se,onClear:pe,portalContainer:v})]})}function pr({continuousMode:t,onContinuousModeToggle:n,previewMode:s,contentViewMode:a,onContentViewModeChange:l,filledCount:r,totalCount:i,warningMessage:o}){return e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-3 py-2 text-xs border-t relative",style:{backgroundColor:q.muted},"data-test":"continuous-mode-status-v2",children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-amber-100 text-amber-800 font-medium animate-pulse","data-test":"status-bar-warning-v2",children:o}),e.jsxs("button",{className:"flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer",onClick:n,"data-test":"continuous-mode-toggle-v2",children:[e.jsx(Za,{className:"w-3 h-3",style:{color:t?le.primary:le.muted}}),e.jsxs("span",{style:{color:t?B.primary:B.muted},children:["Continuous Mode: ",t?"ON":"OFF"]})]}),s==="content"&&e.jsxs("div",{className:"flex items-center gap-1","data-test":"content-view-toggle-v2",children:[e.jsx("button",{onClick:()=>l("schema"),className:`p-1 rounded transition-colors ${a==="schema"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Schema view","data-test":"content-view-schema-v2",children:e.jsx(el,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>l("array"),className:`p-1 rounded transition-colors ${a==="array"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Array view","data-test":"content-view-array-v2",children:e.jsx(cs,{className:"w-3 h-3"})})]}),e.jsxs("span",{style:{color:B.muted},children:[r,"/",i," fields"]})]})}function xr({mode:t,fields:n,selectedFieldId:s,schemaSectionHeight:a,previewMode:l,contentViewMode:r,selectors:i,content:o,activeFieldPath:c,continuousMode:u,filledCount:h,totalCount:m,portalContainer:y,containerRef:j,onFieldSelect:C,onFieldUpdate:N,onFieldEdit:f,onFieldDelete:g,onReorder:x,onAddChild:b,onAddSiblingBefore:p,onAddSiblingAfter:v,onListModeApply:w,onListModeCancel:k,onResizeStart:A,onPreviewModeChange:O,onFieldValueClick:T,onFieldValueHover:I,onClearSelector:_,onSelectorFilterClick:S,onSelectorFilterDoubleClick:P,onConfigClick:F,onFilterChildrenClick:E,onArrayBadgeClick:R,onNavigateUp:V,onNavigateDown:L,canNavigateDown:H,onEditBranching:Q,onImportClick:se,onSchemaCountClick:pe,onBranchSwitch:re,onToggleBranchField:Z,onToggleIfDirect:M,onAddBranch:D,onContinuousModeToggle:z,onContentViewModeChange:ee,warningMessage:ne}){return e.jsxs("div",{ref:j,className:"flex flex-col h-full","data-test":"capture-panel-v2",children:[e.jsxs("div",{className:"p-2 text-xs font-medium border-b shrink-0",style:{backgroundColor:"#f9fafb",color:"#6b7280"},"data-test":"schema-header",children:["Schema ",t==="list"&&"(List Mode)"]}),e.jsx("div",{className:"min-h-0 overflow-auto",style:a!==null?{height:a}:{flex:t==="list"?3:1},"data-test":"schema-section-v2",children:t==="mapped"?e.jsx(Wl,{fields:n,selectedFieldId:s,mode:t,onFieldSelect:C,onFieldUpdate:N,onFieldEdit:f,onFieldDelete:g,onReorder:x,onAddChild:b,onAddSiblingBefore:p,onAddSiblingAfter:v}):e.jsx(Yl,{fields:n,onApply:w,onCancel:k})}),e.jsx("div",{className:"h-1.5 bg-border hover:bg-primary/50 cursor-row-resize shrink-0 transition-colors flex items-center justify-center group",onMouseDown:A,"data-test":"section-resize-handle",children:e.jsx("div",{className:"w-8 h-0.5 bg-muted-foreground/30 group-hover:bg-primary/70 rounded-full transition-colors"})}),e.jsx("div",{className:"flex-1 min-h-0","data-test":"preview-section-v2",children:e.jsx(hr,{mode:l,onModeChange:O,selectors:i,content:o,onFieldValueClick:T,onFieldValueHover:I,onClearSelector:_,onSelectorFilterClick:S,onSelectorFilterDoubleClick:P,onConfigClick:F,onFilterChildrenClick:E,onArrayBadgeClick:R,onNavigateUp:V,onNavigateDown:L,canNavigateDown:H,onEditBranching:Q,onImportClick:se,contentViewMode:r,onSchemaCountClick:pe,activeFieldPath:c,portalContainer:y,onBranchSwitch:re,onToggleBranchField:Z,onToggleIfDirect:M,onAddBranch:D})}),e.jsx(pr,{continuousMode:u,onContinuousModeToggle:z,previewMode:l,contentViewMode:r,onContentViewModeChange:ee,filledCount:h,totalCount:m,warningMessage:ne})]})}const mr=/([[\]():!#$%&'*+,./;<=>?@\\^`{|}~])/g;function sn(t){return t.replace(mr,"\\$1")}function Ye(t){const n=Array.from(t.classList).filter(s=>!s.startsWith("css-")).map(sn).join(".");return n?`.${n}`:t.tagName.toLowerCase()}function ss(t){if(t.closest('[data-test="capture-panel-v2"]')||t.closest('[data-test="draggable-popover-container"]'))return!0;const n=t.closest("[data-radix-popper-content-wrapper]")||t.closest('[role="dialog"]')||t.closest('[role="listbox"]')||t.closest('[role="menu"]');if(n){let s=t;for(;s&&s!==n;){const l=s.getAttribute("data-test");if(l!=null&&l.endsWith("-v2"))return!0;s=s.parentElement}if(n.querySelector('[data-test$="-v2"]'))return!0}return!1}function fr(t){const n=Array.from(t.classList).filter(s=>!s.startsWith("css-")).map(sn).join(".");return n?`.${n}`:t.tagName.toLowerCase()}function X(t,n,s){if(n.length===1)return{...t,[n[0]]:s};const[a,...l]=n,r=typeof t[a]=="object"&&t[a]!==null?t[a]:{};return{...t,[a]:X(r,l,s)}}function oe(t,n){if(n.length===0)return t;const[s,...a]=n,l=t[s];if(a.length===0)return l;if(typeof l=="object"&&l!==null)return oe(l,a)}function Fs(t,n){if(!t||!n)return[document];const s=t.split("."),a=s[s.length-1];if(a==="_container"||a==="_item")return[document];const l=[];let r=n;for(let o=0;o<s.length;o++){const c=s[o];if(typeof r!="object"||r===null)break;const u=r;if(!(c in u))break;if(r=u[c],typeof r=="object"&&r!==null){const h=r;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",j=typeof m=="string"?m:(m==null?void 0:m.selector)??"",C=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(j){const N=j.endsWith("[]")?j.slice(0,-2):j;C?l.push({containerSelector:N,itemSelector:C}):l.push({containerSelector:N,itemSelector:"",containerOnly:!0})}}}}if(l.length===0)return[document];let i=[document];for(let o=0;o<l.length;o++){const c=l[o],u=[];for(const h of i){const m=Array.from(h.querySelectorAll(c.containerSelector));for(const y of m)if(c.containerOnly)u.push(y);else{const j=Array.from(y.querySelectorAll(c.itemSelector));u.push(...j)}}if(u.length===0)return[document];i=u}return i}function gr(t,n){if(!t||!n)return[document];const s=t.split("."),a=s[s.length-1];if(a==="_container"||a==="_item")return[document];const l=[];let r=n;for(let o=0;o<s.length;o++){const c=s[o];if(typeof r!="object"||r===null)break;const u=r;if(!(c in u))break;if(r=u[c],typeof r=="object"&&r!==null){const h=r;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",j=typeof m=="string"?m:(m==null?void 0:m.selector)??"",C=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(j){const N=j.endsWith("[]")?j.slice(0,-2):j;C?l.push({containerSelector:N,itemSelector:C}):l.push({containerSelector:N,itemSelector:"",containerOnly:!0})}}}}if(l.length===0)return[document];let i=[document];for(let o=0;o<l.length;o++){const c=l[o],u=o===l.length-1,h=[];for(const m of i){const y=Array.from(m.querySelectorAll(c.containerSelector));for(const j of y)if(u)h.push(j);else if(c.containerOnly)h.push(j);else{const C=Array.from(j.querySelectorAll(c.itemSelector));h.push(...C)}}if(h.length===0)return[document];i=h}return i}function br(t,n){var a;let s=0;for(const l of t.childNodes)if(l.nodeType===Node.TEXT_NODE&&((a=l.textContent)==null?void 0:a.trim())){if(s===n){const i=window.getSelection();if(i){const o=document.createRange();return o.selectNodeContents(l),i.removeAllRanges(),i.addRange(o),!0}}s++}return!1}function Bs(t,n){if(!t||!n)return;const s=t.split("."),a=oe(n,s);if(W(a)&&a.siblingFilter)return a.siblingFilter}function jr({selectors:t}={}){const n=d.useRef([]);d.useEffect(()=>{const i="capture-selection-style";if(document.getElementById(i))return;const o=document.createElement("style");return o.id=i,o.textContent=`::selection { background: ${Kt.background}; }`,document.head.appendChild(o),()=>{const c=document.getElementById(i);c&&c.remove()}},[]);const s=d.useCallback(()=>{for(const{element:o,originalOutline:c,originalOutlineOffset:u,originalBackground:h}of n.current)o.style.outline=c,o.style.outlineOffset=u,o.style.background=h;n.current=[];const i=window.getSelection();i&&i.removeAllRanges()},[]),a=d.useCallback(i=>{ss(i)||(n.current.push({element:i,originalOutline:i.style.outline,originalOutlineOffset:i.style.outlineOffset,originalBackground:i.style.background}),i.style.outline=we.outline,i.style.outlineOffset=we.outlineOffset,i.style.background=we.background)},[]),l=d.useCallback((i,o,c)=>{s();try{let u=Fs(o,t);if(c){const{ifSelector:N,branchSelectors:f}=c;for(const g of u){if(g===document)continue;const x=g;let b="";for(const{pattern:p,selector:v}of f){const w=p.replace(/^\/|\/$/g,"");if(Qt(x,N,w)){b=v;break}}if(b){const p=Ze(b,g);for(const v of p)a(v)}}return}const h=or(o,t);h&&(u=ur(u,h));const m=Bs(o,t),y=Dt(i),j=mt(i),C=y.textNodeIndex;for(const N of u){let f=Ze(j,N);if(f=At(f,m),C!==void 0)for(const g of f)br(g,C);else for(const g of f)a(g)}}catch{}},[s,a,t]),r=d.useCallback((i,o,c)=>{if(s(),!(!i||c===null||c<0))try{const u=Fs(o,t);if(c>=u.length)return;const h=u[c],m=Bs(o,t);let y=Ze(i,h);y=At(y,m);for(const j of y)a(j)}catch{}},[s,a,t]);return{clearHighlights:s,highlightElement:a,highlightMatches:l,highlightByIndex:r}}function yr({onSelectorCaptured:t,onSelectorInspect:n,selectors:s,preventDefaultOnInteraction:a,onEscapePressed:l}){const[r,i]=d.useState(null),{clearHighlights:o,highlightElement:c,highlightMatches:u,highlightByIndex:h}=jr({selectors:s});d.useEffect(()=>{if(!r)return;const f=b=>{b.key==="Escape"&&(o(),i(null),l==null||l())},g=b=>{const p=b.target;ss(p)||(o(),c(p))},x=b=>{var T;const p=b.target;if(ss(p))return;a&&(b.preventDefault(),b.stopPropagation());const v=fr(p),w=Array.from(document.querySelectorAll(v)),k=w.indexOf(p),A=w.length>1&&k>=0?`${v}[${k}]`:v,O=w.length>1&&k>=0?[((T=p.textContent)==null?void 0:T.trim())??""]:w.map(I=>{var _;return((_=I.textContent)==null?void 0:_.trim())??""});t(r,A,O),o(),i(null)};return window.addEventListener("keydown",f),document.addEventListener("mouseover",g),document.addEventListener("click",x),()=>{window.removeEventListener("keydown",f),document.removeEventListener("mouseover",g),document.removeEventListener("click",x)}},[r,o,c,t,a,l]),d.useEffect(()=>{r||o()},[r,o]);const m=d.useCallback((f,g)=>{!g||g===""?i(f):n==null||n(f,g)},[n]),y=d.useCallback((f,g,x)=>{if(x){u("",g,x);return}if(!f){o();return}u(f,g)},[o,u]),j=d.useCallback((f,g,x=400)=>{y(f,g),setTimeout(()=>{o()},x)},[y,o]),C=d.useCallback((f,g,x)=>{if(!(x===null||x<0))try{const b=gr(g,s);if(x>=b.length)return;const p=b[x];if(p===document)return;p.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},[s]),N=d.useCallback(()=>{o(),i(null)},[o]);return{selectorCaptureFieldPath:r,handleFieldValueClick:m,handleFieldValueHover:y,flashHighlight:j,highlightByIndex:h,scrollToElementByIndex:C,cancelCapture:N}}function vr({selectors:t}){const[n,s]=d.useState(!1),[a,l]=d.useState(null),[r,i]=d.useState(null),[o,c]=d.useState(null),[u,h]=d.useState(null),[m,y]=d.useState(null),j=d.useCallback((g,x)=>{s(!0),l(g);const b=Nl(g,t);if(b.length===0){y(null);const S=wt(x,document);i(S),c(x),h(null);return}const p=mt(x),w=Oe(p).selector;let k=null,A=-1,O=0;for(let S=0;S<b.length;S++){const P=b[S];try{P.querySelectorAll(w).length>0&&(O++,k===null&&(k=P,A=S))}catch{}}const T=k??b[0],I=A>=0?A:0;y(T);const _=wt(x,T);_&&(_.itemStats={itemsWithMatch:O,totalItems:b.length,displayedItemIndex:I}),i(_),c(x),h(null)},[t]),C=d.useCallback(()=>{s(!1),l(null),i(null),c(null),h(null),y(null)},[]),N=d.useCallback(g=>{i(wt(g,m??document))},[m]),f=d.useCallback(g=>{if(!r||g<0||g>=r.siblings.length)return null;const x=r.siblings[g];return ft(x)?x.element:null},[r]);return{isOpen:n,fieldPath:a,domContext:r,initialSelector:o,previousChildIndex:u,openPopover:j,closePopover:C,refreshContext:N,setPreviousChildIndex:h,getSiblingElement:f}}function nn(t,n){var i,o,c;let s=t;if(n&&n.length>0){s=t.cloneNode(!0);for(const u of n){if(u==="#text")continue;s.querySelectorAll(u).forEach(m=>m.remove())}}const a=["DIV","P","LI","SECTION","ARTICLE","HEADER","FOOTER"];if(Array.from(s.children).some(u=>a.includes(u.tagName))){const u=[];for(const h of s.childNodes)if(h.nodeType===Node.TEXT_NODE){const m=(i=h.textContent)==null?void 0:i.trim();m&&u.push(m)}else if(h.nodeType===Node.ELEMENT_NODE){const m=(o=h.textContent)==null?void 0:o.trim();m&&u.push(m)}return u.join(" ")}return((c=s.textContent)==null?void 0:c.trim())??""}function Nr(t){return t.endsWith("[]")?{baseSelector:t.slice(0,-2),selectAll:!0}:{baseSelector:t,selectAll:!1}}function an(t){const n={};for(const[s,a]of Object.entries(t))s.startsWith("_")||(n[s]=a);return n}function ln(t,n){const s={...t};for(const[a,l]of Object.entries(n))a!=="match"&&(s[a]=l);return s}function Cr(t){const n=t.selector;return n?t.index?`${n}[${t.index.type==="single"?t.index.index:""}]`:n:""}function rn(t,n){var a;let s=0;for(const l of t.childNodes)if(l.nodeType===Node.TEXT_NODE){const r=(a=l.textContent)==null?void 0:a.trim();if(r){if(s===n)return r;s++}}return""}function Et(t,n){return n.textNodeIndex!==void 0?rn(t,n.textNodeIndex):n.extractAttribute?t.getAttribute(n.extractAttribute)??"":nn(t,n.excludeChildren)}function wr({domTreeFieldPath:t,domContext:n,domTreeInitialSelector:s,onSelectorCaptured:a,refreshDomTreeContext:l,closeDomTreePopover:r,setDomTreePreviousChildIndex:i}){const o=d.useCallback((N,f)=>{var w;if(!t)return;const g=Ye(f),x=Array.from(document.querySelectorAll(g)),b=x.indexOf(f),p=x.length>1&&b>=0?`${g}[${b}]`:g,v=x.length>1&&b>=0?[((w=f.textContent)==null?void 0:w.trim())??""]:x.map(k=>{var A;return((A=k.textContent)==null?void 0:A.trim())??""});a(t,p,v)},[t,a]),c=d.useCallback(N=>{if(!t||!n)return;i(n.capturedIndex);const f=Ye(N),g=document.querySelectorAll(f),x=Array.from(g).map(b=>{var p;return((p=b.textContent)==null?void 0:p.trim())??""});a(t,f,x),l(f)},[t,n,a,l,i]),u=d.useCallback((N,f)=>{if(!t)return;i(null);const g=Ye(f),x=document.querySelectorAll(g),b=Array.from(x).map(p=>{var v;return((v=p.textContent)==null?void 0:v.trim())??""});a(t,g,b),l(g)},[t,a,l,i]),h=d.useCallback(()=>{t&&(a(t,"",[]),r())},[t,a,r]),m=d.useCallback(N=>{var v;if(!t||!n)return;const f=n.baseSelector,g=`${f}[${N}]`,b=document.querySelectorAll(f)[N],p=((v=b==null?void 0:b.textContent)==null?void 0:v.trim())??"";a(t,g,[p]),l(g),K.success(`Updated selector to [${N}]`)},[t,n,a,l]),y=d.useCallback(()=>{if(!t||!s)return;const N=document.querySelectorAll(s),f=Array.from(N).map(g=>{var x;return((x=g.textContent)==null?void 0:x.trim())??""});a(t,s,f),l(s),K.success("Reverted to original selector")},[t,s,a,l]),j=d.useCallback((N,f)=>{t&&Oa(async()=>{const{querySelectorWithIndex:g}=await Promise.resolve().then(()=>jl);return{querySelectorWithIndex:g}},void 0).then(({querySelectorWithIndex:g})=>{const b=g(N).map(p=>{var v;return((v=p.textContent)==null?void 0:v.trim())??""});a(t,N,b),l(N)})},[t,a,l]),C=d.useCallback((N,f)=>{var O;if(!t||!n)return;const g=(O=n.parent)==null?void 0:O.element;if(!g)return;const x=Ye(g),b=Array.from(document.querySelectorAll(x)),p=b.indexOf(g),w=`${b.length>1&&p>=0?`${x}[${p}]`:x}@text[${f.nodeIndex}]`,k=f.parentElement,A=rn(k,f.nodeIndex);a(t,w,[A]),r(),K.success(`Captured text node @text[${f.nodeIndex}]`)},[t,n,a,r]);return{handleDomTreeSiblingSelect:o,handleDomTreeParentSelect:c,handleDomTreeChildSelect:u,handleClearSelector:h,handleAddIndex:m,handleRevertSelector:y,handleSelectorChange:j,handleTextNodeClick:C}}function kr(t){const[n,s]=d.useState(t),[a,l]=d.useState(null),[r,i]=d.useState(null),[o,c]=d.useState(!1),u=d.useCallback(b=>{l(b)},[]),h=d.useCallback((b,p)=>{s(v=>v.map(w=>w.id===b?{...w,name:p}:w))},[]),m=d.useCallback((b,p,v)=>{i({id:b,name:p,type:v}),c(!0)},[]),y=d.useCallback(b=>{b&&r&&s(p=>p.map(v=>v.id===r.id?{...v,name:b.name,type:b.type}:v)),i(null),c(!1)},[r]),j=d.useCallback(()=>{i(null),c(!1)},[]),C=d.useCallback(b=>{s(p=>p.filter(v=>v.id!==b&&v.parentId!==b))},[]),N=d.useCallback(b=>{const p=(v,w)=>v.flatMap((k,A)=>{const T={...k.data,parentId:w,order:A},I=k.children?p(k.children,k.id):[];return[T,...I]});s(p(b,null))},[]),f=d.useCallback(b=>{const p=`field-${Date.now()}`;s(v=>[...v,{id:p,name:"newField",type:"string",order:v.length,parentId:b,mapping:null}])},[]),g=d.useCallback(b=>{s(p=>{const v=p.find(k=>k.id===b);if(!v)return p;const w=`field-${Date.now()}`;return[...p,{id:w,name:"newField",type:"string",order:v.order-.5,parentId:v.parentId,mapping:null}]})},[]),x=d.useCallback(b=>{s(p=>{const v=p.find(k=>k.id===b);if(!v)return p;const w=`field-${Date.now()}`;return[...p,{id:w,name:"newField",type:"string",order:v.order+.5,parentId:v.parentId,mapping:null}]})},[]);return{fields:n,setFields:s,selectedFieldId:a,editingField:r,isFieldDialogOpen:o,handleFieldSelect:u,handleFieldUpdate:h,handleFieldEdit:m,handleFieldDialogSubmit:y,handleFieldDialogCancel:j,handleFieldDelete:C,handleReorder:N,handleAddChild:f,handleAddSiblingBefore:g,handleAddSiblingAfter:x}}const Je="watcher:custom-captures-v2";function Sr(){const[t,n]=d.useState([]);d.useEffect(()=>{try{const o=localStorage.getItem(Je);o&&n(JSON.parse(o))}catch(o){console.warn("[CaptureStorage] Failed to load from localStorage:",o)}},[]);const s=d.useCallback(o=>{const c={...o,id:`capture-${Date.now()}`,capturedAt:Date.now()};return n(u=>{const h=[...u,c];return localStorage.setItem(Je,JSON.stringify(h)),h}),K.success("Capture saved to localStorage!"),c},[]),a=d.useCallback(o=>{const c=localStorage.getItem(Je);if(!c)return;const h=JSON.parse(c).find(m=>m.id===o);return h&&K.success("Capture loaded!"),h},[]),l=d.useCallback(o=>{n(c=>{const u=c.filter(h=>h.id!==o);return localStorage.setItem(Je,JSON.stringify(u)),u}),K.success("Capture deleted")},[]),r=d.useCallback((o,c)=>{n(u=>{const h=u.map(m=>m.id===o?{...m,name:c}:m);return localStorage.setItem(Je,JSON.stringify(h)),h}),K.success("Capture renamed")},[]),i=d.useCallback(()=>{try{const o=localStorage.getItem(Je);if(!o)return;const c=JSON.parse(o);return c.length===0?void 0:c[c.length-1]}catch{return}},[]);return{savedCaptures:t,saveCapture:s,loadCapture:a,deleteCapture:l,renameCapture:r,getLastCapture:i}}function Ar(t){const n={};for(const[s,a]of Object.entries(t))s==="match"?n[s]=a:typeof a=="string"?n[s]=xt(a):(W(a)||typeof a=="object"&&a!==null&&Array.isArray(a),n[s]=a);return n}function Ir(t){const n=new Set;for(const s of Object.values(t))if(typeof s=="object"&&s!==null)for(const a of Object.keys(s))a!=="match"&&n.add(a);return Array.from(n)}function it(t){const n={};for(const[s,a]of Object.entries(t))if(s==="_container"||s==="_item")n[s]=a;else if(s==="_if")n[s]=a;else if(s==="_branches")if(typeof a=="object"&&a!==null){const l=a,r={};for(const[o,c]of Object.entries(l))typeof c=="object"&&c!==null?r[o]=Ar(c):r[o]=c;n[s]=r;const i=Ir(l);i.length>0&&(n._branchFields=i),"_activeBranch"in t||(n._activeBranch=1)}else n[s]=a;else s==="_branchFields"||s==="_activeBranch"?n[s]=a:typeof a=="string"?n[s]=xt(a):W(a)?n[s]=a:typeof a=="object"&&a!==null&&!Array.isArray(a)?n[s]=it(a):n[s]=a;return n}function ns(t){const n={};for(const[s,a]of Object.entries(t))W(a)?n[s]=hs(a):typeof a=="object"&&a!==null&&!Array.isArray(a)?n[s]=ns(a):n[s]=a;return n}function _r({fields:t,selectors:n,content:s,setFields:a,setSelectors:l,setContent:r}){const[i,o]=d.useState(!0),[c,u]=d.useState(!1),[h,m]=d.useState(!1),[y,j]=d.useState(!1),[C,N]=d.useState(!1),[f,g]=d.useState(!0),[x,b]=d.useState(null),{savedCaptures:p,saveCapture:v,loadCapture:w,deleteCapture:k,renameCapture:A,getLastCapture:O}=Sr();d.useEffect(()=>{const D=O(),z=D&&Object.keys(D.selectors).length>0;if(D&&z){a(D.fields);const ee=it(D.selectors);l(ee),r(D.content)}else{const ee=it(rl);l(ee)}},[O,a,l,r]);const T=d.useCallback(()=>{const D=ns(n);v({name:"TFT Capture",url:window.location.href,fields:t,selectors:D,content:s})},[v,t,n,s]),I=d.useCallback(D=>{const z=w(D);if(z){a(z.fields);const ee=it(z.selectors);l(ee),r(z.content)}},[w,a,l,r]),_=d.useCallback(()=>{const D=ns(n),z={fields:t,selectors:D,content:s},ee=new Blob([JSON.stringify(z,null,2)],{type:"application/json"}),ne=URL.createObjectURL(ee),J=document.createElement("a");J.href=ne,J.download=`capture-${Date.now()}.json`,J.click(),URL.revokeObjectURL(ne)},[t,n,s]),S=d.useCallback(()=>{l({}),r({}),K.success("Capture data cleared")},[l,r]),P=d.useCallback(()=>{o(!0)},[]),F=d.useCallback(()=>{o(!1)},[]),E=d.useCallback(()=>{m(!0)},[]),R=d.useCallback(()=>{m(!1)},[]),V=d.useCallback(()=>{j(!0)},[]),L=d.useCallback(()=>{j(!1)},[]),H=d.useCallback(()=>{N(!0)},[]),Q=d.useCallback(()=>{N(!1)},[]),se=d.useCallback((D,z)=>{A(D,z)},[A]),pe=d.useCallback(D=>{k(D)},[k]),re=d.useCallback(D=>{const z=it(D);l(z),K.success("Schema imported successfully!")},[l]),Z=d.useCallback((D,z)=>{b({fieldName:D,values:z})},[]),M=d.useCallback(()=>{b(null)},[]);return{savedCaptures:p,isPopoverVisible:i,moreActionsOpen:c,importDialogOpen:h,managerPopoverOpen:y,advancedSettingsOpen:C,preventDefaultOnInteraction:f,contentPopover:x,setMoreActionsOpen:u,setPreventDefaultOnInteraction:g,handleSave:T,handleLoad:I,handleRenameCapture:se,handleDeleteCapture:pe,handleDownload:_,handleClear:S,handleOpenPopover:P,handleClosePopover:F,handleOpenImportDialog:E,handleCloseImportDialog:R,handleOpenManagerPopover:V,handleCloseManagerPopover:L,handleOpenAdvancedSettings:H,handleCloseAdvancedSettings:Q,handleImportSchema:re,handleArrayBadgeClick:Z,handleCloseContentPopover:M}}function Er(t){return t.replace(/([[\]():#$^*=!|~'"/@+?{}])/g,"\\$1")}function Tr({selectors:t,captureRoot:n,setAttributePopover:s,setChildFilterPopover:a,onUpdateExcludeChildren:l,onUpdateExtractAttribute:r,onWarning:i}){const o=d.useCallback(f=>{const g=f.split("."),x=oe(t,g);if(W(x))return mt(x);if(typeof x=="string"){const b=x.lastIndexOf("@");return b>0?x.substring(0,b):x}return null},[t]),c=d.useCallback(f=>{const g=f.split("."),x=oe(t,g);return W(x)&&x.excludeChildren?x.excludeChildren:[]},[t]),u=d.useCallback(f=>{const g=f.split("."),x=oe(t,g);return W(x)&&x.extractAttribute?[x.extractAttribute]:["innerText"]},[t]),h=d.useCallback((f,g)=>{const x=o(f);if(!x){i==null||i("No selector defined for this field");return}const b=n??document;try{const p=b.querySelector(x);if(!p){i==null||i("Element not found on page");return}const v=[];for(const k of p.attributes)v.push({name:k.name,value:k.value});const w=u(f);s({isOpen:!0,fieldPath:f,attributes:v,currentAttributes:w,position:g})}catch{i==null||i("Invalid selector")}},[t,o,u,n,s,i]),m=d.useCallback((f,g)=>{const x=o(f);if(!x){K.error("No selector defined for this field");return}const b=n??document;try{const p=b.querySelector(x);if(!p){K.error("No element found for selector");return}const v=[];p.childNodes.forEach((A,O)=>{var T,I,_;if(A.nodeType===Node.ELEMENT_NODE){const S=A,P=S.tagName.toLowerCase(),F=typeof S.className=="string"?S.className:((T=S.className)==null?void 0:T.baseVal)??"",E=F?`.${F.split(" ").filter(Boolean).join(".")}`:"",R=F?`.${F.split(" ").filter(Boolean).map(Q=>Er(Q)).join(".")}`:"",V=`child-${O}-${P}`,L=`${P}${E}`.slice(0,30),H=((I=S.textContent)==null?void 0:I.trim().slice(0,50))||"";v.push({id:V,label:L,selector:`${P}${R}`,textPreview:H})}else if(A.nodeType===Node.TEXT_NODE){const S=(_=A.textContent)==null?void 0:_.trim();S&&v.push({id:`text-${O}`,label:"#text",selector:"#text",textPreview:S.slice(0,50)})}});const w=c(f),k=v.filter(A=>w.includes(A.selector)).map(A=>A.id);a({isOpen:!0,fieldPath:f,children:v,excludedChildren:k,position:g})}catch{K.error("Invalid selector")}},[o,c,n,a]),y=d.useCallback(()=>{s(f=>({...f,isOpen:!1}))},[s]),j=d.useCallback((f,g)=>{const x=g.filter(p=>p!=="innerText"),b=x.length>0?x[0]:void 0;r&&r(f,b),b?K.success(`Extraction set to: ${b}`):K.success("Extraction set to: innerText (default)")},[r]),C=d.useCallback(()=>{a(f=>({...f,isOpen:!1}))},[a]),N=d.useCallback((f,g,x)=>{const b=x.filter(v=>g.includes(v.id)).map(v=>v.selector);l&&l(f,b);const p=x.length-g.length;K.success(`Saved: ${p} children included, ${g.length} excluded`)},[l]);return{handleConfigClick:h,handleFilterChildrenClick:m,handleAttributePopoverClose:y,handleAttributeSelect:j,handleChildFilterPopoverClose:C,handleChildFilterConfirm:N}}function Or({containerRef:t,headerHeight:n=33,minHeight:s=80,bottomPadding:a=100}){const[l,r]=d.useState(null),i=d.useRef(!1),o=d.useCallback(c=>{c.preventDefault(),i.current=!0,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[]);return d.useEffect(()=>{const c=h=>{if(!i.current||!t.current)return;const m=t.current.getBoundingClientRect(),y=h.clientY-m.top-n,j=m.height-n-a;r(Math.max(s,Math.min(j,y)))},u=()=>{i.current&&(i.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",c),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",u)}},[t,n,s,a]),{schemaSectionHeight:l,handleResizeStart:o}}const Fr={isOpen:!1,fieldPath:"",existingIf:null,existingBranches:null,availableFields:[],selectedBranchFields:[],autoToggleIf:!1};function Br({selectors:t,setSelectors:n}){const[s,a]=d.useState(Fr),l=d.useCallback((C,N,f,g=!1)=>{const x=C.split("."),b=oe(t,x);let p=[],v=N,w=f,k=[];if(typeof b=="object"&&b!==null){const A=b;p=Object.keys(A).filter(O=>!O.startsWith("_")),!v&&A._if&&(v=A._if),!w&&A._branches&&(w=A._branches),Array.isArray(A._branchFields)&&(k=A._branchFields)}a({isOpen:!0,fieldPath:C,existingIf:v,existingBranches:w,availableFields:p,selectedBranchFields:k,autoToggleIf:g})},[t]),r=d.useCallback((C,N)=>{const f=s.fieldPath.split(".");n(g=>{const x=oe(g,f);if(typeof x=="object"&&x!==null){const b={...x,_if:C,_branches:N};return X(g,f,b)}return g})},[s.fieldPath,n]),i=d.useCallback(()=>{const C=s.fieldPath.split(".");n(N=>{const f=oe(N,C);if(typeof f=="object"&&f!==null){const{_if:g,_branches:x,...b}=f;return X(N,C,b)}return N})},[s.fieldPath,n]),o=d.useCallback(()=>{a(C=>({...C,isOpen:!1}))},[]),c=d.useCallback(C=>{const N=s.fieldPath.split(".");n(f=>{const g=oe(f,N);if(typeof g=="object"&&g!==null){const x=g;if(C){const b={};for(const[p,v]of Object.entries(x))b[p]=v,(p==="_item"||p==="_container"&&!("_item"in x))&&(b._if={selector:"",condition:"exists"});return"_if"in b?X(f,N,b):X(f,N,{_if:{selector:"",condition:"exists"},...x})}else{const{_if:b,...p}=x;return X(f,N,p)}}return f})},[s.fieldPath,n]),u=d.useCallback(C=>{const N=C.split(".");n(f=>{const g=oe(f,N);if(typeof g=="object"&&g!==null){const x=g;if("_if"in x){const{_if:p,_branchFields:v,_branches:w,_activeBranch:k,...A}=x;return X(f,N,A)}else{const p={};for(const[v,w]of Object.entries(x))p[v]=w,(v==="_item"||v==="_container"&&!("_item"in x))&&(p._if={selector:"",condition:"exists"});return"_if"in p?X(f,N,p):X(f,N,{_if:{selector:"",condition:"exists"},...x})}}return f})},[n]),h=d.useCallback((C,N)=>{a(g=>{const x=N?[...g.selectedBranchFields,C]:g.selectedBranchFields.filter(b=>b!==C);return{...g,selectedBranchFields:x}});const f=s.fieldPath.split(".");n(g=>{const x=oe(g,f);if(typeof x=="object"&&x!==null){const b=x,p=Array.isArray(b._branchFields)?b._branchFields:[],v=N?[...p,C]:p.filter(w=>w!==C);if(N&&p.length===0)return X(g,f,{...b,_branchFields:v,_activeBranch:1,_branches:{1:{},2:{}}});if(!N&&v.length===0){const{_branchFields:w,_activeBranch:k,_branches:A,...O}=b;return X(g,f,O)}return X(g,f,{...b,_branchFields:v})}return g})},[s.fieldPath,n]),m=d.useCallback((C,N)=>{n(f=>{const g=(b,p)=>{if(p.length===0)return{...b,_activeBranch:N};const[v,...w]=p;return{...b,[v]:g(b[v],w)}},x=C?C.split("."):[];return g(f,x)})},[n]),y=d.useCallback((C,N,f)=>{n(g=>{const x=(p,v)=>{var A;if(v.length===0){const O=p._branchFields||[],T=p._branches||{1:{},2:{}};if(f){const I=p[N],_={...T};for(const S of Object.keys(_))_[S]={..._[S],[N]:I};return{...p,_branchFields:[...O,N],_branches:_,_activeBranch:p._activeBranch??1}}else{const I=p._activeBranch||1,_=((A=T[String(I)])==null?void 0:A[N])??p[N],S={...T};for(const F of Object.keys(S)){const{[N]:E,...R}=S[F];S[F]=R}const P=O.filter(F=>F!==N);return{...p,_branchFields:P,_branches:S,[N]:_}}}const[w,...k]=v;return{...p,[w]:x(p[w],k)}},b=C?C.split("."):[];return x(g,b)})},[n]),j=d.useCallback(C=>{n(N=>{const f=(x,b)=>{if(b.length===0){const w=x._branches||{},k=x._branchFields||[],A=String(Object.keys(w).length+1),O={};for(const T of k)O[T]="";return{...x,_branches:{...w,[A]:O}}}const[p,...v]=b;return{...x,[p]:f(x[p],v)}},g=C?C.split("."):[];return f(N,g)})},[n]);return{branchEditorState:s,setBranchEditorState:a,handleEditBranching:l,handleSaveBranching:r,handleRemoveBranching:i,handleCloseBranchEditor:o,handleToggleIf:c,handleToggleIfDirect:u,handlePopoverToggleBranchField:h,handleBranchSwitch:m,handleToggleBranchField:y,handleAddBranch:j}}function as(t,n,s){if(n.length===0)return typeof t=="string"?[t]:[String(t??"")];const[a,...l]=n;return Array.isArray(t)?t.flatMap(r=>as(r==null?void 0:r[a],l)):t&&typeof t=="object"?as(t[a],l):[]}function Ds(t,n){const s=n.split(".");if(s.length<2)return null;const a=s[0],l=s.slice(1);let r=t[a];for(let i=0;i<l.length;i++){const o=l[i];if(typeof r!="object"||r===null)return null;const c=r;if(o in c)r=c[o];else if(c._branches&&typeof c._branches=="object"){const u=c._branches,h=c._activeBranch,m=String(h??1),y=u[m];if(y&&o in y)r=y[o];else for(const j of Object.values(u))if(j&&o in j){r=j[o];break}}else return null}if(W(r))return ge(r);if(typeof r=="string")return r;if(typeof r=="object"&&r!==null){const i=r;if(i._item){if(W(i._item))return ge(i._item);if(typeof i._item=="string")return i._item}}return null}function Dr({content:t,selectors:n,contentPopover:s,highlightByIndex:a,scrollToElementByIndex:l,handleArrayBadgeClick:r}){const i=d.useCallback(u=>{const h=u.split("."),m=h[0],y=t[m];if(!Array.isArray(y))return;const j=h.slice(1),C=[];for(let N=0;N<y.length;N++){const f=y[N],g=as(f,j);C.push(...g)}r(u,C)},[t,r]),o=d.useCallback(u=>{if(!s)return;const h=s.fieldName,m=Ds(n,h);a(m,h,u)},[s,n,a]),c=d.useCallback(u=>{if(!s)return;const h=s.fieldName,m=Ds(n,h);l(m,h,u)},[s,n,l]);return{handleSchemaCountClick:i,handleContentPopoverItemHover:o,handleContentPopoverItemClick:c}}function Mr({setSelectors:t}){const n=d.useCallback((l,r)=>{const i=l.split(".");t(o=>{const c=oe(o,i),u=W(c)?{...c,excludeChildren:r}:{selector:typeof c=="string"?c:"",index:null,excludeChildren:r};return X(o,i,u)})},[t]),s=d.useCallback((l,r)=>{const i=l.split(".");t(o=>{const c=oe(o,i),u=W(c)?{...c,extractAttribute:r}:{selector:typeof c=="string"?c:"",index:null,extractAttribute:r};return X(o,i,u)})},[t]),a=d.useCallback((l,r)=>{const i=l.split(".");t(o=>{const c=oe(o,i),u=W(c)?{...c,siblingFilter:r}:{selector:typeof c=="string"?c:"",index:null,siblingFilter:r};return X(o,i,u)})},[t]);return{handleUpdateExcludeChildren:n,handleUpdateExtractAttribute:s,handleUpdateSiblingFilter:a}}function Pr(){const[t,n]=d.useState(new Map),s=d.useCallback(i=>{const o=t.get(i);return!!o&&o.length>0},[t]),a=d.useCallback((i,o)=>{if(!o)return null;const c=wt(o);if(!c||!c.parent)return null;const u=c.siblings[c.capturedIndex];if(!u||!ft(u))return null;const h=u.element,m=Ye(c.parent.element);return n(y=>{const j=new Map(y),C=j.get(i)??[];return j.set(i,[...C,{parentSelector:m,childIndex:c.capturedIndex,childElement:h}]),j}),m},[]),l=d.useCallback(i=>{const o=t.get(i);if(!o||o.length===0)return null;const c=o[o.length-1];if(!document.contains(c.childElement))return n(h=>{const m=new Map(h),y=m.get(i)??[];return m.set(i,y.slice(0,-1)),m}),null;const u=Ye(c.childElement);return n(h=>{const m=new Map(h),y=m.get(i)??[];return m.set(i,y.slice(0,-1)),m}),{selector:u,element:c.childElement}},[t]),r=d.useCallback(i=>{n(o=>{const c=new Map(o);return c.delete(i),c})},[]);return{canNavigateDown:s,navigateUp:a,navigateDown:l,clearHistory:r}}function Rr({selectors:t,handleSelectorCaptured:n,flashHighlight:s}){const{navigateUp:a,navigateDown:l,canNavigateDown:r}=Pr(),i=d.useCallback(u=>{const h=u.split(".");let m=t;for(const C of h){if(typeof m!="object"||m===null)return;m=m[C]}const y=typeof m=="string"?m:m&&typeof m=="object"&&"selector"in m?m.selector:"";if(!y)return;const j=a(u,y);if(j){const C=document.querySelectorAll(j),N=Array.from(C).map(f=>{var g;return((g=f.textContent)==null?void 0:g.trim())??""});n(u,j,N),s(j,u)}},[t,a,n,s]),o=d.useCallback(u=>{const h=l(u);if(h){const m=document.querySelectorAll(h.selector),y=Array.from(m).map(j=>{var C;return((C=j.textContent)==null?void 0:C.trim())??""});n(u,h.selector,y),s(h.selector,u)}},[l,n,s]),c=d.useCallback(u=>r(u),[r]);return{handleNavigateUp:i,handleNavigateDown:o,handleCanNavigateDown:c}}function Vr(){const[t,n]=d.useState("mapped"),[s,a]=d.useState("selectors"),[l,r]=d.useState("schema"),[i,o]=d.useState(ll),[c,u]=d.useState({}),[h,m]=d.useState(!0),[y,j]=d.useState({isOpen:!1,fieldPath:"",attributes:[],currentAttributes:[],position:{x:0,y:0}}),[C,N]=d.useState({isOpen:!1,fieldPath:"",children:[],excludedChildren:[],position:{x:0,y:0}}),[f,g]=d.useState({isOpen:!1,fieldPath:"",currentSelector:"",currentFilter:null,position:{x:0,y:0}}),x=d.useRef(null),b=d.useRef(()=>{});return{mode:t,setMode:n,previewMode:s,setPreviewMode:a,contentViewMode:l,setContentViewMode:r,selectors:i,setSelectors:o,content:c,setContent:u,continuousMode:h,setContinuousMode:m,attributePopover:y,setAttributePopover:j,childFilterPopover:C,setChildFilterPopover:N,siblingFilterPopover:f,setSiblingFilterPopover:g,containerRef:x,handleFieldValueClickRef:b}}function fs(t,n=""){const s=[];for(const[a,l]of Object.entries(t)){const r=n?`${n}.${a}`:a;W(l)||typeof l=="string"?s.push(r):typeof l=="object"&&l!==null&&s.push(...fs(l,r))}return s}function $r(t,n){const s=n.split(".");let a=t;for(const l of s){if(typeof a!="object"||a===null)return;a=a[l]}return a}function ls(t,n){const s=$r(t,n);return W(s)?ge(s)==="":s===""||s===void 0}function Lr(t,n){const s=fs(t),a=s.indexOf(n);for(let l=a+1;l<s.length;l++)if(ls(t,s[l]))return s[l];for(let l=0;l<a;l++)if(ls(t,s[l]))return s[l];return null}function Ms(t){const n=fs(t);return{filled:n.filter(a=>!ls(t,a)).length,total:n.length}}function zr({continuousMode:t,selectors:n,setSelectors:s,setContent:a,handleFieldValueClickRef:l,selectorCaptureFieldPathRef:r,onOpenSiblingFilterPopover:i}){const o=d.useCallback((m,y,j)=>{const C=m.split("."),N=j.length>1?j:j[0]??"",f=xt(y),g=C[C.length-1]==="_if";s(x=>{let b;if(g){const p=oe(x,C),v={selector:y,condition:(p==null?void 0:p.condition)||"exists"};b=X(x,C,v)}else{let p=!1,v=[];const w=C[C.length-1];if(C.length>1){v=C.slice(0,-1);const k=oe(x,v);if(typeof k=="object"&&k!==null){const A=k;if(p=(A._branchFields||[]).includes(w),p){const T=A._activeBranch||1,I=A._branches||{},_=String(T);if(I[_]){const S={...I};S[_]={...S[_],[w]:f};const P={...A,_branches:S};b=X(x,v,P)}else b=X(x,C,f)}else b=X(x,C,f)}else b=X(x,C,f)}else b=X(x,C,f)}if(t&&y!==""){const p=Lr(b,m);p?setTimeout(()=>{r.current===null&&l.current(p,"")},50):K.success("All fields captured!")}return b}),a(x=>X(x,C,N))},[t,s,a,l,r]),c=d.useCallback(m=>o(m,"",[]),[o]),u=d.useCallback((m,y,j)=>{i?i(m,y,j):K.info(`Filter for ${m} - coming soon!`)},[i]),h=d.useCallback(m=>{K.info(`Auto-filter for ${m} - coming soon!`)},[]);return{handleSelectorCaptured:o,handleClearSelectorFromPreview:c,handleSelectorFilterClick:u,handleSelectorFilterDoubleClick:h}}function qr(t,n){const s=[];let a=t;for(;a;){const l=n.find(r=>r.id===a);if(!l)break;s.unshift(l.name),a=l.parentId}return s.join(".")}function kt(t,n=null){const s={},a=t.filter(l=>l.parentId===n).sort((l,r)=>l.order-r.order);for(const l of a){const r=t.some(i=>i.parentId===l.id);l.type==="array"?s[l.name]={_container:"",_item:"",...kt(t,l.id)}:l.type==="parentSelector"?s[l.name]={_container:"",...kt(t,l.id)}:l.type==="object"||r?s[l.name]=kt(t,l.id):s[l.name]=""}return s}function Ur({fields:t,editingField:n,selectors:s,domTreeFieldPath:a,getFieldPath:l,setFields:r,setSelectors:i,setContent:o,setMode:c,baseHandleFieldDialogSubmit:u,handleSelectorCaptured:h,closeDomTreePopover:m}){const y=d.useCallback(N=>{var f;if(N&&n){const g=(f=t.find(b=>b.id===n.id))==null?void 0:f.type,x=N.type;if(g!==x&&(x==="parentSelector"||x==="array")){const p=l(n.id).split(".");i(v=>{const w=JSON.parse(JSON.stringify(v));let k=w;for(let I=0;I<p.length-1;I++)(typeof k[p[I]]!="object"||k[p[I]]===null)&&(k[p[I]]={}),k=k[p[I]];const A=p[p.length-1],O=k[A],T=x==="array"?{_container:"",_item:""}:{_container:""};return typeof O=="object"&&O!==null?k[A]={...T,...O}:k[A]=T,w})}}u(N)},[n,t,l,i,u]),j=d.useCallback(N=>{r(N),i(kt(N,null)),o({}),c("mapped"),K.success("Schema updated from list")},[r,i,o,c]),C=d.useCallback(N=>{if(a)try{const f=document.querySelectorAll(N),g=Array.from(f).map(x=>{var b;return((b=x.textContent)==null?void 0:b.trim())||""});h(a,N,g),m()}catch{}},[a,h,m]);return{handleFieldDialogSubmit:y,handleListModeApply:j,handleApplyCustomSelector:C}}function Tt(t,n){const s=Cr(t);if(!s)return null;if(!t.siblingFilter)return Js(s,n);const a=Ze(s,n);return At(a,t.siblingFilter)[0]??null}function gt(t,n=document){const s={};for(const[a,l]of Object.entries(t))if(!a.startsWith("_")){if(typeof l=="string"){if(!l){s[a]="";continue}const r=Dt(l),i=Tt(r,n);s[a]=i?Et(i,r):""}else if(W(l)){const r=Tt(l,n);s[a]=r?Et(r,l):""}else if(typeof l=="object"&&l!==null){const r=l,i="_container"in r&&r._container,o="_item"in r&&r._item;i&&o?s[a]=on(r,n):i&&!o?s[a]=cn(r,n):s[a]=gt(r,n)}}return s}function cn(t,n){const s=t._container,a=W(s)?ge(s):s;if(!a)return gt(t,n);const l=n.querySelector(a);if(!l)return{};const r=t._if,i=t._branches,o=dt(r)&&Mt(i),c=an(t);if(o){const u=ps(r,l),h=xs(i,u);if(h){const m=ln(c,h.branch);return rs(m,l)}}return rs(c,l)}function on(t,n){const s=t._container,a=t._item,l=W(s)?ge(s):s,r=W(a)?ge(a):a;if(!l)return[];const{baseSelector:i,selectAll:o}=Nr(l),c=Array.from(n.querySelectorAll(i));if(c.length===0)return[];const u=t._if,h=t._branches,m=dt(u)&&Mt(h),y=an(t),j=[];for(const C of c){const N=r?C.querySelectorAll(r):[C],f=Object.keys(y).length===0&&!m;for(const g of N){if(f){j.push(nn(g));continue}let x;if(m){const p=ps(u,g),v=xs(h,p);v?x=ln(y,v.branch):x=y}else x=y;const b=rs(x,g);j.push(b)}}return j}function rs(t,n){const s={};for(const[a,l]of Object.entries(t))if(!a.startsWith("_")){if(typeof l=="string"){if(!l){s[a]="";continue}const r=Dt(l),i=Tt(r,n);s[a]=i?Et(i,r):""}else if(W(l)){const r=Tt(l,n);s[a]=r?Et(r,l):""}else if(typeof l=="object"&&l!==null){const r=l,i="_container"in r&&r._container,o="_item"in r&&r._item;i&&o?s[a]=on(r,n):i&&!o?s[a]=cn(r,n):s[a]=gt(r,n)}}return s}function Hr({selectors:t,captureRoot:n,setContent:s}){const a=d.useRef(""),l=d.useRef(null);d.useEffect(()=>{const r=JSON.stringify(t),i=n??document,o=r!==a.current,c=i!==l.current;if(!o&&!c)return;a.current=r,l.current=i;const u=setTimeout(()=>{try{const h=gt(t,i);s(h)}catch(h){console.error("[CustomCapture] Extraction error:",h)}},100);return()=>clearTimeout(u)},[t,n,s])}function Wr({portalContainer:t,captureRoot:n,isVisible:s,onVisibilityChange:a}){const{mode:l,setMode:r,previewMode:i,setPreviewMode:o,contentViewMode:c,setContentViewMode:u,selectors:h,setSelectors:m,content:y,setContent:j,continuousMode:C,setContinuousMode:N,attributePopover:f,setAttributePopover:g,childFilterPopover:x,setChildFilterPopover:b,siblingFilterPopover:p,setSiblingFilterPopover:v,containerRef:w,handleFieldValueClickRef:k}=Vr(),{schemaSectionHeight:A,handleResizeStart:O}=Or({containerRef:w}),{fields:T,setFields:I,selectedFieldId:_,editingField:S,isFieldDialogOpen:P,handleFieldSelect:F,handleFieldUpdate:E,handleFieldEdit:R,handleFieldDialogSubmit:V,handleFieldDialogCancel:L,handleFieldDelete:H,handleReorder:Q,handleAddChild:se,handleAddSiblingBefore:pe,handleAddSiblingAfter:re}=kr(al),Z=d.useCallback(G=>qr(G,T),[T]),{savedCaptures:M,isPopoverVisible:D,moreActionsOpen:z,importDialogOpen:ee,managerPopoverOpen:ne,advancedSettingsOpen:J,preventDefaultOnInteraction:Ne,contentPopover:_e,setMoreActionsOpen:ue,setPreventDefaultOnInteraction:Ce,handleSave:Fe,handleLoad:Ee,handleRenameCapture:nt,handleDeleteCapture:Le,handleDownload:ze,handleClear:qe,handleClosePopover:Be,handleOpenImportDialog:Ue,handleCloseImportDialog:He,handleOpenManagerPopover:We,handleCloseManagerPopover:ce,handleOpenAdvancedSettings:De,handleCloseAdvancedSettings:Me,handleImportSchema:Pe,handleArrayBadgeClick:at,handleCloseContentPopover:dn}=_r({fields:T,selectors:h,content:y,setFields:I,setSelectors:m,setContent:j}),gs=d.useRef(null),[bt,Pt]=d.useState(void 0),jt="__siblingFilter",un=d.useCallback((G,xe,Re)=>{Pt(void 0),v({isOpen:!0,fieldPath:G,currentSelector:xe,currentFilter:null,position:Re})},[v]),hn=d.useCallback(()=>{var G;(G=k.current)==null||G.call(k,jt,"")},[]),pn=d.useCallback(()=>{v(G=>({...G,isOpen:!1}))},[v]),xn=d.useCallback(()=>{Pt("")},[]),mn=d.useCallback(()=>{},[bt]),fn=d.useCallback(()=>{},[]),gn=d.useCallback(G=>{},[bt]),bn=d.useCallback(G=>{},[bt]),{handleSelectorCaptured:bs,handleClearSelectorFromPreview:jn,handleSelectorFilterClick:yn,handleSelectorFilterDoubleClick:vn}=zr({continuousMode:C,selectors:h,setSelectors:m,setContent:j,handleFieldValueClickRef:k,selectorCaptureFieldPathRef:gs,onOpenSiblingFilterPopover:un}),yt=d.useCallback((G,xe,Re)=>{if(G===jt){Pt(xe);return}bs(G,xe,Re)},[bs,jt]),{branchEditorState:Nn,handleEditBranching:Cn,handleSaveBranching:wn,handleRemoveBranching:kn,handleCloseBranchEditor:Sn,handleToggleIf:An,handleToggleIfDirect:In,handlePopoverToggleBranchField:_n,handleBranchSwitch:En,handleToggleBranchField:Tn,handleAddBranch:On}=Br({selectors:h,setSelectors:m}),{handleUpdateExcludeChildren:Fn,handleUpdateExtractAttribute:Bn,handleUpdateSiblingFilter:js}=Mr({setSelectors:m}),Dn=d.useCallback((G,xe)=>{js(G,xe),v(Re=>({...Re,isOpen:!1}))},[js,v]),[Mn,ys]=d.useState(null),Rt=d.useRef(null),Pn=d.useCallback((G,xe=3e3)=>{Rt.current&&clearTimeout(Rt.current),ys(G),Rt.current=setTimeout(()=>{ys(null)},xe)},[]),{handleConfigClick:Rn,handleFilterChildrenClick:Vn,handleAttributePopoverClose:$n,handleAttributeSelect:Ln,handleChildFilterPopoverClose:zn,handleChildFilterConfirm:qn}=Tr({selectors:h,captureRoot:n,setAttributePopover:g,setChildFilterPopover:b,onUpdateExcludeChildren:Fn,onUpdateExtractAttribute:Bn,onWarning:Pn}),Un=s??D,Hn=d.useCallback(()=>{Be(),a==null||a(!1)},[Be,a]),{isOpen:Wn,fieldPath:lt,domContext:vs,initialSelector:Ns,previousChildIndex:Gn,openPopover:Cs,closePopover:Vt,refreshContext:Kn,setPreviousChildIndex:Jn}=vr({selectors:h}),{handleFieldDialogSubmit:Xn,handleListModeApply:Yn,handleApplyCustomSelector:Qn}=Ur({fields:T,editingField:S,selectors:h,domTreeFieldPath:lt,getFieldPath:Z,setFields:I,setSelectors:m,setContent:j,setMode:r,baseHandleFieldDialogSubmit:V,handleSelectorCaptured:yt,closeDomTreePopover:Vt}),{handleDomTreeSiblingSelect:Zn,handleDomTreeParentSelect:ea,handleDomTreeChildSelect:ta,handleClearSelector:sa,handleAddIndex:na,handleRevertSelector:aa,handleSelectorChange:la,handleTextNodeClick:ra}=wr({domTreeFieldPath:lt,domContext:vs,domTreeInitialSelector:Ns,onSelectorCaptured:yt,refreshDomTreeContext:Kn,closeDomTreePopover:Vt,setDomTreePreviousChildIndex:Jn}),ia=d.useCallback((G,xe)=>Cs(G,xe),[Cs]),{selectorCaptureFieldPath:$t,handleFieldValueClick:ws,handleFieldValueHover:vt,flashHighlight:ca,highlightByIndex:oa,scrollToElementByIndex:da,cancelCapture:ks}=yr({onSelectorCaptured:yt,onSelectorInspect:ia,selectors:h,preventDefaultOnInteraction:Ne,onEscapePressed:()=>N(!1)});gs.current=$t,k.current=ws;const ua=d.useCallback((G,xe)=>{if(xe===null)vt(null,null);else{const Re=`${G}[${xe}]`;vt(Re,lt)}},[vt,lt]),ha=d.useCallback(G=>{ks(),o(G)},[ks]),{handleSchemaCountClick:pa,handleContentPopoverItemHover:xa,handleContentPopoverItemClick:ma}=Dr({content:y,selectors:h,contentPopover:_e,highlightByIndex:oa,scrollToElementByIndex:da,handleArrayBadgeClick:at}),{handleNavigateUp:fa,handleNavigateDown:ga,handleCanNavigateDown:ba}=Rr({selectors:h,handleSelectorCaptured:yt,flashHighlight:ca});return Hr({selectors:h,captureRoot:n,setContent:j}),e.jsxs(e.Fragment,{children:[e.jsx(be,{isVisible:Un,onClose:Hn,title:"Custom Capture V2",shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-520,y:20},initialSize:{width:500,height:630},showPinButton:!1,portalContainer:t,headerActions:e.jsx(il,{mode:l,moreActionsOpen:z,onModeChange:r,onMoreActionsOpenChange:ue,onSave:Fe,onManage:We,onAdvancedSettings:De,onDownload:ze,onClear:qe,portalContainer:t}),children:e.jsx(xr,{mode:l,fields:T,selectedFieldId:_,schemaSectionHeight:A,previewMode:i,contentViewMode:c,selectors:h,content:y,activeFieldPath:$t,continuousMode:C,filledCount:Ms(h).filled,totalCount:Ms(h).total,portalContainer:t,containerRef:w,onFieldSelect:F,onFieldUpdate:E,onFieldEdit:R,onFieldDelete:H,onReorder:Q,onAddChild:se,onAddSiblingBefore:pe,onAddSiblingAfter:re,onListModeApply:Yn,onListModeCancel:()=>r("mapped"),onResizeStart:O,onPreviewModeChange:ha,onFieldValueClick:ws,onFieldValueHover:vt,onClearSelector:jn,onSelectorFilterClick:yn,onSelectorFilterDoubleClick:vn,onConfigClick:Rn,onFilterChildrenClick:Vn,onArrayBadgeClick:at,onNavigateUp:fa,onNavigateDown:ga,canNavigateDown:ba,onEditBranching:Cn,onImportClick:Ue,onSchemaCountClick:pa,onBranchSwitch:En,onToggleBranchField:Tn,onToggleIfDirect:In,onAddBranch:On,onContinuousModeToggle:()=>N(G=>!G),onContentViewModeChange:u,warningMessage:Mn})}),e.jsx(Ul,{portalContainer:t,isFieldDialogOpen:P,editingField:S,onFieldDialogSubmit:Xn,onFieldDialogCancel:L,contentPopover:_e,onCloseContentPopover:dn,onContentPopoverItemHover:xa,onContentPopoverItemClick:ma,importDialogOpen:ee,onImportSchema:Pe,onCloseImportDialog:He,managerPopoverOpen:ne,savedCaptures:M,onLoad:Ee,onRenameCapture:nt,onDeleteCapture:Le,onCloseManagerPopover:ce,advancedSettingsOpen:J,preventDefaultOnInteraction:Ne,continuousMode:C,onPreventDefaultChange:Ce,onContinuousModeChange:N,onCloseAdvancedSettings:Me,isDomTreePopoverOpen:Wn,domTreeFieldPath:lt,domContext:vs,domTreeInitialSelector:Ns,domTreePreviousChildIndex:Gn,onDomTreeParentSelect:ea,onDomTreeSiblingSelect:Zn,onDomTreeChildSelect:ta,onAddIndex:na,onRevertSelector:aa,onClearSelector:sa,onCloseDomTreePopover:Vt,onSelectorChange:la,onApplyCustomSelector:Qn,attributePopover:f,onAttributeSelect:Ln,onAttributePopoverClose:$n,childFilterPopover:x,onChildFilterConfirm:qn,onChildFilterPopoverClose:zn,branchEditorState:Nn,onSaveBranching:wn,onRemoveBranching:kn,onCloseBranchEditor:Sn,onToggleIf:An,onPopoverToggleBranchField:_n,onDomTreeMatchIndexHover:ua,onTextNodeClick:ra,siblingFilterPopover:p,onSiblingFilterApply:Dn,onSiblingFilterClose:pn,onSiblingFilterStartCapture:hn,isSiblingFilterCapturing:$t===jt,siblingFilterCapturedSelector:bt,onSiblingFilterNavigateUp:mn,onSiblingFilterNavigateDown:fn,siblingFilterCanNavigateDown:!1,onSiblingFilterConfigClick:gn,onSiblingFilterFilterChildrenClick:bn,onSiblingFilterClearSelector:xn})]})}function Gr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-anivia-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Anivia",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Anivia",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Anivia.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Freljord 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_freljord_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Freljord"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Invoker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_invoker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Invoker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Caster"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Anivia.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Frostbite"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/40"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Fire an ice shard at target that deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"325/455/650"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage. If they are "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilled"})}),e.jsx("span",{children:e.jsx("span",{children:", the damage Critically"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Strikes."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsx("div",{className:"flex flex-col gap-[2px]",children:e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"455 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[325/",e.jsx("span",{className:"text-white1",children:"455"}),"/650]"]})})]})})]}),e.jsx(pt,{})]})}function Kr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-blitzcrank-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Blitzcrank",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Blitzcrank",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Blitzcrank.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Zaun 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_zaun_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Zaun"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Juggernaut 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_juggernaut_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Juggernaut"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Blitzcrank.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Static Field"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"60/120"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/480/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds and deal "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"56/84/126"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to all enemies within 1 hex."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"480 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"480"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"84 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/315]"]})})]})]})]}),e.jsx(pt,{})]})}function Jr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-neeko-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/neeko",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Neeko",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Neeko",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Neeko.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Ixtal 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_ixtal_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Ixtal"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Arcanist 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_arcanist_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",style:{outlineOffset:"2px"},children:"Arcanist"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Defender 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_defender_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Defender"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Neeko.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Pop Blossom"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"15/65"})]})]})]}),e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Leap at target and gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/475/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds. Slam down after a brief delay, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"80/120/180"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to enemies within two"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hexes and 20% "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilling"})}),e.jsx("span",{children:e.jsx("span",{children:" them for 2"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"seconds."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"475 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"475"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"120 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[80/",e.jsx("span",{className:"text-white1",children:"120"}),"/180]"]})})]})]})]}),e.jsx(pt,{})]})}function Xr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-graves-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/graves",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Graves",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Graves",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Graves.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Bilgewater 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_bilgewater_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Bilgewater"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Gunslinger 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_gunslinger_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Gunslinger"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsxs("div",{className:"leading-snug pb-3",children:[e.jsx("span",{className:"font-medium",children:"Unlock: "}),e.jsx("div",{className:"leading-tight inline",children:e.jsx("span",{children:e.jsx("span",{children:"Twisted Fate with 2 items equipped"})})})]}),e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Attack Fighter"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Graves.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Collateral Damage"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/50"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Attacks fire in a cone on target, dealing "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"45%"})})})}),e.jsx("span",{children:e.jsx("span",{children:" damage to other enemies hit. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Fire an explosive shell at target, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"200/300/450"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage split among enemies in a 1"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hex"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"circle. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"text-tertiary-11",children:e.jsx("span",{children:e.jsx("span",{children:"Partners in Crime:"})})})}),e.jsx("span",{children:e.jsx("span",{children:" When you field Graves and Twisted Fate, both gain bonuses."})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[20/",e.jsx("span",{className:"text-white1",children:"30"}),"/45]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"300"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"270 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"30 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[180/",e.jsx("span",{className:"text-white1",children:"270"}),"/405]"]})})]})]})]}),e.jsx(pt,{})]})}function Yr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-draven-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/draven",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Draven",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["3",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Draven",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Draven.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Noxus 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_noxus_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Noxus"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Quickstriker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_quickstriker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Quickstriker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Attack Marksman"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Draven.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Spinning Axes"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"60/100"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" If Draven has an empowered axe in hand, his next attack will throw it. On takedown, gain an Adoration stack, doubled if Draven or Darius scored the kill. Every 11 Adoration stacks grants "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"1/3/5"})})})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Gold. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Spin an empowered axe that replaces his basic attack and deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"150/225/375"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage and returns to Draven after hitting an"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"enemy."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[10/",e.jsx("span",{className:"text-white1",children:"15"}),"/25]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"225"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"210 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"15 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/350]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsx("div",{className:"leading-tight",children:e.jsx("span",{children:e.jsx("span",{children:"Gold Gained:"})})}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[1/",e.jsx("span",{className:"text-white1",children:"3"}),"/5]"]})})]})]})]}),e.jsx(pt,{})]})}function Qr(){return e.jsxs("div",{"data-test":"tft-cards-v2",children:[e.jsxs("section",{className:"mb-8","data-test":"one-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"1-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(Gr,{}),e.jsx(Kr,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"two-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"2-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(Jr,{}),e.jsx(Xr,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"three-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"3-Cost Champions"}),e.jsx("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:e.jsx(Yr,{})})]})]})}function Zr(){const[t,n]=d.useState(!1),[s,a]=d.useState({x:0,y:0}),[l,r]=d.useState(null),i=d.useCallback(u=>{const h=u.currentTarget.getBoundingClientRect();a({x:h.right+8,y:h.top}),n(!0)},[]),o=d.useCallback(()=>{n(!1)},[]),c=d.useCallback(u=>{r(u),n(!1)},[]);return e.jsxs("div",{className:"siblings-selector-demo p-4","data-test":"siblings-selector-demo",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6","data-test":"demo-header",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground","data-test":"demo-title",children:"Feature: Sibling Selectors"}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white","data-test":"selector-filter-v2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Selector Filter"]})]}),e.jsx("div",{className:"mb-6 p-4 rounded border border-border bg-card","data-test":"morbol-content-section",dangerouslySetInnerHTML:{__html:`<div class="col-md-4 col-lg-5 col-sm-12" style="">These monstrocities are probably my worst kind of landscape mob. It's so bad that I still hate <em>The Aurum Vale</em> even now. Get out of the way of their bad breath AoEs, else you get multiple debuffs. I'm not sure setting the Choco to heals stops them dying from it, and as an Archer or Bard you may find it difficult to keep the<strong style=""> Morbol</strong>'s attention. Keep the Chocobo on DPS: on heals they stand with you, and tank will turn the ugly plant towards it!    <h4 id="morbol-location" style="">Morbol Location</h4>The<strong style=""> Morbol</strong>s are found in <strong style="">Larkscall in the East Shroud</strong>. For any other reason, keep away from here. The challenge is not aggroing multiple<strong style=""> Morbol</strong>s...ew.<hr style="border-top: 1px solid rgb(238, 238, 238) !important;">          <h4 id="region-area-east-shroud-larkscallnearest-aetheryte" style="">Region/Area</h4> <strong style="">East Shroud:</strong> Larkscall<h4 style="">Nearest Aetheryte</h4> <strong style="">East Shroud:</strong> The Hawthorn Hut        </div>`}}),l&&e.jsxs("div",{className:"mb-4 p-3 rounded bg-muted border border-border","data-test":"active-filter-display",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Active Filter: "}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l.type,l.selector&&e.jsxs(e.Fragment,{children:[" → ",e.jsx("code",{className:"px-1 bg-background rounded",children:l.selector})]}),l.textContent&&e.jsxs(e.Fragment,{children:[' | "',l.textContent,'" (',l.textMatchMode??"exact",")"]})]})]}),e.jsxs("div",{className:"space-y-6","data-test":"demo-content",children:[e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-simple",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 1: Simple Siblings"}),e.jsxs("div",{className:"flex gap-2","data-test":"sibling-row-1",children:[e.jsx("span",{className:"px-3 py-1 rounded bg-red-500/20 text-red-400","data-test":"item-a",children:"Item A"}),e.jsx("span",{className:"px-3 py-1 rounded bg-blue-500/20 text-blue-400","data-test":"item-b",children:"Item B (target)"}),e.jsx("span",{className:"px-3 py-1 rounded bg-green-500/20 text-green-400","data-test":"item-c",children:"Item C"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "previous-sibling" to select Item A relative to Item B'})]}),e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-nested",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 2: Text Content Matching"}),e.jsxs("div",{className:"space-y-2","data-test":"sibling-row-2",children:[e.jsx("div",{className:"px-3 py-1 rounded bg-purple-500/20 text-purple-400","data-test":"label-field",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Enter username",className:"px-3 py-1 rounded border border-border bg-background text-foreground w-full","data-test":"input-field"}),e.jsx("div",{className:"px-3 py-1 rounded bg-purple-500/20 text-purple-400","data-test":"label-field",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Enter password",className:"px-3 py-1 rounded border border-border bg-background text-foreground w-full","data-test":"input-field"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "closest-sibling-before" + text "Username" to target specific input'})]}),e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-disambiguation",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 3: Disambiguation with Regex"}),e.jsxs("div",{className:"flex flex-wrap gap-2","data-test":"sibling-row-3",children:[e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save Draft"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save & Continue"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-emerald-500/20 text-emerald-400","data-test":"submit-btn",children:"Submit"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save Final"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "next-sibling" + regex "/^Save &/" to find "Submit" after "Save & Continue"'})]})]}),e.jsx(be,{isVisible:t,onClose:o,title:"Sibling Selector Filter",initialPosition:s,initialSize:{width:380,height:420},resizable:!0,shouldCloseManually:!0,children:e.jsx(Ys,{onApply:c,onCancel:o,currentFilter:l})})]})}const Ht={champions:[{cost:"1",traits:"Freljord Invoker",type:"Magic Caster",ability:{manaCost:"0/40",description:"Fire an ice shard at target that deals 325/455/650 () magic damage. If they are Chilled, the damage Critically Strikes.",activation:[{kind:"Damage:",value:"455 ()",valuePerLevel:"[325/455/650]"}]}},{cost:"1",traits:"Zaun Juggernaut",type:"Magic Tank",ability:{manaCost:"60/120",description:"Gain 400/480/600 () Shield for 4 seconds and deal 56/84/126 () magic damage to all enemies within 1 hex.",activation:[{kind:"Shield:",value:"480 ()",valuePerLevel:"[400/480/600]"},{kind:"Damage:",value:"84 ()",valuePerLevel:"[140/210/315]"}]}},{cost:"2",traits:"Ixtal Arcanist Defender",type:"Magic Tank",ability:{manaCost:"15/65",description:"Leap at target and gain 400/475/600 () Shield for 4 seconds. Slam down after a brief delay, dealing 80/120/180 () magic damage to enemies within two hexes and 20% Chilling them for 2 seconds.",activation:[{kind:"Shield:",value:"475 ()",valuePerLevel:"[400/475/600]"},{kind:"Damage:",value:"120 ()",valuePerLevel:"[80/120/180]"}]}},{cost:"3",traits:"Noxus Quickstriker",type:"Attack Marksman",ability:{manaCost:"60/100",description:"Passive: If Draven has an empowered axe in hand, his next attack will throw it. On takedown, gain an Adoration stack, doubled if Draven or Darius scored the kill. Every 11 Adoration stacks grants 1/3/5 Gold. Active: Spin an empowered axe that replaces his basic attack and deals 150/225/375 () physical damage and returns to Draven after hitting an enemy.",activation:[{kind:"Damage:",value:"225 = 210 () + 15",valuePerLevel:"[140/210/350]"},{kind:"Gold Gained:",value:"",valuePerLevel:"[1/3/5]"}]}}]},ei={champions:{_container:".mb-8",_item:".rounded.text-white1.w-\\[291px\\].flex.flex-col.h-full.bg-bg",cost:".flex.items-end.text-\\[16px\\]",traits:".absolute.text-lg.leading-snug.bottom-\\[6px\\].left-\\[6px\\]",type:".mb-2.bg-bg2.rounded-lg.px-2.py-1.font-montserrat.font-medium.self-start",ability:{manaCost:".pt-\\[1px\\]",description:".leading-tight[0]",activation:{_container:".flex.flex-col.gap-\\[2px\\]",_item:".flex.flex-wrap.justify-between",kind:"span[0]",value:".leading-tight span:nth-child(2)",valuePerLevel:".text-white2"}}}};function is(t,n,s=""){const a=[];if(Array.isArray(t)&&Array.isArray(n)){const o=Math.max(t.length,n.length);for(let c=0;c<o;c++){const u=`${s}[${c}]`;c>=t.length?a.push({path:u,expected:void 0,actual:n[c]}):c>=n.length?a.push({path:u,expected:t[c],actual:void 0}):a.push(...is(t[c],n[c],u))}return a}if(typeof t=="object"&&t!==null&&typeof n=="object"&&n!==null&&!Array.isArray(t)&&!Array.isArray(n)){const o=new Set([...Object.keys(t),...Object.keys(n)]);for(const c of o){const u=s?`${s}.${c}`:c,h=t[c],m=n[c];h===void 0?a.push({path:u,expected:void 0,actual:m}):m===void 0?a.push({path:u,expected:h,actual:void 0}):a.push(...is(h,m,u))}return a}const l=o=>typeof o=="string"?o.replace(/\s+/g," ").trim():o,r=l(t),i=l(n);return r!==i&&a.push({path:s,expected:t,actual:n}),a}function Ps(t=document){console.group("🧪 Selector Test Runner"),console.log("Extracting content using selectors...");const n=gt(ei,t);console.log("Extracted content:",n),console.log("Expected content:",Ht);const s=is(Ht,n);return s.length===0?console.log("✅ All fields match! No differences found."):(console.log(`❌ Found ${s.length} difference(s):`),console.table(s.map(a=>{var l,r;return{Path:a.path,Expected:typeof a.expected=="string"?a.expected.slice(0,50):(l=JSON.stringify(a.expected))==null?void 0:l.slice(0,50),Actual:typeof a.actual=="string"?a.actual.slice(0,50):(r=JSON.stringify(a.actual))==null?void 0:r.slice(0,50)}})),s.forEach((a,l)=>{console.group(`Difference ${l+1}: ${a.path}`),console.log("Expected:",a.expected),console.log("Actual:",a.actual),console.groupEnd()})),console.groupEnd(),{differences:s,extracted:n,expected:Ht}}function ti(t){const n=[];return n.push(`=== Selector Test Comparison ===
`),t.differences.length===0?n.push(`✅ All fields match! No differences found.
`):(n.push(`❌ Found ${t.differences.length} difference(s):
`),t.differences.forEach((s,a)=>{n.push(`--- Difference ${a+1}: ${s.path} ---`),n.push(`Expected: ${JSON.stringify(s.expected,null,2)}`),n.push(`Actual:   ${JSON.stringify(s.actual,null,2)}`),n.push("")})),n.push(`
=== Full Extracted Content ===
`),n.push(JSON.stringify(t.extracted,null,2)),n.join(`
`)}function hi(){const[t,n]=d.useState(!0),s=d.useRef(null),[a,l]=d.useState(null);d.useEffect(()=>{s.current&&l(s.current)},[]),d.useEffect(()=>{const i=setTimeout(()=>{s.current&&Ps(s.current)},500);return()=>clearTimeout(i)},[]);const r=d.useCallback(async()=>{if(!s.current){K.error("Capture target not ready");return}const i=Ps(s.current),o=ti(i);await navigator.clipboard.writeText(o),K.success(`Copied ${i.differences.length} difference(s) to clipboard`)},[]);return e.jsxs("div",{className:"custom-capture-v2-demo-page flex-1 flex flex-col h-full","data-test":"custom-capture-v2-demo-page",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 border-b bg-background border-border","data-test":"demo-header",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Custom Capture V2 Demo"}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"header-actions",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors bg-amber-500 hover:bg-amber-600 text-white","data-test":"copy-comparison-btn",children:[e.jsx(tl,{className:"w-4 h-4"}),"Copy Comparison"]}),e.jsx("button",{onClick:()=>n(!t),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors text-white ${t?"bg-primary":"bg-muted-foreground"}`,"data-test":"toggle-capture-panel",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4"}),"Hide Panel"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"w-4 h-4"}),"Show Panel"]})})]})]}),e.jsx("div",{ref:s,className:"page-content flex-1 flex flex-col overflow-y-auto min-h-0 bg-background","data-test":"capture-target",children:e.jsxs(Fa,{defaultValue:"tft-cards",className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"px-6 pt-4","data-test":"tab-navigation",children:e.jsxs(Ba,{"data-test":"tabs-list",children:[e.jsx(As,{value:"tft-cards","data-test":"tab-tft-cards",children:"TFT Cards"}),e.jsx(As,{value:"siblings","data-test":"tab-siblings",children:"Feature: Siblings"})]})}),e.jsx(Is,{value:"tft-cards",className:"flex-1 p-6","data-test":"tab-content-tft",children:e.jsx(Qr,{})}),e.jsx(Is,{value:"siblings",className:"flex-1 p-6","data-test":"tab-content-siblings",children:e.jsx(Zr,{})})]})}),e.jsx(Wr,{isVisible:t,onVisibilityChange:n,captureRoot:a})]})}export{hi as CustomCaptureV2DemoPage};
