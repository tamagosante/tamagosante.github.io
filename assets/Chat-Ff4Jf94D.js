var H=Object.defineProperty;var W=(n,s,t)=>s in n?H(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var o=(n,s,t)=>W(n,typeof s!="symbol"?s+"":s,t);import{r as m,j as e}from"./react-vendor-Byz07MLO.js";import{aO as Z,b4 as z,y as j,U as C,S as L,h as T,i as O,j as $,k as q,g as Q,aj as R,a as G}from"./index-BEUYSeX_.js";import{g as U,f as X}from"./format-utils-CaqrGWxs.js";import{I as Y}from"./InputWithAudio-B_2eBeGN.js";import{t as I,T as ee}from"./TTSApiClient-BmPFlMLN.js";import{s as D}from"./systemPromptService-CiGRUnu2.js";import{M as te,ad as se,a$ as K,a5 as ae,aa as re,bl as ie}from"./icons-Detj0uxE.js";import"./utils-DjFvUtuq.js";import"./radix-ui-B6r6BEmy.js";import"./ui-utils-BxIQ3qGg.js";class f{constructor(){o(this,"listeners",new Set)}subscribe(s){return this.listeners.add(s),()=>this.listeners.delete(s)}notify(){this.listeners.forEach(s=>s())}describe(){return[]}}class ne extends f{constructor(){super(...arguments);o(this,"messages",[]);o(this,"inputValue","")}describe(){return[{id:"chat.messaging.sendMessage",name:"Send Message",category:"Chat",description:"Send a user message to the chat",params:[{name:"content",type:"string",required:!0,description:"Message content"}],returns:{type:"void"}},{id:"chat.messaging.clearHistory",name:"Clear History",category:"Chat",description:"Clear all chat messages",returns:{type:"void"}},{id:"chat.messaging.getMessages",name:"Get Messages",category:"Chat",description:"Get all chat messages",returns:{type:"ChatMessage[]"}},{id:"chat.messaging.getInputValue",name:"Get Input Value",category:"Chat",description:"Get current input field value",returns:{type:"string"}},{id:"chat.messaging.storeMessage",name:"Store Message",category:"Chat",description:"Store a message in the chat history",params:[{name:"message",type:"ChatMessage",required:!0,description:"Message to store"}],returns:{type:"void"}}]}getMessages(){return this.messages}getInputValue(){return this.inputValue}setInputValue(t){this.inputValue=t,this.notify()}storeMessage(t){this.messages=[...this.messages,t],this.notify()}updateMessage(t,r){this.messages=this.messages.map(c=>c.id===t?r(c):c),this.notify()}createUserMessage(t){return{id:U(),role:"user",content:t.trim(),timestamp:new Date}}createAssistantMessage(t=""){return{id:U(),role:"assistant",content:t,timestamp:new Date}}clearHistory(){this.messages=[],this.inputValue="",this.notify()}setMessages(t){this.messages=t,this.notify()}}class oe extends f{constructor(){super(...arguments);o(this,"isStreaming",!1);o(this,"isLoading",!1);o(this,"abortController",null)}describe(){return[{id:"chat.streaming.startStreaming",name:"Start Streaming",category:"Chat",description:"Start streaming a response",returns:{type:"AbortController"}},{id:"chat.streaming.stopStreaming",name:"Stop Streaming",category:"Chat",description:"Stop the current streaming response",returns:{type:"void"}},{id:"chat.streaming.abortStream",name:"Abort Stream",category:"Chat",description:"Abort the current stream request",returns:{type:"void"}},{id:"chat.streaming.isActive",name:"Is Active",category:"Chat",description:"Check if streaming is currently active",returns:{type:"boolean"}}]}startStreaming(){return this.isLoading=!0,this.isStreaming=!0,this.abortController=new AbortController,this.notify(),this.abortController}stopStreaming(){this.abortController&&this.abortController.abort(),this.isLoading=!1,this.isStreaming=!1,this.abortController=null,this.notify()}abortStream(){this.abortController&&this.abortController.abort()}isActive(){return this.isStreaming}getIsStreaming(){return this.isStreaming}getIsLoading(){return this.isLoading}getAbortController(){return this.abortController}setLoading(t){this.isLoading=t,this.notify()}setStreaming(t){this.isStreaming=t,this.notify()}endStreaming(){this.isLoading=!1,this.isStreaming=!1,this.abortController=null,this.notify()}}const J=Z.map(n=>({value:n,label:n})),_=J[0].value;class ce extends f{constructor(){super(...arguments);o(this,"selectedModel",_);o(this,"ollamaApiInstance",new z(_))}describe(){return[{id:"chat.models.selectModel",name:"Select Model",category:"Chat",description:"Select a language model",params:[{name:"model",type:"LlmModels",required:!0,description:"Model to select"}],returns:{type:"void"}},{id:"chat.models.getSelectedModel",name:"Get Selected Model",category:"Chat",description:"Get the currently selected model",returns:{type:"LlmModels"}},{id:"chat.models.getAvailableModels",name:"Get Available Models",category:"Chat",description:"Get list of available models",returns:{type:"ModelOption[]"}}]}selectModel(t){this.selectedModel=t,this.ollamaApiInstance=new z(t),this.notify()}getSelectedModel(){return this.selectedModel}getAvailableModels(){return J}getOllamaApiInstance(){return this.ollamaApiInstance}}class le extends f{constructor(){super(...arguments);o(this,"systemPrompts",[]);o(this,"selectedSystemPromptId","")}describe(){return[{id:"chat.prompts.selectPrompt",name:"Select Prompt",category:"Chat",description:"Select a system prompt",params:[{name:"promptId",type:"string",required:!0,description:"System prompt ID"}],returns:{type:"void"}},{id:"chat.prompts.loadPrompts",name:"Load Prompts",category:"Chat",description:"Load system prompts from storage",returns:{type:"void"}},{id:"chat.prompts.getPrompts",name:"Get Prompts",category:"Chat",description:"Get all system prompts",returns:{type:"SystemPrompt[]"}},{id:"chat.prompts.getSelectedPrompt",name:"Get Selected Prompt",category:"Chat",description:"Get the currently selected system prompt",returns:{type:"SystemPrompt | null"}}]}loadPrompts(){const t=D.getSystemPrompts(),r=D.getSelectedSystemPromptId();if(this.systemPrompts=t,r)this.selectedSystemPromptId=r;else if(t.length>0){const c=t.find(i=>i.isDefault)??t[0];this.selectedSystemPromptId=c.id}this.notify()}selectPrompt(t){this.selectedSystemPromptId=t,D.setSelectedSystemPrompt(t),this.notify()}getPrompts(){return this.systemPrompts}getSelectedPrompt(){return this.systemPrompts.find(t=>t.id===this.selectedSystemPromptId)||null}getSelectedPromptId(){return this.selectedSystemPromptId}}class de extends f{describe(){return[{id:"chat.speech.synthesize",name:"Synthesize Speech",category:"Chat",description:"Synthesize text to speech",params:[{name:"options",type:"SynthesizeOptions",required:!0,description:"Synthesis options"}],returns:{type:"Promise<TTSResponse>"}},{id:"chat.speech.playAudio",name:"Play Audio",category:"Chat",description:"Play audio blob",params:[{name:"audioBlob",type:"Blob",required:!0,description:"Audio blob to play"},{name:"onEnded",type:"Function",required:!1,description:"Callback when audio ends"},{name:"speed",type:"number",required:!1,description:"Playback speed"}],returns:{type:"void"}},{id:"chat.speech.stopAudio",name:"Stop Audio",category:"Chat",description:"Stop currently playing audio",returns:{type:"void"}}]}async synthesize(s){return await I.synthesize({text:s.text,voice:s.voice,language:s.language})}playAudio(s,t,r){I.playAudio(s,t,r)}stopAudio(){I.stopAudio()}isPlaying(){return I.isPlaying()}updatePlaybackSpeed(s){I.updatePlaybackSpeed(s)}}const B=[1,1.25,1.5,1.75,2,3,4];class me extends f{constructor(){var c,i,g,x;super();o(this,"ttsSpeed",1);o(this,"favoriteSpeedIds",new Set([1,2]));const t=(i=(c=j.get("app"))==null?void 0:c.tts)==null?void 0:i.chatPlaybackSpeed,r=(x=(g=j.get("app"))==null?void 0:g.tts)==null?void 0:x.chatFavoriteSpeedIds;t!==void 0&&(this.ttsSpeed=t),r&&(this.favoriteSpeedIds=new Set(r))}describe(){return[{id:"chat.speed.setSpeed",name:"Set Speed",category:"Chat",description:"Set TTS playback speed",params:[{name:"speed",type:"number",required:!0,description:"Playback speed multiplier"}],returns:{type:"void"}},{id:"chat.speed.getSpeed",name:"Get Speed",category:"Chat",description:"Get current TTS playback speed",returns:{type:"number"}},{id:"chat.speed.toggleFavorite",name:"Toggle Favorite",category:"Chat",description:"Toggle a speed as favorite",params:[{name:"speed",type:"number",required:!0,description:"Speed to toggle"}],returns:{type:"void"}},{id:"chat.speed.getFavorites",name:"Get Favorites",category:"Chat",description:"Get favorite speed IDs",returns:{type:"Set<number>"}}]}setSpeed(t){this.ttsSpeed=t,j.update("app",{tts:{chatPlaybackSpeed:t}}),this.notify()}getSpeed(){return this.ttsSpeed}toggleFavorite(t){const r=new Set(this.favoriteSpeedIds);r.has(t)?r.delete(t):r.add(t),this.favoriteSpeedIds=r,j.update("app",{tts:{chatFavoriteSpeedIds:Array.from(r)}}),this.notify()}getFavorites(){return this.favoriteSpeedIds}getAvailableSpeeds(){return B}}class pe extends f{constructor(){super(...arguments);o(this,"messagesEndRef",null)}describe(){return[{id:"chat.display.scrollToBottom",name:"Scroll To Bottom",category:"Chat",description:"Scroll messages container to bottom",returns:{type:"void"}},{id:"chat.display.scrollToMessage",name:"Scroll To Message",category:"Chat",description:"Scroll to a specific message",params:[{name:"messageId",type:"string",required:!0,description:"Message ID to scroll to"}],returns:{type:"void"}}]}setMessagesEndRef(t){this.messagesEndRef=t}scrollToBottom(){var t,r;(r=(t=this.messagesEndRef)==null?void 0:t.current)==null||r.scrollIntoView({behavior:"smooth"})}scrollToMessage(t){const r=document.getElementById(t);r&&r.scrollIntoView({behavior:"smooth",block:"center"})}}class he extends f{constructor(){super();o(this,"chatConfig",{autoSpeech:!0,ttsVoice:"vits",ttsSpeed:1});o(this,"storageKey","watcher-chat-config");o(this,"storageCheckInterval",null);o(this,"lastStoredValue",null);this.loadConfig()}describe(){return[{id:"chat.config.getConfig",name:"Get Config",category:"Chat",description:"Get chat configuration",returns:{type:"ChatConfig"}},{id:"chat.config.updateConfig",name:"Update Config",category:"Chat",description:"Update chat configuration",params:[{name:"config",type:"Partial<ChatConfig>",required:!0,description:"Config updates"}],returns:{type:"void"}},{id:"chat.config.persistConfig",name:"Persist Config",category:"Chat",description:"Persist configuration to localStorage",returns:{type:"void"}},{id:"chat.config.loadConfig",name:"Load Config",category:"Chat",description:"Load configuration from localStorage",returns:{type:"void"}}]}getConfig(){return this.chatConfig}updateConfig(t){this.chatConfig={...this.chatConfig,...t},this.persistConfig(),this.notify()}persistConfig(){localStorage.setItem(this.storageKey,JSON.stringify(this.chatConfig))}loadConfig(){var c,i;const t=(i=(c=j.get("app"))==null?void 0:c.tts)==null?void 0:i.chatPlaybackSpeed,r=localStorage.getItem(this.storageKey);if(r)try{this.chatConfig=JSON.parse(r)}catch(g){console.error("Failed to parse chat config:",g)}t!==void 0&&(this.chatConfig.ttsSpeed=t),this.notify()}startStorageSync(t){const r=()=>{const c=localStorage.getItem(this.storageKey);if(c&&c!==this.lastStoredValue)try{this.lastStoredValue=c,this.chatConfig=JSON.parse(c),this.notify()}catch(i){t==null||t(i instanceof Error?i:new Error(String(i)))}};window.addEventListener("storage",r),this.storageCheckInterval=window.setInterval(r,500)}stopStorageSync(){this.storageCheckInterval!==null&&(window.clearInterval(this.storageCheckInterval),this.storageCheckInterval=null)}}class ge extends f{constructor(){super();o(this,"messaging");o(this,"streaming");o(this,"models");o(this,"prompts");o(this,"speech");o(this,"speed");o(this,"display");o(this,"config");this.messaging=new ne,this.streaming=new oe,this.models=new ce,this.prompts=new le,this.speech=new de,this.speed=new me,this.display=new pe,this.config=new he}describe(){return[...this.messaging.describe(),...this.streaming.describe(),...this.models.describe(),...this.prompts.describe(),...this.speech.describe(),...this.speed.describe(),...this.display.describe(),...this.config.describe(),{id:"chat.sendMessage",name:"Send Message",category:"Chat",description:"Send a message and handle the complete flow",params:[{name:"content",type:"string",required:!0,description:"Message content"},{name:"options",type:"SendMessageOptions",required:!1,description:"Additional options"}],returns:{type:"Promise<void>"}}]}async sendMessage(t,r){var k,A,F,M,N;const c=t||this.messaging.getInputValue();if(!c.trim()||this.streaming.getIsLoading())return;const i=r==null?void 0:r.logger,g=this.messaging.createUserMessage(c);this.messaging.storeMessage(g),this.messaging.setInputValue("");const x=this.streaming.startStreaming(),S=this.prompts.getSelectedPrompt(),P=S==null?void 0:S.content;i==null||i.info(`Sending message to Ollama: ${g.content}`),i==null||i.info(`Using system prompt: ${(S==null?void 0:S.name)??"None"}`);try{const d=this.messaging.createAssistantMessage();this.messaging.storeMessage(d);const p=[];P&&p.push({role:"system",content:P}),this.messaging.getMessages().slice(0,-1).forEach(a=>{p.push({role:a.role,content:a.content})}),p.push({role:"user",content:g.content});const b=this.models.getOllamaApiInstance(),v=this.models.getSelectedModel(),h=await b.chat(p,v,{stream:!0,signal:x.signal,onStreamChunk:a=>{var y;this.messaging.updateMessage(d.id,V=>({...V,content:V.content+a})),(y=r==null?void 0:r.onStreamChunk)==null||y.call(r,a)}});if(i==null||i.info("Streaming response completed from Ollama API"),!((k=h==null?void 0:h.message)!=null&&k.content))throw i==null||i.error(`No response content received from Ollama API. Response: ${JSON.stringify(h,null,2)}`),new Error("No response content received");(A=r==null?void 0:r.onSuccess)==null||A.call(r)}catch(d){if(d instanceof Error&&d.name==="AbortError")i==null||i.info("Streaming stopped by user");else{i==null||i.error(`Chat API error: ${String(d)}`);const p=this.messaging.createAssistantMessage("Sorry, I encountered an error while processing your message. Please make sure Ollama is running on localhost:11434.");this.messaging.storeMessage(p),(F=r==null?void 0:r.onError)==null||F.call(r,d instanceof Error?d:new Error(String(d)))}}finally{if(this.streaming.endStreaming(),this.config.getConfig().autoSpeech){const d=this.messaging.getMessages(),p=d[d.length-1];if(p&&p.role==="assistant"&&p.content){const E=((N=(M=j.get("app"))==null?void 0:M.tts)==null?void 0:N.language)??"en",b=this.config.getConfig(),v=this.speed.getSpeed();try{const h=await this.speech.synthesize({text:p.content,voice:b.ttsVoice,language:E});h.success&&h.audioBlob&&(this.speech.playAudio(h.audioBlob,void 0,v),i==null||i.info(`Auto-speaking assistant response with voice: ${b.ttsVoice} at ${v}x speed`))}catch(h){i==null||i.error(`Failed to auto-speak response: ${h}`)}}}}}initialize(){this.prompts.loadPrompts()}dispose(){this.config.stopStorageSync(),this.streaming.stopStreaming(),this.speech.stopAudio()}}const u=new ge;function ue(){const[,n]=m.useReducer(s=>s+1,0);return m.useEffect(()=>{const s=[u.messaging.subscribe(n),u.streaming.subscribe(n),u.models.subscribe(n),u.prompts.subscribe(n),u.speech.subscribe(n),u.speed.subscribe(n),u.display.subscribe(n),u.config.subscribe(n)];return u.initialize(),()=>{s.forEach(t=>t()),u.dispose()}},[]),u}function Ie({logger:n}){const s=ue(),t=m.useRef(null),r=m.useRef(null),c=s.messaging.getMessages(),i=s.messaging.getInputValue(),g=s.streaming.getIsLoading(),x=s.streaming.getIsStreaming(),S=s.models.getSelectedModel(),P=s.models.getAvailableModels(),k=s.prompts.getPrompts(),A=s.prompts.getSelectedPromptId(),F=s.config.getConfig(),M=s.speed.getFavorites();m.useEffect(()=>{s.config.startStorageSync(a=>{n.error(`Failed to parse chat config from storage: ${a}`)})},[s,n]);const N=m.useCallback(()=>{var a;(a=t.current)==null||a.scrollIntoView({behavior:"smooth"})},[]);m.useEffect(()=>{N()},[c,N]),m.useEffect(()=>{var a;(a=r.current)==null||a.focus()},[]);const d=m.useCallback(async()=>{await s.sendMessage(i,{logger:n})},[s,i,n]),p=m.useCallback(()=>{s.streaming.stopStreaming(),n.info("Stopping stream...")},[s,n]),E=m.useCallback(a=>{s.models.selectModel(a),n.info(`Switched to model: ${a}`)},[s,n]),b=m.useCallback(a=>{s.prompts.selectPrompt(a);const y=s.prompts.getSelectedPrompt();n.info(`Switched to system prompt: ${y==null?void 0:y.name}`)},[s,n]),v=m.useCallback(a=>{s.speed.toggleFavorite(a)},[s]),h=m.useCallback(a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),d())},[d]);return e.jsxs("div",{className:"chat-container flex flex-col h-full max-h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"chat-header-controls flex items-center justify-between p-4 border-b gap-4",children:[e.jsxs("div",{className:"chat-header-left flex items-center gap-6",children:[e.jsxs("div",{className:"system-prompt-selector-wrapper flex items-center gap-2",children:[e.jsx(te,{className:`system-prompt-icon ${C.sm} text-muted-foreground`}),e.jsxs(L,{value:A,onValueChange:b,children:[e.jsx(T,{className:"system-prompt-selector w-64",children:e.jsx(O,{placeholder:"Select system prompt"})}),e.jsx($,{className:"system-prompt-options",children:k.map(a=>e.jsx(q,{value:a.id,className:"system-prompt-option",children:e.jsxs("div",{className:"system-prompt-details flex flex-col",children:[e.jsx("span",{className:"system-prompt-name font-medium",children:a.name}),e.jsx("span",{className:"system-prompt-description text-xs text-muted-foreground",children:a.description})]})},a.id))})]})]}),e.jsxs(L,{value:S,onValueChange:E,children:[e.jsx(T,{className:"model-selector w-48",children:e.jsx(O,{placeholder:"Select model"})}),e.jsx($,{className:"model-options",children:P.map(a=>e.jsx(q,{value:a.value,className:"model-option",children:e.jsxs("div",{className:"model-details flex flex-col",children:[e.jsx("span",{className:"model-name font-medium",children:a.label}),a.description&&e.jsx("span",{className:"model-description text-xs text-muted-foreground",children:a.description})]})},a.value))})]})]}),e.jsx(Q,{storageKey:"chat-config",initialConfig:F,prefix:"watcher-",children:(a,y,V)=>e.jsx("div",{className:"chat-settings-wrapper flex items-center gap-2",children:e.jsx(V,{icon:e.jsx(se,{className:`${C.sm}`}),title:"Chat Settings",variant:"ghost",size:"icon",contentClassName:"w-64",children:e.jsxs("div",{className:"chat-settings-content space-y-4","data-test":"chat-settings",children:[e.jsxs("div",{className:"auto-speech-setting flex items-center justify-between","data-test":"auto-speech-setting",children:[e.jsx("label",{className:"text-sm font-medium cursor-pointer",children:"Auto-Speech"}),e.jsx(R,{checked:a.autoSpeech,onCheckedChange:l=>y({...a,autoSpeech:l}),"data-test":"auto-speech-toggle"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically speak assistant responses using text-to-speech"}),e.jsx("div",{className:"border-t border-gray-200 pt-3 mt-3 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between","data-test":"tts-language-control",children:[e.jsx("label",{className:"text-sm font-medium",children:"TTS Language"}),e.jsx(ee,{})]})}),a.autoSpeech&&e.jsx("div",{className:"border-t border-gray-200 pt-3 mt-3 space-y-3",children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium block",children:["Playback Speed: ",e.jsxs("span",{className:"font-bold text-blue-600",children:[a.ttsSpeed,"x"]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-3",children:B.filter(l=>M.has(l)).map(l=>e.jsxs(G,{onClick:()=>{y({...a,ttsSpeed:l}),s.speech.isPlaying()&&s.speech.updatePlaybackSpeed(l)},variant:a.ttsSpeed===l?"default":"outline",size:"sm","data-test":"speed-quick-btn",className:"min-w-fit",children:[l,"x"]},l))}),e.jsxs(L,{value:String(a.ttsSpeed),onValueChange:l=>{const w=parseFloat(l);y({...a,ttsSpeed:w}),s.speech.isPlaying()&&s.speech.updatePlaybackSpeed(w)},children:[e.jsx(T,{className:"w-full","data-test":"tts-speed-select",children:e.jsx(O,{placeholder:"Select speed"})}),e.jsx($,{children:B.map(l=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{value:String(l),className:"flex-1",children:[l,"x ",l===1?"(Normal)":l>=2&&l<=1.75?"(Fast)":l===3?"(Very Fast)":l===4?"(Ultra Fast)":""]}),e.jsx("div",{className:"pointer-events-auto pr-2 cursor-pointer",onPointerDown:w=>{w.stopPropagation(),w.preventDefault(),v(l)},children:e.jsx(R,{checked:M.has(l),"data-test":"speed-checkbox"})})]},l))})]})]})})]})})})})]}),e.jsxs("div",{className:"messages-container flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[c.length===0?e.jsxs("div",{className:"empty-chat-state text-center text-muted-foreground py-8",children:[e.jsx(K,{className:"empty-chat-icon w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"empty-chat-title",children:"Start a conversation with Ollama"}),e.jsx("p",{className:"empty-chat-subtitle text-sm mt-1",children:"Make sure Ollama is running on localhost:11434"})]}):c.map(a=>e.jsxs("div",{className:`message-wrapper flex gap-3 ${a.role==="user"?"message-user justify-end":"message-assistant justify-start"}`,children:[a.role==="assistant"&&e.jsx("div",{className:"assistant-avatar flex-shrink-0",children:e.jsx("div",{className:"assistant-avatar-circle w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(K,{className:`assistant-avatar-icon ${C.sm} text-primary`})})}),e.jsx("div",{className:`message-bubble max-w-[70%] rounded-lg px-4 py-2 ${a.role==="user"?"user-message-bubble bg-primary text-primary-foreground":"assistant-message-bubble bg-muted"}`,children:a.role==="assistant"&&a.content===""?e.jsxs("div",{className:"thinking-indicator flex items-center space-x-1",children:[e.jsx("div",{className:"thinking-dot-1 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce"}),e.jsx("div",{className:"thinking-dot-2 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"thinking-dot-3 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"thinking-text text-sm text-muted-foreground ml-2",children:"Thinking..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"message-content whitespace-pre-wrap text-sm",children:a.content}),e.jsx("p",{className:"message-timestamp text-xs mt-1 opacity-70",children:X(a.timestamp)})]})}),a.role==="user"&&e.jsx("div",{className:"user-avatar flex-shrink-0",children:e.jsx("div",{className:"user-avatar-circle w-8 h-8 rounded-full bg-primary flex items-center justify-center",children:e.jsx(ae,{className:`user-avatar-icon ${C.sm} text-primary-foreground`})})})]},a.id)),e.jsx("div",{ref:t,className:"messages-end-anchor"})]}),e.jsx("div",{className:"chat-input-area border-t p-4",children:e.jsxs("div",{className:"chat-input-wrapper flex gap-2",children:[e.jsx(Y,{ref:r,value:i,onChange:a=>s.messaging.setInputValue(a),onKeyPress:h,placeholder:"Type your message...",disabled:g,className:"flex-1"}),x?e.jsx(G,{onClick:p,size:"icon",variant:"destructive",className:"stop-button",children:e.jsx(re,{className:`stop-icon ${C.sm}`})}):e.jsx(G,{onClick:d,disabled:!i.trim()||g,size:"icon",className:"send-button",children:e.jsx(ie,{className:`send-icon ${C.sm}`})})]})})]})}export{Ie as Chat};
