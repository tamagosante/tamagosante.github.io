const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TodoTable-BljbBDre.js","assets/react-vendor-Byz07MLO.js","assets/table-Cr_drED-.js","assets/index-BEUYSeX_.js","assets/utils-DjFvUtuq.js","assets/radix-ui-B6r6BEmy.js","assets/ui-utils-BxIQ3qGg.js","assets/icons-Detj0uxE.js","assets/index-D__wy4cR.css"])))=>i.map(i=>d[i]);
import{z as ce,x as M,bI as Ee,at as P,C as Fe,V as ee,t as Ye,a as F,b0 as Xe,bJ as Ce,au as G,bK as qe,B as E,E as ea,b7 as aa,bL as ta,y as W,bM as be,bN as sa,bO as na,I as de,L as ae,S as J,h as Y,i as X,j as q,k as Q,l as Oe,aD as ra,aj as Ae,bP as Le,bQ as ia,bR as Re,bS as Be,bT as $e,bU as _e,bV as ze,bW as te,bX as he,bY as Ne,m as la,n as oa,o as Pe,p as ye,g as ca,bZ as da,aJ as ua}from"./index-BEUYSeX_.js";import{r as f,j as e}from"./react-vendor-Byz07MLO.js";import{D as pa}from"./DemoLayout-DGI9K2r9.js";import{a as ma,b as ha,u as ga}from"./react-hooks-CNdHs55p.js";import{bh as fa,aU as xa,T as Ke,Y as ba,ao as va,ab as Me,X as K,a2 as ue,a3 as ja,b1 as ka,y as Ca,D as Na,U as Pa,ai as oe,S as ya,br as wa,d as ge}from"./icons-Detj0uxE.js";import{C as Sa,s as Ia}from"./radix-ui-B6r6BEmy.js";import{t as _}from"./utils-DjFvUtuq.js";import{S as Da}from"./SFSService-cYgO5WK9.js";import"./ui-utils-BxIQ3qGg.js";import"./Breadcrumbs-D-EeNrHD.js";import"./DragDropManager-CacIWg_Z.js";const Ta=[{value:G.LOW,label:"Low",variant:"secondary",className:"bg-gray-100 text-gray-800 border-gray-200"},{value:G.MEDIUM,label:"Medium",variant:"secondary",className:"bg-blue-100 text-blue-800 border-blue-200"},{value:G.HIGH,label:"High",variant:"secondary",className:"bg-orange-100 text-orange-800 border-orange-200"},{value:G.URGENT,label:"Urgent",variant:"destructive",className:"bg-red-100 text-red-800 border-red-200"}],Ea=a=>{var l,n,o;return((o=(n=(l=a.app)==null?void 0:l.claude)==null?void 0:n.data)==null?void 0:o.projects)??[]},Fa=a=>{var l,n,o;return((o=(n=(l=a.app)==null?void 0:l.claude)==null?void 0:n.ui)==null?void 0:o.loadingProjects)??!1};function Oa({todo:a,isDragging:l,kanbanManager:n,onDelete:o,onUpdate:t,isDetailsPanelOpen:r,onOpenDetailsPanel:u,onCloseDetailsPanel:i}){var H,se,ne,re,ie;const h=ma(n,a.id.value,{todoId:a.id.value}),x=ce(Ea),y=ce(Fa),S=JSON.stringify(((H=a.customProps)==null?void 0:H.sessionIds)??[]),v=f.useMemo(()=>{var b;return((b=a.customProps)==null?void 0:b.sessionIds)??[]},[S]),k=f.useCallback(b=>{const w=[];if(b.description?(w.push(`## ${b.title}`),w.push(""),w.push(b.description)):w.push(`${b.title}`),b.dueDate){const A=new Date(b.dueDate.value);w.push(`- Due: ${A.toLocaleDateString()}`)}return b.tags.length>0&&w.push(`- Tags: ${b.tags.join(", ")}`),b.subtasks.length>0&&(w.push(""),w.push("**Subtasks:**"),b.subtasks.forEach(A=>{const z=A.isCompleted?"[x]":"[ ]";w.push(`${z} ${A.title}`)})),w.push(`
`),w.push("I permit and approve all file changes in this session."),w.join(`
`)},[]),N=f.useCallback(async b=>{try{await M.updateTodo(a.id,{priority:b}),t==null||t()}catch(w){console.error("Failed to update priority:",w)}},[a.id,t]),s=f.useCallback(async b=>{try{await M.updateTodo(a.id,{category:b}),t==null||t()}catch(w){console.error("Failed to update category:",w)}},[a.id,a.title,a.category,t]),d=f.useCallback(async b=>{try{await M.updateTodo(a.id,{customProps:{claudeProjectPath:b}}),t==null||t()}catch(w){console.error("Failed to update Claude project:",w)}},[a.id,t]),c=f.useCallback(async(b,w)=>{try{await Ee.claude.linkSessionToTodo(a.id,b),await M.updateTodo(a.id,{status:P.DOING,description:w}),t==null||t()}catch(A){console.error("Failed to update todo status:",A)}},[a.id,t]),m=f.useMemo(()=>x.map(b=>({value:b.path,label:b.name,variant:"outline",className:"bg-purple-50 text-purple-800 border-purple-200"})),[x]),T=f.useMemo(()=>[{value:"__no_project__",label:"No Project",variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200"},...m],[m]),p=f.useCallback(b=>{if(!b)return null;const w=new Date(b.value),A=new Date,z=Math.ceil((w.getTime()-A.getTime())/(1e3*60*60*24));return z<0?e.jsx("span",{className:"text-red-500 text-xs",children:"Overdue"}):z===0?e.jsx("span",{className:"text-orange-500 text-xs",children:"Today"}):z===1?e.jsx("span",{className:"text-blue-500 text-xs",children:"Tomorrow"}):e.jsx("span",{className:"text-gray-500 text-xs",children:w.toLocaleDateString()})},[]),g=f.useCallback(b=>{console.log("Todo: ",a),b.stopPropagation(),u()},[u]),C=f.useCallback(b=>{var A;b.stopPropagation(),(((A=a.customProps)==null?void 0:A.sessionIds)??[]).forEach(z=>{window.open(`/claude/${z}`,"_blank")})},[(se=a.customProps)==null?void 0:se.sessionIds]),L=f.useCallback(b=>{b.stopPropagation(),o(a.id)},[a.id,o]);return e.jsxs(Fe,{ref:h,"data-test":"kanban-card",className:ee("kanban-card p-3 cursor-move hover:shadow-md transition-all bg-white dark:bg-gray-800 relative group",l&&"opacity-50"),children:[e.jsx(Ye,{"data-test":"kanban-card-session-activity",sessionIds:v,className:"absolute top-1 left-1",showCount:!0}),e.jsxs("div",{className:"action-buttons absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity","data-test":"kanban-card-action-buttons",children:[((ne=a.customProps)==null?void 0:ne.sessionIds)&&a.customProps.sessionIds.length>0&&e.jsx(F,{"data-test":"kanban-card-session-link-button",variant:"ghost",size:"icon",onClick:C,className:"session-link-button h-6 w-6 hover:bg-transparent",title:`Open ${a.customProps.sessionIds.length} Claude session${a.customProps.sessionIds.length>1?"s":""} in new tab${a.customProps.sessionIds.length>1?"s":""}`,children:e.jsx(fa,{className:"h-3 w-3 text-black hover:text-blue-500 transition-colors","data-test":"kanban-card-external-link-icon"})}),e.jsx("div",{onClick:b=>b.stopPropagation(),"data-test":"kanban-card-create-session-wrapper",children:e.jsx(Xe,{"data-test":"kanban-card-create-session-button",variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-transparent",icon:e.jsx(xa,{className:"h-3 w-3 text-black hover:text-purple-500 transition-colors","data-test":"kanban-card-wand-icon"}),initialMessage:k(a),buttonTitle:"Ask Claude for help with this task",projectPath:(re=a.customProps)!=null&&re.claudeProjectPath&&a.customProps.claudeProjectPath!=="__no_project__"?a.customProps.claudeProjectPath:void 0,onSessionCreated:c})}),e.jsx(F,{"data-test":"kanban-card-delete-button",variant:"ghost",size:"icon",onClick:L,className:"delete-button h-6 w-6 hover:bg-transparent",children:e.jsx(Ke,{className:"h-3 w-3 text-black hover:text-red-500 transition-colors","data-test":"kanban-card-delete-icon"})})]}),e.jsxs("div",{className:"drag-handle flex items-start gap-2","data-test":"kanban-card-drag-handle",children:[e.jsx(ba,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1","data-test":"kanban-card-grip-icon"}),e.jsxs("div",{className:"card-content flex-1 space-y-2","data-test":"kanban-card-content",children:[e.jsx("h4",{"data-test":"kanban-card-title",className:"card-title font-medium text-sm line-clamp-2 pr-6 cursor-pointer hover:underline",onClick:g,children:a.title||"Untitled"}),e.jsxs("div",{className:"card-metadata flex flex-wrap gap-1","data-test":"kanban-card-metadata",children:[e.jsx(Ce,{"data-test":"kanban-card-priority-selector",value:a.priority,options:Ta,onChange:N,placeholder:"Search priorities..."}),e.jsx(qe,{"data-test":"kanban-card-category-selector",value:a.category,onChange:s,placeholder:"Search categories..."}),!y&&T.length>1&&e.jsx(Ce,{"data-test":"kanban-card-project-selector",value:((ie=a.customProps)==null?void 0:ie.claudeProjectPath)??"__no_project__",options:T,onChange:d,placeholder:"Search projects..."})]}),a.dueDate&&e.jsxs("div",{className:"card-due-date flex items-center gap-1","data-test":"kanban-card-due-date",children:[e.jsx(va,{className:"w-3 h-3 text-gray-400","data-test":"kanban-card-clock-icon"}),p(a.dueDate)]}),a.subtasks.length>0&&e.jsxs("div",{className:"card-subtasks flex items-center gap-1 text-xs text-gray-600","data-test":"kanban-card-subtasks",children:[e.jsx(Me,{className:"w-3 h-3","data-test":"kanban-card-alert-icon"}),e.jsxs("span",{children:[a.subtasks.filter(b=>b.isCompleted).length,"/",a.subtasks.length," subtasks"]})]}),a.tags.length>0&&e.jsxs("div",{className:"card-tags flex flex-wrap gap-1","data-test":"kanban-card-tags",children:[a.tags.slice(0,3).map(b=>e.jsx(E,{variant:"outline",className:"text-xs","data-test":"kanban-card-tag",children:b},b)),a.tags.length>3&&e.jsxs(E,{variant:"outline",className:"text-xs","data-test":"kanban-card-tags-overflow",children:["+",a.tags.length-3]})]})]})]})]})}function Aa({column:a,todos:l,isDropTarget:n,draggedTodoId:o,currentDropZone:t,insertionIndex:r,kanbanManager:u,isAddingTodo:i,newTodoTitle:h,onDeleteTodo:x,onAddClick:y,onCancelAdd:S,onTodoTitleChange:v,onKeyDown:k,onTodoUpdate:N,openDetailsPanelTodoId:s,onOpenDetailsPanel:d,onCloseDetailsPanel:c}){const m=f.useRef(null),T=ha(u,`${a.id}-zone`,void 0,{status:a.id});return f.useEffect(()=>{var p;if(i){const g=(p=m.current)==null?void 0:p.getTextArea();g&&g.focus()}},[i]),e.jsxs("div",{ref:T,"data-test":"kanban-column",className:"kanban-column flex-shrink-0 w-80 h-full flex flex-col min-h-0",children:[e.jsx("div",{className:ee("column-footer rounded-b-lg px-4 py-2 border-t-2 flex-shrink-0",a.className),"data-test":"kanban-column-footer",children:i?e.jsxs("div",{className:"add-todo-input flex gap-2","data-test":"kanban-column-add-todo-input",children:[e.jsx(ea,{ref:m,"data-test":"kanban-column-new-todo-textarea",value:h,onChange:p=>v(p.target.value),placeholder:"Enter task title...",onKeyDown:p=>k(p,a.id),className:"flex-1 text-sm bg-white resize-none min-h-[32px]",rows:1}),e.jsx(F,{"data-test":"kanban-column-cancel-add-button",size:"sm",variant:"ghost",onClick:S,className:"h-8 w-8 p-0",children:e.jsx(K,{className:"h-4 w-4","data-test":"kanban-column-cancel-icon"})})]}):e.jsxs(F,{"data-test":"kanban-column-add-button",variant:"ghost",size:"sm",onClick:()=>y(a.id),className:"add-todo-button w-full h-8 text-sm",children:[e.jsx(ue,{className:"h-4 w-4 mr-1","data-test":"kanban-column-plus-icon"}),"Add task"]})}),e.jsx("div",{className:ee("column-header rounded-t-lg px-4 py-3 border-b-2 flex-shrink-0",a.className),"data-test":"kanban-column-header",children:e.jsxs("div",{className:"flex items-center justify-between","data-test":"kanban-column-header-content",children:[e.jsx("h3",{className:"column-title font-semibold text-sm","data-test":"kanban-column-title",children:a.title}),e.jsx(E,{variant:"secondary",className:"count-badge","data-test":"kanban-column-count-badge",children:l.length})]})}),e.jsxs("div",{"data-test":"kanban-column-content",className:ee("column-content flex-1 min-h-0 p-2 space-y-2 border overflow-y-auto transition-colors",a.className,n&&"ring-2 ring-primary ring-offset-2"),children:[l.map((p,g)=>{const C=t===a.id&&r===g,L=t===a.id&&r===g+1&&g===l.length-1;return e.jsxs("div",{"data-test":"kanban-column-card-wrapper",children:[C&&e.jsx("div",{className:"insertion-indicator h-1 bg-primary rounded mb-2","data-test":"kanban-column-insertion-indicator-before"}),e.jsx(Oa,{todo:p,isDragging:o===p.id.value,kanbanManager:u,onDelete:x,onUpdate:N,isDetailsPanelOpen:s===p.id.value,onOpenDetailsPanel:()=>d(p.id.value),onCloseDetailsPanel:c}),L&&e.jsx("div",{className:"insertion-indicator h-1 bg-primary rounded mt-2","data-test":"kanban-column-insertion-indicator-after"})]},p.id.value)}),l.length===0&&e.jsx("div",{className:"empty-column-state flex items-center justify-center h-32 text-gray-400 text-sm","data-test":"kanban-column-empty-state",children:"Drop tasks here"})]})]})}function La({todo:a,isOpen:l,onClose:n,onUpdate:o,currentCardIndex:t,totalCardsInColumn:r,onNavigatePrevious:u,onNavigateNext:i}){return e.jsx(aa,{open:l,onOpenChange:h=>!h&&n(),children:e.jsxs(Sa,{"data-test":"kanban-card-details-content",className:ee("fixed inset-y-0 right-0 z-50 h-full w-3/4 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-[900px]","flex flex-col overflow-hidden"),children:[e.jsxs(Ia,{"data-test":"kanban-card-details-close-button",className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsx(ta,{todo:a,isOpen:l,onClose:n,onUpdate:o,currentCardIndex:t,totalCardsInColumn:r,onNavigatePrevious:u,onNavigateNext:i})]})})}const We={all:{id:"all",name:"All",description:"Show all todos across all statuses",statuses:[],visibleColumns:[P.FREEZER,P.BACKLOG,P.SELECTED,P.DOING,P.DONE,P.ARCHIVE]},planning:{id:"planning",name:"Planning",description:"Show todos in planning stages (Freezer, Backlog, Selected)",statuses:[P.FREEZER,P.BACKLOG,P.SELECTED],visibleColumns:[P.FREEZER,P.BACKLOG,P.SELECTED]},doing:{id:"doing",name:"Doing",description:"Show todos in doing stages (Selected, Doing)",statuses:[P.SELECTED,P.DOING],visibleColumns:[P.SELECTED,P.DOING]},done:{id:"done",name:"Done",description:"Show completed and archived todos",statuses:[P.DONE,P.ARCHIVE],visibleColumns:[P.DONE,P.ARCHIVE]}};function He(a){return a==="all"||a==="planning"||a==="doing"||a==="done"}function Ra(a){return We[a]}function Ba(a,l){const n=We[l];return n?{...a,statuses:n.statuses,priorities:[],categories:[],visibleColumns:n.visibleColumns}:a}function $a(a){return`Filter ${a+1}`}const Z="all";function _a(a){return{id:Date.now().toString(),name:a,filters:{searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:[],priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:[]}}}function za(a,l,n,o){const t={};let r=null;if(He(a)){const u=Ra(a);u&&(r={searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:u.statuses,priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:u.visibleColumns})}else{const u=l.find(i=>i.id===a);u&&(r=u.filters)}if(r){r.priorities.length===1&&(t.priority=r.priorities[0]),r.categories.length===1&&(t.category=r.categories[0]);const u=r.claudeProjectPaths||(r.claudeProjectPath?[r.claudeProjectPath]:[]);u.length===1&&(t.claudeProjectPath=u[0])}if(o!==Z){const u=n.find(i=>i.id===o);if(u){const i=u.filters;i.priorities.length===1&&(t.priority=i.priorities[0]),i.categories.length===1&&(t.category=i.categories[0]);const h=i.claudeProjectPaths||(i.claudeProjectPath?[i.claudeProjectPath]:[]);h.length===1&&(t.claudeProjectPath=h[0])}}return t}const Ka=[{id:P.FREEZER,title:"Freezer",className:"bg-blue-50 dark:bg-blue-950"},{id:P.BACKLOG,title:"Backlog",className:"bg-gray-50 dark:bg-gray-900"},{id:P.SELECTED,title:"Selected",className:"bg-purple-50 dark:bg-purple-950"},{id:P.DOING,title:"Doing",className:"bg-yellow-50 dark:bg-yellow-950"},{id:P.DONE,title:"Done",className:"bg-green-50 dark:bg-green-950"},{id:P.ARCHIVE,title:"Archive",className:"bg-slate-50 dark:bg-slate-900"}];function Ma({todos:a,onTodosUpdate:l,onTodoStatusUpdate:n,visibleColumns:o,activePresetId:t,customPresets:r,spaces:u,activeSpaceId:i}){const[h,x]=f.useState(null),[y,S]=f.useState(null),[v,k]=f.useState(null),[N,s]=f.useState(null),[d,c]=f.useState(""),[m,T]=f.useState(null),p=f.useMemo(()=>({onDragStart:j=>{var D;const I=(D=j.item.data)==null?void 0:D.todoId;x(I)},onDragMove:j=>{var D,R;const I=((R=(D=j.dropZone)==null?void 0:D.data)==null?void 0:R.status)||null;S(I),k(j.sortIndex)},onDrop:async j=>{var je,ke;const I=(je=j.item.data)==null?void 0:je.todoId,D=(ke=j.dropZone.data)==null?void 0:ke.status,R=j.sortIndex??0;if(!I||!D)return;const B=a.find(O=>O.id.value===I);if(!B)return;const $=a.filter(O=>O.status===D),V=B.status===D,U=V?$.findIndex(O=>O.id.value===I):-1;let le=R;V&&U!==-1&&U<R&&(le=R-1);const pe=a.filter(O=>O.status===D&&O.id.value!==I).sort((O,me)=>(O.sortOrder??0)-(me.sortOrder??0)),Ue=V?le:R;pe.splice(Ue,0,{...B,status:D,sortOrder:0});try{for(let O=0;O<pe.length;O++){const me=pe[O],Je=O;await M.updateTodo(me.id,{status:D,sortOrder:Je})}l()}catch(O){console.error("Failed to update todo:",O)}},onDragEnd:()=>{x(null),S(null),k(null)}}),[a,l]),{manager:g}=ga({snap:{enabled:!1,threshold:10},sort:{enabled:!0,orientation:"vertical",threshold:.5},dragThreshold:5},p),C=j=>a.filter(D=>D.status===j),L=j=>{s(j),c("")},H=()=>{s(null),c("")},se=async j=>{var I,D,R;if(!d.trim()){H();return}try{const B=za(t,r,u,i),$=(R=(D=(I=W.getState().app)==null?void 0:I.claude)==null?void 0:D.ui)==null?void 0:R.selectedProjectPath,V=$&&$!==be?$:void 0,U=B.claudeProjectPath??V,le={title:d.trim(),priority:B.priority??G.LOW,category:B.category??sa.OTHER,customProps:U?{claudeProjectPath:U}:void 0};await Ee.column.createTicket(j,le),l(),H()}catch(B){console.error("Failed to create todo:",B)}},ne=(j,I)=>{j.key==="Enter"?se(I):j.key==="Escape"&&H()},re=async j=>{try{await M.deleteTodo(j),l()}catch(I){console.error("Failed to delete todo:",I)}},ie=j=>{T(j)},b=()=>{T(null)},w=j=>{if(!m)return;const I=a.find($=>$.id.value===m);if(!I)return;const D=a.filter($=>$.status===I.status).sort(($,V)=>($.sortOrder??0)-(V.sortOrder??0)),R=D.findIndex($=>$.id.value===m);if(R===-1)return;const B=j==="previous"?R-1:R+1;B<0||B>=D.length||T(D[B].id.value)},A=m?a.find(j=>j.id.value===m)??null:null,z=A?a.filter(j=>j.status===A.status).sort((j,I)=>(j.sortOrder??0)-(I.sortOrder??0)):[],Qe=A&&z.length>0?z.findIndex(j=>j.id.value===m):void 0,Ze=z.length;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"kanban-board-container flex gap-4 h-full py-2",style:{width:"2000px"},"data-test":"kanban-board-container",children:Ka.filter(j=>o.includes(j.id)).map(j=>{const I=C(j.id),D=y===j.id;return e.jsx(Aa,{column:j,todos:I,isDropTarget:D,draggedTodoId:h,currentDropZone:y,insertionIndex:v,kanbanManager:g,isAddingTodo:N===j.id,newTodoTitle:d,onDeleteTodo:re,onAddClick:L,onCancelAdd:H,onTodoTitleChange:c,onKeyDown:ne,onTodoUpdate:l,openDetailsPanelTodoId:m,onOpenDetailsPanel:ie,onCloseDetailsPanel:b},j.id)})}),e.jsx(La,{"data-test":"kanban-card-details-panel",todo:A,isOpen:!!m,onClose:b,onUpdate:l,currentCardIndex:Qe,totalCardsInColumn:Ze,onNavigatePrevious:()=>w("previous"),onNavigateNext:()=>w("next")})]})}const we=new na,Se=[{value:"title",label:"Title"},{value:"description",label:"Description"},{value:"id",label:"ID"}],Ie=[{value:"contains",label:"Contains",description:"Text contains substring"},{value:"exact",label:"Exact Match",description:"Exact text match"},{value:"startsWith",label:"Starts With",description:"Text starts with substring"},{value:"endsWith",label:"Ends With",description:"Text ends with substring"},{value:"fuzzy",label:"Fuzzy Match",description:"Approximate string matching (typo-tolerant)"},{value:"regex",label:"Regex",description:"Regular expression match"}],fe=[{value:P.FREEZER,label:"Freezer"},{value:P.BACKLOG,label:"Backlog"},{value:P.SELECTED,label:"Selected"},{value:P.DOING,label:"Doing"},{value:P.DONE,label:"Done"},{value:P.ARCHIVE,label:"Archive"}],De=[{value:G.LOW,label:"Low"},{value:G.MEDIUM,label:"Medium"},{value:G.HIGH,label:"High"},{value:G.URGENT,label:"Urgent"}],Wa=[{value:"createdAt",label:"Created Date"},{value:"updatedAt",label:"Updated Date"},{value:"title",label:"Title"},{value:"priority",label:"Priority"}];function Ge({filters:a,onFiltersChange:l,onReset:n,showAdvanced:o}){var N;const[t,r]=f.useState(o??!1),[u,i]=f.useState(()=>we.getAllCategories());f.useEffect(()=>{if(t){const s=we.getAllCategories();i(s)}},[t]);const h=(s,d)=>{l({...a,[s]:d})},x=(s,d)=>{const c=a[s],m=c.includes(d)?c.filter(T=>T!==d):[...c,d];h(s,m)},y=()=>{const s={id:Math.random().toString(36).substring(7),field:"title",operator:"contains",value:"",caseSensitive:!1};h("fieldConditions",[...a.fieldConditions,s])},S=(s,d)=>{h("fieldConditions",a.fieldConditions.map(c=>c.id===s?{...c,...d}:c))},v=s=>{h("fieldConditions",a.fieldConditions.filter(d=>d.id!==s))},k=a.searchQuery||a.fieldConditions.length>0||a.statuses.length>0||a.priorities.length>0||a.categories.length>0||a.claudeProjectPaths&&a.claudeProjectPaths.length>0;return e.jsxs(Fe,{className:"kanban-filters-advanced p-4 space-y-4","data-test":"kanban-filters-advanced-container",children:[e.jsxs("div",{className:"search-section flex gap-2","data-test":"kanban-filters-advanced-search-section",children:[e.jsxs("div",{className:"search-input-wrapper relative flex-1","data-test":"kanban-filters-advanced-search-wrapper",children:[e.jsx(ja,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground","data-test":"kanban-filters-advanced-search-icon"}),e.jsx(de,{"data-test":"kanban-filters-advanced-search-input",placeholder:"Quick search...",value:a.searchQuery,onChange:s=>h("searchQuery",s.target.value),className:"pl-9"})]}),e.jsx(F,{"data-test":"kanban-filters-advanced-toggle-button",variant:"outline",size:"icon",onClick:()=>r(!t),className:t?"bg-accent":"",children:e.jsx(ka,{className:"h-4 w-4","data-test":"kanban-filters-advanced-toggle-icon"})}),k&&e.jsx(F,{"data-test":"kanban-filters-advanced-reset-button",variant:"outline",size:"icon",onClick:n,children:e.jsx(K,{className:"h-4 w-4","data-test":"kanban-filters-advanced-reset-icon"})})]}),t&&e.jsxs("div",{className:"advanced-filters space-y-4","data-test":"kanban-filters-advanced-section",children:[e.jsxs("div",{className:"field-conditions-section space-y-2 p-3 border rounded-md bg-muted/30","data-test":"kanban-filters-advanced-field-conditions",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"kanban-filters-advanced-field-conditions-header",children:[e.jsx(ae,{className:"text-sm font-medium","data-test":"kanban-filters-advanced-field-conditions-label",children:"Field Conditions"}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"kanban-filters-advanced-field-conditions-controls",children:[e.jsxs(J,{value:a.conditionLogic,onValueChange:s=>h("conditionLogic",s),children:[e.jsx(Y,{className:"h-7 w-20 text-xs","data-test":"kanban-filters-advanced-condition-logic-trigger",children:e.jsx(X,{})}),e.jsxs(q,{"data-test":"kanban-filters-advanced-condition-logic-content",children:[e.jsx(Q,{value:"OR","data-test":"kanban-filters-advanced-condition-logic-or",children:"OR"}),e.jsx(Q,{value:"AND","data-test":"kanban-filters-advanced-condition-logic-and",children:"AND"})]})]}),e.jsxs(F,{"data-test":"kanban-filters-advanced-add-condition-button",variant:"outline",size:"sm",onClick:y,className:"h-7 text-xs",children:[e.jsx(ue,{className:"h-3 w-3 mr-1","data-test":"kanban-filters-advanced-add-condition-icon"}),"Add"]})]})]}),a.fieldConditions.length>0?e.jsx("div",{className:"conditions-list space-y-2 mt-2","data-test":"kanban-filters-advanced-conditions-list",children:a.fieldConditions.map((s,d)=>{var c;return e.jsxs("div",{className:"condition-item p-2 border rounded-md space-y-2 bg-background","data-test":"kanban-filters-advanced-condition-item",children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"kanban-filters-advanced-condition-row",children:[e.jsx(E,{variant:"outline",className:"text-xs shrink-0","data-test":"kanban-filters-advanced-condition-number",children:d+1}),e.jsxs(J,{value:s.field,onValueChange:m=>S(s.id,{field:m}),children:[e.jsx(Y,{className:"h-7 flex-1 text-xs","data-test":"kanban-filters-advanced-condition-field-trigger",children:e.jsx(X,{})}),e.jsx(q,{"data-test":"kanban-filters-advanced-condition-field-content",children:Se.map(m=>e.jsx(Q,{value:m.value,"data-test":"kanban-filters-advanced-condition-field-option",children:m.label},m.value))})]}),e.jsx(F,{"data-test":"kanban-filters-advanced-condition-remove",variant:"ghost",size:"icon",onClick:()=>v(s.id),className:"h-7 w-7 shrink-0",children:e.jsx(Ke,{className:"h-3 w-3","data-test":"kanban-filters-advanced-condition-remove-icon"})})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"kanban-filters-advanced-condition-operator-row",children:[e.jsxs(J,{value:s.operator,onValueChange:m=>S(s.id,{operator:m}),children:[e.jsx(Y,{className:"h-7 w-32 text-xs","data-test":"kanban-filters-advanced-condition-operator-trigger",children:e.jsx(X,{})}),e.jsx(q,{"data-test":"kanban-filters-advanced-condition-operator-content",children:Ie.map(m=>e.jsx(Q,{value:m.value,"data-test":"kanban-filters-advanced-condition-operator-option",children:m.label},m.value))})]}),e.jsx(de,{"data-test":"kanban-filters-advanced-condition-value",placeholder:"Search value...",value:s.value,onChange:m=>S(s.id,{value:m.target.value}),className:"h-7 text-xs flex-1"})]}),e.jsxs("div",{className:"flex items-center justify-between","data-test":"kanban-filters-advanced-condition-options",children:[e.jsx("span",{className:"text-xs text-muted-foreground","data-test":"kanban-filters-advanced-condition-description",children:(c=Ie.find(m=>m.value===s.operator))==null?void 0:c.description}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"kanban-filters-advanced-condition-case-sensitive",children:[e.jsx(ae,{htmlFor:`case-${s.id}`,className:"text-xs cursor-pointer","data-test":"kanban-filters-advanced-condition-case-label",children:"Case sensitive"}),e.jsx(Oe,{"data-test":"kanban-filters-advanced-condition-case-switch",id:`case-${s.id}`,checked:s.caseSensitive??!1,onCheckedChange:m=>S(s.id,{caseSensitive:m}),className:"scale-75"})]})]})]},s.id)})}):e.jsx("div",{className:"empty-state text-xs text-muted-foreground text-center py-3 border rounded-md","data-test":"kanban-filters-advanced-conditions-empty",children:'No field conditions. Click "Add" to create one.'})]}),e.jsxs("div",{className:"sort-section grid grid-cols-2 gap-3","data-test":"kanban-filters-advanced-sort-section",children:[e.jsxs("div",{className:"sort-by","data-test":"kanban-filters-advanced-sort-by-wrapper",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-sort-by-label",children:"Sort By"}),e.jsxs(J,{value:a.sortBy,onValueChange:s=>h("sortBy",s),children:[e.jsx(Y,{"data-test":"kanban-filters-advanced-sort-by-trigger",children:e.jsx(X,{})}),e.jsx(q,{"data-test":"kanban-filters-advanced-sort-by-content",children:Wa.map(s=>e.jsx(Q,{value:s.value,"data-test":"kanban-filters-advanced-sort-by-option",children:s.label},s.value))})]})]}),e.jsxs("div",{className:"sort-order","data-test":"kanban-filters-advanced-sort-order-wrapper",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-sort-order-label",children:"Order"}),e.jsxs(J,{value:a.sortOrder,onValueChange:s=>h("sortOrder",s),children:[e.jsx(Y,{"data-test":"kanban-filters-advanced-sort-order-trigger",children:e.jsx(X,{})}),e.jsxs(q,{"data-test":"kanban-filters-advanced-sort-order-content",children:[e.jsx(Q,{value:"asc","data-test":"kanban-filters-advanced-sort-order-asc",children:"Ascending"}),e.jsx(Q,{value:"desc","data-test":"kanban-filters-advanced-sort-order-desc",children:"Descending"})]})]})]})]}),e.jsxs("div",{className:"status-filter","data-test":"kanban-filters-advanced-status-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-status-label",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-status-badges",children:fe.map(s=>e.jsx(E,{"data-test":"kanban-filters-advanced-status-badge",variant:a.statuses.includes(s.value)?"default":"outline",className:"cursor-pointer",onClick:()=>x("statuses",s.value),children:s.label},s.value))})]}),e.jsxs("div",{className:"priority-filter","data-test":"kanban-filters-advanced-priority-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-priority-label",children:"Priority"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-priority-badges",children:De.map(s=>e.jsx(E,{"data-test":"kanban-filters-advanced-priority-badge",variant:a.priorities.includes(s.value)?"default":"outline",className:"cursor-pointer",onClick:()=>x("priorities",s.value),children:s.label},s.value))})]}),e.jsxs("div",{className:"category-filter","data-test":"kanban-filters-advanced-category-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-category-label",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"kanban-filters-advanced-category-badges",children:u.map(s=>e.jsx(E,{"data-test":"kanban-filters-advanced-category-badge",variant:a.categories.includes(s.value)?s.variant??"default":"outline",className:`cursor-pointer ${a.categories.includes(s.value)?s.className??"":""}`,onClick:()=>x("categories",s.value),children:s.label},s.value))})]}),e.jsxs("div",{className:"claude-project-filter","data-test":"kanban-filters-advanced-claude-project-section",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block","data-test":"kanban-filters-advanced-claude-project-label",children:"Claude Projects"}),e.jsx(ra,{"data-test":"kanban-filters-advanced-claude-project-selector",multiSelect:!0,value:a.claudeProjectPaths||[],onChange:s=>h("claudeProjectPaths",s)})]}),e.jsxs("div",{className:"show-columns-section space-y-2 p-3 border rounded-md bg-muted/30","data-test":"kanban-filters-advanced-show-columns-section",children:[e.jsx(ae,{className:"text-sm font-medium","data-test":"kanban-filters-advanced-show-columns-label",children:"Show Columns"}),e.jsx("div",{className:"columns-grid grid grid-cols-2 gap-2","data-test":"kanban-filters-advanced-show-columns-grid",children:fe.map(s=>e.jsxs("div",{className:"column-item flex items-center space-x-2","data-test":"kanban-filters-advanced-show-column-item",children:[e.jsx(Ae,{"data-test":"kanban-filters-advanced-show-column-checkbox",id:`column-${s.value}`,checked:a.visibleColumns.includes(s.value),onCheckedChange:()=>x("visibleColumns",s.value)}),e.jsx("label",{htmlFor:`column-${s.value}`,className:"text-sm cursor-pointer","data-test":"kanban-filters-advanced-show-column-label",children:s.label})]},s.value))})]})]}),k&&e.jsxs("div",{className:"active-filters flex flex-wrap gap-2 pt-2 border-t","data-test":"kanban-filters-advanced-active-filters",children:[a.searchQuery&&e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-search-badge",children:["Search: ",a.searchQuery,e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-search-remove",onClick:()=>h("searchQuery","")})]}),a.fieldConditions.map(s=>{var d;return e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-condition",children:[(d=Se.find(c=>c.value===s.field))==null?void 0:d.label,":"," ",s.operator,' "',s.value,'"',e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-condition-remove",onClick:()=>v(s.id)})]},s.id)}),a.statuses.map(s=>{var d;return e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-status",children:[(d=fe.find(c=>c.value===s))==null?void 0:d.label,e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-status-remove",onClick:()=>x("statuses",s)})]},s)}),a.priorities.map(s=>{var d;return e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-priority",children:[(d=De.find(c=>c.value===s))==null?void 0:d.label,e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-priority-remove",onClick:()=>x("priorities",s)})]},s)}),a.categories.map(s=>{var d;return e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-category",children:[(d=u.find(c=>c.value===s))==null?void 0:d.label,e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-category-remove",onClick:()=>x("categories",s)})]},s)}),(N=a.claudeProjectPaths)==null?void 0:N.map(s=>e.jsxs(E,{variant:"secondary",className:"gap-1","data-test":"kanban-filters-advanced-active-project",children:["Project: ",s,e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-filters-advanced-active-project-remove",onClick:()=>{var d;return h("claudeProjectPaths",((d=a.claudeProjectPaths)==null?void 0:d.filter(c=>c!==s))||[])}})]},s))]})]})}function Ha({spaces:a,activeSpaceId:l,onSpaceSelect:n,onSpaceCreate:o,onSpaceUpdate:t,onSpaceDelete:r,onSpaceConfigOpen:u}){const[i,h]=f.useState(null),[x,y]=f.useState(""),S=(d,c)=>{h(d),y(c)},v=()=>{if(!i||!x.trim()){h(null);return}t(i,x.trim()),h(null),y(""),_.success("Space renamed")},k=()=>{h(null),y("")},N=()=>{const d=a.length+1;o(`Space ${d}`)},s=d=>{const c=a.find(m=>m.id===d);c&&window.confirm(`Delete space "${c.name}"?`)&&(r(d),_.success(`Space "${c.name}" deleted`))};return e.jsxs("div",{className:"kanban-spaces flex items-center gap-2 flex-wrap","data-test":"kanban-spaces-container",children:[e.jsx("span",{className:"text-sm text-muted-foreground mr-1","data-test":"kanban-spaces-label",children:"Spaces:"}),e.jsx(E,{"data-test":"kanban-spaces-all-badge",variant:l===Z?"default":"outline",className:"cursor-pointer",onClick:()=>n(Z),children:"All Spaces"}),a.map(d=>i===d.id?e.jsx("div",{className:"inline-flex items-center gap-1","data-test":"kanban-spaces-editing",children:e.jsx(de,{"data-test":"kanban-spaces-edit-input",value:x,onChange:c=>y(c.target.value),onKeyDown:c=>{c.key==="Enter"&&v(),c.key==="Escape"&&k()},onBlur:v,autoFocus:!0,className:"h-6 w-32 text-xs px-2"})},d.id):e.jsxs(E,{"data-test":"kanban-spaces-badge",variant:l===d.id?"default":"outline",className:"cursor-pointer gap-1 group relative pr-12",onClick:()=>n(d.id),onDoubleClick:()=>S(d.id,d.name),children:[d.name,e.jsxs("div",{className:"absolute right-1 flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity","data-test":"kanban-spaces-actions",children:[e.jsx(F,{"data-test":"kanban-spaces-config-button",variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:c=>{c.stopPropagation(),u(d.id)},title:"Configure space filters",children:e.jsx(Ca,{className:"h-3 w-3","data-test":"kanban-spaces-settings-icon"})}),e.jsx("button",{"data-test":"kanban-spaces-delete-button",className:"p-0 border-0 bg-transparent",onClick:c=>{c.stopPropagation(),s(d.id)},title:"Delete space",children:e.jsx(K,{className:"h-3 w-3 cursor-pointer","data-test":"kanban-spaces-delete-icon"})})]})]},d.id)),e.jsx(F,{"data-test":"kanban-spaces-create-button",variant:"outline",size:"icon",onClick:N,className:"h-6 w-6",title:"Create new space",children:e.jsx(ue,{className:"h-3 w-3","data-test":"kanban-spaces-plus-icon"})})]})}function Ga({onImportComplete:a}){const[l,n]=f.useState(!1),[o,t]=f.useState(!1),[r,u]=f.useState(!1),[i,h]=f.useState(null),x=f.useRef(null),y=async()=>{try{const N=await M.exportTodos(),s=new Blob([N],{type:"application/json"}),d=URL.createObjectURL(s),c=document.createElement("a");c.href=d,c.download=`todos-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d),_.success("Todos exported successfully")}catch(N){console.error("Export failed:",N),_.error("Failed to export todos")}},S=()=>{var N;(N=x.current)==null||N.click()},v=async N=>{var d;const s=(d=N.target.files)==null?void 0:d[0];if(s){t(!0),h(null);try{const c=await s.text(),m=await M.importTodos(c,{replace:r});if(h(m),m.imported>0||m.presetsImported&&m.presetsImported>0||m.spacesImported&&m.spacesImported>0||m.categoriesImported&&m.categoriesImported>0){const T=[];m.imported>0&&T.push(`${m.imported} todo${m.imported>1?"s":""}`),m.presetsImported&&m.presetsImported>0&&T.push(`${m.presetsImported} preset${m.presetsImported>1?"s":""}`),m.spacesImported&&m.spacesImported>0&&T.push(`${m.spacesImported} space${m.spacesImported>1?"s":""}`),m.categoriesImported&&m.categoriesImported>0&&T.push(`${m.categoriesImported} categor${m.categoriesImported>1?"ies":"y"}`),_.success(`Successfully imported ${T.join(", ")}`),a==null||a()}m.skipped>0&&_.warning(`Skipped ${m.skipped} todo${m.skipped>1?"s":""}`),m.errors.length>0&&_.error(`${m.errors.length} error${m.errors.length>1?"s":""} occurred`)}catch(c){console.error("Import failed:",c),_.error(c instanceof Error?c.message:"Failed to import todos"),h({imported:0,skipped:0,errors:[c instanceof Error?c.message:"Unknown error"]})}finally{t(!1),x.current&&(x.current.value="")}}},k=()=>{n(!1),h(null),u(!1)};return e.jsxs("div",{className:"export-import-controls flex items-center gap-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:y,className:"export-button",children:[e.jsx(Na,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(Le,{open:l,onOpenChange:n,children:[e.jsx(ia,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"sm",className:"import-button",children:[e.jsx(Pa,{className:"h-4 w-4 mr-2"}),"Import"]})}),e.jsxs(Re,{className:"import-dialog sm:max-w-[500px]",children:[e.jsxs(Be,{children:[e.jsx($e,{children:"Import Todos, Presets, Spaces & Categories"}),e.jsx(_e,{children:"Import todos, custom filter presets, spaces, and custom categories from a JSON file. You can choose to merge with existing data or replace it entirely."})]}),e.jsxs("div",{className:"import-options space-y-4 py-4",children:[e.jsxs("div",{className:"replace-mode-control flex items-center justify-between",children:[e.jsxs("div",{className:"replace-mode-label",children:[e.jsx(ae,{htmlFor:"replace-mode",className:"text-sm font-medium",children:"Replace existing data"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"When enabled, all existing todos, presets, spaces, and custom categories will be deleted before importing"})]}),e.jsx(Oe,{id:"replace-mode",checked:r,onCheckedChange:u,disabled:o})]}),i&&e.jsxs("div",{className:"import-result space-y-2 p-4 border rounded-md bg-muted/50",children:[e.jsxs("div",{className:"result-summary space-y-1",children:[i.imported>0&&e.jsxs("div",{className:"imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Todos imported: ",i.imported]})]}),i.presetsImported!==void 0&&i.presetsImported>0&&e.jsxs("div",{className:"presets-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Presets imported: ",i.presetsImported]})]}),i.spacesImported!==void 0&&i.spacesImported>0&&e.jsxs("div",{className:"spaces-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Spaces imported: ",i.spacesImported]})]}),i.categoriesImported!==void 0&&i.categoriesImported>0&&e.jsxs("div",{className:"categories-imported-count flex items-center gap-2 text-sm text-green-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Categories imported: ",i.categoriesImported]})]}),i.skipped>0&&e.jsxs("div",{className:"skipped-count flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:["Todos skipped: ",i.skipped]})]})]}),i.errors.length>0&&e.jsxs("div",{className:"error-list space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-red-600",children:"Errors:"}),e.jsxs("ul",{className:"error-items text-xs text-muted-foreground space-y-1",children:[i.errors.slice(0,5).map((N,s)=>e.jsx("li",{className:"error-item",children:N},s)),i.errors.length>5&&e.jsxs("li",{className:"more-errors text-xs italic",children:["... and ",i.errors.length-5," more errors"]})]})]})]})]}),e.jsxs(ze,{children:[e.jsx(F,{variant:"outline",onClick:k,disabled:o,className:"close-button",children:"Close"}),e.jsx(F,{onClick:S,disabled:o,className:"select-file-button",children:o?"Importing...":"Select File"})]}),e.jsx("input",{ref:x,type:"file",accept:".json,application/json",onChange:v,className:"hidden"})]})]})]})}function Va({activePreset:a,customPresets:l,editingPresetId:n,editingPresetName:o,onPresetSelect:t,onPresetUpdate:r,onPresetCreate:u,onPresetDelete:i,onStartEditingPreset:h,onSavePresetName:x,onCancelEditingPreset:y,onEditingPresetNameChange:S}){return e.jsxs("div",{className:"filter-presets flex items-center gap-2","data-test":"kanban-preset-badges-container",children:[e.jsx("span",{className:"text-sm text-muted-foreground mr-1","data-test":"kanban-preset-badges-label",children:"Presets:"}),e.jsx(E,{"data-test":"kanban-preset-badge-all",variant:a==="all"?"default":"outline",className:"cursor-pointer",onClick:()=>t("all"),children:"All"}),e.jsx(E,{"data-test":"kanban-preset-badge-planning",variant:a==="planning"?"default":"outline",className:"cursor-pointer",onClick:()=>t("planning"),children:"Planning"}),e.jsx(E,{"data-test":"kanban-preset-badge-doing",variant:a==="doing"?"default":"outline",className:"cursor-pointer",onClick:()=>t("doing"),children:"Doing"}),e.jsx(E,{"data-test":"kanban-preset-badge-done",variant:a==="done"?"default":"outline",className:"cursor-pointer",onClick:()=>t("done"),children:"Done"}),l.map(v=>n===v.id?e.jsx("div",{className:"inline-flex items-center gap-1","data-test":"kanban-preset-editing",children:e.jsx(de,{"data-test":"kanban-preset-edit-input",value:o,onChange:k=>S(k.target.value),onKeyDown:k=>{k.key==="Enter"&&x(),k.key==="Escape"&&y()},onBlur:x,autoFocus:!0,className:"h-6 w-32 text-xs px-2"})},v.id):e.jsxs(E,{"data-test":"kanban-preset-badge",variant:a===v.id?"default":"outline",className:"cursor-pointer gap-1 group",onClick:()=>t(v.id),onDoubleClick:()=>h(v.id,v.name),children:[v.name,e.jsx(K,{"data-test":"kanban-preset-delete-icon",className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity",onClick:k=>{k.stopPropagation(),i(v.id)}})]},v.id)),l.some(v=>v.id===a)&&e.jsx(F,{"data-test":"kanban-preset-update-button",variant:"outline",size:"icon",onClick:r,className:"h-6 w-6",title:"Update current preset",children:e.jsx(ya,{className:"h-3 w-3","data-test":"kanban-preset-save-icon"})}),e.jsx(F,{"data-test":"kanban-preset-create-button",variant:"outline",size:"icon",onClick:u,className:"h-6 w-6",title:"Create new preset",children:e.jsx(ue,{className:"h-3 w-3","data-test":"kanban-preset-plus-icon"})})]})}function Qa({spaces:a,activeSpaceId:l,onImportComplete:n,onSpaceSelect:o,onSpaceCreate:t,onSpaceUpdate:r,onSpaceDelete:u,onSpaceConfigOpen:i,presetBadgesProps:h}){return e.jsxs("div",{className:"section-header flex items-center justify-between mb-4 flex-shrink-0","data-test":"kanban-board-header",children:[e.jsxs("div",{className:"section-title-area flex items-center gap-4","data-test":"kanban-board-header-title-area",children:[e.jsx("h2",{className:"section-title text-2xl font-bold","data-test":"kanban-board-header-title",children:"Board"}),e.jsx(Ga,{"data-test":"kanban-board-header-export-import",onImportComplete:n})]}),e.jsxs("div",{className:"filter-controls flex flex-col gap-2 items-end","data-test":"kanban-board-header-filter-controls",children:[e.jsx(Ha,{"data-test":"kanban-board-header-spaces",spaces:a,activeSpaceId:l,onSpaceSelect:o,onSpaceCreate:t,onSpaceUpdate:r,onSpaceDelete:u,onSpaceConfigOpen:i}),e.jsx(Va,{"data-test":"kanban-board-header-presets",...h})]})]})}function Za({open:a,editingSpace:l,editingSpaceFilters:n,onOpenChange:o,onFiltersChange:t,onSave:r,onReset:u}){return e.jsx(Le,{open:a,onOpenChange:o,"data-test":"kanban-space-config-dialog",children:e.jsxs(Re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto","data-test":"kanban-space-config-dialog-content",children:[e.jsxs(Be,{"data-test":"kanban-space-config-dialog-header",children:[e.jsxs($e,{"data-test":"kanban-space-config-dialog-title",children:["Configure Space: ",l==null?void 0:l.name]}),e.jsx(_e,{"data-test":"kanban-space-config-dialog-description",children:"Define filters for this space. These filters will be applied as the base layer, with presets layered on top when selected."})]}),n&&e.jsx("div",{className:"space-filter-content py-4","data-test":"kanban-space-config-dialog-filter-content",children:e.jsx(Ge,{"data-test":"kanban-space-config-dialog-filters",filters:n,onFiltersChange:t,onReset:u,showAdvanced:!0})}),e.jsxs(ze,{className:"flex gap-2","data-test":"kanban-space-config-dialog-footer",children:[e.jsx(F,{variant:"outline",onClick:()=>o(!1),"data-test":"kanban-space-config-dialog-cancel-button",children:"Cancel"}),e.jsx(F,{onClick:r,"data-test":"kanban-space-config-dialog-save-button",children:"Save Space Configuration"})]})]})})}function Ua(){const[a,l]=f.useState([]),[n,o]=f.useState(!0),[t,r]=f.useState(!1),u=f.useRef(null),i=f.useRef(0),h=async(v=!1)=>{try{v&&u.current&&(i.current=u.current.scrollLeft),t||o(!0);const k=await M.getAllTodos({sort:{field:"sortOrder",direction:"asc"}});l(k),t||r(!0)}catch(k){console.error("Failed to load todos:",k)}finally{o(!1)}},x=async(v,k)=>{u.current&&(i.current=u.current.scrollLeft),l(N=>N.map(s=>s.id.value===v.value?{...s,status:k}:s));try{await M.updateTodo(v,{status:k})}catch(N){console.error("Failed to update todo status:",N),await h(!0)}},y=()=>{u.current&&(i.current=u.current.scrollLeft)},S=v=>{u.current&&i.current>0&&(u.current.scrollLeft=i.current)};return f.useEffect(()=>{h()},[]),{todos:a,loading:n,loadTodos:h,handleTodoStatusUpdate:x,scrollContainerRef:u,saveScrollPosition:y,restoreScrollPosition:S}}function ve(){var l,n;const a=((n=(l=W.getState().app)==null?void 0:l.kanban)==null?void 0:n.spaces)||[];return Array.isArray(a)?a:[]}function Ja(a){var o;const l=W.getState(),n=(o=l.app)==null?void 0:o.kanban;W.updateState({app:{...l.app,kanban:{spaces:(n==null?void 0:n.spaces)??[],activeSpaceId:a,customPresets:(n==null?void 0:n.customPresets)??[],activePresetId:(n==null?void 0:n.activePresetId)??"all",currentFilters:(n==null?void 0:n.currentFilters)??te,customCategories:(n==null?void 0:n.customCategories)??[],loading:(n==null?void 0:n.loading)??!1,error:n==null?void 0:n.error}}})}function Ya(a){var u;const l=_a(a),o=[...ve(),l],t=W.getState(),r=(u=t.app)==null?void 0:u.kanban;return W.updateState({app:{...t.app,kanban:{spaces:o,activeSpaceId:(r==null?void 0:r.activeSpaceId)??"all",customPresets:(r==null?void 0:r.customPresets)??[],activePresetId:(r==null?void 0:r.activePresetId)??"all",currentFilters:(r==null?void 0:r.currentFilters)??te,customCategories:(r==null?void 0:r.customCategories)??[],loading:(r==null?void 0:r.loading)??!1,error:r==null?void 0:r.error}}}),l}function xe(a,l){var h;const n=ve(),o=n.findIndex(x=>x.id===a);if(o===-1)return null;const t={...n[o],...l},r=[...n.slice(0,o),t,...n.slice(o+1)],u=W.getState(),i=(h=u.app)==null?void 0:h.kanban;return W.updateState({app:{...u.app,kanban:{spaces:r,activeSpaceId:(i==null?void 0:i.activeSpaceId)??"all",customPresets:(i==null?void 0:i.customPresets)??[],activePresetId:(i==null?void 0:i.activePresetId)??"all",currentFilters:(i==null?void 0:i.currentFilters)??te,customCategories:(i==null?void 0:i.customCategories)??[],loading:(i==null?void 0:i.loading)??!1,error:i==null?void 0:i.error}}}),t}function Xa(a){var u;const l=ve(),n=l.filter(i=>i.id!==a);if(n.length===l.length)return!1;const o=W.getState(),t=(u=o.app)==null?void 0:u.kanban,r=(t==null?void 0:t.activeSpaceId)??"all";return W.updateState({app:{...o.app,kanban:{spaces:n,activeSpaceId:r===a?"all":r,customPresets:(t==null?void 0:t.customPresets)??[],activePresetId:(t==null?void 0:t.activePresetId)??"all",currentFilters:(t==null?void 0:t.currentFilters)??te,customCategories:(t==null?void 0:t.customCategories)??[],loading:(t==null?void 0:t.loading)??!1,error:t==null?void 0:t.error}}}),!0}function qa({filters:a,onFiltersChange:l,activeSpace:n}){const[o,t]=f.useState("all"),[r,u]=f.useState([]),[i,h]=f.useState(null),[x,y]=f.useState(""),S=()=>{try{const p=he();p!=null&&p.customPresets&&u(p.customPresets),p!=null&&p.activePresetId&&t(p.activePresetId),p!=null&&p.currentFilters&&l(p.currentFilters)}catch(p){console.error("Failed to load persisted state:",p)}},v=p=>{try{const g=he();Ne({spaces:(g==null?void 0:g.spaces)??[],activeSpaceId:(g==null?void 0:g.activeSpaceId)??n,customPresets:p,activePresetId:o,currentFilters:a,customCategories:(g==null?void 0:g.customCategories)??[]})}catch(g){console.error("Failed to save persisted state:",g)}},k=p=>{t(p),n!==Z&&xe(n,{lastActivePreset:p});let g=a;if(He(p))g=Ba(a,p),l(g);else{const C=r.find(L=>L.id===p);C&&(g=C.filters,l(C.filters))}try{const C=he();Ne({spaces:(C==null?void 0:C.spaces)??[],activeSpaceId:(C==null?void 0:C.activeSpaceId)??n,customPresets:r,activePresetId:p,currentFilters:g,customCategories:(C==null?void 0:C.customCategories)??[]})}catch(C){console.error("Failed to persist active preset:",C)}},N=()=>{const p=r.find(C=>C.id===o);if(!p)return;const g=r.map(C=>C.id===o?{...C,filters:{...a}}:C);u(g),v(g),_.success(`Preset "${p.name}" updated`)},s=()=>{const p={id:Date.now().toString(),name:$a(r.length),filters:{...a}},g=[...r,p];u(g),v(g),t(p.id),_.success(`Preset "${p.name}" created`)},d=p=>{const g=r.filter(C=>C.id!==p);u(g),v(g),o===p&&(t("all"),k("all"))},c=(p,g)=>{h(p),y(g)},m=()=>{if(!i||!x.trim()){h(null);return}const p=r.map(g=>g.id===i?{...g,name:x.trim()}:g);u(p),v(p),_.success("Preset renamed"),h(null)},T=()=>{h(null),y("")};return f.useEffect(()=>{S()},[]),{activePreset:o,customPresets:r,editingPresetId:i,editingPresetName:x,applyPreset:k,createNewPreset:s,updatePreset:N,deletePreset:d,startEditingPreset:c,savePresetName:m,cancelEditingPreset:T,setEditingPresetName:y,loadPresets:S}}function et({spaces:a,activeSpace:l,onPresetRestore:n}){const[o,t]=f.useState(!1),[r,u]=f.useState(null),[i,h]=f.useState(null);return{spaceDialogOpen:o,editingSpace:r,editingSpaceFilters:i,setSpaceDialogOpen:t,setEditingSpaceFilters:h,handleSpaceSelect:d=>{if(Ja(d),d!==Z){const c=a.find(m=>m.id===d);c!=null&&c.lastActivePreset&&n(c.lastActivePreset)}},handleSpaceCreate:d=>{Ya(d),_.success(`Space "${d}" created`)},handleSpaceUpdate:(d,c)=>{xe(d,{name:c})},handleSpaceDelete:d=>{Xa(d)},handleSpaceConfigOpen:d=>{const c=a.find(m=>m.id===d);c&&(u(c),h(c.filters),t(!0))},handleSpaceConfigSave:()=>{!r||!i||(xe(r.id,{filters:i}),t(!1),_.success("Space configuration updated"))},handleSpaceConfigReset:()=>{h({searchQuery:"",fieldConditions:[],conditionLogic:"OR",statuses:[],priorities:[],categories:[],sortBy:"createdAt",sortOrder:"desc",visibleColumns:[]})}}}function at(a,l){const n=[];for(let o=0;o<=l.length;o++)n[o]=[o];for(let o=0;o<=a.length;o++)n[0][o]=o;for(let o=1;o<=l.length;o++)for(let t=1;t<=a.length;t++)l.charAt(o-1)===a.charAt(t-1)?n[o][t]=n[o-1][t-1]:n[o][t]=Math.min(n[o-1][t-1]+1,n[o][t-1]+1,n[o-1][t]+1);return n[l.length][a.length]}function tt(a,l,n=!1){const o=n?a:a.toLowerCase(),t=n?l:l.toLowerCase(),r=Math.floor(t.length*.2);return at(o,t)<=r}function Ve(a,l,n,o=!1){const t=o?a:a.toLowerCase(),r=o?l:l.toLowerCase();switch(n){case"exact":return t===r;case"contains":return t.includes(r);case"startsWith":return t.startsWith(r);case"endsWith":return t.endsWith(r);case"fuzzy":return tt(a,l,o);case"regex":try{return new RegExp(l,o?"":"i").test(a)}catch{return!1}default:return!0}}function st(a,l){const n=l.filters,o=n.claudeProjectPaths||(n.claudeProjectPath?[n.claudeProjectPath]:[]);if(o.length>0&&(a=a.filter(t=>o.some(r=>{var u,i,h;return r===be?!((u=t.customProps)!=null&&u.claudeProjectPath)||((i=t.customProps)==null?void 0:i.claudeProjectPath)!=="NO_PROJECT_ID":((h=t.customProps)==null?void 0:h.claudeProjectPath)===r}))),n.fieldConditions.length>0){const t=n.fieldConditions.map(r=>u=>{const i=String(u[r.field]||"");return Ve(i,r.value,r.operator,r.caseSensitive)});a=a.multiFilter(t,{combineWith:n.conditionLogic})}if(n.searchQuery&&(a=a.search(n.searchQuery,{searchableFields:["title","description"],caseSensitive:!1})),n.statuses.length>0||n.priorities.length>0||n.categories.length>0){const t=[];n.statuses.length>0&&t.push(r=>n.statuses.includes(r.status)),n.priorities.length>0&&t.push(r=>n.priorities.includes(r.priority)),n.categories.length>0&&t.push(r=>n.categories.includes(r.category)),a=a.multiFilter(t,{combineWith:"AND"})}return a}function nt(a,l){const n=l.claudeProjectPaths||(l.claudeProjectPath?[l.claudeProjectPath]:[]);if(n.length>0&&(a=a.filter(o=>n.some(t=>{var r,u,i;return t===be?!((r=o.customProps)!=null&&r.claudeProjectPath)||((u=o.customProps)==null?void 0:u.claudeProjectPath)!=="NO_PROJECT_ID":((i=o.customProps)==null?void 0:i.claudeProjectPath)===t}))),l.fieldConditions.length>0){const o=l.fieldConditions.map(t=>r=>{const u=String(r[t.field]||"");return Ve(u,t.value,t.operator,t.caseSensitive)});a=a.multiFilter(o,{combineWith:l.conditionLogic})}if(l.searchQuery&&(a=a.search(l.searchQuery,{searchableFields:["title","description"],caseSensitive:!1})),l.statuses.length>0||l.priorities.length>0||l.categories.length>0){const o=[];l.statuses.length>0&&o.push(t=>l.statuses.includes(t.status)),l.priorities.length>0&&o.push(t=>l.priorities.includes(t.priority)),l.categories.length>0&&o.push(t=>l.categories.includes(t.category)),a=a.multiFilter(o,{combineWith:"AND"})}return a}function rt({todos:a,filters:l,spaces:n,activeSpace:o,onScrollRestore:t}){const r=f.useMemo(()=>{let i=new Da(a).chain();if(o!==Z){const x=n.find(y=>y.id===o);x&&(i=st(i,x))}return i=nt(i,l),i=i.sort({field:l.sortBy,direction:l.sortOrder}),i.getItems()},[a,l,n,o]);return f.useEffect(()=>{t(r)},[r,t]),{filteredTodos:r}}const it=f.lazy(()=>ua(()=>import("./TodoTable-BljbBDre.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>({default:a.TodoTable}))),lt=[{id:"kanban-data",title:"Data",description:"View kanban data in JSON format",href:"/todo/kanban/data",icon:wa},{id:"kanban-stats",title:"Statistics",description:"Board statistics and metrics"},{id:"kanban-board",title:"Board",description:"Kanban board view"},{id:"kanban-todo",title:"Todo",description:"Todo section"}],ot=[{label:"Home",href:"/"},{label:"Todo",href:"/todo"},{label:"Kanban"}],Te=te,ct=[];function kt(){const{todos:a,loading:l,loadTodos:n,handleTodoStatusUpdate:o,scrollContainerRef:t,saveScrollPosition:r,restoreScrollPosition:u}=Ua(),[i,h]=f.useState(Te),x=p=>{r(),h(p)},y=f.useMemo(()=>p=>{var g,C;return((C=(g=p.app)==null?void 0:g.kanban)==null?void 0:C.spaces)??ct},[]),S=f.useMemo(()=>p=>{var g,C;return((C=(g=p.app)==null?void 0:g.kanban)==null?void 0:C.activeSpaceId)??Z},[]),v=ce(y),k=ce(S),N=qa({filters:i,onFiltersChange:x,activeSpace:k}),s={...N,applyPreset:p=>{r(),N.applyPreset(p)},createNewPreset:()=>{r(),N.createNewPreset()},updatePreset:()=>{r(),N.updatePreset()},deletePreset:p=>{r(),N.deletePreset(p)}},d=et({spaces:v,activeSpace:k,onPresetRestore:s.applyPreset}),c={...d,handleSpaceSelect:p=>{r(),d.handleSpaceSelect(p)},handleSpaceCreate:p=>{r(),d.handleSpaceCreate(p)},handleSpaceUpdate:(p,g)=>{r(),d.handleSpaceUpdate(p,g)},handleSpaceDelete:p=>{r(),d.handleSpaceDelete(p)},handleSpaceConfigSave:()=>{r(),d.handleSpaceConfigSave()}},{filteredTodos:m}=rt({todos:a,filters:i,spaces:v,activeSpace:k,onScrollRestore:u}),T=()=>{n(),s.loadPresets()};return e.jsxs(pa,{title:"Kanban Board",description:"Visual board for managing todos with drag-and-drop",sections:lt,headerOffset:80,breadcrumbs:ot,"data-test":"kanban-page-layout",children:[e.jsx("div",{className:"kanban-page-container flex flex-col gap-6","data-test":"kanban-page-container",children:e.jsxs("section",{id:"kanban-board",className:"kanban-board-section flex-shrink-0 min-w-0 flex flex-col",style:{height:"600px"},"data-test":"kanban-board-section",children:[e.jsx(Qa,{"data-test":"kanban-page-board-header",spaces:v,activeSpaceId:k,onImportComplete:T,onSpaceSelect:c.handleSpaceSelect,onSpaceCreate:c.handleSpaceCreate,onSpaceUpdate:c.handleSpaceUpdate,onSpaceDelete:c.handleSpaceDelete,onSpaceConfigOpen:c.handleSpaceConfigOpen,presetBadgesProps:{activePreset:s.activePreset,customPresets:s.customPresets,editingPresetId:s.editingPresetId,editingPresetName:s.editingPresetName,onPresetSelect:s.applyPreset,onPresetUpdate:s.updatePreset,onPresetCreate:s.createNewPreset,onPresetDelete:s.deletePreset,onStartEditingPreset:s.startEditingPreset,onSavePresetName:s.savePresetName,onCancelEditingPreset:s.cancelEditingPreset,onEditingPresetNameChange:s.setEditingPresetName}}),e.jsx("div",{className:"filters-wrapper mb-4 flex-shrink-0","data-test":"kanban-page-filters-wrapper",children:e.jsx(Ge,{"data-test":"kanban-page-filters",filters:i,onFiltersChange:x,onReset:()=>x(Te)})}),e.jsxs(la,{defaultValue:"kanban",className:"tabs-container flex-1 min-w-0 flex flex-col","data-test":"kanban-page-tabs",children:[e.jsxs(oa,{className:"tabs-list flex-shrink-0 mb-2","data-test":"kanban-page-tabs-list",children:[e.jsx(Pe,{value:"kanban","data-test":"kanban-page-tab-kanban",children:"Kanban Board"}),e.jsx(Pe,{value:"table","data-test":"kanban-page-tab-table",children:"Table View"})]}),e.jsx(ye,{value:"kanban",className:"tab-content-kanban flex-1 h-[60vh] min-w-0 m-0","data-test":"kanban-page-kanban-content",children:e.jsx("div",{ref:t,className:"board-content h-full overflow-x-auto overflow-y-hidden","data-test":"kanban-page-board-content",children:l?e.jsxs("div",{className:"loading-container flex items-center justify-center h-full","data-test":"kanban-page-loading",children:[e.jsx(ge,{className:"w-8 h-8 animate-spin text-gray-400","data-test":"kanban-page-loading-spinner"}),e.jsx("span",{className:"loading-text ml-3 text-gray-600","data-test":"kanban-page-loading-text",children:"Loading kanban board..."})]}):e.jsx(Ma,{"data-test":"kanban-page-board-instance",todos:m,onTodosUpdate:()=>n(!0),onTodoStatusUpdate:o,visibleColumns:i.visibleColumns,activePresetId:s.activePreset,customPresets:s.customPresets,spaces:v,activeSpaceId:k},"kanban-board-instance")})}),e.jsx(ye,{value:"table",className:"tab-content-table flex-1 min-w-0 overflow-hidden m-0 flex flex-col","data-test":"kanban-page-table-content",children:e.jsx(ca,{storageKey:"kanban-table-column-visibility",initialConfig:da,children:(p,g,C)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-controls flex justify-end mb-2 flex-shrink-0",children:e.jsx(C,{title:"Table Column Visibility",contentClassName:"w-80",children:e.jsx("div",{className:"column-visibility-config space-y-3",children:e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{className:"text-xs font-semibold mb-2 text-muted-foreground",children:"Column Visibility"}),e.jsx("div",{className:"space-y-2",children:Object.keys(p).map(L=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{id:`column-${L}`,checked:p[L],onCheckedChange:H=>{g({...p,[L]:H===!0})}}),e.jsx(ae,{htmlFor:`column-${L}`,className:"text-sm font-normal cursor-pointer",children:L.charAt(0).toUpperCase()+L.slice(1).replace(/([A-Z])/g," $1")})]},L))})]})})})}),e.jsx("div",{className:"table-wrapper flex-1 overflow-auto",children:l?e.jsxs("div",{className:"loading-container flex items-center justify-center h-full",children:[e.jsx(ge,{className:"w-8 h-8 animate-spin text-gray-400"}),e.jsx("span",{className:"loading-text ml-3 text-gray-600",children:"Loading table..."})]}):e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"loading-container flex items-center justify-center h-full",children:e.jsx(ge,{className:"w-8 h-8 animate-spin text-gray-400"})}),children:e.jsx(it,{todos:m,columnVisibility:p})})})]})})})]})]})}),e.jsx(Za,{open:c.spaceDialogOpen,editingSpace:c.editingSpace,editingSpaceFilters:c.editingSpaceFilters,onOpenChange:c.setSpaceDialogOpen,onFiltersChange:c.setEditingSpaceFilters,onSave:c.handleSpaceConfigSave,onReset:c.handleSpaceConfigReset})]})}export{kt as KanbanPage};
