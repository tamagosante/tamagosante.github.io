import{r as t,j as e}from"./react-vendor-CrhW4DYn.js";import{L as Q,O as A,I as f,S as D,a as L,b as R,c as T,d as V,B}from"./index-CgyRe94A.js";import{g,f as X}from"./format-utils-Ba8uG3XU.js";import{s as w}from"./systemPromptService-CiGRUnu2.js";import{I as Y}from"./InputWithAudio-CUvh-Dx_.js";import{M as ee,B as _,U as se,S as te,a as ae}from"./icons-6Gjq1X59.js";import"./utils-DPdF7W5J.js";import"./radix-ui-BcQf1l4u.js";import"./ui-utils-BxIQ3qGg.js";import"./textarea-DhMMW6X3.js";const K=Q.map(a=>({value:a,label:a})),U=K[0].value;function he({logger:a}){const[d,x]=t.useState([]),[u,I]=t.useState(""),[y,C]=t.useState(!1),[q,k]=t.useState(!1),[o,z]=t.useState(U),[E,F]=t.useState(new A(U)),[p,J]=t.useState([]),[N,v]=t.useState(""),M=t.useRef(null),O=t.useRef(null),j=t.useRef(null);t.useEffect(()=>{const s=w.getSystemPrompts(),n=w.getSelectedSystemPromptId();if(J(s),n)v(n);else if(s.length>0){const l=s.find(S=>S.isDefault)??s[0];v(l.id)}},[]),t.useEffect(()=>{F(new A(o)),a.info(`Switched to model: ${o}`)},[o,a]);const W=t.useCallback(s=>{v(s),w.setSelectedSystemPrompt(s);const n=p.find(l=>l.id===s);a.info(`Switched to system prompt: ${n==null?void 0:n.name}`)},[p,a]),P=t.useCallback(()=>{var s;(s=M.current)==null||s.scrollIntoView({behavior:"smooth"})},[]);t.useEffect(()=>{P()},[d,P]),t.useEffect(()=>{var s;(s=O.current)==null||s.focus()},[]);const b=t.useCallback(async()=>{var $;if(!u.trim()||y)return;const s={id:g(),role:"user",content:u.trim(),timestamp:new Date};x(r=>[...r,s]),I(""),C(!0);const n=p.find(r=>r.id===N),l=n==null?void 0:n.content;a.info(`Sending message to Ollama: ${s.content}`),a.info(`Using system prompt: ${(n==null?void 0:n.name)??"None"}`);const S=new AbortController;j.current=S;try{const r={id:g(),role:"assistant",content:"",timestamp:new Date};x(m=>[...m,r]),k(!0);const i=[];l&&i.push({role:"system",content:l}),d.forEach(m=>{i.push({role:m.role,content:m.content})}),i.push({role:"user",content:s.content});const c=await E.chat(i,o,{stream:!0,signal:S.signal,onStreamChunk:m=>{x(H=>H.map(h=>h.id===r.id&&h.role==="assistant"?{...h,content:h.content+m}:h))}});if(a.info("Streaming response completed from Ollama API"),!(($=c==null?void 0:c.message)!=null&&$.content))throw a.error(`No response content received from Ollama API. Response: ${JSON.stringify(c,null,2)}`),new Error("No response content received")}catch(r){if(r instanceof Error&&r.name==="AbortError")a.info("Streaming stopped by user");else{a.error(`Chat API error: ${String(r)}`);const i={id:g(),role:"assistant",content:"Sorry, I encountered an error while processing your message. Please make sure Ollama is running on localhost:11434.",timestamp:new Date};x(c=>[...c,i])}}finally{C(!1),k(!1),j.current=null}},[u,y,a,E,p,N,o,d]),Z=t.useCallback(()=>{j.current&&(j.current.abort(),a.info("Stopping stream..."))},[a]),G=t.useCallback(s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),b())},[b]);return e.jsxs("div",{className:"chat-container flex flex-col h-full max-h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"chat-header-controls flex items-center justify-between p-4 border-b gap-4",children:[e.jsxs("div",{className:"system-prompt-selector-wrapper flex items-center gap-2",children:[e.jsx(ee,{className:`system-prompt-icon ${f.sm} text-muted-foreground`}),e.jsxs(D,{value:N,onValueChange:W,children:[e.jsx(L,{className:"system-prompt-selector w-64",children:e.jsx(R,{placeholder:"Select system prompt"})}),e.jsx(T,{className:"system-prompt-options",children:p.map(s=>e.jsx(V,{value:s.id,className:"system-prompt-option",children:e.jsxs("div",{className:"system-prompt-details flex flex-col",children:[e.jsx("span",{className:"system-prompt-name font-medium",children:s.name}),e.jsx("span",{className:"system-prompt-description text-xs text-muted-foreground",children:s.description})]})},s.id))})]})]}),e.jsxs(D,{value:o,onValueChange:s=>z(s),children:[e.jsx(L,{className:"model-selector w-48",children:e.jsx(R,{placeholder:"Select model"})}),e.jsx(T,{className:"model-options",children:K.map(s=>e.jsx(V,{value:s.value,className:"model-option",children:e.jsxs("div",{className:"model-details flex flex-col",children:[e.jsx("span",{className:"model-name font-medium",children:s.label}),s.description&&e.jsx("span",{className:"model-description text-xs text-muted-foreground",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{className:"messages-container flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[d.length===0?e.jsxs("div",{className:"empty-chat-state text-center text-muted-foreground py-8",children:[e.jsx(_,{className:"empty-chat-icon w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"empty-chat-title",children:"Start a conversation with Ollama"}),e.jsx("p",{className:"empty-chat-subtitle text-sm mt-1",children:"Make sure Ollama is running on localhost:11434"})]}):d.map(s=>e.jsxs("div",{className:`message-wrapper flex gap-3 ${s.role==="user"?"message-user justify-end":"message-assistant justify-start"}`,children:[s.role==="assistant"&&e.jsx("div",{className:"assistant-avatar flex-shrink-0",children:e.jsx("div",{className:"assistant-avatar-circle w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(_,{className:`assistant-avatar-icon ${f.sm} text-primary`})})}),e.jsx("div",{className:`message-bubble max-w-[70%] rounded-lg px-4 py-2 ${s.role==="user"?"user-message-bubble bg-primary text-primary-foreground":"assistant-message-bubble bg-muted"}`,children:s.role==="assistant"&&s.content===""?e.jsxs("div",{className:"thinking-indicator flex items-center space-x-1",children:[e.jsx("div",{className:"thinking-dot-1 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce"}),e.jsx("div",{className:"thinking-dot-2 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"thinking-dot-3 w-2 h-2 bg-muted-foreground/60 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"thinking-text text-sm text-muted-foreground ml-2",children:"Thinking..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"message-content whitespace-pre-wrap text-sm",children:s.content}),e.jsx("p",{className:"message-timestamp text-xs mt-1 opacity-70",children:X(s.timestamp)})]})}),s.role==="user"&&e.jsx("div",{className:"user-avatar flex-shrink-0",children:e.jsx("div",{className:"user-avatar-circle w-8 h-8 rounded-full bg-primary flex items-center justify-center",children:e.jsx(se,{className:`user-avatar-icon ${f.sm} text-primary-foreground`})})})]},s.id)),e.jsx("div",{ref:M,className:"messages-end-anchor"})]}),e.jsx("div",{className:"chat-input-area border-t p-4",children:e.jsxs("div",{className:"chat-input-wrapper flex gap-2",children:[e.jsx(Y,{ref:O,value:u,onChange:I,onKeyPress:G,placeholder:"Type your message...",disabled:y,className:"flex-1"}),q?e.jsx(B,{onClick:Z,size:"icon",variant:"destructive",className:"stop-button",children:e.jsx(te,{className:`stop-icon ${f.sm}`})}):e.jsx(B,{onClick:b,disabled:!u.trim()||y,size:"icon",className:"send-button",children:e.jsx(ae,{className:`send-icon ${f.sm}`})})]})})]})}export{he as Chat};
