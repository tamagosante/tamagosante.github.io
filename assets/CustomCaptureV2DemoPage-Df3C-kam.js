import{j as e,r as u}from"./react-vendor-Byz07MLO.js";import{t as G}from"./utils-G1l1U0hd.js";import{S as Se,h as Ae,i as Jt,j as _e,k as ne,a2 as je,L as ye,I as ve,a as ae,l as us,aI as Wn,aq as et,a7 as Un,bT as Hn,bU as Gn,b3 as Kn,aS as Jn,aT as Yn,aU as Xn,H as ke,ar as Qn,c0 as Zn,at as ea,aB as ta}from"./index-hTFRJyrx.js";import{ag as Yt,by as ys,bz as sa,S as na,bs as Bt,b0 as aa,D as la,T as Ve,ab as ra,U as vs,C as Be,X as Le,q as ia,c as ca,Q as Xt,bK as oa,aB as da,as as vt,$ as Ns,a2 as tt,aM as gt,i as ua,br as ha,E as ws,z as Dt,af as Cs,bt as pa,aa as ma,R as ks,a4 as xa,W as fa,_ as ga,f as ba,g as Xe,b1 as Qt,O as bt,e as ja,l as ya,bh as va,bL as Na}from"./icons-yhbeTEay.js";import{D as Ss}from"./DraggableCrudTree-BWkC8K4c.js";import{T as st}from"./TftCardTabs-DP2w7Gz4.js";import"./radix-ui-9f16WUVy.js";import"./ui-utils-BxIQ3qGg.js";import"./DragDropManager-CacIWg_Z.js";import"./treeHelpers-DUv_6quS.js";const W={50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",800:"#1f2937"},pe={100:"#dbeafe",500:"#3b82f6",600:"#2563eb",800:"#1e40af"},_t={100:"#e0e7ff",600:"#4f46e5"},ge={100:"#dcfce7",200:"#bbf7d0",300:"#86efac",500:"#22c55e",600:"#16a34a",800:"#166534"},we={50:"#fef2f2",100:"#fee2e2",500:"#ef4444",600:"#dc2626"},pt={100:"#fef9c3",300:"#fde047",400:"#facc15",700:"#a16207"},wa={500:"#06b6d4"},Ca={highlight:"#f800dd80"},D={primary:W[800],secondary:W[600],muted:W[500],placeholder:W[400],white:"#ffffff",danger:we[600]},L={white:"#ffffff",paper:W[50],subtle:W[100],muted:W[200],primary:pe[500],primaryLight:"rgba(59, 130, 246, 0.15)",whiteAlpha:"rgba(255, 255, 255, 0.8)",success:ge[100],secondary:W[200]},he={default:W[300],light:W[200],primary:pe[500],error:we[500]},Pe={includedBg:ge[100],includedBorder:ge[500],excludedBg:we[100],excludedBorder:we[500],checkBg:ge[500]},be={selectedBg:_t[100],checkBorder:_t[600],checkBg:_t[600],attrBg:pe[100],attrColor:pe[800]},Te={errorBg:we[50],errorText:we[500],successBg:ge[100],successText:ge[600],neutralBg:W[100],neutralText:W[500]},It={selector:{bg:pt[100],bgHover:pt[300],border:pt[400],text:pt[700]},selectorEmpty:{bg:"hsl(var(--background))",bgHover:"hsl(var(--muted))",border:"hsl(var(--border))",text:"hsl(var(--muted-foreground))"},content:{bg:ge[100],bgHover:ge[200],border:ge[300],text:ge[800]}},hs={outline:wa[500],background:Ca.highlight},re={fieldName:pe[600],fieldNameUnderscore:pe[500],punctuation:W[800],collapsedLabel:W[400],nullValue:W[400],genericValue:W[500],arrayIndex:W[400]},Y={primary:pe[600],tabActiveBg:L.white,tabInactiveBg:W[100],tabActiveText:pe[600],tabInactiveText:W[500],tabActiveBorder:pe[600]},$={bg:L.white,text:W[800],border:W[300],itemText:W[800],dangerText:we[600]},ee={muted:W[500],secondary:W[600],primary:pe[500],success:ge[600],danger:we[600]},ie={bg:L.white,headerText:W[500],sectionBorder:W[200],emptyText:W[400]},$e={bg:W[50],border:W[300],borderError:we[500],text:W[800]},Ne={outline:`2px solid ${hs.outline}`,outlineOffset:"2px",background:hs.background},Ft={collapsed:12,expanded:50},ka=[{id:"champions",name:"champions",type:"array",order:0,parentId:null,mapping:null},{id:"cost",name:"cost",type:"string",order:0,parentId:"champions",mapping:null},{id:"traits",name:"traits",type:"string",order:1,parentId:"champions",mapping:null},{id:"type",name:"type",type:"string",order:2,parentId:"champions",mapping:null},{id:"ability",name:"ability",type:"object",order:3,parentId:"champions",mapping:null},{id:"manaCost",name:"manaCost",type:"string",order:0,parentId:"ability",mapping:null},{id:"description",name:"description",type:"string",order:1,parentId:"ability",mapping:null},{id:"activation",name:"activation",type:"array",order:2,parentId:"ability",mapping:null},{id:"kind",name:"kind",type:"string",order:0,parentId:"activation",mapping:null},{id:"value",name:"value",type:"string",order:1,parentId:"activation",mapping:null},{id:"calculation",name:"calculation",type:"string",order:2,parentId:"activation",mapping:null},{id:"valuePerLevel",name:"valuePerLevel",type:"string",order:3,parentId:"activation",mapping:null}],Sa={champions:{_container:"",_item:"",cost:"",traits:"",type:"",ability:{manaCost:"",description:"",activation:{_container:"",_item:"",kind:"",value:"",calculation:"",valuePerLevel:""}}}},Aa={champions:{_container:".mb-8",_item:".rounded.text-white1.w-\\[291px\\].flex.flex-col.h-full.bg-bg",_if:{selector:".leading-snug.pb-3",condition:"exists"},_branches:{1:{match:"/true/",unlockCondition:".leading-snug.pb-3 .leading-tight"},2:{match:"/./"}},name:{selector:".relative.flex.justify-between.p-\\[9px\\].bg-bg.text-\\[18px\\].font-montserrat.font-semibold.rounded-\\[3px\\]",index:null,excludeChildren:[".flex.items-end"]},cost:".flex.items-end.text-\\[16px\\]",traits:".absolute.text-lg.leading-snug.bottom-\\[6px\\].left-\\[6px\\]",type:".mb-2.bg-bg2.rounded-lg.px-2.py-1.font-montserrat.font-medium.self-start",unlockCondition:"",ability:{_container:".p-3.flex.flex-col.text-sm",name:".font-medium.text-sm",manaCost:".pt-\\[1px\\]",description:".leading-tight:not(.inline)",activation:{_container:".flex.flex-col.gap-\\[2px\\]",_item:".flex.flex-wrap.justify-between",kind:".leading-tight > span:first-child",type:"img@alt",value:".text-sky-11, .text-yellow-11, .text-tomato-11",calculation:".text-yellow-11",valuePerLevel:".text-white2"}}}};function _a({mode:t,moreActionsOpen:n,onModeChange:s,onMoreActionsOpenChange:a,onSave:l,onManage:r,onAdvancedSettings:c,onDownload:o,onClear:i,portalContainer:d}){return e.jsxs(e.Fragment,{children:[e.jsxs(Se,{value:t,onValueChange:h=>s(h),children:[e.jsx(Ae,{className:"h-6 w-20 text-xs",style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"capture-mode-select-v2",children:e.jsx(Jt,{})}),e.jsxs(_e,{style:{backgroundColor:$.bg,color:$.text},"data-test":"capture-mode-options-v2",container:d,children:[e.jsx(ne,{value:"mapped",style:{color:$.itemText},"data-test":"capture-mode-mapped-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Yt,{className:"w-3 h-3"}),"Mapped"]})}),e.jsx(ne,{value:"list",style:{color:$.itemText},"data-test":"capture-mode-list-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"}),"List"]})})]})]}),e.jsxs(Se,{open:n,onOpenChange:a,value:"",onValueChange:h=>{a(!1),h==="save"?l():h==="manage"?r():h==="advanced"?c():h==="download"?o():h==="clear"&&i()},children:[e.jsx(Ae,{className:"h-6 w-6 px-0 border-0 shadow-none bg-transparent","data-test":"more-actions-select-v2",hideChevron:!0,children:e.jsx(sa,{className:"w-4 h-4",style:{color:ee.muted}})}),e.jsxs(_e,{style:{backgroundColor:$.bg,color:$.text},"data-test":"more-actions-options-v2",container:d,children:[e.jsx(ne,{value:"save",style:{color:$.itemText},"data-test":"action-save-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-3 h-3"}),"Quick Save"]})}),e.jsx(ne,{value:"manage",style:{color:$.itemText},"data-test":"action-manage-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"w-3 h-3"}),"Manage Saved Data"]})}),e.jsx(ne,{value:"advanced",style:{color:$.itemText},"data-test":"action-advanced-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"w-3 h-3"}),"Advanced Settings"]})}),e.jsx(ne,{value:"download",style:{color:$.itemText},"data-test":"action-download-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(la,{className:"w-3 h-3"}),"Download JSON"]})}),e.jsx(ne,{value:"clear",style:{color:$.dangerText},"data-test":"action-clear-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Clear Data"]})})]})]})]})}const Ia=[{value:"string",label:"Text",icon:"T"},{value:"number",label:"Number",icon:"#"},{value:"boolean",label:"Boolean",icon:"?"},{value:"array",label:"Array",icon:"[]"},{value:"parentSelector",label:"Parent",icon:"{1}"},{value:"object",label:"Object",icon:"{}"}];function Ea({isOpen:t,suggestedName:n,editingField:s,onSubmit:a,onCancel:l,portalContainer:r}){const[c,o]=u.useState(""),[i,d]=u.useState("string"),[h,m]=u.useState(""),[y,j]=u.useState(""),v=u.useRef(null),w=!!s;u.useEffect(()=>{t&&(s?(o(s.name),d(s.type),m(s.containerSelector||""),j(s.itemSelector||"")):(o(n),d("string"),m(""),j("")),setTimeout(()=>{var p;return(p=v.current)==null?void 0:p.focus()},100))},[t,n,s]);const f=()=>{const p={name:c.trim(),type:i};return i==="array"&&(h.trim()&&(p.containerSelector=h.trim()),y.trim()&&(p.itemSelector=y.trim())),p};u.useEffect(()=>{if(!t)return;const p=b=>{b.key==="Escape"?l():b.key==="Enter"&&c.trim()&&a(f())};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,c,i,h,y,a,l]);const g=()=>{c.trim()&&a(f())};return e.jsx(je,{isVisible:t,onClose:l,title:w?"Update Field":"Add Field",shouldCloseManually:!0,initialPosition:{x:window.innerWidth/2-175,y:window.innerHeight/3},className:"!w-[350px]",portalContainer:r,children:e.jsxs("div",{className:"p-3","data-test":"field-dialog",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(ye,{htmlFor:"field-name",className:"text-xs text-foreground font-medium",children:"Field Name"}),e.jsx(ve,{ref:v,id:"field-name",value:c,onChange:p=>o(p.target.value),placeholder:"e.g., title, author, description",className:"mt-1 text-foreground","data-test":"field-name-input"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(ye,{className:"text-xs text-foreground font-medium",children:"Field Type"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-1","data-test":"field-type-selector",children:Ia.map(p=>e.jsxs("button",{type:"button",onClick:()=>d(p.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.stopPropagation(),d(p.value))},className:"flex flex-col items-center p-2 rounded border text-xs transition-colors",style:{borderColor:i===p.value?pe[500]:void 0,backgroundColor:i===p.value?L.primaryLight:void 0,color:i===p.value?pe[500]:void 0,fontWeight:i===p.value?500:void 0},title:p.label,"data-test":"field-type","data-selected":i===p.value,children:[e.jsx("span",{className:"font-mono text-sm",children:p.icon}),e.jsx("span",{className:"text-[10px] mt-0.5",children:p.label})]},p.value))})]}),i==="array"&&e.jsxs("div",{className:"mb-4 space-y-3","data-test":"array-selectors",children:[e.jsxs("div",{children:[e.jsx(ye,{htmlFor:"container-selector",className:"text-xs text-foreground font-medium",children:"Container Selector"}),e.jsx(ve,{id:"container-selector",value:h,onChange:p=>m(p.target.value),placeholder:"e.g., .item-list, #products",className:"mt-1 text-foreground font-mono text-xs","data-test":"container-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Parent element containing all items"})]}),e.jsxs("div",{children:[e.jsx(ye,{htmlFor:"item-selector",className:"text-xs text-foreground font-medium",children:"Item Selector"}),e.jsx(ve,{id:"item-selector",value:y,onChange:p=>j(p.target.value),placeholder:"e.g., .item, > div",className:"mt-1 text-foreground font-mono text-xs","data-test":"item-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Selector for each item (relative to container)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ae,{variant:"ghost",size:"sm",onClick:l,"data-test":"field-dialog-cancel",children:"Cancel"}),e.jsx(ae,{size:"sm",onClick:g,disabled:!c.trim(),"data-test":"field-dialog-submit",children:w?"Update Field":"Add Field"})]})]})})}function Oa({isOpen:t,fieldName:n,values:s,onClose:a,onItemHover:l,onItemClick:r,portalContainer:c}){if(!t)return null;const o=i=>{if(i===null)return"null";if(i===void 0)return"undefined";if(typeof i=="string")return i;if(typeof i=="number"||typeof i=="boolean")return String(i);if(typeof i=="object")try{return JSON.stringify(i,null,2)}catch{return"[Object]"}return String(i)};return e.jsx(je,{isVisible:t,onClose:a,title:`Content: ${n}`,initialPosition:{x:window.innerWidth/2-200,y:100},initialSize:{width:400,height:300},portalContainer:c,resizable:!0,showPinButton:!1,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"content-popover-body-v2",style:{backgroundColor:ie.bg},children:s.length===0?e.jsx("div",{className:"text-sm italic",style:{color:ie.emptyText},"data-test":"content-popover-empty-v2",children:"No values extracted"}):s.length===1?e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words font-mono",style:{color:D.primary,backgroundColor:L.paper,padding:"8px",borderRadius:"4px"},"data-test":"content-popover-single-value-v2",children:o(s[0])}):e.jsxs("div",{className:"space-y-2","data-test":"content-popover-values-list-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2",style:{color:D.muted},"data-test":"content-popover-count-v2",children:[s.length," values extracted"]}),s.map((i,d)=>e.jsxs("div",{className:"text-sm whitespace-pre-wrap break-words font-mono cursor-pointer transition-colors",style:{color:D.primary,backgroundColor:L.paper,padding:"8px",borderRadius:"4px",borderLeft:`3px solid ${he.primary}`},onMouseEnter:()=>l==null?void 0:l(d),onMouseLeave:()=>l==null?void 0:l(null),onClick:()=>r==null?void 0:r(d),"data-test":`content-popover-value-v2-${d}`,children:[e.jsxs("span",{className:"text-xs font-medium mr-2",style:{color:D.muted},children:["[",d,"]"]}),o(i)]},d))]})})})}const Ta=`{
  "champions": {
    "_container": "[data-test='tft-cards-v2']",
    "_item": ".rounded.text-white1",
    "cost": ".flex.items-end",
    "traits": ".absolute.text-lg",
    "type": ".bg-bg2.rounded-lg"
  }
}`;function Ba({isOpen:t,onImport:n,onClose:s,portalContainer:a}){const[l,r]=u.useState(""),[c,o]=u.useState(null),i=()=>{if(o(null),!l.trim()){o("Please enter JSON");return}try{const m=JSON.parse(l);n(m),r(""),s()}catch(m){o(m instanceof Error?m.message:"Invalid JSON")}},d=()=>{r(""),o(null),s()},h=()=>{r(Ta),o(null)};return t?e.jsx(je,{isVisible:t,onClose:d,title:"Import Schema",shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth/2-200,y:window.innerHeight/4},initialSize:{width:400,height:350},portalContainer:a,children:e.jsxs("div",{className:"flex flex-col h-full p-3 gap-3","data-test":"import-dialog-content-v2",children:[e.jsx("div",{className:"flex gap-2","data-test":"import-example-buttons-v2",children:e.jsx("button",{onClick:h,className:"text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:L.subtle,color:D.secondary},"data-test":"import-example-v2",children:"Load Example"})}),e.jsx("textarea",{autoFocus:!0,value:l,onChange:m=>{r(m.target.value),o(null)},placeholder:"Paste JSON selectors here...",className:"flex-1 min-h-0 p-2 text-xs font-mono rounded border resize-none",style:{backgroundColor:$e.bg,borderColor:c?$e.borderError:$e.border,color:$e.text},"data-test":"import-json-input-v2"}),c&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded text-xs",style:{backgroundColor:Te.errorBg,color:D.danger},"data-test":"import-error-v2",children:[e.jsx(ra,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:c})]}),e.jsxs("div",{className:"flex justify-end gap-2","data-test":"import-actions-v2",children:[e.jsx(ae,{variant:"outline",size:"sm",onClick:d,"data-test":"import-cancel-button-v2",children:"Cancel"}),e.jsxs(ae,{size:"sm",onClick:i,className:"gap-1","data-test":"import-confirm-button-v2",children:[e.jsx(vs,{className:"w-3 h-3"}),"Import"]})]})]})}):null}function Da({isOpen:t,savedCaptures:n,onLoad:s,onRename:a,onDelete:l,onClose:r,portalContainer:c}){const[o,i]=u.useState(null),[d,h]=u.useState("");if(!t)return null;const m=f=>new Date(f).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=f=>{i(f.id),h(f.name)},j=()=>{o&&d.trim()&&(a(o,d.trim()),i(null),h(""))},v=()=>{i(null),h("")},w=f=>{f.key==="Enter"?j():f.key==="Escape"&&v()};return e.jsx(je,{isVisible:t,onClose:r,title:"Manage Saved Data",initialPosition:{x:window.innerWidth/2-225,y:100},initialSize:{width:450,height:400},resizable:!0,showPinButton:!1,portalContainer:c,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"saved-data-manager-body",style:{backgroundColor:ie.bg},children:n.length===0?e.jsx("div",{className:"text-sm italic text-center py-8",style:{color:ie.emptyText},"data-test":"saved-data-manager-empty",children:"No saved captures yet"}):e.jsx("div",{className:"space-y-2","data-test":"saved-data-manager-list",children:n.map(f=>e.jsx("div",{className:"flex items-center gap-2 p-2 rounded border",style:{backgroundColor:L.paper,borderColor:he.light},"data-test":`saved-capture-item-${f.id}`,children:o===f.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(ve,{value:d,onChange:g=>h(g.target.value),onKeyDown:w,className:"h-7 text-sm",autoFocus:!0,"data-test":"saved-capture-edit-input"}),e.jsx(ae,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:j,"data-test":"saved-capture-edit-save",children:e.jsx(Be,{className:"w-4 h-4",style:{color:ee.success}})}),e.jsx(ae,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:v,"data-test":"saved-capture-edit-cancel",children:e.jsx(Le,{className:"w-4 h-4",style:{color:ee.muted}})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",style:{color:D.primary},"data-test":"saved-capture-name",children:f.name}),e.jsx("div",{className:"text-xs",style:{color:D.placeholder},"data-test":"saved-capture-date",children:m(f.capturedAt)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>s(f.id),title:"Load","data-test":"saved-capture-load",children:e.jsx(ia,{className:"w-4 h-4",style:{color:ee.primary}})}),e.jsx(ae,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>y(f),title:"Rename","data-test":"saved-capture-rename",children:e.jsx(ca,{className:"w-4 h-4",style:{color:ee.muted}})}),e.jsx(ae,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>l(f.id),title:"Delete","data-test":"saved-capture-delete",children:e.jsx(Ve,{className:"w-4 h-4",style:{color:ee.danger}})})]})]})},f.id))})})})}function Fa({isOpen:t,preventDefaultOnInteraction:n,onPreventDefaultChange:s,continuousMode:a,onContinuousModeChange:l,onClose:r,portalContainer:c}){return t?e.jsx(je,{isVisible:t,onClose:r,title:"Advanced Settings",initialPosition:{x:window.innerWidth/2-175,y:150},initialSize:{width:350,height:260},resizable:!0,showPinButton:!1,portalContainer:c,children:e.jsxs("div",{className:"p-4 space-y-4","data-test":"advanced-settings-body",style:{backgroundColor:ie.bg},children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-prevent-default",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ye,{htmlFor:"prevent-default",className:"text-sm font-medium",style:{color:D.primary},children:"Prevent default on interaction"}),e.jsx("p",{className:"text-xs",style:{color:D.muted},children:"Prevents clicks from triggering page actions during capture mode"})]}),e.jsx(us,{id:"prevent-default",checked:n,onCheckedChange:s,"data-test":"prevent-default-switch"})]}),e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-continuous-mode",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ye,{htmlFor:"continuous-mode",className:"text-sm font-medium",style:{color:D.primary},children:"Continuous capture mode"}),e.jsx("p",{className:"text-xs",style:{color:D.muted},children:"Auto-advance to next empty field after capturing a selector"})]}),e.jsx(us,{id:"continuous-mode",checked:a,onCheckedChange:l,"data-test":"continuous-mode-switch"})]})]})}):null}const Pa=/\[(\d*)(:)?(\d*)?\]$/;function Ie(t){const n=t.trim(),s=n.match(Pa);if(!s)return{selector:n,indexSpec:null};const[a,l,r,c]=s,o=r===":",i=n.slice(0,-a.length);if(i==="")return{selector:n,indexSpec:null};const d=a.slice(1,-1);if(!/^(\d*):?(\d*)$/.test(d))return{selector:n,indexSpec:null};const h=i;let m;if(o)if(l&&c)m={type:"range",start:parseInt(l,10),end:parseInt(c,10)};else if(l)m={type:"from",start:parseInt(l,10)};else if(c)m={type:"to",end:parseInt(c,10)};else return{selector:n,indexSpec:null};else{if(l==="")return{selector:n,indexSpec:null};m={type:"single",index:parseInt(l,10)}}return{selector:h,indexSpec:m}}function Re(t,n){if(!n)return t;switch(n.type){case"single":return`${t}[${n.index}]`;case"from":return`${t}[${n.start}:]`;case"to":return`${t}[:${n.end}]`;case"range":return`${t}[${n.start}:${n.end}]`}}function As(t,n){if(!n)return t;switch(n.type){case"single":{const s=t[n.index];return s?[s]:[]}case"from":return t.slice(n.start);case"to":return t.slice(0,n.end);case"range":return t.slice(n.start,n.end)}}function Pt(t,n,s){const[a,l]=t<=n?[t,n]:[n,t];return a===0&&l===s-1?null:a===l?{type:"single",index:a}:a===0?{type:"to",end:l+1}:l===s-1?{type:"from",start:a}:{type:"range",start:a,end:l+1}}function Zt(t){if(!t)return"all";switch(t.type){case"single":return`[${t.index}]`;case"from":return`[${t.start}:]`;case"to":return`[:${t.end}]`;case"range":return`[${t.start}:${t.end}]`}}function _s(t,n,s){if(!n)return!1;switch(n.type){case"single":return t===n.index;case"from":return t>=n.start&&t<s;case"to":return t>=0&&t<n.end;case"range":return t>=n.start&&t<n.end}}function Is(t){return t?t.type!=="single":!1}function H(t){return typeof t=="object"&&t!==null&&"selector"in t&&typeof t.selector=="string"}function Nt(t){const n=t.match(/@([a-zA-Z0-9-_]+)$/);let s=t,a;n&&(a=n[1],s=t.slice(0,-n[0].length));const l=Ie(s);return{selector:l.selector,index:l.indexSpec,extractAttribute:a}}function es(t){let n=Re(t.selector,t.index);return t.extractAttribute&&(n+=`@${t.extractAttribute}`),n}function me(t){return typeof t=="string"?t:es(t)}function Es(t){if(typeof t=="string"){const n=t.lastIndexOf("@");return n>0?t.substring(0,n):t}return Re(t.selector,t.index)}function Qe(t){return typeof t=="string"&&t.length>0?!0:typeof t=="object"&&t!==null&&"selector"in t&&"condition"in t&&typeof t.selector=="string"&&["exists","text","html"].includes(t.condition)}function Os(t){return typeof t=="string"?{selector:t,condition:"exists"}:t}function wt(t){if(typeof t!="object"||t===null)return!1;for(const n of Object.values(t))if(typeof n!="object"||n===null||!("match"in n)||typeof n.match!="string")return!1;return!0}function ts(t,n){var l;const s=Os(t),a=n.querySelector(s.selector);switch(s.condition){case"exists":return a?"true":"false";case"text":return((l=a==null?void 0:a.textContent)==null?void 0:l.trim())??"";case"html":return(a==null?void 0:a.innerHTML)??""}}function ss(t,n){for(const[s,a]of Object.entries(t)){const l=a.match;let r=l;l.startsWith("/")&&l.endsWith("/")&&(r=l.slice(1,-1));try{if(new RegExp(r).test(n))return{branchKey:s,branch:a}}catch{console.warn(`[CustomCapture] Invalid regex pattern: ${l}`)}}return null}function Mt(t){return"_branchFields"in t&&Array.isArray(t._branchFields)&&"_activeBranch"in t&&typeof t._activeBranch=="number"&&"_branches"in t&&typeof t._branches=="object"&&t._branches!==null}function Ma(t){const n=t.lastIndexOf("@");return n>0?t.substring(0,n):t}function Je(t,n=document){const s=Ma(t),{selector:a,indexSpec:l}=Ie(s),r=Array.from(n.querySelectorAll(a));return As(r,l)}function Ze(t,n=document){return Je(t,n)[0]??null}const $a=Object.freeze(Object.defineProperty({__proto__:null,applyIndexSpec:As,buildIndexedSelector:Re,createRangeIndexSpec:Pt,evaluateIfCondition:ts,findMatchingBranch:ss,formatIndexSpec:Zt,getCssSelectorOnly:Es,getSelectorString:me,hasBranchingConfig:Mt,isBranches:wt,isIfCondition:Qe,isIndexInSpec:_s,isRangeSpec:Is,isSelectorField:H,normalizeIfCondition:Os,parseIndexedSelector:Ie,querySelectorOneWithIndex:Ze,querySelectorWithIndex:Je,toSelectorField:Nt,toSelectorString:es},Symbol.toStringTag,{value:"Module"}));function Ra({baseSelector:t,totalCount:n,currentIndexSpec:s,onSelectorChange:a}){const[l,r]=u.useState(!1),[c,o]=u.useState(null),i=u.useCallback(()=>{r(j=>!j),o(null)},[]),d=u.useCallback(()=>{o(null)},[]),h=u.useCallback((j,v)=>{if(v&&(s==null?void 0:s.type)==="single"){const g=Pt(s.index,j,n),p=Re(t,g);a(p,g);return}if(l){if(c===null)o(j);else{const g=Pt(c,j,n),p=Re(t,g);a(p,g),o(null),r(!1)}return}const w={type:"single",index:j},f=Re(t,w);a(f,w)},[l,c,t,n,s,a]),m=u.useCallback(j=>{const v=Ie(j);a(j,v.indexSpec)},[a]),y=l&&c!==null?`[${c}:?]`:null;return{isRangeMode:l,toggleRangeMode:i,rangeStartIndex:c,handleMatchClick:h,handleTextInput:m,resetRangeSelection:d,pendingRangeDisplay:y}}function Ge(t){var a;const n=((a=t.textContent)==null?void 0:a.trim())??"",s=n.length>97?n.slice(0,97)+"...":n;return{tag:t.tagName.toLowerCase(),classes:Array.from(t.classList),id:t.id||null,textContent:s,element:t}}function xt(t,n=document){var s;if(!t||t.trim()==="")return null;try{const a=Ie(t),l=a.selector,r=((s=a.indexSpec)==null?void 0:s.type)==="single"?a.indexSpec.index:null,c=Array.from(n.querySelectorAll(l));if(c.length===0)return null;const o=r??0,i=c[o]??c[0],d=c.length,h=c.map(Ge),m=i.parentElement;if(!m)return{parent:null,siblings:[Ge(i)],capturedIndex:0,selector:t,baseSelector:l,matchIndex:o,matchCount:d,matches:h};const y=Array.from(m.children),j=y.indexOf(i);return{parent:Ge(m),siblings:y.map(Ge),capturedIndex:j>=0?j:0,selector:t,baseSelector:l,matchIndex:o,matchCount:d,matches:h}}catch{return null}}function Va(t,n){const s=t.split("."),a=s[s.length-1];if(a==="_if"||a==="_container"||a==="_item")return[];let l=n,r=null,c=null,o=!1;for(let m=0;m<s.length;m++){const y=s[m];if(typeof l!="object"||l===null)break;const j=l;if(!(y in j))break;if(l=j[y],typeof l=="object"&&l!==null){const v=l;if("_container"in v){const w=v._container,f="_item"in v?v._item:"",g=typeof w=="string"?w:(w==null?void 0:w.selector)??"",p=typeof f=="string"?f:(f==null?void 0:f.selector)??"";g&&(r=g,p?(c=p,o=!1):(c=null,o=!0))}}}if(!r)return[];const i=r.endsWith("[]")?r.slice(0,-2):r,d=Array.from(document.querySelectorAll(i));if(d.length===0)return[];const h=[];for(const m of d)if(o||!c)h.push(m);else{const y=Array.from(m.querySelectorAll(c));h.push(...y)}return h}function $t(t){const n=[t.tag];if(t.id&&n.push(`#${t.id}`),t.classes.length>0){const s=t.classes.slice(0,3);n.push(`.${s.join(".")}`),t.classes.length>3&&n.push(`+${t.classes.length-3}`)}return n.join("")}function Ts(t,n=30){return t.length<=n?t:t.slice(0,n)+"..."}function La({domContext:t,previousChildIndex:n,onSiblingClick:s,onSiblingHover:a,onAddIndex:l,onChildClick:r}){const c=()=>{if(n==null)return null;const o=t.siblings[t.capturedIndex];if(!o)return null;const i=o.element.children;return n>=i.length?null:i[n]};return e.jsxs("div",{className:"flex-1 min-h-0 overflow-auto","data-test":"dom-tree-siblings-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Siblings (",t.siblings.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.siblings.map((o,i)=>{const d=i===t.capturedIndex,h=d?c():null,m=h?Ge(h):null;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsxs("button",{onClick:()=>s(i,o),onMouseEnter:()=>a(o),onMouseLeave:()=>a(null),className:`flex-1 text-left p-2 rounded text-sm font-mono transition-colors ${d?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100 border border-transparent"}`,"data-test":d?"dom-tree-sibling-captured-v2":"dom-tree-sibling-v2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:["[",i,"]"]}),e.jsx("span",{className:d?"text-blue-700":"text-gray-700",children:$t(o)}),d&&e.jsx("span",{className:"text-xs text-blue-500",children:"← captured"})]}),o.textContent&&e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5 truncate",children:['"',Ts(o.textContent),'"']})]}),d&&l&&t.matchCount>1&&e.jsxs("button",{onClick:y=>l(y,t.matchIndex),className:"shrink-0 mt-2 px-1.5 py-0.5 text-xs bg-amber-100 text-amber-700 hover:bg-amber-200 rounded transition-colors flex items-center gap-0.5",title:`Add [${t.matchIndex}] index to selector (${t.matchCount} matches)`,"data-test":"dom-tree-add-index-v2",children:[e.jsx(Xt,{className:"w-3 h-3"}),"[",t.matchIndex,"] of ",t.matchCount]})]}),d&&m&&r&&e.jsxs("div",{className:"ml-4 mt-1 pl-3 border-l-2 border-blue-300","data-test":"dom-tree-previous-child-v2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-400 mb-1",children:"Previous selection - click to go back"}),e.jsxs("button",{onClick:()=>r(n,h),onMouseEnter:()=>a(m),onMouseLeave:()=>a(null),className:"w-full text-left p-2 rounded text-sm font-mono bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-colors flex items-center gap-2","data-test":"dom-tree-previous-child-row-v2",children:[e.jsx(oa,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-blue-600",children:$t(m)})]})]})]},i)})})]})}function za({currentSelector:t,baseSelector:n,currentIndexSpec:s,isRangeMode:a,pendingRangeDisplay:l,onToggleRangeMode:r,onTextInput:c}){const[o,i]=u.useState(!1),[d,h]=u.useState(t),m=u.useRef(!0);u.useEffect(()=>{o||h(t)},[t,o]);const y=u.useCallback(()=>{i(!0),m.current=!0},[]),j=u.useCallback(()=>{i(!1),m.current&&d!==t&&c(d),m.current=!0},[d,t,c]),v=u.useCallback(f=>{h(f.target.value)},[]),w=u.useCallback(f=>{f.key==="Enter"?f.currentTarget.blur():f.key==="Escape"&&(m.current=!1,h(t),f.currentTarget.blur())},[t]);return e.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2 space-y-2","data-test":"index-range-controls",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Current index:"}),e.jsx("span",{className:"font-mono text-amber-600 font-medium",children:l??Zt(s)})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"selector-text-input",children:[e.jsx(ys,{className:"w-3.5 h-3.5 text-gray-400 shrink-0"}),e.jsx("input",{type:"text",value:d,onChange:v,onFocus:y,onBlur:j,onKeyDown:w,className:"flex-1 text-xs font-mono px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-amber-400 focus:border-amber-400",placeholder:"e.g., .selector[1:3]","data-test":"selector-input"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:r,className:`flex items-center gap-1.5 px-2 py-1 text-xs rounded transition-colors ${a?"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,"data-test":"range-mode-toggle",children:[e.jsx(da,{className:"w-3.5 h-3.5"}),a?"Range Mode ON":"Range Mode"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",title:"Hold Shift and click another match to create a range from current selection",children:[e.jsx(vt,{className:"w-3 h-3"}),e.jsx("span",{children:"Shift+click for range"})]})]}),a&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded","data-test":"range-mode-instructions",children:l?`Click end index to complete range ${l}`:"Click start index, then click end index"})]})}function qa({matches:t,selector:n,baseSelector:s,currentIndexSpec:a,isRangeMode:l,rangeStartIndex:r,pendingRangeDisplay:c,onMatchClick:o,onMatchHover:i,onMatchIndexHover:d,onToggleRangeMode:h,onTextInput:m,onSelectorChange:y}){return t.length<=1?null:e.jsxs("div",{className:"mt-3 pt-3 border-t-2 border-dashed border-amber-300","data-test":"dom-tree-matches-v2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"w-3.5 h-3.5 text-amber-600"}),e.jsxs("span",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:["Switch Index (",t.length," matches)"]}),l&&e.jsx("span",{className:"text-xs bg-amber-500 text-white px-1.5 py-0.5 rounded","data-test":"range-mode-badge",children:"RANGE"}),e.jsx("div",{className:"ml-auto flex items-center text-gray-400 hover:text-gray-600 cursor-help",title:`Index Selection:
• Click: select single index [n]
• Shift+click: select range from current
• Range Mode: click start, then end

Range Syntax:
• [0] - first match only
• [1:] - all except first
• [:2] - first two matches
• [1:3] - second and third`,"data-test":"index-help-icon",children:e.jsx(vt,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-40 overflow-y-auto",children:t.map((j,v)=>{const w=_s(v,a,t.length),f=Is(a),g=l&&r===v;return e.jsxs("button",{onClick:p=>o(v,j,p.shiftKey),onMouseEnter:()=>{d?d(v):i(j)},onMouseLeave:()=>{d?d(null):i(null)},className:`px-2 py-1 rounded text-xs font-mono transition-all ${g?"bg-green-500 text-white font-bold shadow-sm ring-2 ring-green-300":f&&w?"bg-purple-500 text-white font-bold shadow-sm":w?"bg-amber-500 text-white font-bold shadow-sm":"bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200"}`,"data-test":"dom-tree-match-item-v2","data-in-range":w?"true":void 0,"data-range-start":g?"true":void 0,title:g?"Range start - click another to complete":Ts(j.textContent,60),children:["[",v,"]"]},v)})}),y&&e.jsx(za,{currentSelector:n,baseSelector:s,currentIndexSpec:a,isRangeMode:l,pendingRangeDisplay:c,onToggleRangeMode:h,onTextInput:m})]})}function Wa({initialSelector:t,onApply:n,portalContainer:s}){const[a,l]=u.useState(()=>[{id:crypto.randomUUID(),value:t||"",isSelected:!0,matchCount:0,isValid:!0}]),r=u.useRef([]),c=u.useRef(null),[o,i]=u.useState(null),d=u.useCallback(()=>{r.current.forEach(x=>{x.style.outline="",x.style.outlineOffset="",x.style.background=""}),r.current=[]},[]);u.useEffect(()=>()=>{d(),c.current&&clearTimeout(c.current)},[d]);const h=u.useCallback(x=>{if(!x.trim())return{count:0,isValid:!0};if(x.startsWith(":scope"))return{count:0,isValid:!0};try{return{count:document.querySelectorAll(x).length,isValid:!0}}catch{return{count:0,isValid:!1}}},[]);u.useEffect(()=>{l(x=>x.map(N=>{if(N.value.trim()){const C=h(N.value);return{...N,matchCount:C.count,isValid:C.isValid}}return N}))},[h]);const m=u.useCallback(x=>{if(d(),!x.trim())return{count:0,isValid:!0};if(x.startsWith(":scope"))return{count:0,isValid:!0};try{const N=document.querySelectorAll(x);return N.forEach(C=>{const S=C;S.style.outline=Ne.outline,S.style.outlineOffset=Ne.outlineOffset,S.style.background=Ne.background,r.current.push(S)}),{count:N.length,isValid:!0}}catch{return{count:0,isValid:!1}}},[d]),y=u.useCallback((x,N)=>{l(C=>C.map(S=>S.id===x?{...S,value:N}:S)),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{const C=m(N);l(S=>S.map(A=>A.id===x?{...A,matchCount:C.count,isValid:C.isValid}:A))},150)},[m]),j=u.useCallback(x=>{const N=a.find(C=>C.id===x);if(N){const C=m(N.value);l(S=>S.map(A=>A.id===x?{...A,matchCount:C.count,isValid:C.isValid}:A))}},[a,m]),v=u.useCallback(x=>{l(N=>N.map(C=>({...C,isSelected:C.id===x})))},[]),w=u.useCallback(()=>{l(x=>[...x,{id:crypto.randomUUID(),value:"",isSelected:!1,matchCount:0,isValid:!0}])},[]),f=u.useCallback(x=>{l(N=>{var S;if(N.length<=1)return N;const C=N.filter(A=>A.id!==x);return(S=N.find(A=>A.id===x))!=null&&S.isSelected&&C.length>0&&(C[0].isSelected=!0),C})},[]),g=u.useCallback(()=>{const x=a.find(N=>N.isSelected);x!=null&&x.value.trim()&&(d(),n(x.value.trim()))},[a,n,d]),p=u.useCallback(x=>{const N=a.find(C=>C.id===x);if(N!=null&&N.value.trim()){try{const C=document.querySelector(N.value.trim());if(!C)return;const S=[];for(const A of Array.from(C.attributes))if(A.name==="class"){const T=A.value.split(/\s+/).filter(E=>E&&/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(E)).slice(0,6);S.push(T.map(E=>`.${E}`).join(""))}else A.name==="id"&&S.push(`#${A.value}`);if(S.length>0){const A=S.join("");l(T=>T.map(E=>E.id===x?{...E,value:A}:E)),setTimeout(()=>{const T=m(A);l(E=>E.map(k=>k.id===x?{...k,matchCount:T.count,isValid:T.isValid}:k))},50)}}catch{}i(null)}},[a,m]),b=a.find(x=>x.isSelected);return e.jsxs("div",{className:"p-3 h-full flex flex-col",style:{backgroundColor:ie.bg},"data-test":"custom-selector-content",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:ie.headerText},children:"Custom Selectors - type CSS selectors to test"}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2","data-test":"custom-selector-inputs",children:a.map(x=>e.jsxs("div",{className:"flex items-start gap-2","data-test":"custom-selector-row",children:[e.jsx("button",{onClick:()=>v(x.id),className:"mt-2 w-4 h-4 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors",style:{borderColor:x.isSelected?he.primary:he.default,backgroundColor:x.isSelected?L.primary:"transparent"},title:"Select this selector","data-test":"custom-selector-radio",children:x.isSelected&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:L.white}})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Wn,{value:x.value,onChange:N=>y(x.id,N.target.value),onFocus:()=>j(x.id),placeholder:"Enter CSS selector...",rows:1,className:"text-xs font-mono resize-none p-1",style:{borderColor:x.isValid?x.isSelected?he.primary:he.default:he.error,minHeight:"32px"},"data-test":"custom-selector-input"})}),e.jsx("div",{className:"mt-2 px-2 py-0.5 rounded text-xs shrink-0",style:{backgroundColor:x.isValid?x.matchCount>0?Te.successBg:Te.neutralBg:Te.errorBg,color:x.isValid?x.matchCount>0?Te.successText:Te.neutralText:Te.errorText},"data-test":"custom-selector-count",children:x.isValid?x.matchCount===1?"1 match":`${x.matchCount} matches`:"invalid"}),e.jsxs(Se,{open:o===x.id,onOpenChange:N=>i(N?x.id:null),value:"",onValueChange:N=>{switch(i(null),N){case"delete":f(x.id);break;case"list-attributes":p(x.id);break}},children:[e.jsx(Ae,{className:"mt-2 h-6 w-6 px-0 border-0 shadow-none shrink-0",style:{backgroundColor:"transparent",cursor:"pointer"},"data-test":"custom-selector-menu",hideChevron:!0,children:e.jsx(Ns,{className:"w-3 h-3",style:{color:ee.muted}})}),e.jsxs(_e,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border,cursor:"auto",pointerEvents:"auto"},"data-test":"custom-selector-menu-options",container:s,children:[e.jsx(ne,{value:"list-attributes",style:{color:$.itemText,cursor:"pointer",pointerEvents:"auto"},disabled:!x.value.trim()||!x.isValid||x.matchCount===0,"data-test":"custom-selector-action-list",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(Yt,{className:"w-3 h-3"}),"List attributes"]})}),e.jsx(ne,{value:"delete",style:{color:a.length<=1?he.default:$.dangerText,cursor:"pointer",pointerEvents:"auto"},disabled:a.length<=1,"data-test":"custom-selector-action-delete",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(Ve,{className:"w-3 h-3"}),"Delete"]})})]})]})]},x.id))}),e.jsxs("button",{onClick:w,className:"mt-2 flex items-center gap-1 text-xs py-1 px-2 rounded transition-colors self-start",style:{color:ee.primary},"data-test":"custom-selector-add",children:[e.jsx(tt,{className:"w-3 h-3"}),"Add selector"]}),e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:ie.sectionBorder},children:e.jsxs(ae,{onClick:g,disabled:!(b!=null&&b.value.trim())||!(b!=null&&b.isValid),className:"w-full",size:"sm","data-test":"custom-selector-apply",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"Apply Selected"]})})]})}function Ua({isOpen:t,fieldPath:n,domContext:s,initialSelector:a,previousChildIndex:l,onSelectParent:r,onSelectSibling:c,onSelectChild:o,onSelectMatch:i,onAddIndex:d,onRevert:h,onClearSelector:m,onClose:y,onSelectorChange:j,onApplyCustomSelector:v,onMatchIndexHover:w,portalContainer:f}){const[g,p]=u.useState("tree"),b=u.useRef(null),x=s!=null&&s.selector?Ie(s.selector).indexSpec:null,{isRangeMode:N,toggleRangeMode:C,rangeStartIndex:S,handleMatchClick:A,handleTextInput:T,pendingRangeDisplay:E}=Ra({baseSelector:(s==null?void 0:s.baseSelector)??"",totalCount:(s==null?void 0:s.matches.length)??0,currentIndexSpec:x,onSelectorChange:j??(()=>{})});u.useEffect(()=>{t&&p("tree")},[t]);const k=u.useCallback(()=>{b.current&&(b.current.style.outline="",b.current.style.outlineOffset="",b.current.style.background="",b.current=null)},[]),O=u.useCallback(F=>{F!=null&&F.isConnected&&(k(),b.current=F,F.style.outline=Ne.outline,F.style.outlineOffset=Ne.outlineOffset,F.style.background=Ne.background)},[k]);u.useEffect(()=>{t||k()},[t,k]),u.useEffect(()=>{if(!t)return;const F=K=>{K.key==="Escape"&&y()};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[t,y]);const _=u.useCallback(F=>{var K;(K=F==null?void 0:F.element)!=null&&K.isConnected?O(F.element):k()},[O,k]),V=u.useCallback(F=>{w&&(s!=null&&s.baseSelector)&&w(s.baseSelector,F)},[w,s==null?void 0:s.baseSelector]),B=u.useCallback(()=>{!(s!=null&&s.parent)||!r||(k(),r(s.parent.element))},[k,r,s==null?void 0:s.parent]),I=u.useCallback((F,K)=>{k(),c(F,K.element)},[k,c]),P=u.useCallback((F,K)=>{F.stopPropagation(),d==null||d(K)},[d]),M=u.useCallback((F,K,le)=>{k(),j?A(F,le):i==null||i(F)},[k,i,j,A]),R=u.useCallback((F,K)=>{k(),o==null||o(F,K)},[k,o]);if(!t)return null;const U=a&&(s==null?void 0:s.selector)&&a!==s.selector,X=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex rounded overflow-hidden border",style:{borderColor:he.default},"data-test":"dom-tree-view-toggle",children:[e.jsx("button",{onClick:()=>p("tree"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:g==="tree"?L.primary:L.white,color:g==="tree"?D.white:D.muted},title:"DOM Tree View","data-test":"dom-tree-view-tree",children:e.jsx(gt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>p("custom"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:g==="custom"?L.primary:L.white,color:g==="custom"?D.white:D.muted},title:"Custom Selector View","data-test":"dom-tree-view-custom",children:e.jsx(ua,{className:"w-3 h-3"})})]}),g==="tree"&&U&&h&&e.jsx("button",{onClick:h,className:"p-1 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:`Revert to: ${a}`,"data-test":"dom-tree-revert-v2",children:e.jsx(ha,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m,className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"Clear Selector","data-test":"dom-tree-clear-selector-v2",children:e.jsx(Ve,{className:"w-4 h-4"})})]});return e.jsxs(je,{isVisible:t,onClose:y,title:`DOM Tree: ${n}`,shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-490,y:120},initialSize:{width:450,height:600},showPinButton:!1,headerActions:X,portalContainer:f,children:[g==="tree"&&e.jsx("div",{className:"flex flex-col h-full p-2","data-test":"dom-tree-popover-v2",children:s?e.jsxs(e.Fragment,{children:[s.itemStats&&s.itemStats.totalItems>1&&e.jsxs("div",{className:"mb-3 p-2 rounded text-xs flex items-center gap-2",style:{backgroundColor:s.itemStats.itemsWithMatch<s.itemStats.totalItems?"#fef3c7":"#d1fae5",color:s.itemStats.itemsWithMatch<s.itemStats.totalItems?"#92400e":"#065f46"},"data-test":"dom-tree-item-stats-v2",children:[e.jsxs("span",{className:"font-medium",children:["Found in ",s.itemStats.itemsWithMatch," of ",s.itemStats.totalItems," items"]}),s.itemStats.itemsWithMatch<s.itemStats.totalItems&&e.jsxs("span",{className:"opacity-75",children:["(showing item #",s.itemStats.displayedItemIndex+1,")"]})]}),s.parent&&e.jsxs("div",{className:"mb-3","data-test":"dom-tree-parent-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Parent ",r&&"- click to select"]}),e.jsx("button",{onClick:B,onMouseEnter:()=>_(s.parent),onMouseLeave:()=>_(null),className:"w-full text-left text-sm font-mono bg-gray-100 p-2 rounded cursor-pointer hover:bg-gray-200 transition-colors","data-test":"dom-tree-parent-row-v2",children:$t(s.parent)})]}),e.jsx(La,{domContext:s,previousChildIndex:l,onSiblingClick:I,onSiblingHover:_,onAddIndex:d?P:void 0,onChildClick:o?R:void 0}),(i||j)&&e.jsx(qa,{matches:s.matches,selector:s.selector,baseSelector:s.baseSelector,currentIndexSpec:x,isRangeMode:N,rangeStartIndex:S,pendingRangeDisplay:E,onMatchClick:M,onMatchHover:_,onMatchIndexHover:w?V:void 0,onToggleRangeMode:C,onTextInput:T,onSelectorChange:j})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No DOM context available"})}),g==="custom"&&v&&e.jsx(Wa,{initialSelector:s==null?void 0:s.selector,onApply:v,portalContainer:f})]})}function Ha({node:t,includeInnerText:n,selected:s,onNodeClick:a,onToggleHidden:l}){var d,h,m;const r=(d=t.data)==null?void 0:d.isInnerText,c=(h=t.data)==null?void 0:h.isAttribute,o=(m=t.data)==null?void 0:m.isValue;let i=!1;return r?i=n:c&&(i=s.has(t.id)),o?e.jsx("div",{className:"flex items-center py-1 px-2 ml-6",style:{color:D.muted},"data-test":"attribute-value-v2",children:e.jsxs("span",{className:"text-xs font-mono truncate",title:t.label,children:['"',t.label,'"']})}):e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100 group",style:{backgroundColor:i?be.selectedBg:"transparent"},onClick:()=>a(t),"data-test":"attribute-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:i?be.checkBorder:he.default,backgroundColor:i?be.checkBg:"transparent"},children:i&&e.jsx(Be,{className:"w-3 h-3 text-white"})}),t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:r?L.subtle:be.attrBg,color:r?D.muted:be.attrColor},children:t.label}),r&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:L.subtle,color:D.muted},children:"default"}),c&&e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:y=>l(t.id,y),title:"Hide attribute","data-test":"attribute-hide-v2",children:e.jsx(ws,{className:"w-3 h-3",style:{color:ee.muted}})})]})}function Ga({hiddenAttributes:t,onToggleHidden:n}){return t.length===0?null:e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:ie.sectionBorder},"data-test":"hidden-section-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2 flex items-center gap-1",style:{color:D.placeholder},children:[e.jsx(Dt,{className:"w-3 h-3"}),"Hidden (",t.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("div",{className:"flex items-center py-1 px-2 rounded hover:bg-gray-100 group",style:{opacity:.6},"data-test":"hidden-attribute-v2",children:[e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:L.subtle,color:D.muted},children:s.name}),e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:a=>n(s.name,a),title:"Show attribute","data-test":"attribute-show-v2",children:e.jsx(Dt,{className:"w-3 h-3",style:{color:ee.muted}})})]},s.name))})]})}function Ka(t,n){return n?t==="class"?n.split(/\s+/).filter(Boolean):[n]:[]}function Ja(t,n){const s=[];s.push({id:"innerText",label:"innerText",icon:e.jsx(Cs,{className:"w-3 h-3"}),data:{isInnerText:!0,isSelected:n}});for(const a of t){const r=Ka(a.name,a.value).map((c,o)=>({id:`${a.name}:${o}`,label:c,data:{isValue:!0,parentAttr:a.name}}));s.push({id:a.name,label:a.name,children:r.length>0?r:void 0,data:{isAttribute:!0,fullValue:a.value}})}return s}function Ya({isOpen:t,fieldPath:n,currentAttributes:s=[],attributes:a,onSelectAttributes:l,onClose:r,portalContainer:c,position:o}){const[i,d]=u.useState(new Set(s)),[h,m]=u.useState(s.length===0||s.includes("innerText")),[y,j]=u.useState(new Set),[v,w]=u.useState(!1),f=u.useRef(!1);u.useEffect(()=>{if(t&&!f.current){f.current=!0;const _=new Set(s.filter(V=>V!=="innerText"));d(_),m(s.length===0||s.includes("innerText")),j(new Set)}else t||(f.current=!1)},[t,s]);const g=u.useCallback((_,V)=>{V.stopPropagation(),j(B=>{const I=new Set(B);return I.has(_)?I.delete(_):I.add(_),I})},[]),{visibleAttributes:p,hiddenAttributes:b}=u.useMemo(()=>{const _=[],V=[];for(const B of a)y.has(B.name)?V.push(B):_.push(B);return{visibleAttributes:_,hiddenAttributes:V}},[a,y]),x=u.useMemo(()=>Ja(p,h),[p,h]),N=u.useMemo(()=>new Set(p.map(_=>_.name)),[p]),C=u.useCallback(_=>{var V,B;(V=_.data)!=null&&V.isInnerText?m(I=>!I):(B=_.data)!=null&&B.isAttribute&&d(I=>{const P=new Set(I);return P.has(_.id)?P.delete(_.id):P.add(_.id),P})},[]),S=u.useCallback(()=>{const _=[];h&&_.push("innerText"),_.push(...Array.from(i)),l(_),r()},[h,i,l,r]),A=u.useCallback(()=>{const _=new Set(p.map(V=>V.name));d(_),m(!0)},[p]),T=u.useCallback(()=>{d(new Set),m(!1)},[]),E=u.useCallback(()=>{const _=new Set(s.filter(V=>V!=="innerText"));d(_),m(s.length===0||s.includes("innerText")),j(new Set)},[s]),k=u.useCallback(_=>e.jsx(Ha,{node:_,includeInnerText:h,selected:i,onNodeClick:C,onToggleHidden:g}),[h,i,C,g]);if(!t)return null;const O=n.split(".").pop()??n;return e.jsx(je,{isVisible:t,onClose:r,title:`Configure: ${O}`,initialPosition:o??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:c,showPinButton:!1,zIndex:et.draggablePopoverDropdown,headerActions:e.jsxs(Se,{open:v,onOpenChange:w,value:"",onValueChange:_=>{switch(w(!1),_){case"select-all":A();break;case"clear-all":T();break;case"reset":E();break}},children:[e.jsx(Ae,{className:"h-6 w-6 px-0 border-0 shadow-none",style:{backgroundColor:"transparent"},"data-test":"attr-more-actions-v2",hideChevron:!0,children:e.jsx(Ns,{className:"w-4 h-4",style:{color:ee.muted}})}),e.jsxs(_e,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"attr-more-actions-options-v2",container:c,children:[e.jsx(ne,{value:"select-all",style:{color:$.itemText},"data-test":"attr-action-select-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-3 h-3"}),"Select All"]})}),e.jsx(ne,{value:"clear-all",style:{color:$.itemText},"data-test":"attr-action-clear-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ma,{className:"w-3 h-3"}),"Clear All"]})}),e.jsx(ne,{value:"reset",style:{color:$.itemText},"data-test":"attr-action-reset-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-3 h-3"}),"Reset"]})})]})]}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:ie.bg,minWidth:"280px"},"data-test":"attribute-popover-content-v2",children:[e.jsxs("div",{className:"max-h-[300px] overflow-auto",children:[a.length===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100",style:{backgroundColor:h?be.selectedBg:"transparent"},onClick:()=>m(!h),"data-test":"attribute-option-innerText-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2",style:{borderColor:h?be.checkBorder:he.default,backgroundColor:h?be.checkBg:"transparent"},children:h&&e.jsx(Be,{className:"w-3 h-3 text-white"})}),e.jsx(Cs,{className:"w-3 h-3 mr-2"}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:L.subtle,color:D.muted},children:"innerText"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:L.subtle,color:D.muted},children:"default"})]}),e.jsx("div",{className:"text-sm text-center py-4",style:{color:ie.emptyText},"data-test":"no-attributes-message-v2",children:"No other attributes found"})]}):e.jsx(Ss,{data:x,defaultExpandedIds:N,enableEdit:!1,enableDelete:!1,enableDrag:!1,renderNode:k,onItemClick:C}),e.jsx(Ga,{hiddenAttributes:b,onToggleHidden:g})]}),e.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:ie.sectionBorder},children:e.jsxs(ae,{onClick:S,className:"w-full",size:"sm","data-test":"attribute-confirm-button-v2",children:["Confirm (",h?1:0," + ",i.size," selected)"]})})]})})}function Xa({isOpen:t,fieldPath:n,childElements:s,excludedChildren:a=[],onConfirm:l,onClose:r,portalContainer:c,position:o}){const[i,d]=u.useState(new Set(a)),h=u.useRef(!1);u.useEffect(()=>{t&&!h.current?(h.current=!0,d(new Set(a))):t||(h.current=!1)},[t,a]);const m=u.useCallback(g=>{d(p=>{const b=new Set(p);return b.has(g)?b.delete(g):b.add(g),b})},[]),y=u.useCallback(()=>{l(Array.from(i)),r()},[i,l,r]),j=u.useCallback(()=>{d(new Set)},[]),v=s.length-i.size,w=i.size;if(!t)return null;const f=n.split(".").pop()??n;return e.jsx(je,{isVisible:t,onClose:r,title:`Filter Children: ${f}`,initialPosition:o??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:c,showPinButton:!1,zIndex:et.draggablePopoverDropdown,headerActions:e.jsx("button",{onClick:j,className:"p-1 rounded hover:bg-gray-200 transition-colors",title:"Reset - Include all","data-test":"child-filter-reset-v2",children:e.jsx(ks,{className:"w-4 h-4",style:{color:ee.muted}})}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:ie.bg,minWidth:"280px"},"data-test":"child-filter-popover-content-v2",children:[e.jsx("div",{className:"text-xs mb-2 px-1",style:{color:ie.headerText},"data-test":"child-filter-instructions-v2",children:"Uncheck children to exclude them from extraction."}),e.jsx("div",{className:"max-h-[300px] overflow-auto space-y-1",children:s.length===0?e.jsx("div",{className:"text-sm text-center py-4",style:{color:ie.emptyText},"data-test":"no-children-message-v2",children:"No child elements found"}):s.map(g=>{const b=!i.has(g.id);return e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:b?Pe.includedBg:Pe.excludedBg,border:`1px solid ${b?Pe.includedBorder:Pe.excludedBorder}`},onClick:()=>m(g.id),"data-test":"child-filter-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:b?Pe.checkBg:he.default,backgroundColor:b?Pe.checkBg:"transparent"},children:b&&e.jsx(Be,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:be.attrBg,color:be.attrColor},children:g.label})}),g.textPreview&&e.jsxs("div",{className:"text-xs mt-0.5 truncate",style:{color:D.muted},title:g.textPreview,children:['"',g.textPreview.slice(0,40),g.textPreview.length>40?"...":"",'"']})]})]},g.id)})}),e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:ie.sectionBorder},children:[e.jsxs("div",{className:"text-xs mb-2 flex justify-between",style:{color:D.muted},"data-test":"child-filter-summary-v2",children:[e.jsxs("span",{className:"text-green-600",children:[v," included"]}),w>0&&e.jsxs("span",{className:"text-red-600",children:[w," excluded"]})]}),e.jsx(ae,{onClick:y,className:"w-full",size:"sm","data-test":"child-filter-confirm-button-v2",children:"Confirm"})]})]})})}function Qa({availableFields:t,selectedBranchFields:n,onToggleBranchField:s}){return t.length===0?null:e.jsxs("div",{className:"space-y-2","data-test":"branch-field-selection-v2",children:[e.jsx("div",{className:"text-xs font-medium",style:{color:D.primary},children:"Select fields to branch"}),e.jsx("div",{className:"flex flex-wrap gap-x-3 gap-y-2 p-2 rounded",style:{backgroundColor:L.muted},children:t.map(a=>e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer hover:opacity-80","data-test":`branch-field-item-${a}-v2`,children:[e.jsx(Un,{checked:n.includes(a),onCheckedChange:l=>{s==null||s(a,!!l)},className:"h-3.5 w-3.5","data-test":`branch-field-checkbox-${a}-v2`}),e.jsx("span",{className:"text-xs",style:{color:D.primary},children:a})]},a))}),e.jsx("p",{className:"text-[10px]",style:{color:D.muted},children:"Checked fields will have separate selectors per branch variant."})]})}function Za({isIfEnabled:t,conditionSelector:n,conditionType:s,onConditionSelectorChange:a,onConditionTypeChange:l,portalContainer:r}){if(!t)return e.jsxs("div",{className:"text-xs p-3 rounded border border-dashed",style:{color:D.muted,borderColor:D.muted},"data-test":"if-disabled-hint-v2",children:["Enable the ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:L.secondary},children:"_if"})," toggle above to configure conditional branching based on element existence or content."]});const c=()=>s==="exists"?"Evaluates to 'true' if element exists, 'false' otherwise":s==="text"?"Evaluates to the element's text content":"Evaluates to the element's innerHTML";return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium",style:{color:D.primary},children:"Condition (_if)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ve,{value:n,onChange:o=>a(o.target.value),placeholder:"CSS selector to evaluate",className:"text-xs h-8","data-test":"condition-selector-input-v2"})}),e.jsxs(Se,{value:s,onValueChange:o=>l(o),children:[e.jsx(Ae,{className:"w-[100px] h-8 text-xs","data-test":"condition-type-select-v2",children:e.jsx(Jt,{})}),e.jsxs(_e,{container:r,style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},children:[e.jsx(ne,{value:"exists",style:{color:$.itemText},"data-test":"condition-type-exists-v2",children:"exists"}),e.jsx(ne,{value:"text",style:{color:$.itemText},"data-test":"condition-type-text-v2",children:"text"}),e.jsx(ne,{value:"html",style:{color:$.itemText},"data-test":"condition-type-html-v2",children:"html"})]})]})]}),e.jsx("p",{className:"text-[10px]",style:{color:D.muted},children:c()})]})}function el({branch:t,index:n,canRemove:s,availableFieldsForOverride:a,onMatchChange:l,onRemoveBranch:r,onAddOverride:c,onOverrideChange:o,onRemoveOverride:i,portalContainer:d}){return e.jsxs("div",{className:"border rounded p-3 space-y-2",style:{borderColor:Y.primary+"40"},"data-test":`branch-config-${t.key}-v2`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:Y.primary,color:D.white},children:["Branch ",t.key]})}),s&&e.jsx("button",{onClick:()=>r(n),className:"p-1 rounded hover:bg-red-100 transition-colors",style:{color:"#ef4444"},"data-test":`remove-branch-${t.key}-v2`,children:e.jsx(Ve,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs shrink-0",style:{color:D.muted},children:"match:"}),e.jsx(ve,{value:t.match,onChange:h=>l(n,h.target.value),placeholder:"/regex pattern/",className:"text-xs h-7 font-mono flex-1","data-test":`branch-match-input-${t.key}-v2`})]}),Object.entries(t.overrides).length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px]",style:{color:D.muted},children:"Field overrides:"}),Object.entries(t.overrides).map(([h,m])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-xs shrink-0 px-1 rounded",style:{backgroundColor:L.secondary},children:[h,":"]}),e.jsx(ve,{value:m,onChange:y=>o(n,h,y.target.value),placeholder:"selector",className:"text-xs h-6 font-mono flex-1","data-test":`branch-override-${t.key}-${h}-v2`}),e.jsx("button",{onClick:()=>i(n,h),className:"p-0.5 rounded hover:bg-red-100 transition-colors",style:{color:D.muted},children:e.jsx(Le,{className:"w-3 h-3"})})]},h))]}),a.length>0&&e.jsxs(Se,{onValueChange:h=>c(n,h),children:[e.jsxs(Ae,{className:"h-6 text-xs w-[150px]","data-test":`add-override-select-${t.key}-v2`,children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"Add override"})]}),e.jsx(_e,{container:d,style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},children:a.map(h=>e.jsx(ne,{value:h,style:{color:$.itemText},children:h},h))})]})]})}function tl({isOpen:t,fieldPath:n,existingIf:s,existingBranches:a,availableFields:l=[],selectedBranchFields:r=[],onSave:c,onRemove:o,onClose:i,onToggleIf:d,onToggleBranchField:h,portalContainer:m}){const[y,j]=u.useState(!1),[v,w]=u.useState(""),[f,g]=u.useState("exists"),[p,b]=u.useState([]);u.useEffect(()=>{if(t)if(s?(j(!0),w(s.selector),g(s.condition)):(j(!1),w(""),g("exists")),a){const B=Object.entries(a).map(([I,P])=>{const M={};for(const[R,U]of Object.entries(P))R!=="match"&&typeof U=="string"&&(M[R]=U);return{key:I,match:P.match,overrides:M}});b(B)}else b([{key:"1",match:"/true/",overrides:{}},{key:"2",match:"/./",overrides:{}}])},[t,s,a]);const x=u.useCallback(()=>{const B=String(p.length+1);b(I=>[...I,{key:B,match:"/./",overrides:{}}])},[p.length]),N=u.useCallback(B=>{b(I=>I.filter((M,R)=>R!==B).map((M,R)=>({...M,key:String(R+1)})))},[]),C=u.useCallback((B,I)=>{b(P=>P.map((M,R)=>R===B?{...M,match:I}:M))},[]),S=u.useCallback((B,I)=>{b(P=>P.map((M,R)=>R===B?{...M,overrides:{...M.overrides,[I]:""}}:M))},[]),A=u.useCallback((B,I,P)=>{b(M=>M.map((R,U)=>U===B?{...R,overrides:{...R.overrides,[I]:P}}:R))},[]),T=u.useCallback((B,I)=>{b(P=>P.map((M,R)=>{if(R!==B)return M;const{[I]:U,...X}=M.overrides;return{...M,overrides:X}}))},[]),E=u.useCallback(()=>{const B={};for(const I of p)B[I.key]={match:I.match||"/./",...I.overrides};if(v.trim()){const I={selector:v.trim(),condition:f};c(I,B)}else c({selector:"",condition:f},B);i()},[v,f,p,c,i]),k=B=>{const I=p[B],P=Object.keys(I.overrides);return l.filter(M=>!P.includes(M))},O=u.useCallback(()=>{const B=!y;j(B),d(B)},[y,d]);if(!t)return null;const _=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4",style:{color:Y.primary}}),e.jsx("span",{children:"Conditional Branching"})]}),V=e.jsxs("button",{onClick:O,className:"flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-colors",style:{backgroundColor:y?Y.primary:L.muted,color:y?D.white:D.muted},title:y?"Hide _if condition section":"Show _if condition section","data-test":"toggle-if-enabled-v2",children:[y?e.jsx(Be,{className:"w-3 h-3"}):e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{children:"_if"})]});return e.jsx(je,{isVisible:t,onClose:i,title:_,shouldCloseManually:!0,initialPosition:{x:Math.max(16,(window.innerWidth-480)/2),y:100},initialSize:{width:480,height:500},resizable:!0,showPinButton:!1,showInspectorButton:!1,portalContainer:m,zIndex:et.draggablePopoverDropdown,headerActions:V,children:e.jsxs("div",{className:"flex flex-col h-full",style:{backgroundColor:L.white},"data-test":"branch-editor-popover-v2",children:[e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsx(Qa,{availableFields:l,selectedBranchFields:r,onToggleBranchField:h}),e.jsxs("div",{className:"text-xs",style:{color:D.muted},children:["Configuring branching for:"," ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:L.secondary},children:n})]}),e.jsx(Za,{isIfEnabled:y,conditionSelector:v,conditionType:f,onConditionSelectorChange:w,onConditionTypeChange:g,portalContainer:m}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:D.primary},children:"Branches (_branches)"}),e.jsxs(ae,{variant:"ghost",size:"sm",onClick:x,className:"h-6 text-xs","data-test":"add-branch-button-v2",children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),"Add Branch"]})]}),p.map((B,I)=>e.jsx(el,{branch:B,index:I,canRemove:p.length>1,availableFieldsForOverride:k(I),onMatchChange:C,onRemoveBranch:N,onAddOverride:S,onOverrideChange:A,onRemoveOverride:T,portalContainer:m},B.key)),e.jsxs("p",{className:"text-[10px]",style:{color:D.muted},children:["Branches are evaluated in order. First match wins. Use"," ",e.jsx("code",{className:"px-0.5 rounded",style:{backgroundColor:L.secondary},children:"/./"})," ","as a catch-all pattern."]})]})]}),e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-t",style:{backgroundColor:L.muted},children:[s?e.jsxs(ae,{variant:"ghost",size:"sm",onClick:()=>{o(),i()},className:"text-red-500 hover:text-red-600 hover:bg-red-50","data-test":"remove-branching-button-v2",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Remove Branching"]}):e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{variant:"outline",size:"sm",onClick:i,"data-test":"branch-editor-cancel-v2",children:"Cancel"}),e.jsx(ae,{size:"sm",onClick:E,"data-test":"branch-editor-save-v2",children:"Save"})]})]})]})})}function sl({portalContainer:t,isFieldDialogOpen:n,editingField:s,onFieldDialogSubmit:a,onFieldDialogCancel:l,contentPopover:r,onCloseContentPopover:c,onContentPopoverItemHover:o,onContentPopoverItemClick:i,importDialogOpen:d,onImportSchema:h,onCloseImportDialog:m,managerPopoverOpen:y,savedCaptures:j,onLoad:v,onRenameCapture:w,onDeleteCapture:f,onCloseManagerPopover:g,advancedSettingsOpen:p,preventDefaultOnInteraction:b,continuousMode:x,onPreventDefaultChange:N,onContinuousModeChange:C,onCloseAdvancedSettings:S,isDomTreePopoverOpen:A,domTreeFieldPath:T,domContext:E,domTreeInitialSelector:k,domTreePreviousChildIndex:O,onDomTreeParentSelect:_,onDomTreeSiblingSelect:V,onDomTreeChildSelect:B,onAddIndex:I,onRevertSelector:P,onClearSelector:M,onCloseDomTreePopover:R,onSelectorChange:U,onApplyCustomSelector:X,attributePopover:F,onAttributeSelect:K,onAttributePopoverClose:le,childFilterPopover:te,onChildFilterConfirm:ue,onChildFilterPopoverClose:z,branchEditorState:q,onSaveBranching:se,onRemoveBranching:Q,onCloseBranchEditor:J,onToggleIf:Ce,onPopoverToggleBranchField:Ee,onDomTreeMatchIndexHover:ce}){return e.jsxs(e.Fragment,{children:[e.jsx(Ea,{isOpen:n,suggestedName:"",editingField:s,onSubmit:a,onCancel:l,portalContainer:t,"data-test":"field-dialog"}),e.jsx(Oa,{isOpen:r!==null,fieldName:(r==null?void 0:r.fieldName)??"",values:(r==null?void 0:r.values)??[],onClose:c,onItemHover:o,onItemClick:i,portalContainer:t,"data-test":"content-popover"}),e.jsx(Ba,{isOpen:d,onImport:h,onClose:m,portalContainer:t,"data-test":"import-dialog"}),e.jsx(Da,{isOpen:y,savedCaptures:j,onLoad:v,onRename:w,onDelete:f,onClose:g,portalContainer:t,"data-test":"manager-popover"}),e.jsx(Fa,{isOpen:p,preventDefaultOnInteraction:b,onPreventDefaultChange:N,continuousMode:x,onContinuousModeChange:C,onClose:S,portalContainer:t,"data-test":"advanced-settings"}),e.jsx(Ua,{isOpen:A,fieldPath:T??"",domContext:E,initialSelector:k,previousChildIndex:O,onSelectParent:_,onSelectSibling:V,onSelectChild:B,onSelectMatch:I,onAddIndex:I,onRevert:P,onClearSelector:M,onClose:R,onSelectorChange:U,onApplyCustomSelector:X,onMatchIndexHover:ce,portalContainer:t,"data-test":"dom-tree-popover"}),e.jsx(Ya,{isOpen:F.isOpen,fieldPath:F.fieldPath,attributes:F.attributes,currentAttributes:F.currentAttributes,onSelectAttributes:xe=>K(F.fieldPath,xe),onClose:le,portalContainer:t,position:F.position,"data-test":"attribute-popover"}),e.jsx(Xa,{isOpen:te.isOpen,fieldPath:te.fieldPath,childElements:te.children,excludedChildren:te.excludedChildren,onConfirm:xe=>ue(te.fieldPath,xe,te.children),onClose:z,portalContainer:t,position:te.position,"data-test":"child-filter-popover"}),e.jsx(tl,{isOpen:q.isOpen,fieldPath:q.fieldPath,existingIf:q.existingIf,existingBranches:q.existingBranches,availableFields:q.availableFields,selectedBranchFields:q.selectedBranchFields,onSave:se,onRemove:Q,onClose:J,onToggleIf:Ce,onToggleBranchField:Ee,portalContainer:t,"data-test":"branch-editor"})]})}function nl(t){switch(t){case"string":return"T";case"number":return"#";case"boolean":return"?";case"array":return"[]";case"parentSelector":return"{1}";case"object":return"{}";default:return"·"}}function al({fields:t,selectedFieldId:n,mode:s,onFieldSelect:a,onFieldUpdate:l,onFieldEdit:r,onFieldDelete:c,onReorder:o,onAddChild:i,onAddSiblingBefore:d,onAddSiblingAfter:h}){const m=u.useMemo(()=>{const f=g=>t.filter(p=>p.parentId===g).sort((p,b)=>p.order-b.order).map(p=>({id:p.id,label:p.name,children:f(p.id),data:p}));return f(null)},[t]),y=u.useMemo(()=>new Set(t.map(f=>f.id)),[t]),j=u.useCallback(f=>{s==="mapped"&&a(f.id)},[s,a]),v=u.useCallback((f,g,p,b)=>{var S;const x=f.data,N=(x==null?void 0:x.mapping)!=null,C=s==="mapped"&&f.id===n;return e.jsxs("div",{className:`flex items-center gap-2 w-full group ${C?"bg-primary/10 -mx-2 px-2 rounded":""}`,"data-test":"schema-field-v2",children:[e.jsx("span",{className:"flex-shrink-0","data-test":"field-status-icon-v2",children:N?e.jsx(xa,{className:"w-3 h-3 text-green-500"}):e.jsx(fa,{className:"w-3 h-3 text-muted-foreground"})}),e.jsx("span",{className:"flex-shrink-0 text-xs text-muted-foreground font-mono w-4",title:x==null?void 0:x.type,"data-test":"field-type-indicator-v2",children:nl(x==null?void 0:x.type)}),e.jsx("span",{className:"flex-1 truncate",children:b}),((S=x==null?void 0:x.mapping)==null?void 0:S.sampleValue)&&e.jsxs("span",{className:"text-xs text-muted-foreground truncate max-w-[100px]",title:x.mapping.sampleValue,"data-test":"field-sample-value-v2",children:['"',x.mapping.sampleValue.slice(0,20),x.mapping.sampleValue.length>20?"...":"",'"']}),x&&e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(Hn,{onClick:()=>i(x.id),label:"",icon:tt,variant:"ghost",size:"sm",compact:!0,options:[{label:"Add sibling before",onClick:()=>d(x.id)},{label:"Add sibling after",onClick:()=>h(x.id)}],contentStyle:{zIndex:et.draggablePopoverDropdown},"data-test":"add-field-v2"})})]})},[s,n,i,d,h]),w=u.useCallback(f=>{const g=f.data;return g?[{id:"edit",icon:e.jsx(ga,{className:"h-3 w-3"}),title:"Edit field",onClick:()=>r(g.id,g.name,g.type)}]:null},[r]);return t.length===0?e.jsxs("div",{className:"p-4 text-sm text-muted-foreground text-center","data-test":"empty-schema-message-v2",children:[e.jsx("p",{className:"mb-2",children:"No fields defined yet."}),e.jsx("p",{className:"text-xs",children:"Use + to add fields, then click elements to map."})]}):e.jsx("div",{className:"p-2","data-test":"schema-tree-container-v2",children:e.jsx(Ss,{data:m,onUpdate:l,onDelete:c,onReorder:o,onItemClick:j,defaultExpandedIds:y,enableEdit:!1,enableDelete:!0,enableDrag:!0,renderNode:v,quickActions:w})})}function ll(t){if(t.length===0)return"";const n=r=>{switch(r){case"array":return"[]";case"object":return"{}";case"parentSelector":return"{1}";case"number":return"#";case"boolean":return"?";default:return""}},s=[],a=(r,c)=>{const o="  ".repeat(c),i=n(r.type);s.push(`${o}${r.name}${i}`);const d=t.filter(h=>h.parentId===r.id).sort((h,m)=>h.order-m.order);for(const h of d)a(h,c+1)},l=t.filter(r=>r.parentId===null).sort((r,c)=>r.order-c.order);for(const r of l)a(r,0);return s.join(`
`)}function ps(t){var a;const n=t.split(`
`),s=[];for(const l of n){if(l.trim()==="")continue;const r=((a=l.match(/^(\s*)/))==null?void 0:a[1])||"",c=(r.match(/\t/g)||[]).length,o=r.replace(/\t/g,"").length,i=c+Math.floor(o/2);let d=l.trim();if(!d)continue;let h="string";d.endsWith("[]")?(h="array",d=d.slice(0,-2)):d.endsWith("{}")?(h="object",d=d.slice(0,-2)):d.endsWith("{1}")?(h="parentSelector",d=d.slice(0,-3)):d.endsWith("#")?(h="number",d=d.slice(0,-1)):d.endsWith("?")&&(h="boolean",d=d.slice(0,-1)),s.push({name:d,depth:i,type:h})}return s}function rl(t){const n=[],s=[];for(let a=0;a<t.length;a++){const l=t[a];for(;s.length>0&&s[s.length-1].depth>=l.depth;)s.pop();const r=s.length>0?s[s.length-1].id:null,c=`field-${Date.now()}-${a}`;n.push({id:c,name:l.name,type:l.type,order:a,parentId:r,mapping:null}),s.push({depth:l.depth,id:c})}return n}const il=`products[]
  name
  price#
author
  firstName
  lastName`,cl=[{id:"array",label:"Array",icon:"[]",value:"[]"},{id:"parentSelector",label:"Parent Selector",icon:"{1}",value:"{1}"},{id:"object",label:"Object",icon:"{}",value:"{}"},{id:"number",label:"Number",icon:"#",value:"#"},{id:"boolean",label:"Boolean",icon:"?",value:"?"}];function ol({fields:t,onApply:n,onCancel:s}){const[a,l]=u.useState(()=>ll(t)),r=u.useCallback(()=>{const i=ps(a),d=rl(i);n(d)},[a,n]),c=a.trim()?ps(a).length:0,o={triggerChar:"/",items:cl,header:"Field Type",emptyMessage:"No matching types",zIndex:et.draggablePopoverDropdown};return e.jsxs("div",{className:"flex flex-col h-full p-2","data-test":"list-mode-panel-v2",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx(Gn,{value:a,onChange:i=>l(i.target.value),placeholder:il,className:"w-full h-full resize-none font-mono text-sm p-2 border rounded",style:{backgroundColor:$e.bg,color:$e.text},triggerPopover:o,showBuiltInPopover:!1,"data-test":"list-mode-textarea-v2"}),e.jsx("div",{className:"absolute top-1 right-1","data-test":"list-mode-info-v2",children:e.jsx(Kn,{children:e.jsxs(Jn,{children:[e.jsx(Yn,{asChild:!0,children:e.jsx("button",{type:"button",className:"p-1 rounded hover:bg-gray-200 transition-colors",style:{color:D.muted},"data-test":"list-mode-info-button-v2",children:e.jsx(vt,{className:"w-3.5 h-3.5"})})}),e.jsx(Xn,{side:"left",className:"max-w-xs","data-test":"list-mode-info-tooltip-v2",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("p",{className:"font-medium",children:'Type "/" to select field type:'}),e.jsxs("div",{className:"font-mono text-[10px] space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"[]"})," = array"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{1}"})," = parent selector"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{}"})," = object"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"#"})," = number"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"?"})," = boolean"]})]}),e.jsx("p",{className:"text-gray-500 pt-1",children:"Indentation = nesting"})]})})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t","data-test":"list-mode-actions-v2",children:[e.jsxs("span",{className:"text-xs",style:{color:D.muted},"data-test":"field-count-v2",children:[c," field",c!==1?"s":""," detected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ae,{variant:"ghost",size:"sm",onClick:s,className:"h-7","data-test":"list-mode-cancel-v2",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),"Cancel"]}),e.jsxs(ae,{size:"sm",onClick:r,disabled:c===0,className:"h-7","data-test":"list-mode-apply-v2",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"Apply"]})]})]})]})}function dl({activeBranch:t,branchCount:n,parentPath:s,onBranchSwitch:a,onBranchChange:l,onAddBranch:r,className:c}){const o=Array.from({length:n},(i,d)=>d+1);return e.jsxs("div",{className:ke("flex items-center gap-0.5",c),"data-test":"inline-branch-tabs-v2",children:[o.map(i=>e.jsxs("button",{onClick:d=>{d.stopPropagation(),a&&s!==void 0?a(s,i):l&&l(i)},className:ke("px-1 py-px text-[9px] rounded font-mono transition-colors",t===i?"text-white":"bg-muted hover:bg-muted/80 text-muted-foreground"),style:t===i?{backgroundColor:Y.primary}:void 0,"data-test":`branch-tab-${i}-v2`,children:["[",i,"]"]},i)),e.jsx("button",{onClick:i=>{i.stopPropagation(),r&&s!==void 0&&r(s)},className:"px-1 py-px text-[9px] rounded font-mono bg-muted hover:bg-muted/80 text-muted-foreground transition-colors","data-test":"branch-add-tab-v2",title:"Add new branch",children:"[+]"})]})}function ul({node:t,indent:n,isSelector:s,hasChildren:a,hasBranching:l,branchCount:r,branchDetailsExpanded:c,onEditBranching:o,onToggleBranchDetails:i,onToggleIfDirect:d,onToggleBranchField:h,availableBranchFields:m}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:t.isArrayItem?re.arrayIndex:t.name.startsWith("_")?re.fieldNameUnderscore:re.fieldName,cursor:l&&o?"pointer":void 0},onDoubleClick:()=>{var f,g;const y=((f=t.branchingMetadata)==null?void 0:f.isBranchParent)??l,j=((g=t.branchingMetadata)==null?void 0:g.isBranchField)??!1;if((y||a)&&s&&d&&t.name!=="_if"){d(t.path);return}if((j||((m==null?void 0:m.includes(t.name))??!1)||s&&!a)&&h&&t.name!=="_if"){const p=t.path.split("."),b=p.pop(),x=p.join(".");h(x,b,!j)}},"data-test":"field-name",children:[n,t.isArrayItem?t.name:`"${t.name}"`]}),t.name==="_if"&&t.conditionalBranching&&o&&e.jsx("button",{onClick:()=>{var j;const y=t.path.replace(/\._if$/,"");o(y,((j=t.conditionalBranching)==null?void 0:j.ifCondition)??null,null)},className:"ml-1 px-1 py-0.5 rounded text-[10px] hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:Y.primary+"20",color:Y.primary},title:"Click to edit condition type","data-test":"if-condition-type-badge-v2",children:t.conditionalBranching.ifCondition.condition}),t.name==="_if"&&t.conditionalBranching&&!o&&e.jsx("span",{className:"ml-1 px-1 py-0.5 rounded text-[10px]",style:{backgroundColor:Y.primary+"20",color:Y.primary},title:`Condition type: ${t.conditionalBranching.ifCondition.condition}`,"data-test":"if-condition-type-badge-v2",children:t.conditionalBranching.ifCondition.condition}),l&&t.name!=="_if"&&e.jsxs("button",{onClick:()=>{var y,j;o?o(t.path,((y=t.conditionalBranching)==null?void 0:y.ifCondition)??null,((j=t.conditionalBranching)==null?void 0:j.branches)??null):i()},className:ke("inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors",c?"ring-1 ring-offset-1":"hover:opacity-80"),style:{backgroundColor:Y.primary+"20",color:Y.primary,boxShadow:c?`0 0 0 2px ${Y.primary}`:void 0},title:o?"Click to edit branching":"Click to view branch details","data-test":"branch-indicator-v2",children:[e.jsx(gt,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:r}),e.jsx(vt,{className:"w-2 h-2 opacity-60"})]}),s&&a&&!l&&o&&e.jsxs("button",{onClick:()=>o(t.path,null,null),className:"inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors opacity-0 group-hover:opacity-100 hover:opacity-100",style:{backgroundColor:L.secondary,color:D.muted},title:"Add conditional branching","data-test":"add-condition-button-v2",children:[e.jsx(tt,{className:"w-2.5 h-2.5"}),e.jsx(gt,{className:"w-2.5 h-2.5"})]})]})}const hl=250;function mt({value:t,isSelector:n,truncateLength:s=Ft.expanded,onClick:a,onHover:l,onClear:r,onConfigClick:c,onFilterChildrenClick:o,onNavigateUp:i,onNavigateDown:d,canNavigateDown:h=!1,isActive:m=!1,className:y,portalContainer:j}){const[v,w]=u.useState(!1),[f,g]=u.useState(!1),p=u.useRef(null),b=u.useRef({x:0,y:0}),N=n&&t===""?It.selectorEmpty:n?It.selector:It.content,C=!!a,{baseSelector:S,indexDisplay:A,attributeDisplay:T,displayValue:E}=u.useMemo(()=>{if(!n||!t){const X=t.length>s?`${t.slice(0,s)}...`:t;return{baseSelector:t,indexDisplay:null,attributeDisplay:null,displayValue:X}}let I=t,P=null;const M=t.lastIndexOf("@");M>0&&(I=t.substring(0,M),P=t.substring(M+1));const R=Ie(I);if(!R.indexSpec){const X=I.length>s?`${I.slice(0,s)}...`:I;return{baseSelector:I,indexDisplay:null,attributeDisplay:P,displayValue:X}}const U=R.selector.length>s?`${R.selector.slice(0,s)}...`:R.selector;return{baseSelector:R.selector,indexDisplay:Zt(R.indexSpec),attributeDisplay:P,displayValue:U}},[t,n,s]),k=()=>{w(!0),l==null||l(!0)},O=()=>{w(!1),l==null||l(!1)},_=I=>{I.stopPropagation(),r==null||r()},V=u.useCallback(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{p.current=null,a==null||a()},hl)},[a]),B=u.useCallback(async()=>{p.current&&(clearTimeout(p.current),p.current=null);try{await navigator.clipboard.writeText(t),g(!0),setTimeout(()=>g(!1),1500)}catch(I){console.error("Failed to copy:",I)}},[t]);return e.jsxs("span",{className:`inline-flex items-center group/value ${y??""}`,"data-test":"field-value-v2",children:[n&&t!==""&&i&&e.jsxs("span",{className:"inline-flex items-center mr-0.5","data-test":"nav-buttons-v2",children:[e.jsx("button",{onClick:I=>{I.stopPropagation(),i()},className:"p-0.5 hover:bg-gray-200 rounded transition-colors",style:{color:ee.secondary},title:"Go to parent element","data-test":"nav-up-v2",children:e.jsx(ba,{className:"w-3 h-3"})}),e.jsx("button",{onClick:I=>{I.stopPropagation(),d==null||d()},disabled:!h,className:"p-0.5 hover:bg-gray-200 rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",style:{color:ee.secondary},title:h?"Go back to child element":"Navigate up first to enable","data-test":"nav-down-v2",children:e.jsx(Xe,{className:"w-3 h-3"})})]}),e.jsxs("span",{className:`inline-flex items-center min-w-0 ${m?"animate-pulse":""}`,style:{backgroundColor:v?N.bgHover:N.bg,border:`1px solid ${m?"#3b82f6":N.border}`,borderRadius:"4px",padding:"1px 6px",boxShadow:m?"0 0 0 2px rgba(59, 130, 246, 0.4)":void 0},"data-test-active":m?"true":void 0,children:[e.jsx("span",{onClick:V,onDoubleClick:B,onMouseEnter:k,onMouseLeave:O,style:{color:N.text,cursor:C?"pointer":"default"},title:t.length>s?t:"Double-click to copy","data-test":"field-value-text",children:f?e.jsx("span",{className:"text-green-600 font-medium",children:"Copied!"}):`"${E}"`}),A&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-amber-100 text-amber-700 border border-amber-300",title:`Index filter: ${A}`,"data-test":"field-value-index",children:A}),r&&n&&t!==""&&e.jsx("button",{onClick:_,className:"ml-1 opacity-0 group-hover/value:opacity-100 hover:text-red-600 transition-opacity",style:{color:N.text},title:"Clear selector","data-test":"clear-selector-v2",children:e.jsx(Le,{className:"w-3 h-3"})})]}),T&&e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-orange-100 text-orange-700 border border-orange-300",title:`Extract attribute: ${T}`,"data-test":"field-value-attribute",children:["@",T]}),(c||o)&&n&&t!==""&&e.jsxs(Se,{value:"",onValueChange:I=>{I==="configure"?c==null||c(b.current):I==="filter-children"&&(o==null||o(b.current))},children:[e.jsx(Ae,{className:"shrink-0 ml-1 p-1 h-auto w-auto border-0 shadow-none rounded",style:{backgroundColor:L.muted},hideChevron:!0,"data-test":"config-button-v2",children:e.jsx(Bt,{className:"w-3 h-3",style:{color:ee.secondary}})}),e.jsxs(_e,{style:{backgroundColor:$.bg,color:$.text,borderColor:$.border},"data-test":"config-menu-v2",container:j,children:[c&&e.jsx(ne,{value:"configure",style:{color:$.itemText},"data-test":"config-extraction-v2",onPointerDown:I=>{b.current={x:I.clientX,y:I.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"w-3 h-3"}),"Configure extraction"]})}),o&&e.jsx(ne,{value:"filter-children",style:{color:$.itemText},"data-test":"config-filter-children-v2",onPointerDown:I=>{b.current={x:I.clientX,y:I.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"w-3 h-3"}),"Filter out children"]})})]})]})]})}function Et({fieldPath:t,onClick:n,onDoubleClick:s}){return e.jsx("button",{onClick:()=>n==null?void 0:n(t),onDoubleClick:()=>s==null?void 0:s(t),className:"p-1 rounded mr-1 hover:opacity-80 transition-opacity",style:{backgroundColor:L.success},title:"Click: add filter | Double-click: auto-add classes","data-test":"selector-filter-v2",children:e.jsx(Qt,{className:"w-3 h-3",style:{color:ee.success}})})}function pl({node:t,isSelector:n,truncateLength:s,activeFieldPath:a,portalContainer:l,onFieldValueClick:r,onFieldValueHover:c,onClearSelector:o,onConfigClick:i,onFilterChildrenClick:d,onNavigateUp:h,onNavigateDown:m,canNavigateDown:y,onSelectorFilterClick:j,onSelectorFilterDoubleClick:v,onArrayBadgeClick:w,onSchemaCountClick:f}){const g=()=>{if(n&&r){const x=H(t.value)?me(t.value):typeof t.value=="string"?t.value:null;(x!==null||t.name==="_if")&&r(t.path,x??"")}},p=t.value;if(p==null)return t.name==="_if"&&n?e.jsxs("span",{className:"inline-flex items-center","data-test":"if-field-value",children:[e.jsx(Et,{fieldPath:t.path,onClick:j,onDoubleClick:v}),e.jsx(mt,{value:"",isSelector:!0,truncateLength:s,onClick:g,onHover:c,onClear:o,isActive:t.path===a,portalContainer:l})]}):e.jsx("span",{style:{color:re.nullValue},children:"null"});if(H(p)){const x=me(p);return e.jsxs("span",{className:"inline-flex items-center","data-test":"selector-field-value",children:[n&&e.jsx(Et,{fieldPath:t.path,onClick:j,onDoubleClick:v}),e.jsx(mt,{value:x,isSelector:n,truncateLength:s,onClick:n?g:void 0,onHover:c,onClear:n?o:void 0,onConfigClick:n?i:void 0,onFilterChildrenClick:n?d:void 0,onNavigateUp:n?h:void 0,onNavigateDown:n?m:void 0,canNavigateDown:n?y:!1,isActive:n&&t.path===a,portalContainer:l})]})}if(typeof p=="string"){const x=!n&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"string-field-value",children:[n&&e.jsx(Et,{fieldPath:t.path,onClick:j,onDoubleClick:v}),e.jsx(mt,{value:p,isSelector:n,truncateLength:s,onClick:n?g:void 0,onHover:c,onClear:n?o:void 0,onConfigClick:n?i:void 0,onFilterChildrenClick:n?d:void 0,onNavigateUp:n?h:void 0,onNavigateDown:n?m:void 0,canNavigateDown:n?y:!1,isActive:n&&t.path===a,portalContainer:l}),x&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}if(typeof p=="object"&&!Array.isArray(p)&&Object.keys(p).length===0)return e.jsx("span",{style:{color:re.genericValue},children:"{}"});if(Array.isArray(p)){if(!n&&p.length>0){const x=typeof p[0]=="string"?p[0]:String(p[0]),N=p.length-1,C=x.length>s?`${x.slice(0,s)}...`:x;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"array-field-value",children:[e.jsx(mt,{value:C,isSelector:!1,truncateLength:s}),N>0&&e.jsxs("button",{onClick:()=>w==null?void 0:w(t.path,p),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:L.primary,color:D.white},"data-test":"content-array-badge-v2",children:["+",N]})]})}return e.jsxs("span",{style:{color:re.genericValue},children:["[",p.length," items]"]})}const b=!n&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"primitive-field-value",children:[e.jsx("span",{style:{color:re.genericValue},children:String(p)}),b&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}function ml({ifCondition:t,branches:n}){return e.jsxs("div",{className:"ml-4 mt-1 mb-1 p-2 rounded text-[10px] border",style:{backgroundColor:L.muted,borderColor:Y.primary+"40"},"data-test":"branch-details-v2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1.5","data-test":"branch-condition",children:[e.jsx("span",{style:{color:D.muted},children:"if"}),e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:L.secondary,color:D.primary},"data-test":"condition-selector",children:t.selector}),e.jsx("span",{className:"px-1 rounded",style:{backgroundColor:Y.primary+"20",color:Y.primary},"data-test":"condition-type",children:t.condition})]}),Object.entries(n).map(([s,a])=>{const l=Object.keys(a).filter(r=>r!=="match");return e.jsxs("div",{className:"flex items-start gap-1 py-0.5 border-t",style:{borderColor:Y.primary+"20"},"data-test":"branch-item",children:[e.jsx("span",{className:"px-1 rounded shrink-0",style:{backgroundColor:Y.primary,color:D.white},"data-test":"branch-key",children:s}),e.jsx("span",{style:{color:D.muted},children:"match:"}),e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:L.secondary,color:D.primary},"data-test":"branch-match",children:a.match}),l.length>0&&e.jsxs("span",{style:{color:D.muted},"data-test":"branch-overrides",children:["(+",l.length," override",l.length>1?"s":"",")"]})]},s)})]})}function Bs({node:t,level:n,isLast:s,isSelector:a,valuesCollapsed:l,onFieldValueClick:r,onFieldValueHover:c,onClearSelector:o,onSelectorFilterClick:i,onSelectorFilterDoubleClick:d,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:j,onNavigateUp:v,onNavigateDown:w,canNavigateDown:f,onEditBranching:g,truncateLength:p,activeFieldPath:b,portalContainer:x,isBranchField:N,activeBranch:C,branchCount:S,availableBranchFields:A,branchFields:T,onBranchSwitch:E,onToggleBranchField:k,onToggleIfDirect:O,onAddBranch:_}){var at,qe,lt,rt,it,ct,ot;const V=N??((at=t.branchingMetadata)==null?void 0:at.isBranchField)??!1,B=C??((qe=t.branchingMetadata)==null?void 0:qe.activeBranch),I=S??((lt=t.branchingMetadata)==null?void 0:lt.branchCount)??0,P=A??((rt=t.branchingMetadata)==null?void 0:rt.availableBranchFields)??[],M=T??((it=t.branchingMetadata)==null?void 0:it.branchFields)??[],R=((ct=t.branchingMetadata)==null?void 0:ct.isBranchParent)??!1,[U,X]=u.useState(!0),[F,K]=u.useState(!1),le=!!(t.children&&t.children.length>0),te="  ".repeat(n),ue=Array.isArray(t.value)&&le,z=ue?"[":"{",q=ue?"]":"}",se=!!t.conditionalBranching,Q=se?Object.keys(t.conditionalBranching.branches).length:0,J=oe=>{if(c)if(a){const We=typeof t.value=="object"&&t.value!==null&&"selector"in t.value?me(t.value):typeof t.value=="string"?t.value:null;c(oe?We:null,oe?t.path:null)}else c(null,oe?t.path:null)},Ce=()=>{o==null||o(t.path)},Ee=oe=>{h==null||h(t.path,oe)},ce=oe=>{m==null||m(t.path,oe)},xe=()=>{v==null||v(t.path)},ze=()=>{w==null||w(t.path)},De=((ot=t.children)==null?void 0:ot.length)??0,kt=ue?`${De} item${De!==1?"s":""}`:`${De} field${De!==1?"s":""}`;return e.jsxs("div",{"data-test":"field-node-v2",children:[e.jsxs("div",{className:"flex items-center group","data-test":"field-node-line",children:[e.jsx(ul,{node:t,indent:te,isSelector:a,hasChildren:le,hasBranching:se,branchCount:Q,branchDetailsExpanded:F,onEditBranching:g,onToggleBranchDetails:()=>K(!F),onToggleIfDirect:O,onToggleBranchField:k,availableBranchFields:P}),e.jsxs("span",{style:{color:re.punctuation},"data-test":"colon",children:[":"," "]}),le?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>X(!U),className:"inline-flex items-center hover:bg-gray-100 rounded px-0.5 transition-colors","data-test":"toggle-v2",children:[U?e.jsx(Xe,{className:"w-3 h-3",style:{color:ee.muted}}):e.jsx(bt,{className:"w-3 h-3",style:{color:ee.muted}}),e.jsx("span",{style:{color:re.punctuation},children:z}),!U&&e.jsxs("span",{style:{color:re.collapsedLabel},children:[" ",kt," "]}),!U&&e.jsx("span",{style:{color:re.punctuation},children:q})]}),!U&&!s&&e.jsx("span",{style:{color:re.punctuation},children:","})]}):e.jsxs(e.Fragment,{children:[e.jsx(pl,{node:t,isSelector:a,truncateLength:p,activeFieldPath:b,portalContainer:x,onFieldValueClick:r,onFieldValueHover:J,onClearSelector:Ce,onConfigClick:Ee,onFilterChildrenClick:ce,onNavigateUp:xe,onNavigateDown:ze,canNavigateDown:f==null?void 0:f(t.path),onSelectorFilterClick:i,onSelectorFilterDoubleClick:d,onArrayBadgeClick:y,onSchemaCountClick:j}),!s&&e.jsx("span",{style:{color:re.punctuation},children:","})]})]}),V&&B!==void 0&&I>0&&e.jsxs("span",{className:"font-mono whitespace-pre","data-test":"branch-tabs-line",children:[te,"  ",e.jsx(dl,{activeBranch:B,branchCount:I,parentPath:t.path.split(".").slice(0,-1).join("."),onBranchSwitch:E,onAddBranch:_,className:"inline-flex"})]}),se&&F&&e.jsx(ml,{ifCondition:t.conditionalBranching.ifCondition,branches:t.conditionalBranching.branches}),le&&U&&e.jsxs(e.Fragment,{children:[t.children.map((oe,We)=>{var Ue;const dt=!!((Ue=oe.branchingMetadata)!=null&&Ue.isBranchParent),Oe=R&&!dt;return e.jsx(Bs,{node:oe,level:n+1,isLast:We===t.children.length-1,isSelector:a,valuesCollapsed:l,onFieldValueClick:r,onFieldValueHover:c,onClearSelector:o,onSelectorFilterClick:i,onSelectorFilterDoubleClick:d,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:j,onNavigateUp:v,onNavigateDown:w,canNavigateDown:f,onEditBranching:g,truncateLength:p,activeFieldPath:b,portalContainer:x,isBranchField:Oe?M.includes(oe.name):void 0,activeBranch:Oe?B:void 0,branchCount:Oe?I:void 0,availableBranchFields:Oe?P:void 0,branchFields:Oe?M:void 0,onBranchSwitch:E,onToggleBranchField:k,onToggleIfDirect:O,onAddBranch:_},oe.name)}),e.jsxs("div",{"data-test":"closing-bracket",children:[e.jsxs("span",{style:{color:re.punctuation},children:[te,q]}),!s&&e.jsx("span",{style:{color:re.punctuation},children:","})]})]})]})}function Ds(t,n=""){const s=[];for(const a of Object.keys(t)){const l=n?`${n}.${a}`:a;s.push(l);const r=t[a];r&&typeof r=="object"&&!Array.isArray(r)&&s.push(...Ds(r,l))}return s}function Fs(t,n){const s=n.split(".");let a=t;for(const l of s){if(a==null)return[];if(typeof a!="object")return[];a=a[l]}return a==null?[]:Array.isArray(a)?a.map(l=>String(l??"")):typeof a=="object"?[]:[String(a)]}function xl(t,n,s,a){const l=Fs(t,n),r=[];return l.forEach((c,o)=>{fl(c,s,a)&&r.push({path:`${n}[${o}]`,value:c,index:o})}),r}function fl(t,n,s){const a=t.toLowerCase(),l=s.toLowerCase();switch(n){case"equals":return a===l;case"contains":return a.includes(l);case"startsWith":return a.startsWith(l);case"endsWith":return a.endsWith(l);case"regex":try{return new RegExp(s,"i").test(t)}catch{return!1}case"notEquals":return a!==l;case"notContains":return!a.includes(l);default:return!1}}function jt(t,n){const s=t.filter(l=>l.toLowerCase().startsWith(n.toLowerCase()));if(s.length===0)return n;if(s.length===1)return s[0];let a=s[0];for(let l=1;l<s.length;l++){let r=0;for(;r<a.length&&r<s[l].length&&a[r].toLowerCase()===s[l][r].toLowerCase();)r++;if(a=a.slice(0,r),a.length===0)return n}return a.length>n.length?a:n}function gl(t,n){const s=Fs(t,n);return[...new Set(s)].filter(a=>a.trim()!=="")}function Ps(t,n){if(!n)return t;const s=n.toLowerCase();return t.filter(a=>a.toLowerCase().includes(s))}function bl({value:t,onChange:n,onSelect:s,items:a,placeholder:l="Type to filter...",className:r,disabled:c,"data-test":o}){const[i,d]=u.useState(!1),[h,m]=u.useState(0),y=u.useRef(null),j=u.useRef(null),v=u.useMemo(()=>t.trim()?Ps(a,t).slice(0,10):a.slice(0,10),[a,t]);u.useEffect(()=>{m(0)},[v.length]);const w=u.useCallback(N=>{n(N.target.value),d(!0)},[n]),f=u.useCallback(N=>{var C;n(N),s==null||s(N),d(!1),(C=y.current)==null||C.focus()},[n,s]),g=u.useCallback(()=>{if(v.length===0)return!1;const N=jt(v,t);return N.length>t.length?(n(N),!0):v.length===1?(f(v[0]),!0):!1},[v,t,n,f]),p=u.useCallback(N=>{if(!i){(N.key==="ArrowDown"||N.key==="ArrowUp")&&(d(!0),N.preventDefault());return}switch(N.key){case"Escape":N.preventDefault(),d(!1);break;case"ArrowDown":N.preventDefault(),m(C=>C<v.length-1?C+1:0);break;case"ArrowUp":N.preventDefault(),m(C=>C>0?C-1:v.length-1);break;case"Tab":N.preventDefault(),g();break;case"Enter":v.length>0&&(N.preventDefault(),f(v[h]));break}},[i,v,h,g,f]),b=u.useCallback(()=>{setTimeout(()=>d(!1),150)},[]),x=u.useCallback(()=>{a.length>0&&d(!0)},[a.length]);return e.jsx("div",{ref:j,className:"relative","data-test":o,children:e.jsxs(Qn,{open:i&&v.length>0,children:[e.jsx(Zn,{asChild:!0,children:e.jsx(ve,{ref:y,value:t,onChange:w,onKeyDown:p,onBlur:b,onFocus:x,placeholder:l,disabled:c,className:ke("font-mono text-xs",r),"data-test":`${o}-input`})}),e.jsx(ea,{side:"bottom",align:"start",className:"w-[var(--radix-popover-trigger-width)] p-1",onOpenAutoFocus:N=>N.preventDefault(),"data-test":`${o}-dropdown`,children:e.jsx("div",{className:"max-h-[150px] overflow-auto","data-test":`${o}-list`,children:v.map((N,C)=>e.jsx("div",{className:ke("px-2 py-1 text-xs cursor-pointer rounded transition-colors truncate",C===h?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:S=>{S.preventDefault(),f(N)},onMouseEnter:()=>m(C),"data-test":`${o}-item-${C}`,children:N},N))})})]})})}const jl=[{value:"equals",label:"equals"},{value:"contains",label:"contains"},{value:"startsWith",label:"starts with"},{value:"endsWith",label:"ends with"},{value:"regex",label:"regex"},{value:"notEquals",label:"not equals"},{value:"notContains",label:"not contains"}];function yl({fieldPath:t,onFieldPathChange:n,availableFieldPaths:s,operator:a,onOperatorChange:l,compareValue:r,onCompareValueChange:c,availableValues:o,filteredItems:i,selectedMatchIndex:d,onSelectedMatchIndexChange:h,isExpanded:m,onExpandedChange:y,onClear:j,portalContainer:v}){const[w,f]=u.useState(!1),[g,p]=u.useState(!1),[b,x]=u.useState(0),N=t?Ps(s,t).slice(0,10):s.slice(0,10),C=u.useCallback(k=>{n(k.target.value),p(!0),x(0)},[n]),S=u.useCallback(k=>{n(k),p(!1)},[n]),A=u.useCallback(k=>{if(!g&&N.length>0&&(k.key==="ArrowDown"||k.key==="ArrowUp")){p(!0),k.preventDefault();return}if(g)switch(k.key){case"Escape":k.preventDefault(),p(!1);break;case"ArrowDown":k.preventDefault(),x(O=>O<N.length-1?O+1:0);break;case"ArrowUp":k.preventDefault(),x(O=>O>0?O-1:N.length-1);break;case"Tab":if(k.preventDefault(),N.length>0){const O=jt(N,t);O.length>t.length?n(O):N.length===1&&S(N[0])}break;case"Enter":N.length>0&&(k.preventDefault(),S(N[b]));break}},[g,N,t,b,n,S]),T=t.trim()!==""&&r.trim()!=="",E=i.length;return e.jsxs("div",{className:"border-t bg-muted/30","data-test":"content-filter-section",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-muted/50",onClick:()=>y(!m),"data-test":"content-filter-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Xe,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(bt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Qt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"Content Filter"}),T&&E>0&&e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-1.5 py-0.5 rounded","data-test":"filter-match-badge",children:[E," match",E!==1?"es":""]})]}),T&&e.jsx(ae,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:k=>{k.stopPropagation(),j()},"data-test":"filter-clear-btn",children:e.jsx(Le,{className:"w-3 h-3"})})]}),m&&e.jsxs("div",{className:"px-3 pb-3 space-y-2","data-test":"content-filter-controls",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"text-xs text-muted-foreground",children:"Field Path"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{value:t,onChange:C,onKeyDown:A,onFocus:()=>p(!0),onBlur:()=>setTimeout(()=>p(!1),150),placeholder:"e.g., champions._item.cost",className:"font-mono text-xs mt-1","data-test":"filter-field-path-input"}),g&&N.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-[150px] overflow-auto","data-test":"filter-field-path-dropdown",children:N.map((k,O)=>e.jsx("div",{className:ke("px-2 py-1 text-xs font-mono cursor-pointer",O===b?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:_=>{_.preventDefault(),S(k)},onMouseEnter:()=>x(O),"data-test":`filter-field-path-item-${O}`,children:k},k))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-28",children:[e.jsx(ye,{className:"text-xs text-muted-foreground",children:"Operator"}),e.jsxs(Se,{value:a,onValueChange:k=>l(k),children:[e.jsx(Ae,{className:"mt-1 text-xs h-8","data-test":"filter-operator-select",children:e.jsx(Jt,{})}),e.jsx(_e,{container:v,children:jl.map(k=>e.jsx(ne,{value:k.value,className:"text-xs","data-test":`filter-operator-${k.value}`,children:k.label},k.value))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ye,{className:"text-xs text-muted-foreground",children:"Value"}),e.jsx("div",{className:"mt-1",children:e.jsx(bl,{value:r,onChange:c,items:o,placeholder:"Type value to filter...","data-test":"filter-value-input"})})]})]}),T&&E>1&&e.jsxs("div",{className:"pt-2 border-t border-dashed","data-test":"filter-matches-section",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xt,{className:"w-3.5 h-3.5 text-primary"}),e.jsxs("span",{className:"text-xs font-medium",children:["Navigate Matches (",E,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-20 overflow-y-auto",children:i.map((k,O)=>e.jsxs("button",{onClick:()=>h(O),className:ke("px-2 py-1 rounded text-xs font-mono transition-all",O===d?"bg-primary text-primary-foreground font-bold shadow-sm":"bg-muted text-muted-foreground hover:bg-muted/80 border"),title:k.value,"data-test":"filter-match-item",children:["[",k.index,"]"]},O))})]}),T&&E>0&&e.jsxs("div",{className:"pt-2","data-test":"filter-results-section",children:[e.jsxs("button",{onClick:()=>f(!w),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground","data-test":"filter-results-toggle",children:[w?e.jsx(Xe,{className:"w-3 h-3"}):e.jsx(bt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Filtered Results (",E,")"]})]}),w&&e.jsx("div",{className:"mt-2 bg-background border rounded p-2 max-h-32 overflow-auto","data-test":"filter-results-list",children:i.map((k,O)=>e.jsxs("div",{className:ke("text-xs font-mono py-0.5 px-1 rounded",O===d&&"bg-primary/10"),"data-test":"filter-result-item",children:[e.jsxs("span",{className:"text-muted-foreground",children:[k.path,":"]})," ",e.jsxs("span",{className:"text-foreground",children:['"',k.value,'"']})]},O))})]}),T&&E===0&&e.jsx("div",{className:"text-xs text-muted-foreground italic py-2","data-test":"filter-no-matches",children:"No matches found"})]})]})}function ms({mode:t,isActive:n,onModeChange:s,onCopy:a,onImport:l}){const r=t==="selectors"?"Selectors":"Content",c=`preview-tab-${t}-v2`,o=t==="selectors"&&n&&l;return e.jsxs("button",{onClick:()=>s(t),className:"flex-1 px-3 py-2 text-xs font-medium transition-colors flex items-center justify-center gap-1",style:{backgroundColor:n?Y.tabActiveBg:Y.tabInactiveBg,color:n?Y.tabActiveText:Y.tabInactiveText,borderBottom:n?`2px solid ${Y.tabActiveBorder}`:"2px solid transparent"},"data-test":c,children:[r,n&&a&&e.jsx("span",{onClick:i=>{i.stopPropagation(),a()},className:"p-0.5 rounded hover:bg-blue-100 transition-colors",title:`Copy ${t}`,"data-test":`copy-${t}-button-v2`,children:e.jsx(ja,{className:"w-3 h-3"})}),o&&e.jsx("span",{onClick:i=>{i.stopPropagation(),l()},className:"p-0.5 rounded hover:bg-blue-100 transition-colors",title:"Import schema","data-test":"import-selectors-button-v2",children:e.jsx(vs,{className:"w-3 h-3"})})]})}const xs={fieldPath:"",operator:"equals",compareValue:"",isExpanded:!1};function vl(t){const[n,s]=u.useState(xs),[a,l]=u.useState(0),r=u.useMemo(()=>Ds(t),[t]),c=u.useMemo(()=>n.fieldPath?gl(t,n.fieldPath):[],[t,n.fieldPath]),o=u.useMemo(()=>!n.fieldPath||!n.compareValue?[]:xl(t,n.fieldPath,n.operator,n.compareValue),[t,n.fieldPath,n.operator,n.compareValue]),i=o.length,d=u.useCallback((f,g)=>jt(f,g),[]),h=u.useCallback((f,g)=>jt(f,g),[]),m=u.useCallback(f=>{s(g=>({...g,fieldPath:f,compareValue:""})),l(0)},[]),y=u.useCallback(f=>{s(g=>({...g,operator:f})),l(0)},[]),j=u.useCallback(f=>{s(g=>({...g,compareValue:f})),l(0)},[]),v=u.useCallback(f=>{s(g=>({...g,isExpanded:f}))},[]),w=u.useCallback(()=>{s(xs),l(0)},[]);return{filterState:n,filteredItems:o,matchCount:i,selectedMatchIndex:a,availableFieldPaths:r,findFieldPathLCS:d,availableValues:c,findValueLCS:h,setFieldPath:m,setOperator:y,setCompareValue:j,setSelectedMatchIndex:l,setExpanded:v,clearFilter:w}}function Nl(t,n){if(!t||!n)return null;const s=t.split(".");if(s.length<2)return null;const a=s[s.length-1],l=s.slice(0,-1);let r=n;for(const j of l){if(typeof r!="object"||r===null)return null;r=r[j]}if(typeof r!="object"||r===null)return null;const c=r,o=c._branchFields;if(!(o!=null&&o.includes(a)))return null;const i=c._if;if(!i)return null;let d;if(typeof i=="string")d=i;else if(typeof i=="object"&&i.selector)d=i.selector;else return null;if(!d)return null;const h=c._activeBranch||1,m=c._branches;if(!m)return null;const y=Object.entries(m).map(([j,v])=>({branchNum:parseInt(j),match:(v==null?void 0:v.match)||"/./"})).sort((j,v)=>j.branchNum-v.branchNum);return{ifSelector:d,activeBranch:h,allBranchPatterns:y}}function wl(t,n){if(!t||!n)return null;const s=t.split(".");if(s.length<2)return null;const a=s[s.length-1],l=s.slice(0,-1);let r=n;for(const j of l){if(typeof r!="object"||r===null)return null;r=r[j]}if(typeof r!="object"||r===null)return null;const c=r,o=c._branchFields;if(!(o!=null&&o.includes(a)))return null;const i=c._if;if(!i)return null;let d;if(typeof i=="string")d=i;else if(typeof i=="object"&&i.selector)d=i.selector;else return null;if(!d)return null;const h=c._branches;if(!h)return null;const m=[],y=Object.keys(h).sort((j,v)=>parseInt(j)-parseInt(v));for(const j of y){const v=h[j];if(!v||typeof v!="object")continue;const w=v.match||"/./",f=v[a];let g="";typeof f=="string"?g=f:H(f)&&(g=me(f)),m.push({pattern:w,selector:g})}return{ifSelector:d,branchSelectors:m}}function Rt(t,n,s){var c;const a=t.querySelector(n),l=((c=a==null?void 0:a.textContent)==null?void 0:c.trim())||"",r=!!a;if(s==="true")return r;if(s===".")return!0;try{return new RegExp(s).test(l)}catch{return!0}}function Cl(t,n){const{ifSelector:s,activeBranch:a,allBranchPatterns:l}=n,r=l.find(i=>i.branchNum===a);if(!r)return t;const c=r.match.replace(/^\/|\/$/g,""),o=l.filter(i=>i.branchNum<a).map(i=>i.match.replace(/^\/|\/$/g,""));return t.filter(i=>{if(i===document)return!0;const d=i;for(const h of o)if(Rt(d,s,h))return!1;return Rt(d,s,c)})}function Ot(t,n){const s=n.split("."),a=s[0],l=t[a];if(!Array.isArray(l))return 0;const r=s.slice(1),c=(i,d)=>{if(d.length===0)return 1;const[h,...m]=d;return Array.isArray(i)?i.reduce((y,j)=>y+c(j==null?void 0:j[h],m),0):i&&typeof i=="object"?c(i[h],m):0};let o=0;for(const i of l)o+=c(i,r);return o}function yt(t,n=""){const s=["_branches","_branchFields","_activeBranch"],a=Object.entries(t).filter(([o])=>!s.includes(o)),l={_container:0,_item:1,_if:2};a.sort(([o],[i])=>{const d=l[o]??3,h=l[i]??3;return d-h});const c=Mt(t)?t:null;if(c){const o=new Set(a.map(([d])=>d)),i=c._branches[String(c._activeBranch)]||{};for(const d of c._branchFields)o.has(d)||a.push([d,i[d]??""])}return a.map(([o,i])=>{const d=n?`${n}${o}`:o;if(o==="_if"){if(Qe(i)){const y=typeof i=="string"?{selector:i,condition:"exists"}:i;return{name:"_if",path:d,value:y.selector,conditionalBranching:{ifCondition:{selector:y.selector,condition:y.condition},branches:{}}}}return{name:"_if",path:d,value:null,conditionalBranching:{ifCondition:{selector:"",condition:"exists"},branches:{}}}}let h=i;if(c!=null&&c._branchFields.includes(o)){const y=c._branches[String(c._activeBranch)]||{};o in y&&(h=y[o])}const m={name:o,path:d,value:h};if(c!=null&&c._branchFields.includes(o)&&(m.branchingMetadata={isBranchField:!0,activeBranch:c._activeBranch,branchCount:Object.keys(c._branches).length,branchFields:c._branchFields}),!H(h))if(h&&typeof h=="object"&&!Array.isArray(h)){const y=h,j=y._if,v=y._branches;if(Qe(j)&&wt(v)){const w=typeof j=="string"?{selector:j,condition:"exists"}:j;m.conditionalBranching={ifCondition:{selector:w.selector,condition:w.condition},branches:v}}if(Mt(y)){const w=y,f=Object.keys(y).filter(b=>!b.startsWith("_")),g=w._branchFields,p=[...new Set([...f,...g])];m.branchingMetadata={isBranchParent:!0,activeBranch:w._activeBranch,branchCount:Object.keys(w._branches).length,branchFields:w._branchFields,availableBranchFields:p}}m.children=yt(y,`${d}.`)}else Array.isArray(h)&&h.length>0&&typeof h[0]=="object"&&h[0]!==null&&(m.children=h.map((y,j)=>({name:`[${j}]`,path:`${d}[${j}]`,value:y,isArrayItem:!0,arrayIndex:j,children:typeof y=="object"&&y!==null&&!H(y)?yt(y,`${d}[${j}].`):void 0})));return m})}function Vt(t,n="",s=null,a=null){const l=s??t;return Object.entries(t).map(([r,c])=>{const o=n?`${n}${r}`:r,i={name:r,path:o,value:c};if(a!==null&&(i.schemaArrayCount=Ot(l,o)),Array.isArray(c)&&c.length>0){const d=c[0];typeof d=="object"&&d!==null?(i.schemaArrayCount=Ot(l,o),i.value=d,i.children=Vt(d,`${o}.`,l,c.length)):(i.schemaArrayCount=Ot(l,o),i.value=d)}else c&&typeof c=="object"&&!Array.isArray(c)&&(i.children=Vt(c,`${o}.`,l,a));return i})}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t&&typeof t=="object"){if(H(t))return t;const n={},s=new Set(["_branchFields","_activeBranch"]);for(const[a,l]of Object.entries(t))s.has(a)||(n[a]=Lt(l));return n}return t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t&&typeof t=="object"){const n={};for(const[s,a]of Object.entries(t))s.startsWith("_")||(n[s]=zt(a));return n}return t}function kl({mode:t,onModeChange:n,selectors:s,content:a,onFieldValueClick:l,onFieldValueHover:r,onClearSelector:c,onSelectorFilterClick:o,onSelectorFilterDoubleClick:i,onConfigClick:d,onFilterChildrenClick:h,onArrayBadgeClick:m,onNavigateUp:y,onNavigateDown:j,canNavigateDown:v,onEditBranching:w,onImportClick:f,contentViewMode:g="schema",onSchemaCountClick:p,activeFieldPath:b,className:x,portalContainer:N,onBranchSwitch:C,onToggleBranchField:S,onToggleIfDirect:A,onAddBranch:T}){const[E,k]=u.useState(!0),O=t==="selectors"?s:a,{filterState:_,filteredItems:V,selectedMatchIndex:B,availableFieldPaths:I,availableValues:P,setFieldPath:M,setOperator:R,setCompareValue:U,setSelectedMatchIndex:X,setExpanded:F,clearFilter:K}=vl(O),le=t==="selectors"?yt(s):g==="schema"?Vt(a):yt(a),te=Object.keys(O).length===0,ue=E?Ft.collapsed:Ft.expanded,z=u.useCallback((Q,J)=>{if(r){if(t==="selectors"||Q){r(Q,J);return}if(J){const Ce=wl(J,s);if(Ce){r(null,J,Ce);return}const Ee=J.split(".");let ce=s;for(const ze of Ee){if(typeof ce!="object"||ce===null){ce=void 0;break}ce=ce[ze]}let xe=null;H(ce)?xe=me(ce):typeof ce=="string"&&(xe=ce),r(xe,J)}else r(null,null)}},[t,r,s]),q=async()=>{try{const Q=Lt(s),J=JSON.stringify(Q,null,2);await navigator.clipboard.writeText(J),G.success("Selectors copied to clipboard!")}catch{G.error("Failed to copy to clipboard")}},se=async()=>{try{const Q=zt(a),J=JSON.stringify(Q,null,2);await navigator.clipboard.writeText(J),G.success("Content copied to clipboard!")}catch{G.error("Failed to copy to clipboard")}};return e.jsxs("div",{className:`flex flex-col h-full ${x??""}`,"data-test":"preview-tabs-v2",children:[e.jsxs("div",{className:"flex border-b shrink-0",style:{backgroundColor:L.white},"data-test":"preview-mode-tabs-v2",children:[e.jsx(ms,{mode:"selectors",isActive:t==="selectors",onModeChange:n,onCopy:q,onImport:f}),e.jsx(ms,{mode:"content",isActive:t==="content",onModeChange:n,onCopy:se})]}),e.jsx("div",{className:"flex-1 overflow-auto p-2","data-test":"preview-content-v2",children:te?e.jsx("div",{className:"text-sm text-center py-8",style:{color:D.placeholder},"data-test":"empty-preview-v2",children:t==="selectors"?"No selectors defined":"No content extracted"}):e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>k(!E),className:"absolute top-1 right-1 flex items-center gap-1 text-xs px-1.5 py-0.5 rounded hover:bg-gray-200 transition-colors",style:{color:D.muted,backgroundColor:L.whiteAlpha},title:E?"Expand values":"Collapse values","data-test":"toggle-values-collapse-v2",children:[E?e.jsx(bt,{className:"w-3 h-3"}):e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("span",{children:E?"Expand":"Collapse"})]}),e.jsxs("pre",{className:"text-xs font-mono m-0 p-0",style:{background:"transparent"},"data-test":"json-tree-v2",children:[e.jsx("span",{style:{color:re.punctuation},children:"{"}),le.map((Q,J)=>e.jsx(Bs,{node:Q,level:1,isLast:J===le.length-1,isSelector:t==="selectors",valuesCollapsed:E,onFieldValueClick:l,onFieldValueHover:z,onClearSelector:c,onSelectorFilterClick:o,onSelectorFilterDoubleClick:i,onConfigClick:d,onFilterChildrenClick:h,onArrayBadgeClick:m,onSchemaCountClick:p,onNavigateUp:y,onNavigateDown:j,canNavigateDown:v,onEditBranching:t==="selectors"?w:void 0,truncateLength:ue,activeFieldPath:t==="selectors"?b:null,portalContainer:N,onBranchSwitch:C,onToggleBranchField:S,onToggleIfDirect:A,onAddBranch:T},Q.name)),e.jsx("span",{style:{color:re.punctuation},children:"}"})]})]})}),e.jsx(yl,{fieldPath:_.fieldPath,onFieldPathChange:M,availableFieldPaths:I,operator:_.operator,onOperatorChange:R,compareValue:_.compareValue,onCompareValueChange:U,availableValues:P,filteredItems:V,selectedMatchIndex:B,onSelectedMatchIndexChange:X,isExpanded:_.isExpanded,onExpandedChange:F,onClear:K,portalContainer:N})]})}function Sl({continuousMode:t,onContinuousModeToggle:n,previewMode:s,contentViewMode:a,onContentViewModeChange:l,filledCount:r,totalCount:c,warningMessage:o}){return e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-3 py-2 text-xs border-t relative",style:{backgroundColor:L.muted},"data-test":"continuous-mode-status-v2",children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-amber-100 text-amber-800 font-medium animate-pulse","data-test":"status-bar-warning-v2",children:o}),e.jsxs("button",{className:"flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer",onClick:n,"data-test":"continuous-mode-toggle-v2",children:[e.jsx(ya,{className:"w-3 h-3",style:{color:t?ee.primary:ee.muted}}),e.jsxs("span",{style:{color:t?D.primary:D.muted},children:["Continuous Mode: ",t?"ON":"OFF"]})]}),s==="content"&&e.jsxs("div",{className:"flex items-center gap-1","data-test":"content-view-toggle-v2",children:[e.jsx("button",{onClick:()=>l("schema"),className:`p-1 rounded transition-colors ${a==="schema"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Schema view","data-test":"content-view-schema-v2",children:e.jsx(va,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>l("array"),className:`p-1 rounded transition-colors ${a==="array"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Array view","data-test":"content-view-array-v2",children:e.jsx(Yt,{className:"w-3 h-3"})})]}),e.jsxs("span",{style:{color:D.muted},children:[r,"/",c," fields"]})]})}function Al({mode:t,fields:n,selectedFieldId:s,schemaSectionHeight:a,previewMode:l,contentViewMode:r,selectors:c,content:o,activeFieldPath:i,continuousMode:d,filledCount:h,totalCount:m,portalContainer:y,containerRef:j,onFieldSelect:v,onFieldUpdate:w,onFieldEdit:f,onFieldDelete:g,onReorder:p,onAddChild:b,onAddSiblingBefore:x,onAddSiblingAfter:N,onListModeApply:C,onListModeCancel:S,onResizeStart:A,onPreviewModeChange:T,onFieldValueClick:E,onFieldValueHover:k,onClearSelector:O,onSelectorFilterClick:_,onSelectorFilterDoubleClick:V,onConfigClick:B,onFilterChildrenClick:I,onArrayBadgeClick:P,onNavigateUp:M,onNavigateDown:R,canNavigateDown:U,onEditBranching:X,onImportClick:F,onSchemaCountClick:K,onBranchSwitch:le,onToggleBranchField:te,onToggleIfDirect:ue,onAddBranch:z,onContinuousModeToggle:q,onContentViewModeChange:se,warningMessage:Q}){return e.jsxs("div",{ref:j,className:"flex flex-col h-full","data-test":"capture-panel-v2",children:[e.jsxs("div",{className:"p-2 text-xs font-medium border-b shrink-0",style:{backgroundColor:"#f9fafb",color:"#6b7280"},"data-test":"schema-header",children:["Schema ",t==="list"&&"(List Mode)"]}),e.jsx("div",{className:"min-h-0 overflow-auto",style:a!==null?{height:a}:{flex:t==="list"?3:1},"data-test":"schema-section-v2",children:t==="mapped"?e.jsx(al,{fields:n,selectedFieldId:s,mode:t,onFieldSelect:v,onFieldUpdate:w,onFieldEdit:f,onFieldDelete:g,onReorder:p,onAddChild:b,onAddSiblingBefore:x,onAddSiblingAfter:N}):e.jsx(ol,{fields:n,onApply:C,onCancel:S})}),e.jsx("div",{className:"h-1.5 bg-border hover:bg-primary/50 cursor-row-resize shrink-0 transition-colors flex items-center justify-center group",onMouseDown:A,"data-test":"section-resize-handle",children:e.jsx("div",{className:"w-8 h-0.5 bg-muted-foreground/30 group-hover:bg-primary/70 rounded-full transition-colors"})}),e.jsx("div",{className:"flex-1 min-h-0","data-test":"preview-section-v2",children:e.jsx(kl,{mode:l,onModeChange:T,selectors:c,content:o,onFieldValueClick:E,onFieldValueHover:k,onClearSelector:O,onSelectorFilterClick:_,onSelectorFilterDoubleClick:V,onConfigClick:B,onFilterChildrenClick:I,onArrayBadgeClick:P,onNavigateUp:M,onNavigateDown:R,canNavigateDown:U,onEditBranching:X,onImportClick:F,contentViewMode:r,onSchemaCountClick:K,activeFieldPath:i,portalContainer:y,onBranchSwitch:le,onToggleBranchField:te,onToggleIfDirect:ue,onAddBranch:z})}),e.jsx(Sl,{continuousMode:d,onContinuousModeToggle:q,previewMode:l,contentViewMode:r,onContentViewModeChange:se,filledCount:h,totalCount:m,warningMessage:Q})]})}const _l=/([[\]():!#$%&'*+,./;<=>?@\\^`{|}~])/g;function Ms(t){return t.replace(_l,"\\$1")}function Ye(t){const n=Array.from(t.classList).filter(s=>!s.startsWith("css-")).map(Ms).join(".");return n?`.${n}`:t.tagName.toLowerCase()}function qt(t){if(t.closest('[data-test="capture-panel-v2"]')||t.closest('[data-test="draggable-popover-container"]'))return!0;const n=t.closest("[data-radix-popper-content-wrapper]")||t.closest('[role="dialog"]')||t.closest('[role="listbox"]')||t.closest('[role="menu"]');if(n){let s=t;for(;s&&s!==n;){const l=s.getAttribute("data-test");if(l!=null&&l.endsWith("-v2"))return!0;s=s.parentElement}if(n.querySelector('[data-test$="-v2"]'))return!0}return!1}function Il(t){const n=Array.from(t.classList).filter(s=>!s.startsWith("css-")).map(Ms).join(".");return n?`.${n}`:t.tagName.toLowerCase()}function fs(t,n){if(!t||!n)return[document];const s=t.split("."),a=s[s.length-1];if(a==="_container"||a==="_item")return[document];const l=[];let r=n;for(let o=0;o<s.length;o++){const i=s[o];if(typeof r!="object"||r===null)break;const d=r;if(!(i in d))break;if(r=d[i],typeof r=="object"&&r!==null){const h=r;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",j=typeof m=="string"?m:(m==null?void 0:m.selector)??"",v=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(j){const w=j.endsWith("[]")?j.slice(0,-2):j;v?l.push({containerSelector:w,itemSelector:v}):l.push({containerSelector:w,itemSelector:"",containerOnly:!0})}}}}if(l.length===0)return[document];let c=[document];for(let o=0;o<l.length;o++){const i=l[o],d=[];for(const h of c){const m=Array.from(h.querySelectorAll(i.containerSelector));for(const y of m)if(i.containerOnly)d.push(y);else{const j=Array.from(y.querySelectorAll(i.itemSelector));d.push(...j)}}if(d.length===0)return[document];c=d}return c}function El(t,n){if(!t||!n)return[document];const s=t.split("."),a=s[s.length-1];if(a==="_container"||a==="_item")return[document];const l=[];let r=n;for(let o=0;o<s.length;o++){const i=s[o];if(typeof r!="object"||r===null)break;const d=r;if(!(i in d))break;if(r=d[i],typeof r=="object"&&r!==null){const h=r;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",j=typeof m=="string"?m:(m==null?void 0:m.selector)??"",v=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(j){const w=j.endsWith("[]")?j.slice(0,-2):j;v?l.push({containerSelector:w,itemSelector:v}):l.push({containerSelector:w,itemSelector:"",containerOnly:!0})}}}}if(l.length===0)return[document];let c=[document];for(let o=0;o<l.length;o++){const i=l[o],d=o===l.length-1,h=[];for(const m of c){const y=Array.from(m.querySelectorAll(i.containerSelector));for(const j of y)if(d)h.push(j);else if(i.containerOnly)h.push(j);else{const v=Array.from(j.querySelectorAll(i.itemSelector));h.push(...v)}}if(h.length===0)return[document];c=h}return c}function Ol({selectors:t}={}){const n=u.useRef([]),s=u.useCallback(()=>{for(const{element:c,originalOutline:o,originalOutlineOffset:i,originalBackground:d}of n.current)c.style.outline=o,c.style.outlineOffset=i,c.style.background=d;n.current=[]},[]),a=u.useCallback(c=>{qt(c)||(n.current.push({element:c,originalOutline:c.style.outline,originalOutlineOffset:c.style.outlineOffset,originalBackground:c.style.background}),c.style.outline=Ne.outline,c.style.outlineOffset=Ne.outlineOffset,c.style.background=Ne.background)},[]),l=u.useCallback((c,o,i)=>{s();try{let d=fs(o,t);if(i){const{ifSelector:m,branchSelectors:y}=i;for(const j of d){if(j===document)continue;const v=j;let w="";for(const{pattern:f,selector:g}of y){const p=f.replace(/^\/|\/$/g,"");if(Rt(v,m,p)){w=g;break}}if(w){const f=Je(w,j);for(const g of f)a(g)}}return}const h=Nl(o,t);h&&(d=Cl(d,h));for(const m of d){const y=Je(c,m);for(const j of y)a(j)}}catch{}},[s,a,t]),r=u.useCallback((c,o,i)=>{if(s(),!(!c||i===null||i<0))try{const d=fs(o,t);if(i>=d.length)return;const h=d[i],m=Je(c,h);for(const y of m)a(y)}catch{}},[s,a,t]);return{clearHighlights:s,highlightElement:a,highlightMatches:l,highlightByIndex:r}}function Tl({onSelectorCaptured:t,onSelectorInspect:n,selectors:s,preventDefaultOnInteraction:a,onEscapePressed:l}){const[r,c]=u.useState(null),{clearHighlights:o,highlightElement:i,highlightMatches:d,highlightByIndex:h}=Ol({selectors:s});u.useEffect(()=>{if(!r)return;const f=b=>{b.key==="Escape"&&(o(),c(null),l==null||l())},g=b=>{const x=b.target;qt(x)||(o(),i(x))},p=b=>{const x=b.target;if(qt(x))return;a&&(b.preventDefault(),b.stopPropagation());const N=Il(x),C=document.querySelectorAll(N),S=Array.from(C).map(A=>{var T;return((T=A.textContent)==null?void 0:T.trim())??""});t(r,N,S),o(),c(null)};return window.addEventListener("keydown",f),document.addEventListener("mouseover",g),document.addEventListener("click",p),()=>{window.removeEventListener("keydown",f),document.removeEventListener("mouseover",g),document.removeEventListener("click",p)}},[r,o,i,t,a,l]),u.useEffect(()=>{r||o()},[r,o]);const m=u.useCallback((f,g)=>{!g||g===""?c(f):n==null||n(f,g)},[n]),y=u.useCallback((f,g,p)=>{if(p){d("",g,p);return}if(!f){o();return}d(f,g)},[o,d]),j=u.useCallback((f,g,p=400)=>{y(f,g),setTimeout(()=>{o()},p)},[y,o]),v=u.useCallback((f,g,p)=>{if(!(p===null||p<0))try{const b=El(g,s);if(p>=b.length)return;const x=b[p];if(x===document)return;x.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},[s]),w=u.useCallback(()=>{o(),c(null)},[o]);return{selectorCaptureFieldPath:r,handleFieldValueClick:m,handleFieldValueHover:y,flashHighlight:j,highlightByIndex:h,scrollToElementByIndex:v,cancelCapture:w}}function Bl({selectors:t}){const[n,s]=u.useState(!1),[a,l]=u.useState(null),[r,c]=u.useState(null),[o,i]=u.useState(null),[d,h]=u.useState(null),[m,y]=u.useState(null),j=u.useCallback((g,p)=>{s(!0),l(g);const b=Va(g,t);if(b.length===0){y(null);const O=xt(p,document);c(O),i(p),h(null);return}const N=Ie(p).selector;let C=null,S=-1,A=0;for(let O=0;O<b.length;O++){const _=b[O];try{_.querySelectorAll(N).length>0&&(A++,C===null&&(C=_,S=O))}catch{}}const T=C??b[0],E=S>=0?S:0;y(T);const k=xt(p,T);k&&(k.itemStats={itemsWithMatch:A,totalItems:b.length,displayedItemIndex:E}),c(k),i(p),h(null)},[t]),v=u.useCallback(()=>{s(!1),l(null),c(null),i(null),h(null),y(null)},[]),w=u.useCallback(g=>{c(xt(g,m??document))},[m]),f=u.useCallback(g=>!r||g<0||g>=r.siblings.length?null:r.siblings[g].element,[r]);return{isOpen:n,fieldPath:a,domContext:r,initialSelector:o,previousChildIndex:d,openPopover:j,closePopover:v,refreshContext:w,setPreviousChildIndex:h,getSiblingElement:f}}function Dl({domTreeFieldPath:t,domContext:n,domTreeInitialSelector:s,onSelectorCaptured:a,refreshDomTreeContext:l,closeDomTreePopover:r,setDomTreePreviousChildIndex:c}){const o=u.useCallback((v,w)=>{if(!t)return;const f=Ye(w),g=document.querySelectorAll(f),p=Array.from(g).map(b=>{var x;return((x=b.textContent)==null?void 0:x.trim())??""});a(t,f,p)},[t,a]),i=u.useCallback(v=>{if(!t||!n)return;c(n.capturedIndex);const w=Ye(v),f=document.querySelectorAll(w),g=Array.from(f).map(p=>{var b;return((b=p.textContent)==null?void 0:b.trim())??""});a(t,w,g),l(w)},[t,n,a,l,c]),d=u.useCallback((v,w)=>{if(!t)return;c(null);const f=Ye(w),g=document.querySelectorAll(f),p=Array.from(g).map(b=>{var x;return((x=b.textContent)==null?void 0:x.trim())??""});a(t,f,p),l(f)},[t,a,l,c]),h=u.useCallback(()=>{t&&(a(t,"",[]),r())},[t,a,r]),m=u.useCallback(v=>{var x;if(!t||!n)return;const w=n.baseSelector,f=`${w}[${v}]`,p=document.querySelectorAll(w)[v],b=((x=p==null?void 0:p.textContent)==null?void 0:x.trim())??"";a(t,f,[b]),l(f),G.success(`Updated selector to [${v}]`)},[t,n,a,l]),y=u.useCallback(()=>{if(!t||!s)return;const v=document.querySelectorAll(s),w=Array.from(v).map(f=>{var g;return((g=f.textContent)==null?void 0:g.trim())??""});a(t,s,w),l(s),G.success("Reverted to original selector")},[t,s,a,l]),j=u.useCallback((v,w)=>{t&&ta(async()=>{const{querySelectorWithIndex:f}=await Promise.resolve().then(()=>$a);return{querySelectorWithIndex:f}},void 0).then(({querySelectorWithIndex:f})=>{const p=f(v).map(b=>{var x;return((x=b.textContent)==null?void 0:x.trim())??""});a(t,v,p),l(v)})},[t,a,l]);return{handleDomTreeSiblingSelect:o,handleDomTreeParentSelect:i,handleDomTreeChildSelect:d,handleClearSelector:h,handleAddIndex:m,handleRevertSelector:y,handleSelectorChange:j}}function Fl(t){const[n,s]=u.useState(t),[a,l]=u.useState(null),[r,c]=u.useState(null),[o,i]=u.useState(!1),d=u.useCallback(b=>{l(b)},[]),h=u.useCallback((b,x)=>{s(N=>N.map(C=>C.id===b?{...C,name:x}:C))},[]),m=u.useCallback((b,x,N)=>{c({id:b,name:x,type:N}),i(!0)},[]),y=u.useCallback(b=>{b&&r&&s(x=>x.map(N=>N.id===r.id?{...N,name:b.name,type:b.type}:N)),c(null),i(!1)},[r]),j=u.useCallback(()=>{c(null),i(!1)},[]),v=u.useCallback(b=>{s(x=>x.filter(N=>N.id!==b&&N.parentId!==b))},[]),w=u.useCallback(b=>{const x=(N,C)=>N.flatMap((S,A)=>{const E={...S.data,parentId:C,order:A},k=S.children?x(S.children,S.id):[];return[E,...k]});s(x(b,null))},[]),f=u.useCallback(b=>{const x=`field-${Date.now()}`;s(N=>[...N,{id:x,name:"newField",type:"string",order:N.length,parentId:b,mapping:null}])},[]),g=u.useCallback(b=>{s(x=>{const N=x.find(S=>S.id===b);if(!N)return x;const C=`field-${Date.now()}`;return[...x,{id:C,name:"newField",type:"string",order:N.order-.5,parentId:N.parentId,mapping:null}]})},[]),p=u.useCallback(b=>{s(x=>{const N=x.find(S=>S.id===b);if(!N)return x;const C=`field-${Date.now()}`;return[...x,{id:C,name:"newField",type:"string",order:N.order+.5,parentId:N.parentId,mapping:null}]})},[]);return{fields:n,setFields:s,selectedFieldId:a,editingField:r,isFieldDialogOpen:o,handleFieldSelect:d,handleFieldUpdate:h,handleFieldEdit:m,handleFieldDialogSubmit:y,handleFieldDialogCancel:j,handleFieldDelete:v,handleReorder:w,handleAddChild:f,handleAddSiblingBefore:g,handleAddSiblingAfter:p}}const Me="watcher:custom-captures-v2";function Pl(){const[t,n]=u.useState([]);u.useEffect(()=>{try{const o=localStorage.getItem(Me);o&&n(JSON.parse(o))}catch(o){console.warn("[CaptureStorage] Failed to load from localStorage:",o)}},[]);const s=u.useCallback(o=>{const i={...o,id:`capture-${Date.now()}`,capturedAt:Date.now()};return n(d=>{const h=[...d,i];return localStorage.setItem(Me,JSON.stringify(h)),h}),G.success("Capture saved to localStorage!"),i},[]),a=u.useCallback(o=>{const i=localStorage.getItem(Me);if(!i)return;const h=JSON.parse(i).find(m=>m.id===o);return h&&G.success("Capture loaded!"),h},[]),l=u.useCallback(o=>{n(i=>{const d=i.filter(h=>h.id!==o);return localStorage.setItem(Me,JSON.stringify(d)),d}),G.success("Capture deleted")},[]),r=u.useCallback((o,i)=>{n(d=>{const h=d.map(m=>m.id===o?{...m,name:i}:m);return localStorage.setItem(Me,JSON.stringify(h)),h}),G.success("Capture renamed")},[]),c=u.useCallback(()=>{try{const o=localStorage.getItem(Me);if(!o)return;const i=JSON.parse(o);return i.length===0?void 0:i[i.length-1]}catch{return}},[]);return{savedCaptures:t,saveCapture:s,loadCapture:a,deleteCapture:l,renameCapture:r,getLastCapture:c}}function Ml(t){const n={};for(const[s,a]of Object.entries(t))s==="match"?n[s]=a:typeof a=="string"?n[s]=Nt(a):(H(a)||typeof a=="object"&&a!==null&&Array.isArray(a),n[s]=a);return n}function $l(t){const n=new Set;for(const s of Object.values(t))if(typeof s=="object"&&s!==null)for(const a of Object.keys(s))a!=="match"&&n.add(a);return Array.from(n)}function Ke(t){const n={};for(const[s,a]of Object.entries(t))if(s==="_container"||s==="_item")n[s]=a;else if(s==="_if")n[s]=a;else if(s==="_branches")if(typeof a=="object"&&a!==null){const l=a,r={};for(const[o,i]of Object.entries(l))typeof i=="object"&&i!==null?r[o]=Ml(i):r[o]=i;n[s]=r;const c=$l(l);c.length>0&&(n._branchFields=c),"_activeBranch"in t||(n._activeBranch=1)}else n[s]=a;else s==="_branchFields"||s==="_activeBranch"?n[s]=a:typeof a=="string"?n[s]=Nt(a):H(a)?n[s]=a:typeof a=="object"&&a!==null&&!Array.isArray(a)?n[s]=Ke(a):n[s]=a;return n}function Wt(t){const n={};for(const[s,a]of Object.entries(t))H(a)?n[s]=es(a):typeof a=="object"&&a!==null&&!Array.isArray(a)?n[s]=Wt(a):n[s]=a;return n}function Rl({fields:t,selectors:n,content:s,setFields:a,setSelectors:l,setContent:r}){const[c,o]=u.useState(!0),[i,d]=u.useState(!1),[h,m]=u.useState(!1),[y,j]=u.useState(!1),[v,w]=u.useState(!1),[f,g]=u.useState(!0),[p,b]=u.useState(null),{savedCaptures:x,saveCapture:N,loadCapture:C,deleteCapture:S,renameCapture:A,getLastCapture:T}=Pl();u.useEffect(()=>{const z=T(),q=z&&Object.keys(z.selectors).length>0;if(z&&q){a(z.fields);const se=Ke(z.selectors);l(se),r(z.content)}else{const se=Ke(Aa);l(se)}},[T,a,l,r]);const E=u.useCallback(()=>{const z=Wt(n);N({name:"TFT Capture",url:window.location.href,fields:t,selectors:z,content:s})},[N,t,n,s]),k=u.useCallback(z=>{const q=C(z);if(q){a(q.fields);const se=Ke(q.selectors);l(se),r(q.content)}},[C,a,l,r]),O=u.useCallback(()=>{const z=Wt(n),q={fields:t,selectors:z,content:s},se=new Blob([JSON.stringify(q,null,2)],{type:"application/json"}),Q=URL.createObjectURL(se),J=document.createElement("a");J.href=Q,J.download=`capture-${Date.now()}.json`,J.click(),URL.revokeObjectURL(Q)},[t,n,s]),_=u.useCallback(()=>{l({}),r({}),G.success("Capture data cleared")},[l,r]),V=u.useCallback(()=>{o(!0)},[]),B=u.useCallback(()=>{o(!1)},[]),I=u.useCallback(()=>{m(!0)},[]),P=u.useCallback(()=>{m(!1)},[]),M=u.useCallback(()=>{j(!0)},[]),R=u.useCallback(()=>{j(!1)},[]),U=u.useCallback(()=>{w(!0)},[]),X=u.useCallback(()=>{w(!1)},[]),F=u.useCallback((z,q)=>{A(z,q)},[A]),K=u.useCallback(z=>{S(z)},[S]),le=u.useCallback(z=>{const q=Ke(z);l(q),G.success("Schema imported successfully!")},[l]),te=u.useCallback((z,q)=>{b({fieldName:z,values:q})},[]),ue=u.useCallback(()=>{b(null)},[]);return{savedCaptures:x,isPopoverVisible:c,moreActionsOpen:i,importDialogOpen:h,managerPopoverOpen:y,advancedSettingsOpen:v,preventDefaultOnInteraction:f,contentPopover:p,setMoreActionsOpen:d,setPreventDefaultOnInteraction:g,handleSave:E,handleLoad:k,handleRenameCapture:F,handleDeleteCapture:K,handleDownload:O,handleClear:_,handleOpenPopover:V,handleClosePopover:B,handleOpenImportDialog:I,handleCloseImportDialog:P,handleOpenManagerPopover:M,handleCloseManagerPopover:R,handleOpenAdvancedSettings:U,handleCloseAdvancedSettings:X,handleImportSchema:le,handleArrayBadgeClick:te,handleCloseContentPopover:ue}}function Z(t,n,s){if(n.length===1)return{...t,[n[0]]:s};const[a,...l]=n,r=typeof t[a]=="object"&&t[a]!==null?t[a]:{};return{...t,[a]:Z(r,l,s)}}function de(t,n){if(n.length===0)return t;const[s,...a]=n,l=t[s];if(a.length===0)return l;if(typeof l=="object"&&l!==null)return de(l,a)}function Vl(t){return t.replace(/([[\]():#$^*=!|~'"/@+?{}])/g,"\\$1")}function Ll({selectors:t,captureRoot:n,setAttributePopover:s,setChildFilterPopover:a,onUpdateExcludeChildren:l,onUpdateExtractAttribute:r,onWarning:c}){const o=u.useCallback(f=>{const g=f.split("."),p=de(t,g);if(H(p))return Es(p);if(typeof p=="string"){const b=p.lastIndexOf("@");return b>0?p.substring(0,b):p}return null},[t]),i=u.useCallback(f=>{const g=f.split("."),p=de(t,g);return H(p)&&p.excludeChildren?p.excludeChildren:[]},[t]),d=u.useCallback(f=>{const g=f.split("."),p=de(t,g);return H(p)&&p.extractAttribute?[p.extractAttribute]:["innerText"]},[t]),h=u.useCallback((f,g)=>{const p=o(f);if(!p){c==null||c("No selector defined for this field");return}const b=n??document;try{const x=b.querySelector(p);if(!x){c==null||c("Element not found on page");return}const N=[];for(const S of x.attributes)N.push({name:S.name,value:S.value});const C=d(f);s({isOpen:!0,fieldPath:f,attributes:N,currentAttributes:C,position:g})}catch{c==null||c("Invalid selector")}},[t,o,d,n,s,c]),m=u.useCallback((f,g)=>{const p=o(f);if(!p){G.error("No selector defined for this field");return}const b=n??document;try{const x=b.querySelector(p);if(!x){G.error("No element found for selector");return}const N=[];x.childNodes.forEach((A,T)=>{var E,k,O;if(A.nodeType===Node.ELEMENT_NODE){const _=A,V=_.tagName.toLowerCase(),B=typeof _.className=="string"?_.className:((E=_.className)==null?void 0:E.baseVal)??"",I=B?`.${B.split(" ").filter(Boolean).join(".")}`:"",P=B?`.${B.split(" ").filter(Boolean).map(X=>Vl(X)).join(".")}`:"",M=`child-${T}-${V}`,R=`${V}${I}`.slice(0,30),U=((k=_.textContent)==null?void 0:k.trim().slice(0,50))||"";N.push({id:M,label:R,selector:`${V}${P}`,textPreview:U})}else if(A.nodeType===Node.TEXT_NODE){const _=(O=A.textContent)==null?void 0:O.trim();_&&N.push({id:`text-${T}`,label:"#text",selector:"#text",textPreview:_.slice(0,50)})}});const C=i(f),S=N.filter(A=>C.includes(A.selector)).map(A=>A.id);a({isOpen:!0,fieldPath:f,children:N,excludedChildren:S,position:g})}catch{G.error("Invalid selector")}},[o,i,n,a]),y=u.useCallback(()=>{s(f=>({...f,isOpen:!1}))},[s]),j=u.useCallback((f,g)=>{const p=g.filter(x=>x!=="innerText"),b=p.length>0?p[0]:void 0;r&&r(f,b),b?G.success(`Extraction set to: ${b}`):G.success("Extraction set to: innerText (default)")},[r]),v=u.useCallback(()=>{a(f=>({...f,isOpen:!1}))},[a]),w=u.useCallback((f,g,p)=>{const b=p.filter(N=>g.includes(N.id)).map(N=>N.selector);l&&l(f,b);const x=p.length-g.length;G.success(`Saved: ${x} children included, ${g.length} excluded`)},[l]);return{handleConfigClick:h,handleFilterChildrenClick:m,handleAttributePopoverClose:y,handleAttributeSelect:j,handleChildFilterPopoverClose:v,handleChildFilterConfirm:w}}function zl({containerRef:t,headerHeight:n=33,minHeight:s=80,bottomPadding:a=100}){const[l,r]=u.useState(null),c=u.useRef(!1),o=u.useCallback(i=>{i.preventDefault(),c.current=!0,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[]);return u.useEffect(()=>{const i=h=>{if(!c.current||!t.current)return;const m=t.current.getBoundingClientRect(),y=h.clientY-m.top-n,j=m.height-n-a;r(Math.max(s,Math.min(j,y)))},d=()=>{c.current&&(c.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",i),document.addEventListener("mouseup",d),()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",d)}},[t,n,s,a]),{schemaSectionHeight:l,handleResizeStart:o}}const ql={isOpen:!1,fieldPath:"",existingIf:null,existingBranches:null,availableFields:[],selectedBranchFields:[],autoToggleIf:!1};function Wl({selectors:t,setSelectors:n}){const[s,a]=u.useState(ql),l=u.useCallback((v,w,f,g=!1)=>{const p=v.split("."),b=de(t,p);let x=[],N=w,C=f,S=[];if(typeof b=="object"&&b!==null){const A=b;x=Object.keys(A).filter(T=>!T.startsWith("_")),!N&&A._if&&(N=A._if),!C&&A._branches&&(C=A._branches),Array.isArray(A._branchFields)&&(S=A._branchFields)}a({isOpen:!0,fieldPath:v,existingIf:N,existingBranches:C,availableFields:x,selectedBranchFields:S,autoToggleIf:g})},[t]),r=u.useCallback((v,w)=>{const f=s.fieldPath.split(".");n(g=>{const p=de(g,f);if(typeof p=="object"&&p!==null){const b={...p,_if:v,_branches:w};return Z(g,f,b)}return g})},[s.fieldPath,n]),c=u.useCallback(()=>{const v=s.fieldPath.split(".");n(w=>{const f=de(w,v);if(typeof f=="object"&&f!==null){const{_if:g,_branches:p,...b}=f;return Z(w,v,b)}return w})},[s.fieldPath,n]),o=u.useCallback(()=>{a(v=>({...v,isOpen:!1}))},[]),i=u.useCallback(v=>{const w=s.fieldPath.split(".");n(f=>{const g=de(f,w);if(typeof g=="object"&&g!==null){const p=g;if(v){const b={};for(const[x,N]of Object.entries(p))b[x]=N,(x==="_item"||x==="_container"&&!("_item"in p))&&(b._if={selector:"",condition:"exists"});return"_if"in b?Z(f,w,b):Z(f,w,{_if:{selector:"",condition:"exists"},...p})}else{const{_if:b,...x}=p;return Z(f,w,x)}}return f})},[s.fieldPath,n]),d=u.useCallback(v=>{const w=v.split(".");n(f=>{const g=de(f,w);if(typeof g=="object"&&g!==null){const p=g;if("_if"in p){const{_if:x,_branchFields:N,_branches:C,_activeBranch:S,...A}=p;return Z(f,w,A)}else{const x={};for(const[N,C]of Object.entries(p))x[N]=C,(N==="_item"||N==="_container"&&!("_item"in p))&&(x._if={selector:"",condition:"exists"});return"_if"in x?Z(f,w,x):Z(f,w,{_if:{selector:"",condition:"exists"},...p})}}return f})},[n]),h=u.useCallback((v,w)=>{a(g=>{const p=w?[...g.selectedBranchFields,v]:g.selectedBranchFields.filter(b=>b!==v);return{...g,selectedBranchFields:p}});const f=s.fieldPath.split(".");n(g=>{const p=de(g,f);if(typeof p=="object"&&p!==null){const b=p,x=Array.isArray(b._branchFields)?b._branchFields:[],N=w?[...x,v]:x.filter(C=>C!==v);if(w&&x.length===0)return Z(g,f,{...b,_branchFields:N,_activeBranch:1,_branches:{1:{},2:{}}});if(!w&&N.length===0){const{_branchFields:C,_activeBranch:S,_branches:A,...T}=b;return Z(g,f,T)}return Z(g,f,{...b,_branchFields:N})}return g})},[s.fieldPath,n]),m=u.useCallback((v,w)=>{n(f=>{const g=(b,x)=>{if(x.length===0)return{...b,_activeBranch:w};const[N,...C]=x;return{...b,[N]:g(b[N],C)}},p=v?v.split("."):[];return g(f,p)})},[n]),y=u.useCallback((v,w,f)=>{n(g=>{const p=(x,N)=>{var A;if(N.length===0){const T=x._branchFields||[],E=x._branches||{1:{},2:{}};if(f){const k=x[w],O={...E};for(const _ of Object.keys(O))O[_]={...O[_],[w]:k};return{...x,_branchFields:[...T,w],_branches:O,_activeBranch:x._activeBranch??1}}else{const k=x._activeBranch||1,O=((A=E[String(k)])==null?void 0:A[w])??x[w],_={...E};for(const B of Object.keys(_)){const{[w]:I,...P}=_[B];_[B]=P}const V=T.filter(B=>B!==w);return{...x,_branchFields:V,_branches:_,[w]:O}}}const[C,...S]=N;return{...x,[C]:p(x[C],S)}},b=v?v.split("."):[];return p(g,b)})},[n]),j=u.useCallback(v=>{n(w=>{const f=(p,b)=>{if(b.length===0){const C=p._branches||{},S=p._branchFields||[],A=String(Object.keys(C).length+1),T={};for(const E of S)T[E]="";return{...p,_branches:{...C,[A]:T}}}const[x,...N]=b;return{...p,[x]:f(p[x],N)}},g=v?v.split("."):[];return f(w,g)})},[n]);return{branchEditorState:s,setBranchEditorState:a,handleEditBranching:l,handleSaveBranching:r,handleRemoveBranching:c,handleCloseBranchEditor:o,handleToggleIf:i,handleToggleIfDirect:d,handlePopoverToggleBranchField:h,handleBranchSwitch:m,handleToggleBranchField:y,handleAddBranch:j}}function Ut(t,n,s){if(n.length===0)return typeof t=="string"?[t]:[String(t??"")];const[a,...l]=n;return Array.isArray(t)?t.flatMap(r=>Ut(r==null?void 0:r[a],l)):t&&typeof t=="object"?Ut(t[a],l):[]}function gs(t,n){const s=n.split(".");if(s.length<2)return null;const a=s[0],l=s.slice(1);let r=t[a];for(let c=0;c<l.length;c++){const o=l[c];if(typeof r!="object"||r===null)return null;const i=r;if(o in i)r=i[o];else if(i._branches&&typeof i._branches=="object"){const d=i._branches,h=i._activeBranch,m=String(h??1),y=d[m];if(y&&o in y)r=y[o];else for(const j of Object.values(d))if(j&&o in j){r=j[o];break}}else return null}if(H(r))return me(r);if(typeof r=="string")return r;if(typeof r=="object"&&r!==null){const c=r;if(c._item){if(H(c._item))return me(c._item);if(typeof c._item=="string")return c._item}}return null}function Ul({content:t,selectors:n,contentPopover:s,highlightByIndex:a,scrollToElementByIndex:l,handleArrayBadgeClick:r}){const c=u.useCallback(d=>{const h=d.split("."),m=h[0],y=t[m];if(!Array.isArray(y))return;const j=h.slice(1),v=[];for(let w=0;w<y.length;w++){const f=y[w],g=Ut(f,j);v.push(...g)}r(d,v)},[t,r]),o=u.useCallback(d=>{if(!s)return;const h=s.fieldName,m=gs(n,h);a(m,h,d)},[s,n,a]),i=u.useCallback(d=>{if(!s)return;const h=s.fieldName,m=gs(n,h);l(m,h,d)},[s,n,l]);return{handleSchemaCountClick:c,handleContentPopoverItemHover:o,handleContentPopoverItemClick:i}}function Hl({setSelectors:t}){const n=u.useCallback((a,l)=>{const r=a.split(".");t(c=>{const o=de(c,r),i=H(o)?{...o,excludeChildren:l}:{selector:typeof o=="string"?o:"",index:null,excludeChildren:l};return Z(c,r,i)})},[t]),s=u.useCallback((a,l)=>{const r=a.split(".");t(c=>{const o=de(c,r),i=H(o)?{...o,extractAttribute:l}:{selector:typeof o=="string"?o:"",index:null,extractAttribute:l};return Z(c,r,i)})},[t]);return{handleUpdateExcludeChildren:n,handleUpdateExtractAttribute:s}}function Gl(){const[t,n]=u.useState(new Map),s=u.useCallback(c=>{const o=t.get(c);return!!o&&o.length>0},[t]),a=u.useCallback((c,o)=>{var m;if(!o)return null;const i=xt(o);if(!i||!i.parent)return null;const d=(m=i.siblings[i.capturedIndex])==null?void 0:m.element;if(!d)return null;const h=Ye(i.parent.element);return n(y=>{const j=new Map(y),v=j.get(c)??[];return j.set(c,[...v,{parentSelector:h,childIndex:i.capturedIndex,childElement:d}]),j}),h},[]),l=u.useCallback(c=>{const o=t.get(c);if(!o||o.length===0)return null;const i=o[o.length-1];if(!document.contains(i.childElement))return n(h=>{const m=new Map(h),y=m.get(c)??[];return m.set(c,y.slice(0,-1)),m}),null;const d=Ye(i.childElement);return n(h=>{const m=new Map(h),y=m.get(c)??[];return m.set(c,y.slice(0,-1)),m}),{selector:d,element:i.childElement}},[t]),r=u.useCallback(c=>{n(o=>{const i=new Map(o);return i.delete(c),i})},[]);return{canNavigateDown:s,navigateUp:a,navigateDown:l,clearHistory:r}}function Kl({selectors:t,handleSelectorCaptured:n,flashHighlight:s}){const{navigateUp:a,navigateDown:l,canNavigateDown:r}=Gl(),c=u.useCallback(d=>{const h=d.split(".");let m=t;for(const v of h){if(typeof m!="object"||m===null)return;m=m[v]}const y=typeof m=="string"?m:m&&typeof m=="object"&&"selector"in m?m.selector:"";if(!y)return;const j=a(d,y);if(j){const v=document.querySelectorAll(j),w=Array.from(v).map(f=>{var g;return((g=f.textContent)==null?void 0:g.trim())??""});n(d,j,w),s(j,d)}},[t,a,n,s]),o=u.useCallback(d=>{const h=l(d);if(h){const m=document.querySelectorAll(h.selector),y=Array.from(m).map(j=>{var v;return((v=j.textContent)==null?void 0:v.trim())??""});n(d,h.selector,y),s(h.selector,d)}},[l,n,s]),i=u.useCallback(d=>r(d),[r]);return{handleNavigateUp:c,handleNavigateDown:o,handleCanNavigateDown:i}}function Jl(){const[t,n]=u.useState("mapped"),[s,a]=u.useState("selectors"),[l,r]=u.useState("schema"),[c,o]=u.useState(Sa),[i,d]=u.useState({}),[h,m]=u.useState(!0),[y,j]=u.useState({isOpen:!1,fieldPath:"",attributes:[],currentAttributes:[],position:{x:0,y:0}}),[v,w]=u.useState({isOpen:!1,fieldPath:"",children:[],excludedChildren:[],position:{x:0,y:0}}),f=u.useRef(null),g=u.useRef(()=>{});return{mode:t,setMode:n,previewMode:s,setPreviewMode:a,contentViewMode:l,setContentViewMode:r,selectors:c,setSelectors:o,content:i,setContent:d,continuousMode:h,setContinuousMode:m,attributePopover:y,setAttributePopover:j,childFilterPopover:v,setChildFilterPopover:w,containerRef:f,handleFieldValueClickRef:g}}function ns(t,n=""){const s=[];for(const[a,l]of Object.entries(t)){const r=n?`${n}.${a}`:a;H(l)||typeof l=="string"?s.push(r):typeof l=="object"&&l!==null&&s.push(...ns(l,r))}return s}function Yl(t,n){const s=n.split(".");let a=t;for(const l of s){if(typeof a!="object"||a===null)return;a=a[l]}return a}function Ht(t,n){const s=Yl(t,n);return H(s)?me(s)==="":s===""||s===void 0}function Xl(t,n){const s=ns(t),a=s.indexOf(n);for(let l=a+1;l<s.length;l++)if(Ht(t,s[l]))return s[l];for(let l=0;l<a;l++)if(Ht(t,s[l]))return s[l];return null}function bs(t){const n=ns(t);return{filled:n.filter(a=>!Ht(t,a)).length,total:n.length}}function Ql({continuousMode:t,selectors:n,setSelectors:s,setContent:a,handleFieldValueClickRef:l,selectorCaptureFieldPathRef:r}){const c=u.useCallback((h,m,y)=>{const j=h.split("."),v=y.length>1?y:y[0]??"",w=Nt(m),f=j[j.length-1]==="_if";s(g=>{let p;if(f){const b=de(g,j),x={selector:m,condition:(b==null?void 0:b.condition)||"exists"};p=Z(g,j,x)}else{let b=!1,x=[];const N=j[j.length-1];if(j.length>1){x=j.slice(0,-1);const C=de(g,x);if(typeof C=="object"&&C!==null){const S=C;if(b=(S._branchFields||[]).includes(N),b){const T=S._activeBranch||1,E=S._branches||{},k=String(T);if(E[k]){const O={...E};O[k]={...O[k],[N]:w};const _={...S,_branches:O};p=Z(g,x,_)}else p=Z(g,j,w)}else p=Z(g,j,w)}else p=Z(g,j,w)}else p=Z(g,j,w)}if(t&&m!==""){const b=Xl(p,h);b?setTimeout(()=>{r.current===null&&l.current(b,"")},0):G.success("All fields captured!")}return p}),a(g=>Z(g,j,v))},[t,s,a,l,r]),o=u.useCallback(h=>c(h,"",[]),[c]),i=u.useCallback(h=>{G.info(`Filter for ${h} - coming soon!`)},[]),d=u.useCallback(h=>{G.info(`Auto-filter for ${h} - coming soon!`)},[]);return{handleSelectorCaptured:c,handleClearSelectorFromPreview:o,handleSelectorFilterClick:i,handleSelectorFilterDoubleClick:d}}function Zl(t,n){const s=[];let a=t;for(;a;){const l=n.find(r=>r.id===a);if(!l)break;s.unshift(l.name),a=l.parentId}return s.join(".")}function ft(t,n=null){const s={},a=t.filter(l=>l.parentId===n).sort((l,r)=>l.order-r.order);for(const l of a){const r=t.some(c=>c.parentId===l.id);l.type==="array"?s[l.name]={_container:"",_item:"",...ft(t,l.id)}:l.type==="parentSelector"?s[l.name]={_container:"",...ft(t,l.id)}:l.type==="object"||r?s[l.name]=ft(t,l.id):s[l.name]=""}return s}function er({fields:t,editingField:n,selectors:s,domTreeFieldPath:a,getFieldPath:l,setFields:r,setSelectors:c,setContent:o,setMode:i,baseHandleFieldDialogSubmit:d,handleSelectorCaptured:h,closeDomTreePopover:m}){const y=u.useCallback(w=>{var f;if(w&&n){const g=(f=t.find(b=>b.id===n.id))==null?void 0:f.type,p=w.type;if(g!==p&&(p==="parentSelector"||p==="array")){const x=l(n.id).split(".");c(N=>{const C=JSON.parse(JSON.stringify(N));let S=C;for(let k=0;k<x.length-1;k++)(typeof S[x[k]]!="object"||S[x[k]]===null)&&(S[x[k]]={}),S=S[x[k]];const A=x[x.length-1],T=S[A],E=p==="array"?{_container:"",_item:""}:{_container:""};return typeof T=="object"&&T!==null?S[A]={...E,...T}:S[A]=E,C})}}d(w)},[n,t,l,c,d]),j=u.useCallback(w=>{r(w),c(ft(w,null)),o({}),i("mapped"),G.success("Schema updated from list")},[r,c,o,i]),v=u.useCallback(w=>{if(a)try{const f=document.querySelectorAll(w),g=Array.from(f).map(p=>{var b;return((b=p.textContent)==null?void 0:b.trim())||""});h(a,w,g),m()}catch{}},[a,h,m]);return{handleFieldDialogSubmit:y,handleListModeApply:j,handleApplyCustomSelector:v}}function Ct(t,n){var c,o,i;let s=t;if(n&&n.length>0){s=t.cloneNode(!0);for(const d of n){if(d==="#text")continue;s.querySelectorAll(d).forEach(m=>m.remove())}}const a=["DIV","P","LI","SECTION","ARTICLE","HEADER","FOOTER"];if(Array.from(s.children).some(d=>a.includes(d.tagName))){const d=[];for(const h of s.childNodes)if(h.nodeType===Node.TEXT_NODE){const m=(c=h.textContent)==null?void 0:c.trim();m&&d.push(m)}else if(h.nodeType===Node.ELEMENT_NODE){const m=(o=h.textContent)==null?void 0:o.trim();m&&d.push(m)}return d.join(" ")}return((i=s.textContent)==null?void 0:i.trim())??""}function tr(t){return t.endsWith("[]")?{baseSelector:t.slice(0,-2),selectAll:!0}:{baseSelector:t,selectAll:!1}}function $s(t){const n={};for(const[s,a]of Object.entries(t))s.startsWith("_")||(n[s]=a);return n}function Rs(t,n){const s={...t};for(const[a,l]of Object.entries(n))a!=="match"&&(s[a]=l);return s}function Vs(t){const n=t.selector;return n?t.index?`${n}[${t.index.type==="single"?t.index.index:""}]`:n:""}function Ls(t,n){return n.extractAttribute?t.getAttribute(n.extractAttribute)??"":Ct(t,n.excludeChildren)}function nt(t,n=document){const s={};for(const[a,l]of Object.entries(t))if(!a.startsWith("_")){if(typeof l=="string"){if(!l){s[a]="";continue}const r=Ze(l,n);s[a]=r?Ct(r):""}else if(H(l)){const r=Vs(l);if(!r){s[a]="";continue}const c=Ze(r,n);s[a]=c?Ls(c,l):""}else if(typeof l=="object"&&l!==null){const r=l,c="_container"in r&&r._container,o="_item"in r&&r._item;c&&o?s[a]=qs(r,n):c&&!o?s[a]=zs(r,n):s[a]=nt(r,n)}}return s}function zs(t,n){const s=t._container,a=H(s)?me(s):s;if(!a)return nt(t,n);const l=n.querySelector(a);if(!l)return{};const r=t._if,c=t._branches,o=Qe(r)&&wt(c),i=$s(t);if(o){const d=ts(r,l),h=ss(c,d);if(h){const m=Rs(i,h.branch);return Gt(m,l)}}return Gt(i,l)}function qs(t,n){const s=t._container,a=t._item,l=H(s)?me(s):s,r=H(a)?me(a):a;if(!l)return[];const{baseSelector:c,selectAll:o}=tr(l),i=Array.from(n.querySelectorAll(c));if(i.length===0)return[];const d=t._if,h=t._branches,m=Qe(d)&&wt(h),y=$s(t),j=[];for(const v of i){const w=r?v.querySelectorAll(r):[v],f=Object.keys(y).length===0&&!m;for(const g of w){if(f){j.push(Ct(g));continue}let p;if(m){const x=ts(d,g),N=ss(h,x);N?p=Rs(y,N.branch):p=y}else p=y;const b=Gt(p,g);j.push(b)}}return j}function Gt(t,n){const s={};for(const[a,l]of Object.entries(t))if(!a.startsWith("_")){if(typeof l=="string"){if(!l){s[a]="";continue}const r=Ze(l,n);s[a]=r?Ct(r):""}else if(H(l)){const r=Vs(l);if(!r){s[a]="";continue}const c=Ze(r,n);s[a]=c?Ls(c,l):""}else if(typeof l=="object"&&l!==null){const r=l,c="_container"in r&&r._container,o="_item"in r&&r._item;c&&o?s[a]=qs(r,n):c&&!o?s[a]=zs(r,n):s[a]=nt(r,n)}}return s}function sr({selectors:t,captureRoot:n,setContent:s}){const a=u.useRef(""),l=u.useRef(null);u.useEffect(()=>{const r=JSON.stringify(t),c=n??document,o=r!==a.current,i=c!==l.current;if(!o&&!i)return;a.current=r,l.current=c;const d=setTimeout(()=>{try{const h=nt(t,c);s(h)}catch(h){console.error("[CustomCapture] Extraction error:",h)}},100);return()=>clearTimeout(d)},[t,n,s])}function nr({portalContainer:t,captureRoot:n,isVisible:s,onVisibilityChange:a}){const{mode:l,setMode:r,previewMode:c,setPreviewMode:o,contentViewMode:i,setContentViewMode:d,selectors:h,setSelectors:m,content:y,setContent:j,continuousMode:v,setContinuousMode:w,attributePopover:f,setAttributePopover:g,childFilterPopover:p,setChildFilterPopover:b,containerRef:x,handleFieldValueClickRef:N}=Jl(),{schemaSectionHeight:C,handleResizeStart:S}=zl({containerRef:x}),{fields:A,setFields:T,selectedFieldId:E,editingField:k,isFieldDialogOpen:O,handleFieldSelect:_,handleFieldUpdate:V,handleFieldEdit:B,handleFieldDialogSubmit:I,handleFieldDialogCancel:P,handleFieldDelete:M,handleReorder:R,handleAddChild:U,handleAddSiblingBefore:X,handleAddSiblingAfter:F}=Fl(ka),K=u.useCallback(fe=>Zl(fe,A),[A]),{savedCaptures:le,isPopoverVisible:te,moreActionsOpen:ue,importDialogOpen:z,managerPopoverOpen:q,advancedSettingsOpen:se,preventDefaultOnInteraction:Q,contentPopover:J,setMoreActionsOpen:Ce,setPreventDefaultOnInteraction:Ee,handleSave:ce,handleLoad:xe,handleRenameCapture:ze,handleDeleteCapture:De,handleDownload:kt,handleClear:at,handleClosePopover:qe,handleOpenImportDialog:lt,handleCloseImportDialog:rt,handleOpenManagerPopover:it,handleCloseManagerPopover:ct,handleOpenAdvancedSettings:ot,handleCloseAdvancedSettings:oe,handleImportSchema:We,handleArrayBadgeClick:dt,handleCloseContentPopover:Oe}=Rl({fields:A,selectors:h,content:y,setFields:T,setSelectors:m,setContent:j}),Ue=u.useRef(null),{handleSelectorCaptured:ut,handleClearSelectorFromPreview:Ws,handleSelectorFilterClick:Us,handleSelectorFilterDoubleClick:Hs}=Ql({continuousMode:v,selectors:h,setSelectors:m,setContent:j,handleFieldValueClickRef:N,selectorCaptureFieldPathRef:Ue}),{branchEditorState:Gs,handleEditBranching:Ks,handleSaveBranching:Js,handleRemoveBranching:Ys,handleCloseBranchEditor:Xs,handleToggleIf:Qs,handleToggleIfDirect:Zs,handlePopoverToggleBranchField:en,handleBranchSwitch:tn,handleToggleBranchField:sn,handleAddBranch:nn}=Wl({selectors:h,setSelectors:m}),{handleUpdateExcludeChildren:an,handleUpdateExtractAttribute:ln}=Hl({setSelectors:m}),[rn,as]=u.useState(null),St=u.useRef(null),cn=u.useCallback((fe,Fe=3e3)=>{St.current&&clearTimeout(St.current),as(fe),St.current=setTimeout(()=>{as(null)},Fe)},[]),{handleConfigClick:on,handleFilterChildrenClick:dn,handleAttributePopoverClose:un,handleAttributeSelect:hn,handleChildFilterPopoverClose:pn,handleChildFilterConfirm:mn}=Ll({selectors:h,captureRoot:n,setAttributePopover:g,setChildFilterPopover:b,onUpdateExcludeChildren:an,onUpdateExtractAttribute:ln,onWarning:cn}),xn=s??te,fn=u.useCallback(()=>{qe(),a==null||a(!1)},[qe,a]),{isOpen:gn,fieldPath:He,domContext:ls,initialSelector:rs,previousChildIndex:bn,openPopover:is,closePopover:At,refreshContext:jn,setPreviousChildIndex:yn}=Bl({selectors:h}),{handleFieldDialogSubmit:vn,handleListModeApply:Nn,handleApplyCustomSelector:wn}=er({fields:A,editingField:k,selectors:h,domTreeFieldPath:He,getFieldPath:K,setFields:T,setSelectors:m,setContent:j,setMode:r,baseHandleFieldDialogSubmit:I,handleSelectorCaptured:ut,closeDomTreePopover:At}),{handleDomTreeSiblingSelect:Cn,handleDomTreeParentSelect:kn,handleDomTreeChildSelect:Sn,handleClearSelector:An,handleAddIndex:_n,handleRevertSelector:In,handleSelectorChange:En}=Dl({domTreeFieldPath:He,domContext:ls,domTreeInitialSelector:rs,onSelectorCaptured:ut,refreshDomTreeContext:jn,closeDomTreePopover:At,setDomTreePreviousChildIndex:yn}),On=u.useCallback((fe,Fe)=>is(fe,Fe),[is]),{selectorCaptureFieldPath:cs,handleFieldValueClick:os,handleFieldValueHover:ht,flashHighlight:Tn,highlightByIndex:Bn,scrollToElementByIndex:Dn,cancelCapture:ds}=Tl({onSelectorCaptured:ut,onSelectorInspect:On,selectors:h,preventDefaultOnInteraction:Q,onEscapePressed:()=>w(!1)});Ue.current=cs,N.current=os;const Fn=u.useCallback((fe,Fe)=>{if(Fe===null)ht(null,null);else{const qn=`${fe}[${Fe}]`;ht(qn,He)}},[ht,He]),Pn=u.useCallback(fe=>{ds(),o(fe)},[ds]),{handleSchemaCountClick:Mn,handleContentPopoverItemHover:$n,handleContentPopoverItemClick:Rn}=Ul({content:y,selectors:h,contentPopover:J,highlightByIndex:Bn,scrollToElementByIndex:Dn,handleArrayBadgeClick:dt}),{handleNavigateUp:Vn,handleNavigateDown:Ln,handleCanNavigateDown:zn}=Kl({selectors:h,handleSelectorCaptured:ut,flashHighlight:Tn});return sr({selectors:h,captureRoot:n,setContent:j}),e.jsxs(e.Fragment,{children:[e.jsx(je,{isVisible:xn,onClose:fn,title:"Custom Capture V2",shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-520,y:20},initialSize:{width:500,height:630},showPinButton:!1,portalContainer:t,headerActions:e.jsx(_a,{mode:l,moreActionsOpen:ue,onModeChange:r,onMoreActionsOpenChange:Ce,onSave:ce,onManage:it,onAdvancedSettings:ot,onDownload:kt,onClear:at,portalContainer:t}),children:e.jsx(Al,{mode:l,fields:A,selectedFieldId:E,schemaSectionHeight:C,previewMode:c,contentViewMode:i,selectors:h,content:y,activeFieldPath:cs,continuousMode:v,filledCount:bs(h).filled,totalCount:bs(h).total,portalContainer:t,containerRef:x,onFieldSelect:_,onFieldUpdate:V,onFieldEdit:B,onFieldDelete:M,onReorder:R,onAddChild:U,onAddSiblingBefore:X,onAddSiblingAfter:F,onListModeApply:Nn,onListModeCancel:()=>r("mapped"),onResizeStart:S,onPreviewModeChange:Pn,onFieldValueClick:os,onFieldValueHover:ht,onClearSelector:Ws,onSelectorFilterClick:Us,onSelectorFilterDoubleClick:Hs,onConfigClick:on,onFilterChildrenClick:dn,onArrayBadgeClick:dt,onNavigateUp:Vn,onNavigateDown:Ln,canNavigateDown:zn,onEditBranching:Ks,onImportClick:lt,onSchemaCountClick:Mn,onBranchSwitch:tn,onToggleBranchField:sn,onToggleIfDirect:Zs,onAddBranch:nn,onContinuousModeToggle:()=>w(fe=>!fe),onContentViewModeChange:d,warningMessage:rn})}),e.jsx(sl,{portalContainer:t,isFieldDialogOpen:O,editingField:k,onFieldDialogSubmit:vn,onFieldDialogCancel:P,contentPopover:J,onCloseContentPopover:Oe,onContentPopoverItemHover:$n,onContentPopoverItemClick:Rn,importDialogOpen:z,onImportSchema:We,onCloseImportDialog:rt,managerPopoverOpen:q,savedCaptures:le,onLoad:xe,onRenameCapture:ze,onDeleteCapture:De,onCloseManagerPopover:ct,advancedSettingsOpen:se,preventDefaultOnInteraction:Q,continuousMode:v,onPreventDefaultChange:Ee,onContinuousModeChange:w,onCloseAdvancedSettings:oe,isDomTreePopoverOpen:gn,domTreeFieldPath:He,domContext:ls,domTreeInitialSelector:rs,domTreePreviousChildIndex:bn,onDomTreeParentSelect:kn,onDomTreeSiblingSelect:Cn,onDomTreeChildSelect:Sn,onAddIndex:_n,onRevertSelector:In,onClearSelector:An,onCloseDomTreePopover:At,onSelectorChange:En,onApplyCustomSelector:wn,attributePopover:f,onAttributeSelect:hn,onAttributePopoverClose:un,childFilterPopover:p,onChildFilterConfirm:mn,onChildFilterPopoverClose:pn,branchEditorState:Gs,onSaveBranching:Js,onRemoveBranching:Ys,onCloseBranchEditor:Xs,onToggleIf:Qs,onPopoverToggleBranchField:en,onDomTreeMatchIndexHover:Fn})]})}function ar(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-anivia-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Anivia",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Anivia",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Anivia.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Freljord 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_freljord_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Freljord"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Invoker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_invoker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Invoker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Caster"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Anivia.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Frostbite"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/40"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Fire an ice shard at target that deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"325/455/650"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage. If they are "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilled"})}),e.jsx("span",{children:e.jsx("span",{children:", the damage Critically"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Strikes."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsx("div",{className:"flex flex-col gap-[2px]",children:e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"455 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[325/",e.jsx("span",{className:"text-white1",children:"455"}),"/650]"]})})]})})]}),e.jsx(st,{})]})}function lr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-blitzcrank-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Blitzcrank",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Blitzcrank",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Blitzcrank.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Zaun 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_zaun_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Zaun"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Juggernaut 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_juggernaut_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Juggernaut"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Blitzcrank.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Static Field"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"60/120"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/480/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds and deal "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"56/84/126"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to all enemies within 1 hex."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"480 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"480"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"84 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/315]"]})})]})]})]}),e.jsx(st,{})]})}function rr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-neeko-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/neeko",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Neeko",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Neeko",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Neeko.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Ixtal 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_ixtal_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Ixtal"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Arcanist 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_arcanist_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",style:{outlineOffset:"2px"},children:"Arcanist"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Defender 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_defender_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Defender"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Neeko.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Pop Blossom"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"15/65"})]})]})]}),e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Leap at target and gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/475/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds. Slam down after a brief delay, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"80/120/180"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to enemies within two"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hexes and 20% "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilling"})}),e.jsx("span",{children:e.jsx("span",{children:" them for 2"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"seconds."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"475 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"475"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"120 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[80/",e.jsx("span",{className:"text-white1",children:"120"}),"/180]"]})})]})]})]}),e.jsx(st,{})]})}function ir(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-graves-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/graves",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Graves",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Graves",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Graves.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Bilgewater 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_bilgewater_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Bilgewater"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Gunslinger 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_gunslinger_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Gunslinger"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsxs("div",{className:"leading-snug pb-3",children:[e.jsx("span",{className:"font-medium",children:"Unlock: "}),e.jsx("div",{className:"leading-tight inline",children:e.jsx("span",{children:e.jsx("span",{children:"Twisted Fate with 2 items equipped"})})})]}),e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Attack Fighter"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Graves.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Collateral Damage"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/50"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Attacks fire in a cone on target, dealing "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"45%"})})})}),e.jsx("span",{children:e.jsx("span",{children:" damage to other enemies hit. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Fire an explosive shell at target, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"200/300/450"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage split among enemies in a 1"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hex"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"circle. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"text-tertiary-11",children:e.jsx("span",{children:e.jsx("span",{children:"Partners in Crime:"})})})}),e.jsx("span",{children:e.jsx("span",{children:" When you field Graves and Twisted Fate, both gain bonuses."})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[20/",e.jsx("span",{className:"text-white1",children:"30"}),"/45]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"300"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"270 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"30 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[180/",e.jsx("span",{className:"text-white1",children:"270"}),"/405]"]})})]})]})]}),e.jsx(st,{})]})}function cr(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-draven-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/draven",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Draven",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["3",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Draven",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Draven.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Noxus 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_noxus_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Noxus"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Quickstriker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_quickstriker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Quickstriker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Attack Marksman"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Draven.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Spinning Axes"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"60/100"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" If Draven has an empowered axe in hand, his next attack will throw it. On takedown, gain an Adoration stack, doubled if Draven or Darius scored the kill. Every 11 Adoration stacks grants "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"1/3/5"})})})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Gold. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Spin an empowered axe that replaces his basic attack and deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"150/225/375"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage and returns to Draven after hitting an"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"enemy."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[10/",e.jsx("span",{className:"text-white1",children:"15"}),"/25]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"225"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"210 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"15 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/350]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsx("div",{className:"leading-tight",children:e.jsx("span",{children:e.jsx("span",{children:"Gold Gained:"})})}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[1/",e.jsx("span",{className:"text-white1",children:"3"}),"/5]"]})})]})]})]}),e.jsx(st,{})]})}function or(){return e.jsxs("div",{"data-test":"tft-cards-v2",children:[e.jsxs("section",{className:"mb-8","data-test":"one-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"1-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(ar,{}),e.jsx(lr,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"two-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"2-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(rr,{}),e.jsx(ir,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"three-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"3-Cost Champions"}),e.jsx("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:e.jsx(cr,{})})]})]})}const Tt={champions:[{cost:"1",traits:"Freljord Invoker",type:"Magic Caster",ability:{manaCost:"0/40",description:"Fire an ice shard at target that deals 325/455/650 () magic damage. If they are Chilled, the damage Critically Strikes.",activation:[{kind:"Damage:",value:"455 ()",valuePerLevel:"[325/455/650]"}]}},{cost:"1",traits:"Zaun Juggernaut",type:"Magic Tank",ability:{manaCost:"60/120",description:"Gain 400/480/600 () Shield for 4 seconds and deal 56/84/126 () magic damage to all enemies within 1 hex.",activation:[{kind:"Shield:",value:"480 ()",valuePerLevel:"[400/480/600]"},{kind:"Damage:",value:"84 ()",valuePerLevel:"[140/210/315]"}]}},{cost:"2",traits:"Ixtal Arcanist Defender",type:"Magic Tank",ability:{manaCost:"15/65",description:"Leap at target and gain 400/475/600 () Shield for 4 seconds. Slam down after a brief delay, dealing 80/120/180 () magic damage to enemies within two hexes and 20% Chilling them for 2 seconds.",activation:[{kind:"Shield:",value:"475 ()",valuePerLevel:"[400/475/600]"},{kind:"Damage:",value:"120 ()",valuePerLevel:"[80/120/180]"}]}},{cost:"3",traits:"Noxus Quickstriker",type:"Attack Marksman",ability:{manaCost:"60/100",description:"Passive: If Draven has an empowered axe in hand, his next attack will throw it. On takedown, gain an Adoration stack, doubled if Draven or Darius scored the kill. Every 11 Adoration stacks grants 1/3/5 Gold. Active: Spin an empowered axe that replaces his basic attack and deals 150/225/375 () physical damage and returns to Draven after hitting an enemy.",activation:[{kind:"Damage:",value:"225 = 210 () + 15",valuePerLevel:"[140/210/350]"},{kind:"Gold Gained:",value:"",valuePerLevel:"[1/3/5]"}]}}]},dr={champions:{_container:".mb-8",_item:".rounded.text-white1.w-\\[291px\\].flex.flex-col.h-full.bg-bg",cost:".flex.items-end.text-\\[16px\\]",traits:".absolute.text-lg.leading-snug.bottom-\\[6px\\].left-\\[6px\\]",type:".mb-2.bg-bg2.rounded-lg.px-2.py-1.font-montserrat.font-medium.self-start",ability:{manaCost:".pt-\\[1px\\]",description:".leading-tight[0]",activation:{_container:".flex.flex-col.gap-\\[2px\\]",_item:".flex.flex-wrap.justify-between",kind:"span[0]",value:".leading-tight span:nth-child(2)",valuePerLevel:".text-white2"}}}};function Kt(t,n,s=""){const a=[];if(Array.isArray(t)&&Array.isArray(n)){const o=Math.max(t.length,n.length);for(let i=0;i<o;i++){const d=`${s}[${i}]`;i>=t.length?a.push({path:d,expected:void 0,actual:n[i]}):i>=n.length?a.push({path:d,expected:t[i],actual:void 0}):a.push(...Kt(t[i],n[i],d))}return a}if(typeof t=="object"&&t!==null&&typeof n=="object"&&n!==null&&!Array.isArray(t)&&!Array.isArray(n)){const o=new Set([...Object.keys(t),...Object.keys(n)]);for(const i of o){const d=s?`${s}.${i}`:i,h=t[i],m=n[i];h===void 0?a.push({path:d,expected:void 0,actual:m}):m===void 0?a.push({path:d,expected:h,actual:void 0}):a.push(...Kt(h,m,d))}return a}const l=o=>typeof o=="string"?o.replace(/\s+/g," ").trim():o,r=l(t),c=l(n);return r!==c&&a.push({path:s,expected:t,actual:n}),a}function js(t=document){console.group("🧪 Selector Test Runner"),console.log("Extracting content using selectors...");const n=nt(dr,t);console.log("Extracted content:",n),console.log("Expected content:",Tt);const s=Kt(Tt,n);return s.length===0?console.log("✅ All fields match! No differences found."):(console.log(`❌ Found ${s.length} difference(s):`),console.table(s.map(a=>{var l,r;return{Path:a.path,Expected:typeof a.expected=="string"?a.expected.slice(0,50):(l=JSON.stringify(a.expected))==null?void 0:l.slice(0,50),Actual:typeof a.actual=="string"?a.actual.slice(0,50):(r=JSON.stringify(a.actual))==null?void 0:r.slice(0,50)}})),s.forEach((a,l)=>{console.group(`Difference ${l+1}: ${a.path}`),console.log("Expected:",a.expected),console.log("Actual:",a.actual),console.groupEnd()})),console.groupEnd(),{differences:s,extracted:n,expected:Tt}}function ur(t){const n=[];return n.push(`=== Selector Test Comparison ===
`),t.differences.length===0?n.push(`✅ All fields match! No differences found.
`):(n.push(`❌ Found ${t.differences.length} difference(s):
`),t.differences.forEach((s,a)=>{n.push(`--- Difference ${a+1}: ${s.path} ---`),n.push(`Expected: ${JSON.stringify(s.expected,null,2)}`),n.push(`Actual:   ${JSON.stringify(s.actual,null,2)}`),n.push("")})),n.push(`
=== Full Extracted Content ===
`),n.push(JSON.stringify(t.extracted,null,2)),n.join(`
`)}function Nr(){const[t,n]=u.useState(!0),s=u.useRef(null),[a,l]=u.useState(null);u.useEffect(()=>{s.current&&l(s.current)},[]),u.useEffect(()=>{const c=setTimeout(()=>{s.current&&js(s.current)},500);return()=>clearTimeout(c)},[]);const r=u.useCallback(async()=>{if(!s.current){G.error("Capture target not ready");return}const c=js(s.current),o=ur(c);await navigator.clipboard.writeText(o),G.success(`Copied ${c.differences.length} difference(s) to clipboard`)},[]);return e.jsxs("div",{className:"custom-capture-v2-demo-page flex-1 flex flex-col h-full","data-test":"custom-capture-v2-demo-page",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 border-b bg-background border-border","data-test":"demo-header",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Custom Capture V2 Demo"}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"header-actions",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors bg-amber-500 hover:bg-amber-600 text-white","data-test":"copy-comparison-btn",children:[e.jsx(Na,{className:"w-4 h-4"}),"Copy Comparison"]}),e.jsx("button",{onClick:()=>n(!t),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors text-white ${t?"bg-primary":"bg-muted-foreground"}`,"data-test":"toggle-capture-panel",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"w-4 h-4"}),"Hide Panel"]}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4"}),"Show Panel"]})})]})]}),e.jsx("div",{ref:s,className:"page-content flex-1 p-6 overflow-y-auto min-h-0 bg-background","data-test":"capture-target",children:e.jsx(or,{})}),e.jsx(nr,{isVisible:t,onVisibilityChange:n,captureRoot:a})]})}export{Nr as CustomCaptureV2DemoPage};
