var de=Object.defineProperty;var pe=(d,t,o)=>t in d?de(d,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[t]=o;var te=(d,t,o)=>pe(d,typeof t!="symbol"?t+"":t,o);import{r as b,j as e}from"./react-vendor-Byz07MLO.js";import{S as he}from"./SFSService-BFwsjKwD.js";import{I as L,a7 as se,L as H,a as O,B as ne,S as J,h as X,i as Q,j as ee,k as Y,l as me,ar as ge,as as fe,at as xe}from"./index-hTFRJyrx.js";import{a2 as le,X as oe,aG as be,V as ye,O as ie,g as ve,b1 as Se}from"./icons-yhbeTEay.js";function je(d){const t={field:d.field,caseSensitive:!1};switch(d.operator){case"equals":return{...t,operator:"eq",value:d.value};case"contains":return{...t,operator:"contains",value:String(d.value)};case"starts_with":return{...t,operator:"startsWith",value:String(d.value)};case"ends_with":return{...t,operator:"endsWith",value:String(d.value)};case"greater_than":return{...t,operator:"gt",value:Number(d.value)};case"less_than":return{...t,operator:"lt",value:Number(d.value)};case"between":return{...t,operator:"between",valueRange:[d.valueMin??0,d.valueMax??0]};case"is_true":return{...t,operator:"eq",value:!0};case"is_false":return{...t,operator:"eq",value:!1};default:return{...t,operator:"eq",value:d.value}}}let Ce=0;function Pe({data:d,initialSearchTerm:t="",initialFilters:o=[],initialSort:c=null}){const[l,r]=b.useState(t),[a,s]=b.useState(!1),[u,p]=b.useState(!1),[g,n]=b.useState(o),[i,h]=b.useState(c),[v,m]=b.useState([]),j=b.useMemo(()=>new he(d),[d]),M=b.useMemo(()=>{let y=j.chain();if(l.trim()&&(y=y.search(l,{caseSensitive:a,exactMatch:u})),g.length>0){const C=g.map(w=>je(w));C.length===1?y=y.advancedFilter(C[0]):C.length>1&&(y=y.advancedFilter({conditions:C,logic:"AND"}))}if(v.length>0){const C=v.map(w=>({field:w.field,direction:w.direction}));y=y.multiSort(C)}else i&&(y=y.sort({field:i.field,direction:i.direction}));return y.getItems()},[j,l,a,u,g,i,v]),k=b.useCallback(y=>{const C={...y,id:`filter-${++Ce}`};n(w=>[...w,C])},[]),A=b.useCallback(y=>{n(C=>C.filter(w=>w.id!==y))},[]),z=b.useCallback((y,C)=>{n(w=>w.map(G=>G.id===y?{...G,...C}:G))},[]),I=b.useCallback(()=>{n([])},[]),T=b.useCallback((y,C)=>{h({field:y,direction:C}),m([])},[]),F=b.useCallback(y=>{h(C=>!C||C.field!==y?{field:y,direction:"asc"}:C.direction==="asc"?{field:y,direction:"desc"}:null),m([])},[]),_=b.useCallback(()=>{h(null)},[]),B=b.useCallback(y=>{m(C=>{let w=C;return C.length===0&&i&&(w=[i]),w.find($=>$.field===y)?w.map($=>$.field===y?{...$,direction:$.direction==="asc"?"desc":"asc"}:$):[...w,{field:y,direction:"asc"}]}),h(null)},[i]),V=b.useCallback(y=>{m(C=>C.filter(w=>w.field!==y))},[]),N=b.useCallback(()=>{m([])},[]),E=b.useCallback((y,C)=>{m(w=>{const G=w.findIndex(S=>S.field===y);if(G===-1)return w;const $=C==="up"?G-1:G+1;if($<0||$>=w.length)return w;const f=[...w];return[f[G],f[$]]=[f[$],f[G]],f})},[]),U={searchTerm:l,caseSensitive:a,exactMatch:u,filters:g,sort:i,multiSort:v},D={setSearchTerm:r,setCaseSensitive:s,setExactMatch:p,addFilter:k,removeFilter:A,updateFilter:z,clearFilters:I,setSort:T,toggleSort:F,clearSort:_,addMultiSort:B,removeMultiSort:V,clearMultiSort:N,reorderMultiSort:E},x={processedData:M,totalCount:d.length,filteredCount:M.length};return{state:U,actions:D,computed:x,tableProps:{data:M}}}class we{constructor(t){te(this,"items",[]);t&&(this.items=structuredClone(t))}getItems(){return structuredClone(this.items)}setItems(t){this.items=structuredClone(t)}categorize(t,o={}){const{allowMultiple:c=!1,usePriority:l=!0}=o,r=this.getItems(),a={categories:{},uncategorized:[],summary:{totalItems:r.length,categorizedItems:0,uncategorizedItems:0,categoryStats:{}}};return t.forEach(s=>{a.categories[s.name]=[],a.summary.categoryStats[s.name]=0}),r.forEach(s=>{const u=t.filter(p=>p.criteria(s));if(u.length===0)a.uncategorized.push(s),a.summary.uncategorizedItems++;else if(u.length===1||!c){let p;if(u.length===1)p=u[0];else if(l)p=u.reduce((g,n)=>(g.priority??0)>=(n.priority??0)?g:n);else{const g=t.findIndex(n=>n.name===u[0].name);p=t[g]}a.categories[p.name].push(structuredClone(s)),a.summary.categoryStats[p.name]++,a.summary.categorizedItems++}else u.forEach(p=>{a.categories[p.name].push(structuredClone(s)),a.summary.categoryStats[p.name]++}),a.summary.categorizedItems++}),a}groupBy(t,o={}){const{nullGroupName:c="null",sortGroups:l}=o,r=this.getItems(),a={},s={};r.forEach(h=>{const v=h[t],m=v!=null?String(v):c;a[m]||(a[m]=[],s[m]=0),a[m].push(structuredClone(h)),s[m]++});const u=Object.entries(s);let p="",g="",n=0,i=r.length;if(u.forEach(([h,v])=>{v>n&&(n=v,p=h),v<i&&(i=v,g=h)}),l){const h={};return Object.keys(a).sort((m,j)=>l==="asc"?m.localeCompare(j):j.localeCompare(m)).forEach(m=>{h[m]=a[m]}),{groups:h,summary:{totalItems:r.length,groupCount:Object.keys(h).length,largestGroup:p,smallestGroup:g,groupStats:s}}}return{groups:a,summary:{totalItems:r.length,groupCount:Object.keys(a).length,largestGroup:p,smallestGroup:g,groupStats:s}}}groupByMultiple(t,o={}){if(t.length===0)return{};if(t.length===1)return this.groupBy(t[0],o).groups;const{nullGroupName:c="null",sortGroups:l}=o,r=this.getItems(),a=(u,p,g=0)=>{const n=p[g],i={};if(u.forEach(v=>{const m=v[n],j=m!=null?String(m):c;i[j]||(i[j]=[]),i[j].push(v)}),g===p.length-1)return i;const h={};return Object.entries(i).forEach(([v,m])=>{h[v]=a(m,p,g+1)}),h};let s=a(r,t);if(l){const u=p=>{const g={};return Object.keys(p).sort((i,h)=>l==="asc"?i.localeCompare(h):h.localeCompare(i)).forEach(i=>{const h=p[i];h&&typeof h=="object"&&!Array.isArray(h)?g[i]=u(h):g[i]=h}),g};s=u(s)}return s}groupByFn(t,o={}){const{sortGroups:c}=o,l=this.getItems(),r={},a={};l.forEach(i=>{const h=t(i);r[h]||(r[h]=[],a[h]=0),r[h].push(structuredClone(i)),a[h]++});const s=Object.entries(a);let u="",p="",g=0,n=l.length;if(s.forEach(([i,h])=>{h>g&&(g=h,u=i),h<n&&(n=h,p=i)}),c){const i={};return Object.keys(r).sort((v,m)=>c==="asc"?v.localeCompare(m):m.localeCompare(v)).forEach(v=>{i[v]=r[v]}),{groups:i,summary:{totalItems:l.length,groupCount:Object.keys(i).length,largestGroup:u,smallestGroup:p,groupStats:a}}}return{groups:r,summary:{totalItems:l.length,groupCount:Object.keys(r).length,largestGroup:u,smallestGroup:p,groupStats:a}}}sliceEqual(t,o={}){if(t<=0)throw new Error("Count must be greater than 0");const{includeStats:c=!0}=o,l=this.getItems(),r=l.length;t>r&&(t=r);const a=[],s=[],u=Math.floor(r/t),p=r%t;let g=0;for(let i=0;i<t;i++){const h=u+(i<p?1:0),v=g+h,m=l.slice(g,v);a.push(m),s.push(m.length),g=v}const n={slices:a};return c&&(n.summary={totalItems:r,sliceCount:a.length,itemsPerSlice:s}),n}sliceBySize(t,o={}){if(t<=0)throw new Error("Size must be greater than 0");const{includeStats:c=!0}=o,l=this.getItems(),r=l.length,a=[],s=[];for(let p=0;p<r;p+=t){const g=l.slice(p,p+t);a.push(g),s.push(g.length)}const u={slices:a};return c&&(u.summary={totalItems:r,sliceCount:a.length,itemsPerSlice:s}),u}sliceByDistribution(t,o={}){const{includeStats:c=!0}=o,l=this.getItems(),r=l.length,a=t(l),s=a.map(p=>p.length),u={slices:a};return c&&(u.summary={totalItems:r,sliceCount:a.length,itemsPerSlice:s}),u}transformToArray(t,o=(c,l)=>({key:c,items:l})){return Object.entries(t).map(([c,l])=>o(c,structuredClone(l)))}getStats(t){const o=this.getItems(),c={totalItems:o.length};return t.forEach(l=>{c[l.name]=l.fn(o)}),c}}const ae={primaryField:null,secondaryFields:[],sortGroups:"asc",nullGroupName:"(empty)"},re={enabled:!1,currentSlice:0,sliceSize:5,sliceSizeOptions:[1,5,10,20,50]};function ce(d,t,o=[]){return`${o.length>0?o.join("::")+"::":""}${d}:${t}`}function Ne(d,t,o,c=0,l=[]){const r=[];return Object.entries(d).forEach(([a,s])=>{const u=ce(t,a,l),p=o[u]!==!1,g={id:`header-${u}`,type:"group-header",depth:c,fieldName:t,groupValue:a,itemCount:s.length,isExpanded:p,groupKey:u,parentGroupKeys:l};r.push(g),p&&s.forEach((n,i)=>{const h={id:`data-${u}-${i}`,type:"data-row",depth:c+1,data:n,parentGroupKey:u,originalIndex:i};r.push(h)})}),r}function ue(d,t,o,c=0,l=[]){const r=[],a=t[0],s=t.slice(1);return Object.entries(d).forEach(([u,p])=>{const g=ce(a,u,l),n=o[g]!==!1;let i=0;if(s.length===0)i=Array.isArray(p)?p.length:0;else{const v=m=>Array.isArray(m)?m.length:Object.values(m).reduce((j,M)=>j+v(M),0);i=v(p)}const h={id:`header-${g}`,type:"group-header",depth:c,fieldName:a,groupValue:u,itemCount:i,isExpanded:n,groupKey:g,parentGroupKeys:l};if(r.push(h),n){if(s.length===0&&Array.isArray(p))p.forEach((v,m)=>{const j={id:`data-${g}-${m}`,type:"data-row",depth:c+1,data:v,parentGroupKey:g,originalIndex:m};r.push(j)});else if(s.length>0){const v=ue(p,s,o,c+1,[...l,g]);r.push(...v)}}}),r}function Fe(d){if(d.length===0)return[];const t=d[0],o=[];return Object.entries(t).forEach(([c,l])=>{if(Array.isArray(l)||typeof l=="object"&&l!==null)return;let r="string";typeof l=="number"?r="number":typeof l=="boolean"?r="boolean":(l instanceof Date||!isNaN(Date.parse(String(l))))&&(r="date"),o.push({field:c,label:c.charAt(0).toUpperCase()+c.slice(1).replace(/([A-Z])/g," $1"),type:r})}),o}function Te(d){const{data:t,groupableFields:o,initialGroupConfig:c,initialSliceConfig:l,onGroupChange:r,onSliceChange:a}=d,[s,u]=b.useState({...ae,...c}),[p,g]=b.useState({}),[n,i]=b.useState({...re,...l}),h=b.useMemo(()=>o||Fe(t),[t,o]),v=b.useMemo(()=>new we(t),[t]),m=b.useMemo(()=>{if(!s.primaryField)return null;const f=[s.primaryField,...s.secondaryFields];return f.length===1?v.groupBy(s.primaryField,{nullGroupName:s.nullGroupName,sortGroups:s.sortGroups}):{groups:v.groupByMultiple(f,{nullGroupName:s.nullGroupName,sortGroups:s.sortGroups}),summary:{totalItems:t.length,groupCount:0,largestGroup:"",smallestGroup:"",groupStats:{}}}},[v,s,t.length]),j=b.useMemo(()=>{if(!m||!s.primaryField)return t.map((S,q)=>({id:`data-${q}`,type:"data-row",depth:0,data:S,parentGroupKey:"",originalIndex:q}));const f=[s.primaryField,...s.secondaryFields];return f.length===1?Ne(m.groups,s.primaryField,p):ue(m.groups,f,p)},[m,s.primaryField,s.secondaryFields,p,t]),M=b.useMemo(()=>{if(!n.enabled)return j;if(s.primaryField){const f=j.filter(P=>P.type==="group-header"&&P.depth===0),S=n.currentSlice*n.sliceSize,q=S+n.sliceSize,R=new Set(f.slice(S,q).map(P=>P.groupKey));return j.filter(P=>{if(P.type==="group-header"){const K=P;return K.depth===0?R.has(K.groupKey):K.parentGroupKeys.some(Z=>R.has(Z))||R.has(K.groupKey)}else{const K=P,Z=K.parentGroupKey.split("::")[0];return R.has(Z)||R.has(K.parentGroupKey)}})}else{const f=n.currentSlice*n.sliceSize,S=f+n.sliceSize;return j.slice(f,S)}},[j,n,s.primaryField]),k=b.useMemo(()=>{if(!n.enabled)return 1;if(s.primaryField){const f=j.filter(S=>S.type==="group-header"&&S.depth===0);return Math.ceil(f.length/n.sliceSize)}else return Math.ceil(j.length/n.sliceSize)},[j,n,s.primaryField]),A=b.useMemo(()=>{var f;return(f=m==null?void 0:m.summary)!=null&&f.groupStats?m.summary.groupStats:{}},[m]),z=b.useMemo(()=>m&&typeof m.groups=="object"?Object.keys(m.groups).length:0,[m]),I=b.useCallback(f=>{const S={...s,primaryField:f,secondaryFields:f?s.secondaryFields:[]};u(S),g({}),r==null||r(S)},[s,r]),T=b.useCallback(f=>{const S={...s,primaryField:f[0]||null,secondaryFields:f.slice(1)};u(S),g({}),r==null||r(S)},[s,r]),F=b.useCallback(f=>{if(!s.primaryField){I(f);return}const S={...s,secondaryFields:[...s.secondaryFields,f]};u(S),r==null||r(S)},[s,r,I]),_=b.useCallback(f=>{if(f===0)if(s.secondaryFields.length>0){const S={...s,primaryField:s.secondaryFields[0],secondaryFields:s.secondaryFields.slice(1)};u(S),r==null||r(S)}else I(null);else{const S={...s,secondaryFields:s.secondaryFields.filter((q,R)=>R!==f-1)};u(S),r==null||r(S)}},[s,r,I]),B=b.useCallback(f=>{g(S=>({...S,[f]:S[f]===!1}))},[]),V=b.useCallback(()=>{const f={};j.forEach(S=>{S.type==="group-header"&&(f[S.groupKey]=!0)}),g(f)},[j]),N=b.useCallback(()=>{const f={};j.forEach(S=>{S.type==="group-header"&&(f[S.groupKey]=!1)}),g(f)},[j]),E=b.useCallback(()=>{const f={...n,enabled:!n.enabled,currentSlice:0};i(f),a==null||a(f)},[n,a]),U=b.useCallback(f=>{const S={...n,sliceSize:f,currentSlice:0};i(S),a==null||a(S)},[n,a]),D=b.useCallback(()=>{if(n.currentSlice<k-1){const f={...n,currentSlice:n.currentSlice+1};i(f),a==null||a(f)}},[n,k,a]),x=b.useCallback(()=>{if(n.currentSlice>0){const f={...n,currentSlice:n.currentSlice-1};i(f),a==null||a(f)}},[n,a]),y=b.useCallback(f=>{if(f>=0&&f<k){const S={...n,currentSlice:f};i(S),a==null||a(S)}},[n,k,a]),C=b.useCallback(()=>{u(ae),g({}),i(re)},[]),w={groupConfig:s,expandedGroups:p,sliceConfig:n},G={setGroupBy:I,setGroupByMultiple:T,addGroupLevel:F,removeGroupLevel:_,toggleGroup:B,expandAll:V,collapseAll:N,toggleSlicing:E,setSliceSize:U,nextSlice:D,previousSlice:x,goToSlice:y,reset:C},$={flattenedRows:M,totalGroups:z,totalItems:t.length,totalSlices:k,sliceDisplay:`${n.currentSlice+1} of ${k}`,hasNextSlice:n.currentSlice<k-1,hasPreviousSlice:n.currentSlice>0,groupStats:A,groupableFields:h};return{state:w,actions:G,computed:$,tableProps:{data:M,isGrouped:!!s.primaryField,isSliced:n.enabled}}}const W={string:["equals","contains","starts_with","ends_with"],number:["equals","greater_than","less_than","between"],boolean:["is_true","is_false"],date:["equals","greater_than","less_than","between"]};function Re({columns:d,filters:t,searchTerm:o,caseSensitive:c,exactMatch:l,onSearchChange:r,onCaseSensitiveChange:a,onExactMatchChange:s,onAddFilter:u,onRemoveFilter:p,onClearFilters:g}){const[n,i]=b.useState(""),[h,v]=b.useState(""),[m,j]=b.useState(""),[M,k]=b.useState(""),[A,z]=b.useState(""),[I,T]=b.useState("true"),F=d.find(x=>x.id===n),_=F?W[F.type]:[],B=x=>{i(x);const y=d.find(C=>C.id===x);y&&v(W[y.type][0]),j(""),k(""),z("")},V=()=>{if(!n||!h&&(F==null?void 0:F.type)!=="boolean")return;let x=m;const y=d.find(G=>G.id===n);(y==null?void 0:y.type)==="number"&&h!=="between"?x=Number(m):(y==null?void 0:y.type)==="boolean"&&(x=I==="true");let C=h;(y==null?void 0:y.type)==="boolean"&&(C=I==="true"?"is_true":"is_false");const w={field:n,operator:C,value:x};h==="between"&&(w.valueMin=Number(M),w.valueMax=Number(A)),u(w),i(""),v(""),j(""),k(""),z("")},N=x=>{const y=d.find(G=>G.id===x.field),C=(y==null?void 0:y.label)??x.field,w=x.operator;return x.operator==="between"?`${C} ${w} ${x.valueMin} and ${x.valueMax}`:x.operator==="is_true"||x.operator==="is_false"?`${C} ${w}`:`${C} ${w} ${x.value}`},E=t.length,U=h==="between",D=(F==null?void 0:F.type)==="boolean";return e.jsxs("div",{className:"space-y-4","data-test":"enhanced-filter-bar",children:[e.jsxs("div",{className:"flex items-center gap-4","data-test":"search-row",children:[e.jsx(L,{placeholder:"Filter all columns...",value:o,onChange:x=>r(x.target.value),className:"max-w-sm","data-test":"global-search-input"}),e.jsxs("div",{className:"flex items-center gap-4","data-test":"search-options",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{id:"case-sensitive",checked:c,onCheckedChange:x=>a(x===!0),"data-test":"search-case-sensitive-toggle"}),e.jsx(H,{htmlFor:"case-sensitive",className:"text-sm","data-test":"case-sensitive-label",children:"Case sensitive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{id:"exact-match",checked:l,onCheckedChange:x=>s(x===!0),"data-test":"search-exact-match-toggle"}),e.jsx(H,{htmlFor:"exact-match",className:"text-sm","data-test":"exact-match-label",children:"Exact match"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap","data-test":"filter-builder-row",children:[e.jsxs("select",{value:n,onChange:x=>B(x.target.value),className:"h-9 w-40 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-field-select",children:[e.jsx("option",{value:"",children:"Select field"}),d.map(x=>e.jsx("option",{value:x.id,"data-test":`filter-field-option-${x.id}`,children:x.label},x.id))]}),n&&!D&&e.jsx("select",{value:h,onChange:x=>v(x.target.value),className:"h-9 w-36 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-operator-select",children:_.map(x=>e.jsx("option",{value:x,"data-test":`filter-operator-option-${x}`,children:x},x))}),n&&D?e.jsxs("select",{value:I,onChange:x=>T(x.target.value),className:"h-9 w-24 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-boolean-select",children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]}):n&&U?e.jsxs(e.Fragment,{children:[e.jsx(L,{type:"number",placeholder:"Min",value:M,onChange:x=>k(x.target.value),className:"w-24","data-test":"filter-value-min-input"}),e.jsx(L,{type:"number",placeholder:"Max",value:A,onChange:x=>z(x.target.value),className:"w-24","data-test":"filter-value-max-input"})]}):n?e.jsx(L,{type:(F==null?void 0:F.type)==="number"?"number":"text",placeholder:"Value...",value:m,onChange:x=>j(x.target.value),className:"w-32","data-test":"filter-value-input"}):null,n&&e.jsxs(O,{size:"sm",onClick:V,"data-test":"filter-add-button",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2","data-test":"active-filter-count",children:[E," ",E===1?"filter":"filters"]}),E>0&&e.jsx(O,{size:"sm",variant:"outline",onClick:g,"data-test":"filter-clear-all-button",children:"Clear all"})]}),E>0&&e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"filter-chips",children:t.map(x=>e.jsxs(ne,{variant:"secondary",className:"flex items-center gap-1 pr-1","data-test":`filter-chip-${x.field}`,children:[e.jsx("span",{children:N(x)}),e.jsx(O,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>p(x.id),"data-test":"filter-chip-remove",children:e.jsx(oe,{className:"h-3 w-3"})})]},x.id))})]})}function Ge({groupableFields:d,selectedField:t,onFieldSelect:o,disabled:c}){return e.jsxs("div",{"data-test":"group-selector",className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Group by"}),e.jsxs(J,{value:t||"none",onValueChange:l=>o(l==="none"?null:l),disabled:c,children:[e.jsx(X,{"data-test":"group-selector-trigger",className:"w-[180px] h-8",children:e.jsx(Q,{placeholder:"Select field..."})}),e.jsxs(ee,{"data-test":"group-selector-dropdown",children:[e.jsx(Y,{value:"none","data-test":"group-option-none",children:"None"}),d.map(l=>e.jsx(Y,{value:l.field,"data-test":`group-option-${l.field}`,children:l.label},l.field))]})]})]})}function ke({groupableFields:d,selectedField:t,excludeFields:o,onFieldSelect:c,onRemove:l,index:r,disabled:a}){const s=d.filter(u=>!o.includes(u.field)||u.field===t);return e.jsxs("div",{"data-test":`group-selector-secondary-${r}`,className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"then"}),e.jsxs(J,{value:t,onValueChange:c,disabled:a,children:[e.jsx(X,{"data-test":`group-selector-secondary-trigger-${r}`,className:"w-[150px] h-8",children:e.jsx(Q,{placeholder:"Select field..."})}),e.jsx(ee,{"data-test":`group-selector-secondary-dropdown-${r}`,children:s.map(u=>e.jsx(Y,{value:u.field,"data-test":`group-option-${u.field}`,children:u.label},u.field))})]}),e.jsx(O,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:l,"data-test":"remove-group-secondary",title:"Remove grouping level",children:e.jsx(oe,{className:"h-4 w-4"})})]})}function Ie({onClick:d,disabled:t}){return e.jsxs(O,{variant:"ghost",size:"sm",onClick:d,disabled:t,"data-test":"add-group-button",className:"h-8 gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Add level"})]})}function Ke({groupableFields:d,selectedField:t,secondaryFields:o,onFieldSelect:c,onAddSecondary:l,onRemoveSecondary:r,disabled:a}){const s=[t,...o].filter(Boolean),u=d.filter(n=>!s.includes(n.field)),p=t&&u.length>0,g=()=>{u.length>0&&l(u[0].field)};return e.jsxs("div",{"data-test":"group-selector-container",className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Ge,{groupableFields:d,selectedField:t,onFieldSelect:c,disabled:a}),o.map((n,i)=>e.jsx(ke,{groupableFields:d,selectedField:n,excludeFields:s.filter(h=>h!==n),onFieldSelect:h=>{[...o],r(i),l(h)},onRemove:()=>r(i),index:i,disabled:a},`secondary-${i}`)),t&&o.length===0&&e.jsx("div",{"data-test":"group-selector-secondary",className:"hidden"}),p&&e.jsx(Ie,{onClick:g,disabled:a})]})}function Le({enabled:d,currentSlice:t,totalSlices:o,sliceSize:c,sliceSizeOptions:l,onToggle:r,onSliceSizeChange:a,onNextSlice:s,onPreviousSlice:u,hasNext:p,hasPrevious:g,sliceDisplay:n}){return e.jsxs("div",{"data-test":"slice-controls-container",className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{id:"slice-toggle",checked:d,onCheckedChange:r,"data-test":"slice-toggle"}),e.jsxs(H,{htmlFor:"slice-toggle",className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),"Slice view"]})]}),d&&e.jsxs("div",{"data-test":"slice-controls",className:"flex items-center gap-3 border-l pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show"}),e.jsxs(J,{value:String(c),onValueChange:i=>a(Number(i)),children:[e.jsx(X,{"data-test":"slice-size-config",className:"w-[70px] h-8",children:e.jsx(Q,{})}),e.jsx(ee,{children:l.map(i=>e.jsx(Y,{value:String(i),"data-test":`slice-size-${i}`,children:i},i))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:u,disabled:!g,"data-test":"slice-previous",title:"Previous slice",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx("span",{"data-test":"slice-info",className:"text-sm text-muted-foreground min-w-[60px] text-center",children:n}),e.jsx(O,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:s,disabled:!p,"data-test":"slice-next",title:"Next slice",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]})}function Me(d){return{paddingLeft:`${1+d*1.5}rem`}}function $e({groupRow:d,onToggle:t,colSpan:o}){const{fieldName:c,groupValue:l,itemCount:r,isExpanded:a,groupKey:s,depth:u}=d,g=`group-header-${l.replace(/\s+/g,"-").toLowerCase()}`;return e.jsx("tr",{"data-test":g,className:"bg-muted/50 hover:bg-muted/70 cursor-pointer transition-colors group-header-row",onClick:()=>t(s),children:e.jsx("td",{colSpan:o,className:"py-2 font-medium",style:Me(u),"data-test":`group-header-level-${u}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{"data-test":"group-toggle-icon",className:"flex items-center justify-center w-5 h-5 rounded hover:bg-muted",children:a?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[c,":"]})," ",e.jsx("span",{className:"font-medium",children:l})]}),e.jsx(ne,{variant:"secondary","data-test":"group-count",className:"ml-2 text-xs",children:r})]})})})}function Ee({dataRow:d,columns:t,onRowClick:o,columnSizeVars:c}){const{data:l,originalIndex:r,depth:a,parentGroupKey:s}=d,u={paddingLeft:`${a*1.5}rem`},p=s.replace(/[^a-zA-Z0-9-]/g,"-").toLowerCase(),g=s?`data-row-${p}-${r}`:`data-row-${r}`;return e.jsx("tr",{"data-test":g,className:"hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>o==null?void 0:o(l),children:t.map((n,i)=>{const h=n.accessorKey||n.id||`col-${i}`,v=l[h],m=i===0?{...u}:{};if(c){const j=`--col-${h}-size`;c[j]&&(m.width=`calc(var(${j}) * 1px)`,m.maxWidth=`calc(var(${j}) * 1px)`)}return e.jsx("td",{className:"p-3 text-sm border-b break-words overflow-hidden",style:m,children:Oe(n,v,l)},h)})})}function Oe(d,t,o){if(d.cellRenderer)return d.cellRenderer(o);if(d.accessorFn){const c=d.accessorFn(o,0);return String(c??"")}return t==null?e.jsx("span",{className:"text-muted-foreground",children:"-"}):typeof t=="boolean"?t?"Yes":"No":typeof t=="object"?JSON.stringify(t):String(t)}function De({rows:d,columns:t,onToggleGroup:o,onRowClick:c,columnSizeVars:l}){const r=t.length;return e.jsx("tbody",{"data-test":"grouped-table-body",className:"divide-y divide-gray-200",style:l,children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r,className:"px-4 py-8 text-center text-muted-foreground",children:"No results found"})}):d.map(a=>{if(a.type==="group-header"){const s=a;return e.jsx($e,{groupRow:s,onToggle:o,colSpan:r},s.id)}else{const s=a;return e.jsx(Ee,{dataRow:s,columns:t,onRowClick:c,columnSizeVars:l},s.id)}})})}function Ue({columnId:d,columnLabel:t,columnType:o,currentFilter:c,onApplyFilter:l,onClearFilter:r,isActive:a=!1}){var _,B,V;const[s,u]=b.useState(!1),[p,g]=b.useState((c==null?void 0:c.operator)??W[o][0]),[n,i]=b.useState(((_=c==null?void 0:c.value)==null?void 0:_.toString())??""),[h,v]=b.useState(((B=c==null?void 0:c.valueMin)==null?void 0:B.toString())??""),[m,j]=b.useState(((V=c==null?void 0:c.valueMax)==null?void 0:V.toString())??""),[M,k]=b.useState(o==="boolean"&&c?c.value===!0?"true":"false":"true"),A=W[o],z=p==="between",I=o==="boolean",T=()=>{let N=n;o==="number"&&p!=="between"?N=Number(n):I&&(N=M==="true");const E={field:d,operator:p,value:N};p==="between"&&(E.valueMin=Number(h),E.valueMax=Number(m)),l(E),u(!1)},F=()=>{i(""),v(""),j(""),g(W[o][0]),r(),u(!1)};return e.jsxs(ge,{open:s,onOpenChange:u,children:[e.jsx(fe,{asChild:!0,children:e.jsx(O,{variant:"ghost",size:"sm","data-test":`column-filter-button-${d}`,className:`h-6 w-6 p-0 ${a?"active text-primary":"text-muted-foreground"}`,onClick:N=>{N.stopPropagation()},children:e.jsx(Se,{className:"h-3.5 w-3.5"})})}),e.jsx(xe,{"data-test":`column-filter-popover-${d}`,className:"w-72 p-4",align:"start",onClick:N=>N.stopPropagation(),children:e.jsxs("div",{className:"space-y-4","data-test":"filter-popover-content",children:[e.jsxs("div",{className:"font-medium text-sm","data-test":"filter-column-label",children:["Filter: ",t]}),!I&&e.jsx("select",{value:p,onChange:N=>g(N.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-operator-select",children:A.map(N=>e.jsx("option",{value:N,"data-test":`operator-option-${N}`,children:N},N))}),I?e.jsxs("select",{value:M,onChange:N=>k(N.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-boolean-select",children:[e.jsx("option",{value:"true","data-test":"boolean-option-true",children:"True"}),e.jsx("option",{value:"false","data-test":"boolean-option-false",children:"False"})]}):z?e.jsxs("div",{className:"flex gap-2","data-test":"between-inputs",children:[e.jsx(L,{type:"number",placeholder:"Min",value:h,onChange:N=>v(N.target.value),"data-test":"filter-value-min-input"}),e.jsx(L,{type:"number",placeholder:"Max",value:m,onChange:N=>j(N.target.value),"data-test":"filter-value-max-input"})]}):e.jsx(L,{type:o==="number"?"number":"text",placeholder:`Enter ${o} value...`,value:n,onChange:N=>i(N.target.value),"data-test":"filter-value-input"}),e.jsxs("div",{className:"flex gap-2","data-test":"filter-actions",children:[e.jsx(O,{size:"sm",className:"flex-1",onClick:T,"data-test":"filter-apply-button",children:"Apply"}),e.jsx(O,{size:"sm",variant:"outline",onClick:F,"data-test":"filter-clear-button",children:"Clear"})]})]})})]})}export{De as T,Re as U,Te as a,Ke as b,Le as c,Ue as d,Pe as u};
