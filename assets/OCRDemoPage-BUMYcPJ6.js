import{r as c,j as e}from"./react-vendor-Byz07MLO.js";import{B as X}from"./Breadcrumbs-CbFAFVWz.js";import{C as S,b as L,c as U,d as T,e as M,R as Y,a as j}from"./index-BbgB-sev.js";import{A as Z,a as _}from"./alert-BK0jqY_S.js";import{u as g}from"./useOcr-DjwVfUqd.js";import{I as D,av as ee,d as se,U as ae,ab as te,ai as A,e as ne}from"./icons-Detj0uxE.js";import"./radix-ui-B6r6BEmy.js";import"./utils-DjFvUtuq.js";import"./ui-utils-BxIQ3qGg.js";function ie({logger:s}){const[l,b]=c.useState(null),[N,z]=c.useState(null),[K,I]=c.useState(!1),[x,C]=c.useState(100),[p,v]=c.useState(null),f=c.useRef(null),{result:n,isProcessing:R,error:F,processingTime:$,processBlob:O,cancel:P,reset:m}=g(),E=c.useCallback(async a=>{a.preventDefault();const t=a.clipboardData.items;for(const i of t)if(i.type.startsWith("image/")){const d=i.getAsFile();if(d){if(d.size>5242880){s==null||s.error(`Image too large: ${(d.size/1024/1024).toFixed(2)}MB. Maximum allowed: 5MB`),m();return}s==null||s.info(`Image size: ${(d.size/1024/1024).toFixed(2)}MB`);const o=new FileReader;o.onload=async()=>{const r=o.result,u=new Image;u.src=r,await new Promise(Q=>{u.onload=Q});const w=r.split(",")[1].length*3/4/1024;b(r),z(r),C(100),v({width:u.width,height:u.height,sizeKB:w}),m(),s==null||s.info("Image pasted successfully")},o.readAsDataURL(d)}break}},[s,m]),V=c.useCallback(async a=>{var i;const t=(i=a.target.files)==null?void 0:i[0];if(t&&t.type.startsWith("image/")){if(t.size>5242880){s==null||s.error(`Image too large: ${(t.size/1024/1024).toFixed(2)}MB. Maximum allowed: 5MB`),m(),f.current&&(f.current.value="");return}s==null||s.info(`Image file selected: ${t.name} (${(t.size/1024/1024).toFixed(2)}MB)`);const h=new FileReader;h.onload=async()=>{const o=h.result,r=new Image;r.src=o,await new Promise(w=>{r.onload=w});const B=o.split(",")[1].length*3/4/1024;b(o),z(o),C(100),v({width:r.width,height:r.height,sizeKB:B}),m()},h.readAsDataURL(t)}},[s,m]),H=c.useCallback(async()=>{if(!l){s==null||s.error("Please provide an image first");return}s==null||s.info("Starting OCR processing...");const t=await(await fetch(l)).blob(),i=await O(t);i?s==null||s.info(`OCR completed in ${i.processingTime}ms`):s==null||s.error("OCR processing failed")},[l,s,O]),W=c.useCallback(()=>{P(),s==null||s.info("OCR processing cancelled")},[P,s]),q=c.useCallback(()=>{b(null),z(null),C(100),v(null),m(),I(!1),f.current&&(f.current.value="")},[m]),G=c.useCallback(async()=>{if(!N){s==null||s.error("No image to downscale");return}try{s==null||s.info(`Downscaling image to ${x}%...`);const a=new Image;a.src=N,await new Promise((B,w)=>{a.onload=B,a.onerror=w});const t=Math.floor(a.width*(x/100)),i=Math.floor(a.height*(x/100)),d=document.createElement("canvas");d.width=t,d.height=i;const y=d.getContext("2d");if(!y){s==null||s.error("Failed to get canvas context");return}y.drawImage(a,0,0,t,i);const h=d.toDataURL("image/jpeg",.9),r=h.split(",")[1].length*3/4,u=r/(1024*1024),k=r/1024;b(h),v({width:t,height:i,sizeKB:k}),s==null||s.info(`Image downscaled to ${t}x${i} (${u.toFixed(2)}MB)`)}catch(a){s==null||s.error(`Failed to downscale image: ${a instanceof Error?a.message:"Unknown error"}`)}},[N,x,s]),J=c.useCallback(async()=>{if(n!=null&&n.extractedText)try{await navigator.clipboard.writeText(n.extractedText),I(!0),s==null||s.info("OCR result copied to clipboard"),setTimeout(()=>I(!1),2e3)}catch{s==null||s.error("Failed to copy to clipboard")}},[n,s]);return e.jsx("div",{className:"ocr-demo-container p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(S,{className:"h-fit",children:[e.jsxs(L,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Image Preview"]}),e.jsx(T,{children:"Paste an image (Ctrl+V) or upload a file (max 5MB)"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"paste-area border-2 border-dashed rounded-lg p-8 text-center cursor-pointer hover:border-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",onPaste:E,tabIndex:0,role:"button","aria-label":"Paste image area",children:l?e.jsxs("div",{className:"image-preview-container space-y-2",children:[e.jsx("img",{src:l,alt:"Pasted preview",className:"image-preview max-w-full max-h-[600px] mx-auto rounded-lg shadow-md"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Image ready for OCR processing"})]}):e.jsxs("div",{className:"empty-state space-y-3",children:[e.jsx(D,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Click here and press Ctrl+V to paste an image"})]})}),l&&e.jsxs("div",{className:"downscale-controls mt-4 p-4 border rounded-lg bg-muted/50",children:[p&&e.jsxs("div",{className:"image-info flex items-center justify-between mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Dimensions: "}),e.jsxs("span",{className:"font-medium",children:[p.width," × ",p.height]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Size: "}),e.jsx("span",{className:"font-medium",children:p.sizeKB<1024?`${p.sizeKB.toFixed(1)} KB`:`${(p.sizeKB/1024).toFixed(2)} MB`})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[x,"%"]})]}),e.jsx(Y,{value:[x],onValueChange:a=>C(a[0]),min:10,max:100,step:5,className:"mb-3"}),e.jsxs(j,{onClick:G,disabled:!N,variant:"outline",size:"sm",className:"w-full",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),x===100?"Reset to Original":"Apply Downscale"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{children:e.jsxs(M,{className:"pt-6",children:[e.jsxs("div",{className:"ocr-controls-section flex items-center gap-3 flex-wrap",children:[R?e.jsxs(j,{variant:"destructive",onClick:W,className:"cancel-button",size:"lg",children:[e.jsx(se,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancel"]}):e.jsxs(j,{onClick:H,disabled:!l,className:"run-ocr-button bg-foreground text-background hover:bg-foreground/90",size:"lg",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Run OCR"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:V,className:"hidden"}),e.jsxs(j,{variant:"outline",onClick:()=>{var a;return(a=f.current)==null?void 0:a.click()},className:"upload-button",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upload Image"]}),l&&e.jsx(j,{variant:"outline",onClick:q,className:"clear-button",children:"Clear"})]}),R&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Processing..."})]}),F&&!R&&e.jsxs(Z,{variant:"destructive",className:"mt-4",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(_,{children:F})]})]})}),e.jsxs(S,{className:"h-fit",children:[e.jsxs(L,{children:[e.jsxs(U,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-green-600"}),"Extracted Text"]}),n&&e.jsx(j,{variant:"outline",size:"sm",onClick:J,className:"copy-button",children:K?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 text-green-600"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Copy"]})})]}),n&&e.jsxs(T,{className:"space-y-1",children:[n.detectedLanguage&&e.jsxs("div",{children:["Language: ",n.detectedLanguage]}),n.confidence&&e.jsxs("div",{children:["Confidence: ",n.confidence]}),$&&e.jsxs("div",{className:"text-xs",children:["Processing time: ",$,"ms • Model: ",n.modelUsed]})]})]}),e.jsx(M,{children:n?e.jsx("div",{className:"result-text-container p-4 bg-muted rounded-lg font-mono text-sm whitespace-pre-wrap break-words max-h-[600px] overflow-y-auto",children:n.extractedText}):e.jsxs("div",{className:"empty-result text-center p-12 text-muted-foreground",children:[e.jsx("p",{children:"No text extracted yet"}),e.jsx("p",{className:"text-sm mt-2",children:'Upload an image and click "Run OCR" to extract text'})]})})]})]})]})})}function pe({logger:s}){const l=[{label:"Home",href:"/"},{label:"Demo",href:"/demo"},{label:"OCR"}];return e.jsxs("div",{className:"ocr-demo-page flex-1 flex flex-col h-full",children:[e.jsx("div",{className:"page-header p-6 pb-0 flex-shrink-0",children:e.jsx("div",{className:"breadcrumb-section mb-4",children:e.jsx(X,{items:l})})}),e.jsx("div",{className:"page-content flex-1 overflow-y-auto min-h-0",children:e.jsx(ie,{logger:s})})]})}export{pe as OCRDemoPage};
