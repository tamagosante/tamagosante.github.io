import{r}from"./react-vendor-Byz07MLO.js";import{W as L,X as W,Y as z,Z as G,_ as P}from"./index-eHP58yiE.js";function j(H={}){const{maxRows:y=3,maxColumnsPerRow:u=7,enabled:b=!0}=H,[v,g]=r.useState(!1),[l,k]=r.useState([]),[R,f]=r.useState(0),[h,T]=r.useState(0),[K,w]=r.useState(""),[M,S]=r.useState(""),[E,C]=r.useState([]),[p,B]=r.useState(0),V=r.useRef(0),q=r.useRef(!1),d=r.useRef(null),m=r.useCallback(()=>{C([]),B(0)},[]),I=r.useCallback(t=>{let e="";for(const a of t){e+=a;const s=e.length,n=L(e,s);if(n.found){const o=W(e,s,n.sequenceStart,n.detectedBaseChar);o.type==="auto-complete"&&o.replacement&&(e=o.replacement)}}return e},[y,u]),i=r.useCallback(()=>{g(!1),k([]),f(0),w(""),S("")},[]),A=r.useCallback(t=>{if(!d.current)return;const e=d.current;if(i(),e.focus(),e.setSelectionRange(h,h+1),!document.execCommand("insertText",!1,t)){const n=e.value,o=n.substring(0,h)+t+n.substring(h+1);e.value=o;const c=new Event("input",{bubbles:!0});e.dispatchEvent(c)}const s=h+1;e.setSelectionRange(s,s),requestAnimationFrame(()=>{d.current&&d.current.focus()})},[h,i]),F=r.useCallback(t=>{if(!b)return;const e=t.currentTarget,a=e.selectionStart||0,s=e.value.charAt(a-1).toLowerCase();if(q.current)q.current=!1;else{const o=a>=2?e.value.charAt(a-2):"";(/[\s.,;:!?()[\]{}'"<>/\\-]/.test(o)||o==="")&&s&&!/[\s.,;:!?()[\]{}'"<>/\\-]/.test(s)?(B(a-1),C([s])):s&&!/[\s.,;:!?()[\]{}'"<>/\\-]/.test(s)?C(D=>[...D,s]):m()}const n=L(e.value,a);if(n.found&&n.sequenceStart<a-1){const o=e.value.slice(n.sequenceStart,a).toLowerCase(),c=W(e.value,a,n.sequenceStart,n.detectedBaseChar);switch(c.type){case"terminate":g(!1),w(""),S("");return;case"auto-complete":e.value=c.replacement,e.setSelectionRange(c.newCursorPos,c.newCursorPos),g(!1),w(""),S("");return;case"show-popover":w(o),S(n.detectedBaseChar),T(n.sequenceStart),k(c.diacritics),f(0),g(!0);return}return}if(z(s)){const o=G[s],c=y*u;k(o.slice(0,c)),T(a-1),w(s),S(s),f(0),g(!0)}else g(!1),w(""),S("")},[b,y,u,m]),N=r.useCallback(t=>{if(!b)return;const e=t.currentTarget,a=e.selectionStart||0;if(t.key==="Backspace"&&E.length>0){const s=e.value.substring(p).split(/[\s.,;:!?()[\]{}'"<>/\\-]/)[0].length,n=p+s;if(a>p&&a<=n){t.preventDefault(),t.stopPropagation();const o=E.slice(0,-1);C(o);const c=I(o),D=e.value.substring(0,p),O=e.value.substring(n),U=D+c+O;if(q.current=!0,e.setSelectionRange(p,n),!document.execCommand("insertText",!1,c)){e.value=U;const _=new Event("input",{bubbles:!0});e.dispatchEvent(_)}const x=p+c.length;e.setSelectionRange(x,x),V.current=x,o.length===0&&m();return}}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(t.key)&&m(),!!v)switch(t.key){case"ArrowRight":t.preventDefault(),t.stopPropagation(),f(s=>P(s,"right",l.length,u));break;case"ArrowLeft":t.preventDefault(),t.stopPropagation(),f(s=>P(s,"left",l.length,u));break;case"ArrowDown":t.preventDefault(),t.stopPropagation(),f(s=>P(s,"down",l.length,u));break;case"ArrowUp":t.preventDefault(),t.stopPropagation(),f(s=>P(s,"up",l.length,u));break;case"Enter":case"Tab":t.preventDefault(),t.stopPropagation(),A(l[R]);break;case"Escape":t.preventDefault(),t.stopPropagation(),i();break;default:t.key.length===1&&i();break}},[v,b,l,R,u,A,i,E,p,I,m]);return r.useEffect(()=>{if(!v)return;const t=e=>{d.current&&!d.current.contains(e.target)&&i()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[v,i]),{showPopover:v,diacritics:l,selectedIndex:R,handleKeyDown:N,handleInput:F,selectDiacritic:A,closePopover:i,inputRef:d}}export{j as u};
