import{j as e,r as o,h as ci}from"./react-vendor-Byz07MLO.js";import{t as te}from"./utils-DJ2ViQ2u.js";import{S as Fe,h as Me,i as xt,j as Be,k as he,ac as Ge,L as De,I as ke,a as re,l as Bs,aR as di,ab as Ze,aj as ui,ad as ds,ae as us,af as hs,ag as Ut,bd as Pa,a_ as za,a$ as Ra,b0 as $a,m as Fn,n as Mn,o as Wt,p as qt,b3 as hi,b4 as pi,c3 as mi,c4 as xi,V as yt,aA as fi,cc as gi,aC as bi,aK as yi,T as ji}from"./index-eHP58yiE.js";import{a6 as Ks,bG as La,v as vi,bH as Ni,S as wi,b3 as fn,bb as Ci,D as ki,a as Kt,bS as Si,bT as Va,T as ft,U as jt,$ as Ua,C as Nt,X as et,ai as Ei,c as Wa,a5 as Bn,H as Pn,bU as _i,aL as Ii,aA as ps,u as qa,w as ot,aW as Yt,J as Ka,bA as Ai,E as Ga,ao as gn,bB as Ti,_ as zn,R as Rn,o as Ye,q as Ve,f as Gs,bp as Oi,bq as Di,a1 as Fi,bV as Mi,n as Ja,bc as Js,y as Ha,a9 as Bi,t as Pi,bL as zi,bW as Ri,bX as $i,d as Hs,e as $n,be as Ya,F as Li,bY as Xa,K as bn,aw as Ps,bZ as as,b_ as Vi,b$ as Ui,P as Wi,a$ as qi,ad as Ki,bs as Gi,a8 as Ln,b5 as Vn,bu as Za,c0 as Ji,bJ as Hi,c1 as Yi}from"./icons-vtiX7BHn.js";import{D as Qa}from"./DraggableCrudTree-CyO8j1zi.js";import{T as ms}from"./TftCardTabs-DP2w7Gz4.js";import{a as Bt,U as Xi}from"./UiDataTable-BJzbkTin.js";import"./radix-ui-v9Pxfv0s.js";import"./ui-utils-BxIQ3qGg.js";import"./DragDropManager-KcuPnjwl.js";import"./treeHelpers-DUv_6quS.js";import"./react-hooks-rjLLAVfy.js";function Zi({mode:t,moreActionsOpen:s,onModeChange:n,onMoreActionsOpenChange:a,onSave:r,onManage:l,onAdvancedSettings:i,onDownload:c,onClear:d,onRunActions:u,onDryRun:h,onRunManually:m,portalContainer:y}){return e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{value:t,onValueChange:p=>n(p),children:[e.jsx(Me,{className:"h-6 w-20 text-xs bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200 border-zinc-200 dark:border-zinc-600","data-test":"capture-mode-select-v2",children:e.jsx(xt,{})}),e.jsxs(Be,{className:"bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200 border-zinc-200 dark:border-zinc-600","data-test":"capture-mode-options-v2",container:y,children:[e.jsx(he,{value:"mapped",className:"text-zinc-700 dark:text-zinc-200","data-test":"capture-mode-mapped-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ks,{className:"w-3 h-3"}),"Mapped"]})}),e.jsx(he,{value:"list",className:"text-zinc-700 dark:text-zinc-200","data-test":"capture-mode-list-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(La,{className:"w-3 h-3"}),"List"]})}),e.jsx(he,{value:"automationV2",className:"text-zinc-700 dark:text-zinc-200","data-test":"capture-mode-automation-v2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(vi,{className:"w-3 h-3"}),"Auto"]})})]})]}),e.jsxs(Fe,{open:s,onOpenChange:a,value:"",onValueChange:p=>{a(!1),p==="save"?r():p==="manage"?l():p==="advanced"?i():p==="download"?c():p==="clear"?d():p==="runActions"?u==null||u():p==="dryRun"?h==null||h():p==="runManually"&&(m==null||m())},children:[e.jsx(Me,{className:"h-6 w-6 px-0 border-0 shadow-none bg-transparent","data-test":"more-actions-select-v2",hideChevron:!0,children:e.jsx(Ni,{className:"w-4 h-4 text-zinc-500 dark:text-zinc-400"})}),e.jsxs(Be,{className:"bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200 border-zinc-200 dark:border-zinc-600","data-test":"more-actions-options-v2",container:y,children:[e.jsx(he,{value:"save",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-save-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(wi,{className:"w-3 h-3"}),"Quick Save"]})}),e.jsx(he,{value:"manage",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-manage-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fn,{className:"w-3 h-3"}),"Manage Saved Data"]})}),e.jsx(he,{value:"advanced",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-advanced-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ci,{className:"w-3 h-3"}),"Advanced Settings"]})}),e.jsx(he,{value:"download",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-download-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ki,{className:"w-3 h-3"}),"Download JSON"]})}),u&&e.jsx(he,{value:"runActions",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-run-actions-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Kt,{className:"w-3 h-3"}),"Run Actions"]})}),h&&e.jsx(he,{value:"dryRun",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-dry-run-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Si,{className:"w-3 h-3"}),"Dry Run"]})}),m&&e.jsx(he,{value:"runManually",className:"text-zinc-700 dark:text-zinc-200","data-test":"action-run-manually-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-3 h-3"}),"Run Manually"]})}),e.jsx(he,{value:"clear",className:"text-red-600 dark:text-red-400","data-test":"action-clear-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-3 h-3"}),"Clear Data"]})})]})]})]})}const Ne={50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",800:"#1f2937"},ut={100:"#dbeafe",500:"#3b82f6",600:"#2563eb",800:"#1e40af"},dn={100:"#e0e7ff",600:"#4f46e5"},Qe={100:"#dcfce7",200:"#bbf7d0",300:"#86efac",500:"#22c55e",600:"#16a34a",800:"#166534"},st={50:"#fef2f2",100:"#fee2e2",500:"#ef4444",600:"#dc2626"},Cs={100:"#fef9c3",300:"#fde047",400:"#facc15",700:"#a16207"},Qi={500:"#06b6d4"},eo={highlight:"#f800dd80"},$={primary:Ne[800],secondary:Ne[600],muted:Ne[500],placeholder:Ne[400],white:"#ffffff",danger:st[600]},oe={white:"#ffffff",paper:Ne[50],subtle:Ne[100],muted:Ne[200],primary:ut[500],primaryAlpha:"rgba(59, 130, 246, 0.1)",primaryLight:"rgba(59, 130, 246, 0.15)",whiteAlpha:"rgba(255, 255, 255, 0.8)",error:st[50],success:Qe[100],danger:st[100],secondary:Ne[200]},qe={default:Ne[300],light:Ne[200],primary:ut[500],error:st[500]},Pt={includedBg:Qe[100],includedBorder:Qe[500],excludedBg:st[100],excludedBorder:st[500],checkBg:Qe[500]},it={selectedBg:dn[100],checkBorder:dn[600],checkBg:dn[600],attrBg:ut[100],attrColor:ut[800]},It={errorBg:st[50],errorText:st[500],successBg:Qe[100],successText:Qe[600],neutralBg:Ne[100],neutralText:Ne[500]},Ot={selector:{bg:Cs[100],bgHover:Cs[300],border:Cs[400],text:Cs[700]},selectorEmpty:{bg:"hsl(var(--background))",bgHover:"hsl(var(--muted))",border:"hsl(var(--border))",text:"hsl(var(--muted-foreground))"},content:{bg:Qe[100],bgHover:Qe[200],border:Qe[300],text:Qe[800]}},Gt={outline:Qi[500],background:eo.highlight};oe.primaryAlpha;const $e={fieldName:ut[600],fieldNameUnderscore:ut[500],punctuation:Ne[800],collapsedLabel:Ne[400],nullValue:Ne[400],genericValue:Ne[500],arrayIndex:Ne[400]},_e={primary:ut[600],tabActiveBg:oe.white},ee={bg:oe.white,text:Ne[800],border:Ne[300],itemText:Ne[800],dangerText:st[600]},Te={muted:Ne[500],secondary:Ne[600],primary:ut[500],success:Qe[600],danger:st[600]},Ue={bg:oe.white,headerText:Ne[500],sectionBorder:Ne[200],emptyText:Ne[400]},$t={bg:Ne[50],border:Ne[300],borderError:st[500],text:Ne[800]},ct={outline:`2px solid ${Gt.outline}`,outlineOffset:"2px",background:Gt.background},yn={collapsed:12,expanded:50},to=250,so=1500,er=200,no=50,da=1,Ys=200,ao=50,ro=[{value:"string",label:"Text",icon:"T"},{value:"number",label:"Number",icon:"#"},{value:"boolean",label:"Boolean",icon:"?"},{value:"array",label:"Array",icon:"[]"},{value:"parentSelector",label:"Parent",icon:"{1}"},{value:"object",label:"Object",icon:"{}"}];function lo({isOpen:t,suggestedName:s,editingField:n,onSubmit:a,onCancel:r,portalContainer:l}){const[i,c]=o.useState(""),[d,u]=o.useState("string"),[h,m]=o.useState(""),[y,p]=o.useState(""),v=o.useRef(null),j=!!n;o.useEffect(()=>{t&&(n?(c(n.name),u(n.type),m(n.containerSelector||""),p(n.itemSelector||"")):(c(s),u("string"),m(""),p("")),setTimeout(()=>{var x;return(x=v.current)==null?void 0:x.focus()},100))},[t,s,n]);const f=()=>{const x={name:i.trim(),type:d};return d==="array"&&(h.trim()&&(x.containerSelector=h.trim()),y.trim()&&(x.itemSelector=y.trim())),x};o.useEffect(()=>{if(!t)return;const x=N=>{N.key==="Escape"?r():N.key==="Enter"&&i.trim()&&a(f())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[t,i,d,h,y,a,r]);const b=()=>{i.trim()&&a(f())};return e.jsx(Ge,{isVisible:t,onClose:r,title:j?"Update Field":"Add Field",shouldCloseManually:!0,initialPosition:{x:window.innerWidth/2-175,y:window.innerHeight/3},className:"!w-[350px]",portalContainer:l,children:e.jsxs("div",{className:"p-3","data-test":"field-dialog",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(De,{htmlFor:"field-name",className:"text-xs text-foreground font-medium",children:"Field Name"}),e.jsx(ke,{ref:v,id:"field-name",value:i,onChange:x=>c(x.target.value),placeholder:"e.g., title, author, description",className:"mt-1 text-foreground","data-test":"field-name-input"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(De,{className:"text-xs text-foreground font-medium",children:"Field Type"}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-1","data-test":"field-type-selector",children:ro.map(x=>e.jsxs("button",{type:"button",onClick:()=>u(x.value),onKeyDown:N=>{N.key==="Enter"&&(N.preventDefault(),N.stopPropagation(),u(x.value))},className:"flex flex-col items-center p-2 rounded border text-xs transition-colors",style:{borderColor:d===x.value?ut[500]:void 0,backgroundColor:d===x.value?oe.primaryLight:void 0,color:d===x.value?ut[500]:void 0,fontWeight:d===x.value?500:void 0},title:x.label,"data-test":"field-type","data-selected":d===x.value,children:[e.jsx("span",{className:"font-mono text-sm",children:x.icon}),e.jsx("span",{className:"text-[10px] mt-0.5",children:x.label})]},x.value))})]}),d==="array"&&e.jsxs("div",{className:"mb-4 space-y-3","data-test":"array-selectors",children:[e.jsxs("div",{children:[e.jsx(De,{htmlFor:"container-selector",className:"text-xs text-foreground font-medium",children:"Container Selector"}),e.jsx(ke,{id:"container-selector",value:h,onChange:x=>m(x.target.value),placeholder:"e.g., .item-list, #products",className:"mt-1 text-foreground font-mono text-xs","data-test":"container-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Parent element containing all items"})]}),e.jsxs("div",{children:[e.jsx(De,{htmlFor:"item-selector",className:"text-xs text-foreground font-medium",children:"Item Selector"}),e.jsx(ke,{id:"item-selector",value:y,onChange:x=>p(x.target.value),placeholder:"e.g., .item, > div",className:"mt-1 text-foreground font-mono text-xs","data-test":"item-selector-input"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Selector for each item (relative to container)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(re,{variant:"ghost",size:"sm",onClick:r,"data-test":"field-dialog-cancel",children:"Cancel"}),e.jsx(re,{size:"sm",onClick:b,disabled:!i.trim(),"data-test":"field-dialog-submit",children:j?"Update Field":"Add Field"})]})]})})}function io({isOpen:t,fieldName:s,values:n,onClose:a,onItemHover:r,onItemClick:l,portalContainer:i}){if(!t)return null;const c=d=>{if(d===null)return"null";if(d===void 0)return"undefined";if(typeof d=="string")return d;if(typeof d=="number"||typeof d=="boolean")return String(d);if(typeof d=="object")try{return JSON.stringify(d,null,2)}catch{return"[Object]"}return String(d)};return e.jsx(Ge,{isVisible:t,onClose:a,title:`Content: ${s}`,initialPosition:{x:window.innerWidth/2-200,y:100},initialSize:{width:400,height:300},portalContainer:i,resizable:!0,showPinButton:!1,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"content-popover-body-v2",style:{backgroundColor:Ue.bg},children:n.length===0?e.jsx("div",{className:"text-sm italic",style:{color:Ue.emptyText},"data-test":"content-popover-empty-v2",children:"No values extracted"}):n.length===1?e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words font-mono",style:{color:$.primary,backgroundColor:oe.paper,padding:"8px",borderRadius:"4px"},"data-test":"content-popover-single-value-v2",children:c(n[0])}):e.jsxs("div",{className:"space-y-2","data-test":"content-popover-values-list-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2",style:{color:$.muted},"data-test":"content-popover-count-v2",children:[n.length," values extracted"]}),n.map((d,u)=>e.jsxs("div",{className:"text-sm whitespace-pre-wrap break-words font-mono cursor-pointer transition-colors",style:{color:$.primary,backgroundColor:oe.paper,padding:"8px",borderRadius:"4px",borderLeft:`3px solid ${qe.primary}`},onMouseEnter:()=>r==null?void 0:r(u),onMouseLeave:()=>r==null?void 0:r(null),onClick:()=>l==null?void 0:l(u),"data-test":"content-popover-value-v2",children:[e.jsxs("span",{className:"text-xs font-medium mr-2",style:{color:$.muted},children:["[",u,"]"]}),c(d)]},u))]})})})}const oo=`{
  "champions": {
    "_container": "[data-test='tft-cards-v2']",
    "_item": ".rounded.text-white1",
    "cost": ".flex.items-end",
    "traits": ".absolute.text-lg",
    "type": ".bg-bg2.rounded-lg"
  }
}`;function co({isOpen:t,onImport:s,onClose:n,portalContainer:a}){const[r,l]=o.useState(""),[i,c]=o.useState(null),d=o.useRef(null),u=o.useCallback(p=>{var f;const v=(f=p.target.files)==null?void 0:f[0];if(!v)return;const j=new FileReader;j.onload=b=>{var x;try{const N=(x=b.target)==null?void 0:x.result;JSON.parse(N),l(N),c(null)}catch{c("File content is not valid JSON")}},j.readAsText(v),p.target.value=""},[]),h=()=>{if(c(null),!r.trim()){c("Please enter JSON");return}try{const p=JSON.parse(r);s(p),l(""),n()}catch(p){c(p instanceof Error?p.message:"Invalid JSON")}},m=()=>{l(""),c(null),n()},y=()=>{l(oo),c(null)};return t?e.jsx(Ge,{isVisible:t,onClose:m,title:"Import Schema",shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth/2-200,y:window.innerHeight/4},initialSize:{width:400,height:350},portalContainer:a,children:e.jsxs("div",{className:"flex flex-col h-full p-3 gap-3","data-test":"import-dialog-content-v2",children:[e.jsxs("div",{className:"flex gap-2","data-test":"import-example-buttons-v2",children:[e.jsx("button",{onClick:y,className:"text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:oe.subtle,color:$.secondary},"data-test":"import-example-v2",children:"Load Example"}),e.jsx("input",{ref:d,type:"file",accept:".json",onChange:u,className:"hidden","data-test":"import-upload-input-v2"}),e.jsxs("button",{onClick:()=>{var p;return(p=d.current)==null?void 0:p.click()},className:"flex items-center gap-1 text-xs px-2 py-1 rounded border transition-colors hover:bg-zinc-100",style:{color:$.muted,borderColor:$.muted},"data-test":"import-upload-button-v2",children:[e.jsx(jt,{className:"w-3 h-3"}),"Upload .json"]})]}),e.jsx("textarea",{autoFocus:!0,value:r,onChange:p=>{l(p.target.value),c(null)},placeholder:"Paste JSON selectors here...",className:"flex-1 min-h-0 p-2 text-xs font-mono rounded border resize-none",style:{backgroundColor:$t.bg,borderColor:i?$t.borderError:$t.border,color:$t.text},"data-test":"import-json-input-v2"}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded text-xs",style:{backgroundColor:It.errorBg,color:$.danger},"data-test":"import-error-v2",children:[e.jsx(Ua,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex justify-end gap-2","data-test":"import-actions-v2",children:[e.jsx(re,{variant:"outline",size:"sm",onClick:m,"data-test":"import-cancel-button-v2",children:"Cancel"}),e.jsxs(re,{size:"sm",onClick:h,className:"gap-1","data-test":"import-confirm-button-v2",children:[e.jsx(jt,{className:"w-3 h-3"}),"Import"]})]})]})}):null}function uo({isOpen:t,savedCaptures:s,onLoad:n,onRename:a,onDelete:r,onClose:l,portalContainer:i}){const[c,d]=o.useState(null),[u,h]=o.useState("");if(!t)return null;const m=f=>new Date(f).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=f=>{d(f.id),h(f.name)},p=()=>{c&&u.trim()&&(a(c,u.trim()),d(null),h(""))},v=()=>{d(null),h("")},j=f=>{f.key==="Enter"?p():f.key==="Escape"&&v()};return e.jsx(Ge,{isVisible:t,onClose:l,title:"Manage Saved Data",initialPosition:{x:window.innerWidth/2-225,y:100},initialSize:{width:450,height:400},resizable:!0,showPinButton:!1,portalContainer:i,children:e.jsx("div",{className:"p-3 h-full overflow-auto","data-test":"saved-data-manager-body",style:{backgroundColor:Ue.bg},children:s.length===0?e.jsx("div",{className:"text-sm italic text-center py-8",style:{color:Ue.emptyText},"data-test":"saved-data-manager-empty",children:"No saved captures yet"}):e.jsx("div",{className:"space-y-2","data-test":"saved-data-manager-list",children:[...s].sort((f,b)=>b.capturedAt-f.capturedAt).map(f=>e.jsx("div",{className:"flex items-center gap-2 p-2 rounded border",style:{backgroundColor:oe.paper,borderColor:qe.light},"data-test":"saved-capture-item",children:c===f.id?e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(ke,{value:u,onChange:b=>h(b.target.value),onKeyDown:j,className:"h-7 text-sm",autoFocus:!0,"data-test":"saved-capture-edit-input"}),e.jsx(re,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:p,"data-test":"saved-capture-edit-save",children:e.jsx(Nt,{className:"w-4 h-4",style:{color:Te.success}})}),e.jsx(re,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:v,"data-test":"saved-capture-edit-cancel",children:e.jsx(et,{className:"w-4 h-4",style:{color:Te.muted}})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",style:{color:$.primary},"data-test":"saved-capture-name",children:f.name}),e.jsx("div",{className:"text-xs",style:{color:$.placeholder},"data-test":"saved-capture-date",children:m(f.capturedAt)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>n(f.id),title:"Load","data-test":"saved-capture-load",children:e.jsx(Ei,{className:"w-4 h-4",style:{color:Te.primary}})}),e.jsx(re,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>y(f),title:"Rename","data-test":"saved-capture-rename",children:e.jsx(Wa,{className:"w-4 h-4",style:{color:Te.muted}})}),e.jsx(re,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>r(f.id),title:"Delete","data-test":"saved-capture-delete",children:e.jsx(ft,{className:"w-4 h-4",style:{color:Te.danger}})})]})]})},f.id))})})})}function ho({isOpen:t,preventDefaultOnInteraction:s,onPreventDefaultChange:n,continuousMode:a,onContinuousModeChange:r,onClose:l,portalContainer:i}){return t?e.jsx(Ge,{isVisible:t,onClose:l,title:"Advanced Settings",initialPosition:{x:window.innerWidth/2-175,y:150},initialSize:{width:350,height:260},resizable:!0,showPinButton:!1,portalContainer:i,children:e.jsxs("div",{className:"p-4 space-y-4","data-test":"advanced-settings-body",style:{backgroundColor:Ue.bg},children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-prevent-default",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(De,{htmlFor:"prevent-default",className:"text-sm font-medium",style:{color:$.primary},children:"Prevent default on interaction"}),e.jsx("p",{className:"text-xs",style:{color:$.muted},children:"Prevents clicks from triggering page actions during capture mode"})]}),e.jsx(Bs,{id:"prevent-default",checked:s,onCheckedChange:n,"data-test":"prevent-default-switch"})]}),e.jsxs("div",{className:"flex items-center justify-between","data-test":"setting-continuous-mode",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(De,{htmlFor:"continuous-mode",className:"text-sm font-medium",style:{color:$.primary},children:"Continuous capture mode"}),e.jsx("p",{className:"text-xs",style:{color:$.muted},children:"Auto-advance to next empty field after capturing a selector"})]}),e.jsx(Bs,{id:"continuous-mode",checked:a,onCheckedChange:r,"data-test":"continuous-mode-switch"})]})]})}):null}const ks={single:t=>`:nth-of-type(${t+1})`,from:t=>`[${t}:]`,to:t=>`[:${t}]`,range:(t,s)=>`[${t}:${s}]`},ua={nthOfType:/:nth-of-type\((\d+)\)$/,bracket:/\[(\d*)(:)?(\d*)?\]$/};function wt(t){const s=t.trim(),n=s.match(ua.nthOfType);if(n){const p=s.slice(0,-n[0].length);if(p)return{selector:p,indexSpec:{type:"single",index:parseInt(n[1],10)-1}}}const a=s.match(ua.bracket);if(!a)return{selector:s,indexSpec:null};const[r,l,i,c]=a,d=i===":",u=s.slice(0,-r.length);if(u==="")return{selector:s,indexSpec:null};const h=r.slice(1,-1);if(!/^(\d*):?(\d*)$/.test(h))return{selector:s,indexSpec:null};const m=u;let y;if(d)if(l&&c)y={type:"range",start:parseInt(l,10),end:parseInt(c,10)};else if(l)y={type:"from",start:parseInt(l,10)};else if(c)y={type:"to",end:parseInt(c,10)};else return{selector:s,indexSpec:null};else{if(l==="")return{selector:s,indexSpec:null};y={type:"single",index:parseInt(l,10)}}return{selector:m,indexSpec:y}}function Ke(t,s){if(!s)return t;switch(s.type){case"single":return`${t}${ks.single(s.index)}`;case"from":return`${t}${ks.from(s.start)}`;case"to":return`${t}${ks.to(s.end)}`;case"range":return`${t}${ks.range(s.start,s.end)}`}}function tr(t,s){if(!s)return t;switch(s.type){case"single":{const n=t[s.index];return n?[n]:[]}case"from":return t.slice(s.start);case"to":return t.slice(0,s.end);case"range":return t.slice(s.start,s.end)}}function jn(t,s,n){const[a,r]=t<=s?[t,s]:[s,t];return a===0&&r===n-1?null:a===r?{type:"single",index:a}:a===0?{type:"to",end:r+1}:r===n-1?{type:"from",start:a}:{type:"range",start:a,end:r+1}}function Un(t){if(!t)return"all";switch(t.type){case"single":return`[${t.index}]`;case"from":return`[${t.start}:]`;case"to":return`[:${t.end}]`;case"range":return`[${t.start}:${t.end}]`}}function sr(t,s,n){if(!s)return!1;switch(s.type){case"single":return t===s.index;case"from":return t>=s.start&&t<n;case"to":return t>=0&&t<s.end;case"range":return t>=s.start&&t<s.end}}function nr(t){return t?t.type!=="single":!1}function ye(t){return typeof t=="object"&&t!==null&&"selector"in t&&typeof t.selector=="string"}function xs(t){let s=t,n,a;const r=s.match(/@text\[(\d+)\]$/);if(r)a=parseInt(r[1],10),s=s.slice(0,-r[0].length);else{const i=s.match(/@([a-zA-Z0-9-_]+)$/);i&&(n=i[1],s=s.slice(0,-i[0].length))}const l=wt(s);return{selector:l.selector,index:l.indexSpec,extractAttribute:n,textNodeIndex:a}}function Wn(t){let s=Ke(t.selector,t.index);return t.textNodeIndex!==void 0?s+=`@text[${t.textNodeIndex}]`:t.extractAttribute&&(s+=`@${t.extractAttribute}`),s}function Xs(t){return ye(t)?t:xs(t)}function we(t){return typeof t=="string"?t:Wn(t)}function fs(t){if(typeof t=="string"){let s=t.replace(/@text\[\d+\]$/,"");const n=s.lastIndexOf("@");return n>0?s.substring(0,n):s}return Ke(t.selector,t.index)}function He(t){return typeof t=="object"&&t!==null&&"operator"in t&&"conditions"in t&&Array.isArray(t.conditions)}function is(t){return typeof t=="string"&&t.length>0||He(t)?!0:typeof t=="object"&&t!==null&&"selector"in t&&"condition"in t&&typeof t.selector=="string"&&["exists","text","html"].includes(t.condition)}function Zs(t){if(typeof t!="object"||t===null)return!1;for(const s of Object.values(t)){if(typeof s!="object"||s===null||!("match"in s))return!1;const n=s.match;if(typeof n!="string"&&!Array.isArray(n))return!1}return!0}function vn(t,s){var r;const n=typeof t=="string"?{selector:t,condition:"exists"}:t,a=s.querySelector(n.selector);switch(n.condition){case"exists":return a?"true":"false";case"text":return((r=a==null?void 0:a.textContent)==null?void 0:r.trim())??"";case"html":return(a==null?void 0:a.innerHTML)??""}}function Xt(t,s){return He(t)?{values:t.conditions.map(a=>vn(a,s)),operator:t.operator}:{values:[vn(t,s)],operator:"SINGLE"}}function ha(t){let s=t;t.startsWith("/")&&t.endsWith("/")&&(s=t.slice(1,-1));try{return new RegExp(s)}catch{return console.warn(`[CustomCapture] Invalid regex pattern: ${t}`),null}}function qn(t,s){for(const[n,a]of Object.entries(t)){const r=Array.isArray(a.match)?a.match:null,l=r?null:ha(a.match);let i=!1;if(r){const c=s.values.map((d,u)=>{const h=r[u]??r[r.length-1]??"/./",m=ha(h);return m?m.test(d):!1});s.operator==="AND"?i=c.every(Boolean):s.operator==="OR"?i=c.some(Boolean):i=c[0]??!1}else l&&(s.operator==="AND"?i=s.values.every(c=>l.test(c)):s.operator==="OR"?i=s.values.some(c=>l.test(c)):i=l.test(s.values[0]));if(i)return{branchKey:n,branch:a}}return null}function Nn(t){return"_branchFields"in t&&Array.isArray(t._branchFields)&&"_activeBranch"in t&&typeof t._activeBranch=="number"&&"_branches"in t&&typeof t._branches=="object"&&t._branches!==null}function po(t,s,n){var r;const a=((r=t.textContent)==null?void 0:r.trim())??"";switch(n){case"exact":return a===s;case"contains":return a.includes(s);case"regex":try{return new RegExp(s).test(a)}catch{return!1}default:return!1}}function zt(t,s){if(!t||!t.matches(s.selector))return!1;if(s.textContent&&s.textContent.trim()!==""){const n=s.textMatchMode??"contains";return po(t,s.textContent,n)}return!0}function mo(t,s){switch(s.type){case"previous-sibling":{const n=t.previousElementSibling;return zt(n,s)?n:null}case"next-sibling":{const n=t.nextElementSibling;return zt(n,s)?n:null}case"closest-sibling-before":{let n=t.previousElementSibling;for(;n;){if(zt(n,s))return n;n=n.previousElementSibling}return null}case"closest-sibling-after":{let n=t.nextElementSibling;for(;n;){if(zt(n,s))return n;n=n.nextElementSibling}return null}case"closest-sibling":{let n=t.previousElementSibling,a=t.nextElementSibling;for(;n||a;){if(n){if(zt(n,s))return n;n=n.previousElementSibling}if(a){if(zt(a,s))return a;a=a.nextElementSibling}}return null}default:return null}}function ar(t,s){return mo(t,s)!==null}function zs(t,s){return s?t.filter(n=>ar(n,s)):t}function xo(t){const s=t.lastIndexOf("@");return s>0?t.substring(0,s):t}function Jt(t,s=document){const n=xo(t),{selector:a,indexSpec:r}=wt(n),l=Array.from(s.querySelectorAll(a));return tr(l,r)}function rr(t,s=document){return Jt(t,s)[0]??null}const fo=Object.freeze(Object.defineProperty({__proto__:null,applyIndexSpec:tr,applySiblingFilter:zs,buildIndexedSelector:Ke,createRangeIndexSpec:jn,elementPassesSiblingFilter:ar,evaluateConditions:Xt,evaluateIfCondition:vn,findMatchingBranch:qn,formatIndexSpec:Un,getCssSelectorOnly:fs,getSelectorString:we,hasBranchingConfig:Nn,isBranches:Zs,isCompoundCondition:He,isIfCondition:is,isIndexInSpec:sr,isRangeSpec:nr,isSelectorField:ye,normalizeSelectorValue:Xs,parseIndexedSelector:wt,querySelectorOneWithIndex:rr,querySelectorWithIndex:Jt,toSelectorField:xs,toSelectorString:Wn},Symbol.toStringTag,{value:"Module"}));function gs(t){return t.type==="element"}function Es(t){return t.type==="text"}function rs(t){var a;const s=((a=t.textContent)==null?void 0:a.trim())??"",n=s.length>97?s.slice(0,97)+"...":s;return{type:"element",tag:t.tagName.toLowerCase(),classes:Array.from(t.classList),id:t.id||null,textContent:n,element:t}}function go(t,s,n){var l;const a=((l=t.textContent)==null?void 0:l.trim())??"";return{type:"text",textContent:a.length>97?a.slice(0,97)+"...":a,parentElement:s,nodeIndex:n,textNode:t}}function bo(t){var a;const s=[];let n=0;for(const r of t.childNodes)r.nodeType===Node.ELEMENT_NODE?s.push(rs(r)):r.nodeType===Node.TEXT_NODE&&((a=r.textContent)!=null&&a.trim())&&(s.push(go(r,t,n)),n++);return s}function _s(t,s=document){var n;if(!t||t.trim()==="")return null;try{const a=fs(t),r=wt(a),l=r.selector,i=((n=r.indexSpec)==null?void 0:n.type)==="single"?r.indexSpec.index:null,c=Array.from(s.querySelectorAll(l));if(c.length===0)return null;const d=i??0,u=c[d]??c[0],h=c.length,m=c.map(rs),y=u.parentElement;if(!y)return{parent:null,siblings:[rs(u)],capturedIndex:0,selector:t,baseSelector:l,matchIndex:d,matchCount:h,matches:m};const p=bo(y),v=p.findIndex(j=>gs(j)&&j.element===u);return{parent:rs(y),siblings:p,capturedIndex:v>=0?v:0,selector:t,baseSelector:l,matchIndex:d,matchCount:h,matches:m}}catch{return null}}function yo(t,s){const n=t.split("."),a=n[n.length-1];if(a==="_if"||a==="_container"||a==="_item")return[];let r=s,l=null,i=null,c=!1;for(let m=0;m<n.length;m++){const y=n[m];if(typeof r!="object"||r===null)break;const p=r;if(!(y in p))break;if(r=p[y],typeof r=="object"&&r!==null){const v=r;if("_container"in v){const j=v._container,f="_item"in v?v._item:"",b=typeof j=="string"?j:(j==null?void 0:j.selector)??"",x=typeof f=="string"?f:(f==null?void 0:f.selector)??"";b&&(l=b,x?(i=x,c=!1):(i=null,c=!0))}}}if(!l)return[];const d=l.endsWith("[]")?l.slice(0,-2):l,u=Array.from(document.querySelectorAll(d));if(u.length===0)return[];const h=[];for(const m of u)if(c||!i)h.push(m);else{const y=Array.from(m.querySelectorAll(i));h.push(...y)}return h}function jo({baseSelector:t,totalCount:s,currentIndexSpec:n,onSelectorChange:a}){const[r,l]=o.useState(!1),[i,c]=o.useState(null),d=o.useCallback(()=>{l(p=>!p),c(null)},[]),u=o.useCallback(()=>{c(null)},[]),h=o.useCallback((p,v)=>{if(v&&(n==null?void 0:n.type)==="single"){const b=jn(n.index,p,s),x=Ke(t,b);a(x,b);return}if(r){if(i===null)c(p);else{const b=jn(i,p,s),x=Ke(t,b);a(x,b),c(null),l(!1)}return}const j={type:"single",index:p},f=Ke(t,j);a(f,j)},[r,i,t,s,n,a]),m=o.useCallback(p=>{const v=wt(p);a(p,v.indexSpec)},[a]),y=r&&i!==null?`[${i}:?]`:null;return{isRangeMode:r,toggleRangeMode:d,rangeStartIndex:i,handleMatchClick:h,handleTextInput:m,resetRangeSelection:u,pendingRangeDisplay:y}}function Kn(t){const s=[t.tag];if(t.id&&s.push(`#${t.id}`),t.classes.length>0){const n=t.classes.slice(0,3);s.push(`.${n.join(".")}`),t.classes.length>3&&s.push(`+${t.classes.length-3}`)}return s.join("")}function vo(t){return`@text[${t.nodeIndex}]`}function No(t){return Es(t)?vo(t):Kn(t)}function lr(t,s=30){return t.length<=s?t:t.slice(0,s)+"..."}function wo({domContext:t,previousChildIndex:s,onSiblingClick:n,onSiblingHover:a,onAddIndex:r,onChildClick:l,onTextNodeClick:i,onTextNodeHover:c}){const d=()=>{if(s==null)return null;const m=t.siblings[t.capturedIndex];if(!m||!gs(m))return null;const y=m.element.children;return s>=y.length?null:y[s]},u=(m,y)=>{Es(y)?i==null||i(m,y):n(m,y)},h=m=>{m&&Es(m)?c==null||c(m):a(m)};return e.jsxs("div",{className:"flex-1 min-h-0 overflow-auto","data-test":"dom-tree-siblings-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Siblings (",t.siblings.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.siblings.map((m,y)=>{const p=y===t.capturedIndex,v=Es(m),j=p&&!v?d():null,f=j?rs(j):null;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsxs("button",{onClick:()=>u(y,m),onMouseEnter:()=>h(m),onMouseLeave:()=>h(null),className:`flex-1 text-left p-2 rounded text-sm font-mono transition-colors ${v?"bg-purple-50 hover:bg-purple-100 border border-purple-200":p?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100 border border-transparent"}`,"data-test":v?"dom-tree-text-node-v2":p?"dom-tree-sibling-captured-v2":"dom-tree-sibling-v2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:["[",y,"]"]}),v&&e.jsx(Bn,{className:"w-3.5 h-3.5 text-purple-500"}),e.jsx("span",{className:v?"text-purple-700 italic":p?"text-blue-700":"text-gray-700",children:No(m)}),p&&!v&&e.jsx("span",{className:"text-xs text-blue-500",children:"← captured"})]}),m.textContent&&e.jsxs("div",{className:`text-xs mt-0.5 truncate ${v?"text-purple-400":"text-gray-400"}`,children:['"',lr(m.textContent),'"']})]}),p&&r&&t.matchCount>1&&e.jsxs("button",{onClick:b=>r(b,t.matchIndex),className:"shrink-0 mt-2 px-1.5 py-0.5 text-xs bg-amber-100 text-amber-700 hover:bg-amber-200 rounded transition-colors flex items-center gap-0.5",title:`Add [${t.matchIndex}] index to selector (${t.matchCount} matches)`,"data-test":"dom-tree-add-index-v2",children:[e.jsx(Pn,{className:"w-3 h-3"}),"[",t.matchIndex,"] of ",t.matchCount]})]}),p&&f&&l&&e.jsxs("div",{className:"ml-4 mt-1 pl-3 border-l-2 border-blue-300","data-test":"dom-tree-previous-child-v2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-400 mb-1",children:"Previous selection - click to go back"}),e.jsxs("button",{onClick:()=>l(s,j),onMouseEnter:()=>a(f),onMouseLeave:()=>a(null),className:"w-full text-left p-2 rounded text-sm font-mono bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-colors flex items-center gap-2","data-test":"dom-tree-previous-child-row-v2",children:[e.jsx(_i,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-blue-600",children:Kn(f)})]})]})]},y)})})]})}function Co({currentSelector:t,baseSelector:s,currentIndexSpec:n,isRangeMode:a,pendingRangeDisplay:r,onToggleRangeMode:l,onTextInput:i}){const[c,d]=o.useState(!1),[u,h]=o.useState(t),m=o.useRef(!0);o.useEffect(()=>{c||h(t)},[t,c]);const y=o.useCallback(()=>{d(!0),m.current=!0},[]),p=o.useCallback(()=>{d(!1),m.current&&u!==t&&i(u),m.current=!0},[u,t,i]),v=o.useCallback(f=>{h(f.target.value)},[]),j=o.useCallback(f=>{f.key==="Enter"?f.currentTarget.blur():f.key==="Escape"&&(m.current=!1,h(t),f.currentTarget.blur())},[t]);return e.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2 space-y-2","data-test":"index-range-controls",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Current index:"}),e.jsx("span",{className:"font-mono text-amber-600 font-medium",children:r??Un(n)})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"selector-text-input",children:[e.jsx(La,{className:"w-3.5 h-3.5 text-gray-400 shrink-0"}),e.jsx("input",{type:"text",value:u,onChange:v,onFocus:y,onBlur:p,onKeyDown:j,className:"flex-1 text-xs font-mono px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-amber-400 focus:border-amber-400",placeholder:"e.g., .selector[1:3]","data-test":"selector-input"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:l,className:`flex items-center gap-1.5 px-2 py-1 text-xs rounded transition-colors ${a?"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,"data-test":"range-mode-toggle",children:[e.jsx(Ii,{className:"w-3.5 h-3.5"}),a?"Range Mode ON":"Range Mode"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",title:"Hold Shift and click another match to create a range from current selection",children:[e.jsx(ps,{className:"w-3 h-3"}),e.jsx("span",{children:"Shift+click for range"})]})]}),a&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded","data-test":"range-mode-instructions",children:r?`Click end index to complete range ${r}`:"Click start index, then click end index"})]})}function ko({matches:t,selector:s,baseSelector:n,currentIndexSpec:a,isRangeMode:r,rangeStartIndex:l,pendingRangeDisplay:i,onMatchClick:c,onMatchHover:d,onMatchIndexHover:u,onToggleRangeMode:h,onTextInput:m,onSelectorChange:y}){return t.length<=1?null:e.jsxs("div",{className:"mt-3 pt-3 border-t-2 border-dashed border-amber-300","data-test":"dom-tree-matches-v2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pn,{className:"w-3.5 h-3.5 text-amber-600"}),e.jsxs("span",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:["Switch Index (",t.length," matches)"]}),r&&e.jsx("span",{className:"text-xs bg-amber-500 text-white px-1.5 py-0.5 rounded","data-test":"range-mode-badge",children:"RANGE"}),e.jsx("div",{className:"ml-auto flex items-center text-gray-400 hover:text-gray-600 cursor-help",title:`Index Selection:
• Click: select single index [n]
• Shift+click: select range from current
• Range Mode: click start, then end

Range Syntax:
• [0] - first match only
• [1:] - all except first
• [:2] - first two matches
• [1:3] - second and third`,"data-test":"index-help-icon",children:e.jsx(ps,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-40 overflow-y-auto",children:t.map((p,v)=>{const j=sr(v,a,t.length),f=nr(a),b=r&&l===v;return e.jsxs("button",{onClick:x=>c(v,p,x.shiftKey),onMouseEnter:()=>{u?u(v):d(p)},onMouseLeave:()=>{u?u(null):d(null)},className:`px-2 py-1 rounded text-xs font-mono transition-all ${b?"bg-green-500 text-white font-bold shadow-sm ring-2 ring-green-300":f&&j?"bg-purple-500 text-white font-bold shadow-sm":j?"bg-amber-500 text-white font-bold shadow-sm":"bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200"}`,"data-test":"dom-tree-match-item-v2","data-in-range":j?"true":void 0,"data-range-start":b?"true":void 0,title:b?"Range start - click another to complete":lr(p.textContent,60),children:["[",v,"]"]},v)})}),y&&e.jsx(Co,{currentSelector:s,baseSelector:n,currentIndexSpec:a,isRangeMode:r,pendingRangeDisplay:i,onToggleRangeMode:h,onTextInput:m})]})}function So({initialSelector:t,onApply:s,portalContainer:n}){const[a,r]=o.useState(()=>[{id:crypto.randomUUID(),value:t||"",isSelected:!0,matchCount:0,isValid:!0}]),l=o.useRef([]),i=o.useRef(null),[c,d]=o.useState(null),u=o.useCallback(()=>{l.current.forEach(g=>{g.style.outline="",g.style.outlineOffset="",g.style.background=""}),l.current=[]},[]);o.useEffect(()=>()=>{u(),i.current&&clearTimeout(i.current)},[u]);const h=o.useCallback(g=>{if(!g.trim())return{count:0,isValid:!0};if(g.startsWith(":scope"))return{count:0,isValid:!0};try{return{count:document.querySelectorAll(g).length,isValid:!0}}catch{return{count:0,isValid:!1}}},[]);o.useEffect(()=>{r(g=>g.map(w=>{if(w.value.trim()){const E=h(w.value);return{...w,matchCount:E.count,isValid:E.isValid}}return w}))},[h]);const m=o.useCallback(g=>{if(u(),!g.trim())return{count:0,isValid:!0};if(g.startsWith(":scope"))return{count:0,isValid:!0};try{const w=document.querySelectorAll(g);return w.forEach(E=>{const k=E;k.style.outline=ct.outline,k.style.outlineOffset=ct.outlineOffset,k.style.background=ct.background,l.current.push(k)}),{count:w.length,isValid:!0}}catch{return{count:0,isValid:!1}}},[u]),y=o.useCallback((g,w)=>{r(E=>E.map(k=>k.id===g?{...k,value:w}:k)),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{const E=m(w);r(k=>k.map(T=>T.id===g?{...T,matchCount:E.count,isValid:E.isValid}:T))},150)},[m]),p=o.useCallback(g=>{const w=a.find(E=>E.id===g);if(w){const E=m(w.value);r(k=>k.map(T=>T.id===g?{...T,matchCount:E.count,isValid:E.isValid}:T))}},[a,m]),v=o.useCallback(g=>{r(w=>w.map(E=>({...E,isSelected:E.id===g})))},[]),j=o.useCallback(()=>{r(g=>[...g,{id:crypto.randomUUID(),value:"",isSelected:!1,matchCount:0,isValid:!0}])},[]),f=o.useCallback(g=>{r(w=>{var k;if(w.length<=1)return w;const E=w.filter(T=>T.id!==g);return(k=w.find(T=>T.id===g))!=null&&k.isSelected&&E.length>0&&(E[0].isSelected=!0),E})},[]),b=o.useCallback(()=>{const g=a.find(w=>w.isSelected);g!=null&&g.value.trim()&&(u(),s(g.value.trim()))},[a,s,u]),x=o.useCallback(g=>{const w=a.find(E=>E.id===g);if(w!=null&&w.value.trim()){try{const E=document.querySelector(w.value.trim());if(!E)return;const k=[];for(const T of Array.from(E.attributes))if(T.name==="class"){const B=T.value.split(/\s+/).filter(P=>P&&/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(P)).slice(0,6);k.push(B.map(P=>`.${P}`).join(""))}else T.name==="id"&&k.push(`#${T.value}`);if(k.length>0){const T=k.join("");r(B=>B.map(P=>P.id===g?{...P,value:T}:P)),setTimeout(()=>{const B=m(T);r(P=>P.map(_=>_.id===g?{..._,matchCount:B.count,isValid:B.isValid}:_))},50)}}catch{}d(null)}},[a,m]),N=a.find(g=>g.isSelected);return e.jsxs("div",{className:"p-3 h-full flex flex-col",style:{backgroundColor:Ue.bg},"data-test":"custom-selector-content",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:Ue.headerText},children:"Custom Selectors - type CSS selectors to test"}),e.jsx("div",{className:"flex-1 overflow-auto space-y-2","data-test":"custom-selector-inputs",children:a.map(g=>e.jsxs("div",{className:"flex items-start gap-2","data-test":"custom-selector-row",children:[e.jsx("button",{onClick:()=>v(g.id),className:"mt-2 w-4 h-4 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors",style:{borderColor:g.isSelected?qe.primary:qe.default,backgroundColor:g.isSelected?oe.primary:"transparent"},title:"Select this selector","data-test":"custom-selector-radio",children:g.isSelected&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:oe.white}})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(di,{value:g.value,onChange:w=>y(g.id,w.target.value),onFocus:()=>p(g.id),placeholder:"Enter CSS selector...",rows:2,className:"text-xs font-mono resize-none p-1",style:{borderColor:g.isValid?g.isSelected?qe.primary:qe.default:qe.error,minHeight:"64px"},"data-test":"custom-selector-input"})}),e.jsx("div",{className:"mt-2 px-2 py-0.5 rounded text-xs shrink-0",style:{backgroundColor:g.isValid?g.matchCount>0?It.successBg:It.neutralBg:It.errorBg,color:g.isValid?g.matchCount>0?It.successText:It.neutralText:It.errorText},"data-test":"custom-selector-count",children:g.isValid?g.matchCount===1?"1 match":`${g.matchCount} matches`:"invalid"}),e.jsxs(Fe,{open:c===g.id,onOpenChange:w=>d(w?g.id:null),value:"",onValueChange:w=>{switch(d(null),w){case"delete":f(g.id);break;case"list-attributes":x(g.id);break}},children:[e.jsx(Me,{className:"mt-2 h-6 w-6 px-0 border-0 shadow-none shrink-0",style:{backgroundColor:"transparent",cursor:"pointer"},"data-test":"custom-selector-menu",hideChevron:!0,children:e.jsx(qa,{className:"w-3 h-3",style:{color:Te.muted}})}),e.jsxs(Be,{style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border,cursor:"auto",pointerEvents:"auto"},"data-test":"custom-selector-menu-options",container:n,children:[e.jsx(he,{value:"list-attributes",style:{color:ee.itemText,cursor:"pointer",pointerEvents:"auto"},disabled:!g.value.trim()||!g.isValid||g.matchCount===0,"data-test":"custom-selector-action-list",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(Ks,{className:"w-3 h-3"}),"List attributes"]})}),e.jsx(he,{value:"delete",style:{color:a.length<=1?qe.default:ee.dangerText,cursor:"pointer",pointerEvents:"auto"},disabled:a.length<=1,"data-test":"custom-selector-action-delete",children:e.jsxs("span",{className:"flex items-center gap-2",style:{pointerEvents:"none"},children:[e.jsx(ft,{className:"w-3 h-3"}),"Delete"]})})]})]})]},g.id))}),e.jsxs("button",{onClick:j,className:"mt-2 flex items-center gap-1 text-xs py-1 px-2 rounded transition-colors self-start",style:{color:Te.primary},"data-test":"custom-selector-add",children:[e.jsx(ot,{className:"w-3 h-3"}),"Add selector"]}),e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:Ue.sectionBorder},children:e.jsxs(re,{onClick:b,disabled:!(N!=null&&N.value.trim())||!(N!=null&&N.isValid),className:"w-full",size:"sm","data-test":"custom-selector-apply",children:[e.jsx(Nt,{className:"w-3 h-3 mr-1"}),"Apply Selected"]})})]})}function Eo({isOpen:t,fieldPath:s,domContext:n,initialSelector:a,previousChildIndex:r,onSelectParent:l,onSelectSibling:i,onSelectChild:c,onSelectMatch:d,onAddIndex:u,onRevert:h,onClearSelector:m,onClose:y,onSelectorChange:p,onApplyCustomSelector:v,onMatchIndexHover:j,onTextNodeClick:f,portalContainer:b}){const[x,N]=o.useState("tree"),g=o.useRef(null),w=o.useRef(null),E=n!=null&&n.selector?wt(n.selector).indexSpec:null,{isRangeMode:k,toggleRangeMode:T,rangeStartIndex:B,handleMatchClick:P,handleTextInput:_,pendingRangeDisplay:I}=jo({baseSelector:(n==null?void 0:n.baseSelector)??"",totalCount:(n==null?void 0:n.matches.length)??0,currentIndexSpec:E,onSelectorChange:p??(()=>{})});o.useEffect(()=>{t&&N("tree")},[t]);const C=o.useCallback(()=>{var Y;if(g.current&&(g.current.style.outline="",g.current.style.outlineOffset="",g.current.style.background="",g.current=null),w.current){const{element:ne,originalBg:Q,originalOutline:X}=w.current;ne.style.background=Q,ne.style.outline=X,w.current=null}(Y=window.getSelection())==null||Y.removeAllRanges()},[]),S=o.useCallback(Y=>{Y!=null&&Y.isConnected&&(C(),g.current=Y,Y.style.outline=ct.outline,Y.style.outlineOffset=ct.outlineOffset,Y.style.background=ct.background)},[C]);o.useEffect(()=>{t||C()},[t,C]),o.useEffect(()=>{if(!t)return;const Y=ne=>{ne.key==="Escape"&&y()};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[t,y]);const A=o.useCallback(Y=>{var ne;(ne=Y==null?void 0:Y.element)!=null&&ne.isConnected?S(Y.element):C()},[S,C]),R=o.useCallback(Y=>{var ne;C(),Y&&gs(Y)&&(ne=Y.element)!=null&&ne.isConnected&&S(Y.element)},[C,S]),L=o.useCallback(Y=>{if(C(),!Y)return;const ne=window.getSelection();if(ne){const Q=document.createRange();Q.selectNodeContents(Y.textNode),ne.removeAllRanges(),ne.addRange(Q)}},[C]),W=o.useCallback(Y=>{j&&(n!=null&&n.baseSelector)&&j(n.baseSelector,Y)},[j,n==null?void 0:n.baseSelector]),D=o.useCallback(()=>{!(n!=null&&n.parent)||!l||(C(),l(n.parent.element))},[C,l,n==null?void 0:n.parent]),H=o.useCallback((Y,ne)=>{C(),i(Y,ne.element)},[C,i]),Z=o.useCallback((Y,ne)=>{Y.stopPropagation(),u==null||u(ne)},[u]),le=o.useCallback((Y,ne,Q)=>{C(),p?P(Y,Q):d==null||d(Y)},[C,d,p,P]),fe=o.useCallback((Y,ne)=>{C(),c==null||c(Y,ne)},[C,c]);if(!t)return null;const je=a&&(n==null?void 0:n.selector)&&a!==n.selector,ae=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex rounded overflow-hidden border",style:{borderColor:qe.default},"data-test":"dom-tree-view-toggle",children:[e.jsx("button",{onClick:()=>N("tree"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:x==="tree"?oe.primary:oe.white,color:x==="tree"?$.white:$.muted},title:"DOM Tree View","data-test":"dom-tree-view-tree",children:e.jsx(Yt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>N("custom"),className:"px-2 py-1 flex items-center gap-1 text-xs transition-colors",style:{backgroundColor:x==="custom"?oe.primary:oe.white,color:x==="custom"?$.white:$.muted},title:"Custom Selector View","data-test":"dom-tree-view-custom",children:e.jsx(Ka,{className:"w-3 h-3"})})]}),x==="tree"&&je&&h&&e.jsx("button",{onClick:h,className:"p-1 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:`Revert to: ${a}`,"data-test":"dom-tree-revert-v2",children:e.jsx(Ai,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m,className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"Clear Selector","data-test":"dom-tree-clear-selector-v2",children:e.jsx(ft,{className:"w-4 h-4"})})]});return e.jsxs(Ge,{isVisible:t,onClose:y,title:`DOM Tree: ${s}`,shouldCloseManually:!0,resizable:!0,initialPosition:{x:window.innerWidth-490,y:120},initialSize:{width:450,height:600},showPinButton:!1,headerActions:ae,portalContainer:b,children:[x==="tree"&&e.jsx("div",{className:"flex flex-col h-full p-2","data-test":"dom-tree-popover-v2",children:n?e.jsxs(e.Fragment,{children:[n.itemStats&&n.itemStats.totalItems>1&&e.jsxs("div",{className:"mb-3 p-2 rounded text-xs flex items-center gap-2",style:{backgroundColor:n.itemStats.itemsWithMatch<n.itemStats.totalItems?"#fef3c7":"#d1fae5",color:n.itemStats.itemsWithMatch<n.itemStats.totalItems?"#92400e":"#065f46"},"data-test":"dom-tree-item-stats-v2",children:[e.jsxs("span",{className:"font-medium",children:["Found in ",n.itemStats.itemsWithMatch," of ",n.itemStats.totalItems," items"]}),n.itemStats.itemsWithMatch<n.itemStats.totalItems&&e.jsxs("span",{className:"opacity-75",children:["(showing item #",n.itemStats.displayedItemIndex+1,")"]})]}),n.parent&&e.jsxs("div",{className:"mb-3","data-test":"dom-tree-parent-v2",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-1",children:["Parent ",l&&"- click to select"]}),e.jsx("button",{onClick:D,onMouseEnter:()=>A(n.parent),onMouseLeave:()=>A(null),className:"w-full text-left text-sm font-mono bg-gray-100 p-2 rounded cursor-pointer hover:bg-gray-200 transition-colors","data-test":"dom-tree-parent-row-v2",children:Kn(n.parent)})]}),e.jsx(wo,{domContext:n,previousChildIndex:r,onSiblingClick:H,onSiblingHover:R,onAddIndex:u?Z:void 0,onChildClick:c?fe:void 0,onTextNodeClick:f,onTextNodeHover:L}),(d||p)&&e.jsx(ko,{matches:n.matches,selector:n.selector,baseSelector:n.baseSelector,currentIndexSpec:E,isRangeMode:k,rangeStartIndex:B,pendingRangeDisplay:I,onMatchClick:le,onMatchHover:A,onMatchIndexHover:j?W:void 0,onToggleRangeMode:T,onTextInput:_,onSelectorChange:p})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No DOM context available"})}),x==="custom"&&v&&e.jsx(So,{initialSelector:(n==null?void 0:n.selector)??a??void 0,onApply:v,portalContainer:b})]})}function _o({node:t,includeInnerText:s,selected:n,onNodeClick:a,onToggleHidden:r}){var u,h,m;const l=(u=t.data)==null?void 0:u.isInnerText,i=(h=t.data)==null?void 0:h.isAttribute,c=(m=t.data)==null?void 0:m.isValue;let d=!1;return l?d=s:i&&(d=n.has(t.id)),c?e.jsx("div",{className:"flex items-center py-1 px-2 ml-6",style:{color:$.muted},"data-test":"attribute-value-v2",children:e.jsxs("span",{className:"text-xs font-mono truncate",title:t.label,children:['"',t.label,'"']})}):e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100 group",style:{backgroundColor:d?it.selectedBg:"transparent"},onClick:()=>a(t),"data-test":"attribute-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:d?it.checkBorder:qe.default,backgroundColor:d?it.checkBg:"transparent"},children:d&&e.jsx(Nt,{className:"w-3 h-3 text-white"})}),t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:l?oe.subtle:it.attrBg,color:l?$.muted:it.attrColor},children:t.label}),l&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:oe.subtle,color:$.muted},children:"default"}),i&&e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:y=>r(t.id,y),title:"Hide attribute","data-test":"attribute-hide-v2",children:e.jsx(Ga,{className:"w-3 h-3",style:{color:Te.muted}})})]})}function Io({hiddenAttributes:t,onToggleHidden:s}){return t.length===0?null:e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:Ue.sectionBorder},"data-test":"hidden-section-v2",children:[e.jsxs("div",{className:"text-xs font-medium mb-2 flex items-center gap-1",style:{color:$.placeholder},children:[e.jsx(gn,{className:"w-3 h-3"}),"Hidden (",t.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.map(n=>e.jsxs("div",{className:"flex items-center py-1 px-2 rounded hover:bg-gray-100 group",style:{opacity:.6},"data-test":"hidden-attribute-v2",children:[e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:oe.subtle,color:$.muted},children:n.name}),e.jsx("button",{className:"ml-auto opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-gray-200 transition-opacity",onClick:a=>s(n.name,a),title:"Show attribute","data-test":"attribute-show-v2",children:e.jsx(gn,{className:"w-3 h-3",style:{color:Te.muted}})})]},n.name))})]})}function Ao(t,s){return s?t==="class"?s.split(/\s+/).filter(Boolean):[s]:[]}function To(t,s){const n=[];n.push({id:"innerText",label:"innerText",icon:e.jsx(Bn,{className:"w-3 h-3"}),data:{isInnerText:!0,isSelected:s}});for(const a of t){const l=Ao(a.name,a.value).map((i,c)=>({id:`${a.name}:${c}`,label:i,data:{isValue:!0,parentAttr:a.name}}));n.push({id:a.name,label:a.name,children:l.length>0?l:void 0,data:{isAttribute:!0,fullValue:a.value}})}return n}function Oo({isOpen:t,fieldPath:s,currentAttributes:n=[],attributes:a,onSelectAttributes:r,onClose:l,portalContainer:i,position:c}){const[d,u]=o.useState(new Set(n)),[h,m]=o.useState(n.length===0||n.includes("innerText")),[y,p]=o.useState(new Set),[v,j]=o.useState(!1),f=o.useRef(!1);o.useEffect(()=>{if(t&&!f.current){f.current=!0;const C=new Set(n.filter(S=>S!=="innerText"));u(C),m(n.length===0||n.includes("innerText")),p(new Set)}else t||(f.current=!1)},[t,n]);const b=o.useCallback((C,S)=>{S.stopPropagation(),p(A=>{const R=new Set(A);return R.has(C)?R.delete(C):R.add(C),R})},[]),{visibleAttributes:x,hiddenAttributes:N}=o.useMemo(()=>{const C=[],S=[];for(const A of a)y.has(A.name)?S.push(A):C.push(A);return{visibleAttributes:C,hiddenAttributes:S}},[a,y]),g=o.useMemo(()=>To(x,h),[x,h]),w=o.useMemo(()=>new Set(x.map(C=>C.name)),[x]),E=o.useCallback(C=>{var S,A;(S=C.data)!=null&&S.isInnerText?m(R=>!R):(A=C.data)!=null&&A.isAttribute&&u(R=>{const L=new Set(R);return L.has(C.id)?L.delete(C.id):L.add(C.id),L})},[]),k=o.useCallback(()=>{const C=[];h&&C.push("innerText"),C.push(...Array.from(d)),r(C),l()},[h,d,r,l]),T=o.useCallback(()=>{const C=new Set(x.map(S=>S.name));u(C),m(!0)},[x]),B=o.useCallback(()=>{u(new Set),m(!1)},[]),P=o.useCallback(()=>{const C=new Set(n.filter(S=>S!=="innerText"));u(C),m(n.length===0||n.includes("innerText")),p(new Set)},[n]),_=o.useCallback(C=>e.jsx(_o,{node:C,includeInnerText:h,selected:d,onNodeClick:E,onToggleHidden:b}),[h,d,E,b]);if(!t)return null;const I=s.split(".").pop()??s;return e.jsx(Ge,{isVisible:t,onClose:l,title:`Configure: ${I}`,initialPosition:c??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:i,showPinButton:!1,zIndex:Ze.draggablePopoverDropdown,headerActions:e.jsxs(Fe,{open:v,onOpenChange:j,value:"",onValueChange:C=>{switch(j(!1),C){case"select-all":T();break;case"clear-all":B();break;case"reset":P();break}},children:[e.jsx(Me,{className:"h-6 w-6 px-0 border-0 shadow-none",style:{backgroundColor:"transparent"},"data-test":"attr-more-actions-v2",hideChevron:!0,children:e.jsx(qa,{className:"w-4 h-4",style:{color:Te.muted}})}),e.jsxs(Be,{style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"attr-more-actions-options-v2",container:i,children:[e.jsx(he,{value:"select-all",style:{color:ee.itemText},"data-test":"attr-action-select-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ti,{className:"w-3 h-3"}),"Select All"]})}),e.jsx(he,{value:"clear-all",style:{color:ee.itemText},"data-test":"attr-action-clear-all-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(zn,{className:"w-3 h-3"}),"Clear All"]})}),e.jsx(he,{value:"reset",style:{color:ee.itemText},"data-test":"attr-action-reset-v2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Rn,{className:"w-3 h-3"}),"Reset"]})})]})]}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:Ue.bg,minWidth:"280px"},"data-test":"attribute-popover-content-v2",children:[e.jsxs("div",{className:"max-h-[300px] overflow-auto",children:[a.length===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:bg-gray-100",style:{backgroundColor:h?it.selectedBg:"transparent"},onClick:()=>m(!h),"data-test":"attribute-option-innerText-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2",style:{borderColor:h?it.checkBorder:qe.default,backgroundColor:h?it.checkBg:"transparent"},children:h&&e.jsx(Nt,{className:"w-3 h-3 text-white"})}),e.jsx(Bn,{className:"w-3 h-3 mr-2"}),e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:oe.subtle,color:$.muted},children:"innerText"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded ml-2",style:{backgroundColor:oe.subtle,color:$.muted},children:"default"})]}),e.jsx("div",{className:"text-sm text-center py-4",style:{color:Ue.emptyText},"data-test":"no-attributes-message-v2",children:"No other attributes found"})]}):e.jsx(Qa,{data:g,defaultExpandedIds:w,enableEdit:!1,enableDelete:!1,enableDrag:!1,renderNode:_,onItemClick:E}),e.jsx(Io,{hiddenAttributes:N,onToggleHidden:b})]}),e.jsx("div",{className:"mt-3 pt-2 border-t",style:{borderColor:Ue.sectionBorder},children:e.jsxs(re,{onClick:k,className:"w-full",size:"sm","data-test":"attribute-confirm-button-v2",children:["Confirm (",h?1:0," + ",d.size," selected)"]})})]})})}function Do({isOpen:t,fieldPath:s,childElements:n,excludedChildren:a=[],onConfirm:r,onClose:l,portalContainer:i,position:c}){const[d,u]=o.useState(new Set(a)),h=o.useRef(!1);o.useEffect(()=>{t&&!h.current?(h.current=!0,u(new Set(a))):t||(h.current=!1)},[t,a]);const m=o.useCallback(b=>{u(x=>{const N=new Set(x);return N.has(b)?N.delete(b):N.add(b),N})},[]),y=o.useCallback(()=>{r(Array.from(d)),l()},[d,r,l]),p=o.useCallback(()=>{u(new Set)},[]),v=n.length-d.size,j=d.size;if(!t)return null;const f=s.split(".").pop()??s;return e.jsx(Ge,{isVisible:t,onClose:l,title:`Filter Children: ${f}`,initialPosition:c??{x:window.innerWidth-350,y:100},anchorOrigin:"top-right",portalContainer:i,showPinButton:!1,zIndex:Ze.draggablePopoverDropdown,headerActions:e.jsx("button",{onClick:p,className:"p-1 rounded hover:bg-gray-200 transition-colors",title:"Reset - Include all","data-test":"child-filter-reset-v2",children:e.jsx(Rn,{className:"w-4 h-4",style:{color:Te.muted}})}),children:e.jsxs("div",{className:"p-2 flex flex-col",style:{backgroundColor:Ue.bg,minWidth:"280px"},"data-test":"child-filter-popover-content-v2",children:[e.jsx("div",{className:"text-xs mb-2 px-1",style:{color:Ue.headerText},"data-test":"child-filter-instructions-v2",children:"Uncheck children to exclude them from extraction."}),e.jsx("div",{className:"max-h-[300px] overflow-auto space-y-1",children:n.length===0?e.jsx("div",{className:"text-sm text-center py-4",style:{color:Ue.emptyText},"data-test":"no-children-message-v2",children:"No child elements found"}):n.map(b=>{const N=!d.has(b.id);return e.jsxs("div",{className:"flex items-center py-1.5 px-2 rounded cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:N?Pt.includedBg:Pt.excludedBg,border:`1px solid ${N?Pt.includedBorder:Pt.excludedBorder}`},onClick:()=>m(b.id),"data-test":"child-filter-option-v2",children:[e.jsx("div",{className:"w-4 h-4 border rounded flex items-center justify-center mr-2 flex-shrink-0",style:{borderColor:N?Pt.checkBg:qe.default,backgroundColor:N?Pt.checkBg:"transparent"},children:N&&e.jsx(Nt,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:it.attrBg,color:it.attrColor},children:b.label})}),b.textPreview&&e.jsxs("div",{className:"text-xs mt-0.5 truncate",style:{color:$.muted},title:b.textPreview,children:['"',b.textPreview.slice(0,40),b.textPreview.length>40?"...":"",'"']})]})]},b.id)})}),e.jsxs("div",{className:"mt-3 pt-2 border-t",style:{borderColor:Ue.sectionBorder},children:[e.jsxs("div",{className:"text-xs mb-2 flex justify-between",style:{color:$.muted},"data-test":"child-filter-summary-v2",children:[e.jsxs("span",{className:"text-green-600",children:[v," included"]}),j>0&&e.jsxs("span",{className:"text-red-600",children:[j," excluded"]})]}),e.jsx(re,{onClick:y,className:"w-full",size:"sm","data-test":"child-filter-confirm-button-v2",children:"Confirm"})]})]})})}function Fo({availableFields:t,selectedBranchFields:s,onToggleBranchField:n}){return t.length===0?null:e.jsxs("div",{className:"space-y-2","data-test":"branch-field-selection",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-200","data-test":"branch-field-selection-label",children:"Select fields to branch"}),e.jsx("div",{className:"flex flex-wrap gap-x-3 gap-y-2 p-2 rounded bg-zinc-100 dark:bg-zinc-800","data-test":"branch-field-selection-options",children:t.map(a=>e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer hover:opacity-80","data-test":"branch-field-item",children:[e.jsx(ui,{checked:s.includes(a),onCheckedChange:r=>{n==null||n(a,!!r)},className:"h-3.5 w-3.5","data-test":"branch-field-checkbox"}),e.jsx("span",{className:"text-xs text-zinc-700 dark:text-zinc-200","data-test":"branch-field-label",children:a})]},a))}),e.jsx("p",{className:"text-[10px]",style:{color:$.muted},"data-test":"branch-field-selection-hint",children:"Checked fields will have separate selectors per branch variant."})]})}function os({value:t,onSingleClick:s,onHoverChange:n,onClear:a}){const[r,l]=o.useState(!1),[i,c]=o.useState(!1),d=o.useRef(null),u=o.useCallback(()=>{s&&(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{d.current=null,s()},to))},[s]),h=o.useCallback(async()=>{if(d.current&&(clearTimeout(d.current),d.current=null),!!t)try{await navigator.clipboard.writeText(t),c(!0),setTimeout(()=>c(!1),so)}catch{}},[t]),m=o.useCallback(()=>{l(!0),n==null||n(!0)},[n]),y=o.useCallback(()=>{l(!1),n==null||n(!1)},[n]),p=o.useCallback(v=>{v.stopPropagation(),a==null||a()},[a]);return{isHovered:r,showCopied:i,handleClick:u,handleDoubleClick:h,handleMouseEnter:m,handleMouseLeave:y,handleClear:p}}function Mo({condition:t,index:s,canRemove:n,onChange:a,onRemove:r,onSelectorClick:l,onSelectorHover:i,existingSelectors:c,portalContainer:d}){const u=Object.entries(c??{}),{isHovered:h,showCopied:m,handleClick:y,handleDoubleClick:p,handleMouseEnter:v,handleMouseLeave:j,handleClear:f}=os({value:t.selector,onSingleClick:l,onHoverChange:i,onClear:()=>a(s,{...t,selector:""})}),b=t.selector===""?Ot.selectorEmpty:Ot.selector;return e.jsxs("div",{className:"flex flex-col gap-1.5","data-test":`branch-condition-row-${s}`,children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":`branch-condition-header-${s}`,children:[e.jsxs(Fe,{value:t.condition,onValueChange:x=>a(s,{...t,condition:x}),children:[e.jsx(Me,{className:"w-[80px] h-6 text-xs","data-test":`branch-condition-type-select-${s}`,children:e.jsx(xt,{})}),e.jsxs(Be,{container:d,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},children:[e.jsx(he,{value:"exists",style:{color:ee.itemText},"data-test":`branch-condition-type-exists-${s}`,children:"exists"}),e.jsx(he,{value:"text",style:{color:ee.itemText},"data-test":`branch-condition-type-text-${s}`,children:"text"}),e.jsx(he,{value:"html",style:{color:ee.itemText},"data-test":`branch-condition-type-html-${s}`,children:"html"})]})]}),e.jsx(ke,{value:t.label??"",onChange:x=>a(s,{...t,label:x.target.value||void 0}),placeholder:"Label (optional)",className:"flex-1 text-xs h-6 border-zinc-200","data-test":`branch-condition-label-input-${s}`}),n&&e.jsx("button",{onClick:()=>r(s),className:"p-1 hover:text-red-600 transition-colors shrink-0",style:{color:$.muted},title:"Remove condition","data-test":`branch-condition-remove-${s}`,children:e.jsx(ft,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"relative group/selector",onClick:y,onDoubleClick:p,onMouseEnter:v,onMouseLeave:j,style:{backgroundColor:h?b.bgHover:b.bg,border:`1px solid ${b.border}`,borderRadius:"4px",cursor:l?"pointer":"default"},onMouseDown:x=>x.stopPropagation(),onPointerDown:x=>x.stopPropagation(),"data-test":`branch-condition-selector-wrapper-${s}`,children:[m&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-green-600 font-medium z-10","data-test":`branch-condition-copied-feedback-${s}`,children:"Copied!"}),e.jsx(ke,{value:t.selector,onChange:x=>a(s,{...t,selector:x.target.value}),placeholder:"CSS selector to evaluate",className:`text-xs h-6 border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 ${u.length>0?"pr-12":"pr-6"}`,style:{color:b.text},"data-test":`branch-condition-selector-input-${s}`}),e.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[t.selector!==""&&e.jsx("button",{onClick:f,className:"p-0.5 opacity-0 group-hover/selector:opacity-100 hover:text-red-600 transition-opacity",style:{color:b.text},title:"Clear selector","data-test":`branch-condition-clear-button-${s}`,children:e.jsx(et,{className:"w-3 h-3"})}),u.length>0&&e.jsxs(Fe,{value:"",onValueChange:x=>a(s,{...t,selector:x}),children:[e.jsx(Me,{className:"w-6 h-6 p-0 border-0 bg-transparent hover:bg-zinc-200 rounded transition-colors",hideChevron:!0,title:"Pick from existing selectors","data-test":`branch-condition-pick-selector-${s}`,children:e.jsx(Ye,{className:"w-3 h-3",style:{color:$.muted}})}),e.jsx(Be,{container:d,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":`branch-condition-pick-selector-options-${s}`,children:u.map(([x,N])=>e.jsxs(he,{value:N,style:{color:ee.itemText},"data-test":`branch-condition-pick-selector-option-${s}`,children:[e.jsx("span",{className:"font-medium",children:x}),e.jsx("span",{className:"ml-1 opacity-60 font-mono text-[10px]",children:N})]},x))})]})]})]})]})}const Bo={selector:"",condition:"exists"};function Po({isIfEnabled:t,conditions:s,operator:n,onConditionsChange:a,onOperatorChange:r,onSelectorClick:l,onSelectorHover:i,existingSelectors:c,portalContainer:d}){if(!t)return e.jsxs("div",{className:"text-xs p-3 rounded border border-dashed",style:{color:$.muted,borderColor:$.muted},"data-test":"branch-condition-disabled-hint",children:["Enable the ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:oe.secondary},children:"_if"})," toggle above to configure conditional branching based on element existence or content."]});const u=(p,v)=>{const j=[...s];j[p]=v,a(j)},h=p=>{s.length<=1||a(s.filter((v,j)=>j!==p))},m=()=>{a([...s,{...Bo}])},y=()=>{if(s.length===1){const p=s[0].condition;return p==="exists"?"Evaluates to 'true' if element exists, 'false' otherwise":p==="text"?"Evaluates to the element's text content":"Evaluates to the element's innerHTML"}return n==="AND"?"Branch matches when ALL conditions match the branch regex pattern":"Branch matches when ANY condition matches the branch regex pattern"};return e.jsxs("div",{className:"space-y-2","data-test":"branch-condition-section",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-200","data-test":"branch-condition-label",children:"Condition (_if)"}),s.map((p,v)=>e.jsxs("div",{children:[v>0&&e.jsx("div",{className:"flex justify-center py-1","data-test":"branch-condition-operator-row",children:e.jsxs(Fe,{value:n,onValueChange:j=>r(j),children:[e.jsx(Me,{className:"w-[80px] h-6 text-xs",style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"branch-condition-operator-select",children:e.jsx(xt,{})}),e.jsxs(Be,{container:d,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},children:[e.jsx(he,{value:"AND",style:{color:ee.itemText},"data-test":"branch-condition-operator-and",children:"AND"}),e.jsx(he,{value:"OR",style:{color:ee.itemText},"data-test":"branch-condition-operator-or",children:"OR"})]})]})}),e.jsx(Mo,{condition:p,index:v,canRemove:s.length>1,onChange:u,onRemove:h,onSelectorClick:l?()=>l(v):void 0,onSelectorHover:i?j=>i(v,j):void 0,existingSelectors:c,portalContainer:d})]},v)),e.jsxs("button",{onClick:m,className:"flex items-center gap-1 text-xs px-2 py-1 rounded transition-colors hover:bg-zinc-100",style:{color:$.muted},"data-test":"branch-condition-add-button",children:[e.jsx(ot,{className:"w-3 h-3"}),"Add condition"]}),e.jsx("p",{className:"text-[10px]",style:{color:$.muted},"data-test":"branch-condition-hint",children:y()})]})}function ir({value:t,onChange:s,onSelectorClick:n,onSelectorHover:a,placeholder:r="CSS selector",disabled:l=!1}){const i=t===""?Ot.selectorEmpty:Ot.selector,{isHovered:c,showCopied:d,handleClick:u,handleDoubleClick:h,handleMouseEnter:m,handleMouseLeave:y,handleClear:p}=os({value:t,onSingleClick:()=>{console.log("[ActionSelectorWrapper] click",{value:t,hasOnSelectorClick:!!n}),n==null||n()},onHoverChange:a,onClear:()=>s("")});return e.jsxs("div",{className:"flex-1 relative group/selector",onClick:u,onDoubleClick:h,onMouseEnter:m,onMouseLeave:y,style:{backgroundColor:c?i.bgHover:i.bg,border:`1px solid ${i.border}`,borderRadius:"4px",cursor:n?"pointer":"default",opacity:l?.5:1},onMouseDown:v=>v.stopPropagation(),onPointerDown:v=>v.stopPropagation(),"data-test":"action-selector-wrapper",children:[d&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-green-600 font-medium z-10","data-test":"action-selector-copied-feedback",children:"Copied!"}),e.jsx(ke,{value:t,onChange:v=>s(v.target.value),onClick:v=>{t===""&&n&&(v.preventDefault(),v.stopPropagation(),console.log("[ActionSelectorWrapper] Input click intercepted (empty), triggering capture"),n())},placeholder:r,disabled:l,className:"text-xs h-6 font-mono border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 pr-6",style:{color:i.text},"data-test":"action-selector-input"}),t!==""&&!l&&e.jsx("button",{onClick:p,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 opacity-0 group-hover/selector:opacity-100 hover:text-red-600 transition-opacity",style:{color:i.text},title:"Clear selector","data-test":"action-selector-clear-button",children:e.jsx(et,{className:"w-3 h-3","data-test":"action-selector-clear-icon"})})]})}const zo=["exists","text","html"],Ro={exists:"exists",text:"text",html:"html"},$o=["click","hover","focus","waitForText","input","key","if"],Lo={click:"Click",hover:"Hover",focus:"Focus",waitForText:"Wait for text",input:"Input",key:"Key",if:"If"},pa=[{bg:"rgba(99, 102, 241, 0.04)",border:"#a5b4fc"},{bg:"rgba(99, 102, 241, 0.06)",border:"#c7d2fe"},{bg:"rgba(99, 102, 241, 0.08)",border:"#ddd6fe"},{bg:"rgba(99, 102, 241, 0.10)",border:"#e9d5ff"}];function Vo(t){return pa[t%pa.length]}function Uo({action:t,onChange:s,onSelectorClick:n,onSelectorHover:a,colors:r,portalContainer:l,depth:i=0}){const c=Vo(i),d=t._branches??[],[u,h]=o.useState(()=>{const _={};return d.forEach((I,C)=>{_[C]=!0}),_}),m=o.useRef(null),y=o.useRef(t._if.selector);o.useEffect(()=>{var C;const _=y.current,I=t._if.selector;if(I!==_&&((C=m.current)==null?void 0:C.type)==="action"){const{branchIndex:S,actionIndex:A}=m.current;console.log("[IfActionContent] Routing captured selector to action",{branchIndex:S,actionIndex:A,currentSelector:I});const R=[...t._branches],L=[...R[S]._actions],W=L[A];W.type!=="if"&&W.type!=="key"&&(L[A]={...W,selector:I},R[S]={...R[S],_actions:L},s({...t,_if:{...t._if,selector:_},_branches:R})),m.current=null}y.current=I},[t,s]);const p=()=>{console.log("[IfActionContent] Condition selector clicked"),m.current={type:"condition"},n==null||n()},v=(_,I)=>{var A;const C=(A=t._branches[_])==null?void 0:A._actions[I],S=(C==null?void 0:C.type)!=="if"&&(C==null?void 0:C.type)!=="key"?(C==null?void 0:C.selector)??"":"";console.log("[IfActionContent] Branch action selector clicked",{branchIndex:_,actionIndex:I,branchActionSelector:S,hasOnSelectorClick:!!n}),m.current={type:"action",branchIndex:_,actionIndex:I},n==null||n(S)},j=_=>{s({...t,_if:{...t._if,selector:_}})},f=_=>{s({...t,_if:{...t._if,condition:_}})},b=(_,I)=>{const C=[...t._branches];C[_]={...C[_],label:I},s({...t,_branches:C})},x=(_,I)=>{const C=[...t._branches];C[_]={...C[_],match:I},s({...t,_branches:C})},N=(_,I,C)=>{const S=[...t._branches],A=[...S[_]._actions];A[I]=C,S[_]={...S[_],_actions:A},s({...t,_branches:S})},g=(_,I)=>{const C=[...t._branches],S=I==="if"?{type:"if",_if:{selector:"",condition:"exists"},_branches:[{match:"/true/",label:"Case 1",_actions:[]}]}:I==="key"?{type:"key",key:"Escape"}:I==="waitForText"?{type:"waitForText",selector:"",text:""}:I==="input"?{type:"input",selector:"",value:""}:{type:I,selector:""};C[_]={...C[_],_actions:[...C[_]._actions,S]},s({...t,_branches:C})},w=(_,I)=>{const C=[...t._branches];C[_]={...C[_],_actions:C[_]._actions.filter((S,A)=>A!==I)},s({...t,_branches:C})},E=()=>{const _={match:`/case${t._branches.length+1}/`,label:`Case ${t._branches.length+1}`,_actions:[]};s({...t,_branches:[...t._branches,_]}),h(I=>({...I,[t._branches.length]:!0}))},k=()=>{if(t._branches.some(C=>C.match==="*"))return;const I={match:"*",label:"Else",_actions:[]};s({...t,_branches:[...t._branches,I]}),h(C=>({...C,[t._branches.length]:!0}))},T=_=>{t._branches.length<=1||s({...t,_branches:t._branches.filter((I,C)=>C!==_)})},B=_=>{h(I=>({...I,[_]:!I[_]}))},P=d.some(_=>_.match==="*");return e.jsxs("div",{className:"pl-4 pr-2 py-2 space-y-2 mt-2 rounded-md bg-indigo-500/10",style:{borderLeft:`3px solid ${c.border}`},"data-test":"if-action-content","data-depth":i,children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"if-action-condition",children:[e.jsx("span",{className:"text-[10px] shrink-0 font-semibold px-1.5 py-0.5 rounded",style:{backgroundColor:c.border,color:"white"},children:"IF"}),e.jsx(ir,{value:t._if.selector,onChange:j,onSelectorClick:p,onSelectorHover:a,placeholder:".selector"}),e.jsxs(Fe,{value:t._if.condition,onValueChange:f,children:[e.jsx(Me,{className:"h-6 text-xs w-[80px]","data-test":"if-condition-type-select",children:e.jsx(xt,{})}),e.jsx(Be,{container:l,style:{backgroundColor:ee.bg},children:zo.map(_=>e.jsx(he,{value:_,"data-test":"if-condition-type-option",children:Ro[_]},_))})]})]}),e.jsx("div",{className:"space-y-2","data-test":"if-action-branches",children:d.map((_,I)=>e.jsxs("div",{className:"border-l-2 pl-2 py-1 rounded-sm bg-zinc-100/50",style:{borderColor:_.match==="*"?"#d1d5db":"#c7d2fe"},"data-test":"if-action-branch",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1","data-test":"if-branch-header",children:[e.jsx("button",{onClick:()=>B(I),className:"p-0.5 hover:bg-white/10 rounded","data-test":"if-branch-toggle",children:u[I]?e.jsx(Ye,{className:"w-3 h-3"}):e.jsx(Ve,{className:"w-3 h-3"})}),e.jsx(ke,{value:_.label??"",onChange:C=>b(I,C.target.value),placeholder:"Label",className:"text-xs h-5 w-20","data-test":"if-branch-label"}),_.match==="*"?e.jsx("span",{className:"text-[10px] px-1 bg-gray-600 text-white rounded","data-test":"if-branch-else-badge",children:"else"}):e.jsx(ke,{value:_.match,onChange:C=>x(I,C.target.value),placeholder:"/pattern/",className:"text-xs h-5 font-mono flex-1","data-test":"if-branch-match"}),d.length>1&&e.jsx("button",{onClick:()=>T(I),className:"p-0.5 hover:text-red-500",title:"Remove branch","data-test":"if-branch-remove",children:e.jsx(ft,{className:"w-3 h-3"})})]}),u[I]&&e.jsxs("div",{className:"pl-4 space-y-1","data-test":"if-branch-actions",children:[_._actions.map((C,S)=>{const A=C.type!=="if"&&C.type!=="key"?C.selector??"":"";return e.jsx(or,{action:C,index:S,totalActions:_._actions.length,onChange:(R,L)=>N(I,S,L),onRemove:()=>w(I,S),onMoveUp:()=>{},onMoveDown:()=>{},onSelectorClick:()=>v(I,S),onSelectorHover:R=>{console.log("[IfActionContent] Branch action hover",{branchIndex:I,actionIndex:S,isHovered:R,branchActionSelector:A,hasOnSelectorHover:!!a}),a==null||a(R,A)},portalContainer:l,ifDepth:i+1},S)}),e.jsxs(Fe,{onValueChange:C=>g(I,C),children:[e.jsxs(Me,{className:"h-5 text-xs w-[100px]","data-test":"if-branch-add-action",children:[e.jsx(ot,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"Add"})]}),e.jsx(Be,{container:l,style:{backgroundColor:ee.bg},children:$o.map(C=>e.jsx(he,{value:C,"data-test":"if-branch-add-action-option",children:Lo[C]},C))})]})]})]},I))}),e.jsxs("div",{className:"flex gap-2","data-test":"if-action-add-buttons",children:[e.jsxs("button",{onClick:E,className:"text-xs px-2 py-0.5 rounded border hover:bg-white/10",style:{borderColor:qe.light},"data-test":"if-add-case",children:[e.jsx(ot,{className:"w-3 h-3 inline mr-1"}),"Add case"]}),!P&&e.jsxs("button",{onClick:k,className:"text-xs px-2 py-0.5 rounded border hover:bg-white/10",style:{borderColor:qe.light},"data-test":"if-add-else",children:[e.jsx(ot,{className:"w-3 h-3 inline mr-1"}),"Add else"]})]})]})}const Wo=["click","hover","focus","waitForText","input","key","if"],qo={click:"Click",hover:"Hover",focus:"Focus",waitForText:"Wait for text",input:"Input",key:"Key",if:"If"},Ko={click:"#3b82f6",hover:"#8b5cf6",focus:"#06b6d4",waitForText:"#f59e0b",input:"#10b981",key:"#ec4899",if:"#6366f1"},Go={click:"#93c5fd",hover:"#c4b5fd",focus:"#67e8f9",waitForText:"#fcd34d",input:"#6ee7b7",key:"#f9a8d4",if:"#a5b4fc"},Jo=["Escape","Enter","Backspace","Delete",...Array.from({length:26},(t,s)=>String.fromCharCode(97+s)),...Array.from({length:26},(t,s)=>String.fromCharCode(65+s))];function or({action:t,index:s,totalActions:n,isFlashing:a,onChange:r,onRemove:l,onMoveUp:i,onMoveDown:c,onSelectorClick:d,onSelectorHover:u,portalContainer:h,ifDepth:m=0}){var R,L,W;const[y,p]=o.useState(!1);o.useEffect(()=>{const D=()=>{p(document.documentElement.classList.contains("dark"))};D();const H=new MutationObserver(D);return H.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>H.disconnect()},[]);const v=t.type==="waitForText",j=t.type==="input",f=t.type==="key",b=t.type==="if",x=D=>{b||r(s,{...t,selector:D})},N=b?((R=t._if)==null?void 0:R.selector)??"":t.selector??"",g=D=>{const H=t.type!=="if"?t.delay:void 0;D==="waitForText"?r(s,{type:"waitForText",selector:N,text:"",delay:H}):D==="input"?r(s,{type:"input",selector:N,value:"",delay:H}):D==="key"?r(s,{type:"key",key:"Escape",selector:N||void 0,delay:H}):D==="if"?r(s,{type:"if",_if:{selector:"",condition:"exists"},_branches:[{match:"/true/",label:"Case 1",_actions:[]}],label:t.label}):r(s,{type:D,selector:N,delay:H})},w=D=>{t.type==="key"&&r(s,{...t,key:D})},E=D=>{if(b)return;const H=D===""?void 0:parseInt(D,10);r(s,{...t,delay:H})},k=D=>{t.type==="waitForText"&&r(s,{...t,text:D})},T=D=>{if(t.type==="waitForText"){const H=D?parseInt(D,10):void 0;if(H!==void 0&&isNaN(H))return;r(s,{...t,timeout:H})}},B=D=>{t.type==="input"&&r(s,{...t,value:D})},P=D=>{b||r(s,{...t,replayPreceding:D||void 0})},_=D=>{r(s,{...t,active:D?void 0:!1})},I=D=>{r(s,{...t,label:D||void 0})},C=Ko[t.type],S=y?Go[t.type]:C,A=t.active===!1;return e.jsxs("div",{className:"flex flex-col gap-2 p-3 rounded-md",style:{borderLeft:`3px solid ${A?"#a1a1aa":C}`,boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",backgroundColor:a?"rgba(0, 0, 0, 0.08)":A?"rgba(244, 244, 245, 0.3)":"rgba(244, 244, 245, 0.5)",opacity:A?.6:1,transition:a?"none":"background-color 400ms ease-out, opacity 200ms ease-out"},"data-test":"branch-action-item","data-inactive":A?"true":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"branch-action-header",children:[e.jsx("span",{className:"text-[10px] shrink-0 px-1.5 py-0.5 rounded font-medium",style:{backgroundColor:y?`${C}40`:`${C}20`,color:S},"data-test":"branch-action-index",children:s+1}),e.jsx(ke,{value:t.label??"",onChange:D=>I(D.target.value),placeholder:"Action label (optional)",className:"flex-1 text-xs h-6 border-zinc-200","data-test":"action-label-input"}),e.jsxs(ds,{children:[e.jsx(us,{asChild:!0,children:e.jsx("button",{className:"p-0.5 rounded hover:bg-zinc-200 transition-colors shrink-0",style:{color:$.muted},"data-test":"action-config-button",children:e.jsx(Gs,{className:"w-3 h-3","data-test":"action-config-icon"})})}),e.jsxs(hs,{align:"end",container:h,style:{zIndex:Ze.draggablePopoverDropdown},"data-test":"action-config-menu",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 py-1.5",onPointerDown:D=>D.stopPropagation(),"data-test":"action-active-field",children:[e.jsx("span",{className:"text-xs",style:{color:$.muted},children:"Active"}),e.jsx("input",{type:"checkbox",checked:t.active!==!1,onChange:D=>_(D.target.checked),className:"w-4 h-4","data-test":"action-active-checkbox"})]}),e.jsxs(Ut,{disabled:s===0,onClick:()=>i(s),"data-test":"action-move-up",children:[e.jsx(Oi,{className:"w-3 h-3 mr-2"}),"Move Up"]}),e.jsxs(Ut,{disabled:s===n-1,onClick:()=>c(s),"data-test":"action-move-down",children:[e.jsx(Di,{className:"w-3 h-3 mr-2"}),"Move Down"]}),!b&&e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 py-1.5",onPointerDown:D=>D.stopPropagation(),"data-test":"action-delay-field",children:[e.jsx("span",{className:"text-xs",style:{color:$.muted},children:"Delay"}),e.jsx(ke,{type:"number",min:0,step:no,value:((L=t.delay)==null?void 0:L.toString())??er.toString(),onChange:D=>E(D.target.value),className:"text-xs h-6 w-[70px] font-mono","data-test":"action-delay-input"})]}),!b&&e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 py-1.5",onPointerDown:D=>D.stopPropagation(),"data-test":"action-replay-preceding-field",children:[e.jsx("span",{className:"text-xs",style:{color:$.muted},children:"Replay clicks"}),e.jsx("input",{type:"checkbox",checked:t.replayPreceding??!1,onChange:D=>P(D.target.checked),className:"w-4 h-4","data-test":"action-replay-preceding-checkbox"})]}),v&&e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 py-1.5",onPointerDown:D=>D.stopPropagation(),"data-test":"action-timeout-field",children:[e.jsx("span",{className:"text-xs",style:{color:$.muted},children:"Timeout"}),e.jsx(ke,{value:((W=t.timeout)==null?void 0:W.toString())??"",onChange:D=>T(D.target.value),placeholder:"5000",className:"text-xs h-5 w-[60px] font-mono","data-test":"action-timeout-input"})]}),e.jsxs(Ut,{onClick:()=>l(s),className:"text-red-600 focus:text-red-600","data-test":"action-delete",children:[e.jsx(ft,{className:"w-3 h-3 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"branch-action-type-row",children:[e.jsxs(Fe,{value:t.type,onValueChange:D=>g(D),children:[e.jsx(Me,{className:"h-6 text-xs w-[100px]","data-test":"action-type-select",children:e.jsx(xt,{})}),e.jsx(Be,{container:h,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"action-type-options",children:Wo.map(D=>e.jsx(he,{value:D,style:{color:ee.itemText},"data-test":"action-type-option",children:qo[D]},D))})]}),!b&&e.jsx(ir,{value:N,onChange:x,onSelectorClick:d,onSelectorHover:u})]}),v&&e.jsxs("div",{className:"pl-6 space-y-1","data-test":"action-text-field",children:[e.jsx("span",{className:"text-[10px]",style:{color:$.muted},children:"text:"}),e.jsx("textarea",{value:t.text,onChange:D=>k(D.target.value),placeholder:"text to wait for",rows:2,className:"w-full text-xs font-mono px-2 py-1 rounded border border-input bg-transparent resize-none focus:outline-none focus:ring-1 focus:ring-ring","data-test":"action-text-input"})]}),j&&e.jsxs("div",{className:"pl-6 space-y-1","data-test":"action-value-field",children:[e.jsx("span",{className:"text-[10px]",style:{color:$.muted},children:"value:"}),e.jsx("textarea",{value:t.value,onChange:D=>B(D.target.value),placeholder:"Hello {{name}} {{index}}",rows:2,className:"w-full text-xs font-mono px-2 py-1 rounded border border-input bg-transparent resize-none focus:outline-none focus:ring-1 focus:ring-ring","data-test":"action-value-input"})]}),f&&e.jsxs("div",{className:"pl-6 flex items-center gap-2","data-test":"action-key-field",children:[e.jsx("span",{className:"text-[10px]",style:{color:$.muted},children:"key:"}),e.jsxs(Fe,{value:t.key,onValueChange:w,children:[e.jsx(Me,{className:"h-6 text-xs w-[100px]","data-test":"action-key-select",children:e.jsx(xt,{})}),e.jsx(Be,{container:h,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"action-key-options",children:Jo.map(D=>e.jsx(he,{value:D,style:{color:ee.itemText},"data-test":"action-key-option",children:D},D))})]})]}),b&&e.jsx(Uo,{action:t,onChange:D=>r(s,D),onSelectorClick:d,onSelectorHover:u,colors:oe,portalContainer:h,depth:m})]})}const Ho={text:"#18181b",muted:"#71717a",accent:"#2563eb",success:"#16a34a",warning:"#ca8a04",error:"#dc2626",border:"#e4e4e7",headerBg:"#f4f4f5",rowBg:"#ffffff",rowHoverBg:"#fafafa"},Yo={text:"#d4d4d4",muted:"#737373",accent:"#60a5fa",success:"#4ade80",warning:"#facc15",error:"#f87171",border:"#404040",headerBg:"#262626",rowBg:"#1a1a1a",rowHoverBg:"#262626"};function Xo(t){return t?Yo:Ho}function Zo(t){return t?Array.isArray(t)?t.join(" & "):t:"-"}function Qo(t){var n,a;const s=t.selector??"";switch(t.type){case"click":return`click on ${s}`;case"hover":return`hover on ${s}`;case"input":return`input "${t.value??""}" into ${s}`;case"waitForText":return`wait for text "${t.text??""}" in ${s}`;case"key":return s?`press ${t.key??"key"} on ${s}`:`press ${t.key??"key"}`;case"if":return`if ${((n=t._if)==null?void 0:n.selector)??""} ${((a=t._if)==null?void 0:a.condition)??"exists"}`;default:return`${t.type} on ${s}`}}function lt(t){var s;return t.type==="if"?((s=t._if)==null?void 0:s.selector)??"":t.selector??""}function cr(t,s=0,n){const a=[];for(const r of t)if(a.push({description:Qo(r),selector:lt(r),active:r.active,depth:s,branchLabel:n}),r.type==="if"&&r._branches){for(const l of r._branches)if(l._actions&&l._actions.length>0){const i=cr(l._actions,s+1,l.label??l.match);a.push(...i)}}return a}function ec(t){if(t.capturedFields){const s=["name","Name","fullName","full_name","displayName"];for(const a of s)if(t.capturedFields[a])return t.capturedFields[a];const n=Object.values(t.capturedFields);if(n.length>0&&n[0])return n[0]}return`Item ${t.itemIndex}`}function Is(t){if(!t)return[];const s=new Map;for(const a of t.actions){const r=a.pageNumber??1;s.has(r)||s.set(r,[]),s.get(r).push(a)}const n=[];for(const[a,r]of s)n.push({pageNumber:a,items:r.map(l=>({itemIndex:l.itemIndex,name:ec(l),branchMatch:Zo(l.matchedBranch),processed:l.success,actions:l.executedActions?cr(l.executedActions):[]}))});return n.sort((a,r)=>a.pageNumber-r.pageNumber)}const tc=["click","hover","focus","waitForText","input","key","if"],sc={click:"Click",hover:"Hover",focus:"Focus",waitForText:"Wait for text",input:"Input",key:"Key",if:"If"};function ma({branch:t,index:s,canRemove:n,conditionCount:a,availableFieldsForOverride:r,onMatchChange:l,onRemoveBranch:i,onAddOverride:c,onOverrideChange:d,onRemoveOverride:u,onAddAction:h,onActionChange:m,onRemoveAction:y,onMoveAction:p,onActionSelectorClick:v,onActionSelectorHover:j,onRenameKey:f,portalContainer:b}){const x=t.actions&&t.actions.length>0,[N,g]=o.useState(null),[w,E]=o.useState(!1),[k,T]=o.useState(t.key),B=400,P=o.useCallback((S,A)=>{const R=A==="up"?S-1:S+1;p(s,S,A),g(R),setTimeout(()=>g(null),B)},[s,p]),_=o.useCallback(()=>{T(t.key),E(!0)},[t.key]),I=o.useCallback(()=>{const S=k.trim();S&&S!==t.key&&f&&f(s,S),E(!1)},[k,t.key,f,s]),C=o.useCallback(S=>{S.key==="Enter"?I():S.key==="Escape"&&(E(!1),T(t.key))},[I,t.key]);return e.jsxs("div",{className:"border rounded p-3 space-y-2",style:{borderColor:_e.primary+"40"},"data-test":"branch-config-item",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"branch-config-header",children:[e.jsx("div",{className:"flex items-center gap-2",children:w?e.jsxs("div",{className:"flex items-center gap-1","data-test":"branch-key-edit",children:[e.jsx("span",{className:"text-xs",style:{color:$.muted},children:"Branch"}),e.jsx(ke,{value:k,onChange:S=>T(S.target.value),onKeyDown:C,onBlur:I,autoFocus:!0,className:"h-6 w-24 text-xs font-mono","data-test":"branch-key-input"}),e.jsx("button",{onClick:I,className:"p-1 rounded hover:bg-green-100 transition-colors",style:{color:"#22c55e"},"data-test":"branch-key-confirm-button",children:e.jsx(Nt,{className:"w-3 h-3"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:_e.primary,color:$.white},"data-test":"branch-config-label",children:["Branch ",t.key]}),f&&e.jsx("button",{onClick:_,className:"p-1 rounded hover:bg-zinc-100 dark:hover:bg-zinc-700 transition-colors",style:{color:$.muted},title:"Rename branch","data-test":"branch-key-edit-button",children:e.jsx(Wa,{className:"w-3 h-3"})})]})}),n&&e.jsx("button",{onClick:()=>i(s),className:"p-1 rounded hover:bg-red-100 transition-colors",style:{color:"#ef4444"},"data-test":"remove-branch-button",children:e.jsx(ft,{className:"w-3 h-3","data-test":"remove-branch-icon"})})]}),a<=1?e.jsxs("div",{className:"flex items-center gap-2","data-test":"branch-match-section",children:[e.jsx("span",{className:"text-xs shrink-0",style:{color:$.muted},children:"match:"}),e.jsx(ke,{value:typeof t.match=="string"?t.match:t.match[0]??"/./",onChange:S=>l(s,S.target.value),placeholder:"/regex pattern/",className:"text-xs h-7 font-mono flex-1","data-test":"branch-match-input"})]}):e.jsx("div",{className:"space-y-1","data-test":"branch-match-section",children:Array.from({length:a},(S,A)=>{const R=Array.isArray(t.match)?t.match:[t.match],L=R[A]??"/./";return e.jsxs("div",{className:"flex items-center gap-2","data-test":`branch-match-row-${A}`,children:[e.jsxs("span",{className:"text-xs shrink-0 px-1 rounded font-mono",style:{color:$.muted,backgroundColor:oe.secondary},children:["if[",A,"]:"]}),e.jsx(ke,{value:L,onChange:W=>{const D=[...R];for(;D.length<a;)D.push("/./");D[A]=W.target.value,l(s,D)},placeholder:"/regex pattern/",className:"text-xs h-7 font-mono flex-1","data-test":`branch-match-input-${A}`})]},A)})}),Object.entries(t.overrides).length>0&&e.jsxs("div",{className:"space-y-1","data-test":"branch-overrides-section",children:[e.jsxs("div",{className:"flex items-center gap-1","data-test":"branch-overrides-label",children:[e.jsx("span",{className:"text-[10px]",style:{color:$.muted},children:"Field overrides:"}),e.jsx(Pa,{children:e.jsxs(za,{children:[e.jsx(Ra,{asChild:!0,children:e.jsx(ps,{className:"w-3 h-3 cursor-help",style:{color:$.muted},"data-test":"branch-overrides-info-icon"})}),e.jsxs($a,{side:"right",className:"max-w-xs text-xs",container:b,"data-test":"branch-overrides-info-tooltip",children:[e.jsx("p",{className:"font-medium mb-1",children:"Override field selectors per branch"}),e.jsx("p",{className:"text-zinc-400",children:'Example: A "price" field might use ".sale-price" on sale pages but ".regular-price" on normal pages. Add the field here to use a different selector when this branch matches.'})]})]})})]}),Object.entries(t.overrides).map(([S,A])=>e.jsxs("div",{className:"flex items-center gap-1","data-test":"branch-override-item",children:[e.jsxs("span",{className:"text-xs shrink-0 px-1 rounded",style:{backgroundColor:oe.secondary},"data-test":"branch-override-field-name",children:[S,":"]}),e.jsx(ke,{value:A,onChange:R=>d(s,S,R.target.value),placeholder:"selector",className:"text-xs h-6 font-mono flex-1","data-test":"branch-override-input"}),e.jsx("button",{onClick:()=>u(s,S),className:"p-0.5 rounded hover:bg-red-100 transition-colors",style:{color:$.muted},"data-test":"branch-override-remove-button",children:e.jsx(et,{className:"w-3 h-3","data-test":"branch-override-remove-icon"})})]},S))]}),r.length>0&&e.jsxs(Fe,{onValueChange:S=>c(s,S),children:[e.jsxs(Me,{className:"h-6 text-xs w-[150px]","data-test":"add-override-select",children:[e.jsx(ot,{className:"w-3 h-3 mr-1","data-test":"add-override-icon"}),e.jsx("span",{children:"Add override"})]}),e.jsx(Be,{container:b,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"add-override-options",children:r.map(S=>e.jsx(he,{value:S,style:{color:ee.itemText},"data-test":"add-override-option",children:S},S))})]}),e.jsxs("div",{className:"border-t pt-2 mt-2 space-y-2",style:{borderColor:oe.muted},"data-test":"branch-actions-section",children:[e.jsxs("div",{className:"flex items-center gap-1","data-test":"branch-actions-header",children:[e.jsx(Fi,{className:"w-3 h-3",style:{color:_e.primary},"data-test":"branch-actions-header-icon"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-700 dark:text-zinc-200","data-test":"branch-actions-header-label",children:"Actions"}),!x&&e.jsx("span",{className:"text-[10px]",style:{color:$.muted},"data-test":"branch-actions-empty-hint",children:"(none)"})]}),x&&e.jsx("div",{className:"space-y-3","data-test":"branch-actions-list",children:t.actions.map((S,A)=>e.jsx(or,{action:S,index:A,totalActions:t.actions.length,isFlashing:N===A,onChange:(R,L)=>m(s,R,L),onRemove:R=>y(s,R),onMoveUp:R=>P(R,"up"),onMoveDown:R=>P(R,"down"),onSelectorClick:v?R=>v(s,A,R??lt(S)):void 0,onSelectorHover:j?(R,L)=>j(s,A,L??lt(S),R):void 0,portalContainer:b},A))}),e.jsxs(Fe,{onValueChange:S=>h(s,S),children:[e.jsxs(Me,{className:"h-6 text-xs w-[130px]","data-test":"add-action-select",children:[e.jsx(ot,{className:"w-3 h-3 mr-1","data-test":"add-action-icon"}),e.jsx("span",{children:"Add action"})]}),e.jsx(Be,{container:b,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"add-action-options",children:tc.map(S=>e.jsx(he,{value:S,style:{color:ee.itemText},"data-test":"add-action-option",children:sc[S]},S))})]})]})]})}function nc({branches:t,availableFields:s,conditionCount:n,onAddBranch:a,onRemoveBranch:r,onMatchChange:l,onAddOverride:i,onOverrideChange:c,onRemoveOverride:d,onAddAction:u,onActionChange:h,onRemoveAction:m,onMoveAction:y,onSelectorClick:p,onActionSelectorHover:v,onRenameKey:j,portalContainer:f}){const[b,x]=o.useState("tabs"),[N,g]=o.useState("");o.useEffect(()=>{if(t.length>0){const k=t[0].key;t.some(B=>B.key===N)||g(k)}},[t,N]);const w=k=>{const T=t[k],B=Object.keys(T.overrides);return s.filter(P=>!B.includes(P))},E=k=>{const T=t[k];r(k),T.key===N&&t.length>1&&g(String(k===0?1:0))};return e.jsxs("div",{className:"space-y-2","data-test":"branch-editor-branches-section",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"branch-editor-branches-header",children:[e.jsx("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-200","data-test":"branch-editor-branches-label",children:"Branches (_branches)"}),e.jsxs("div",{className:"flex items-center gap-1","data-test":"branch-editor-branches-controls",children:[e.jsxs("div",{className:"flex items-center border rounded",style:{borderColor:oe.muted},"data-test":"branch-editor-display-mode-toggle",children:[e.jsx("button",{onClick:()=>x("list"),className:"p-1 rounded-l transition-colors",style:{backgroundColor:b==="list"?_e.primary:"transparent",color:b==="list"?$.white:$.muted},title:"List view","data-test":"branch-editor-list-mode-button",children:e.jsx(Ks,{className:"w-3.5 h-3.5","data-test":"branch-editor-list-mode-icon"})}),e.jsx("button",{onClick:()=>x("tabs"),className:"p-1 rounded-r transition-colors",style:{backgroundColor:b==="tabs"?_e.primary:"transparent",color:b==="tabs"?$.white:$.muted},title:"Tabs view","data-test":"branch-editor-tabs-mode-button",children:e.jsx(Mi,{className:"w-3.5 h-3.5","data-test":"branch-editor-tabs-mode-icon"})})]}),e.jsxs(re,{variant:"ghost",size:"sm",onClick:a,className:"h-6 text-xs","data-test":"branch-editor-add-branch-button",children:[e.jsx(ot,{className:"w-3 h-3 mr-1","data-test":"branch-editor-add-branch-icon"}),"Add Branch"]})]})]}),b==="list"&&e.jsx("div",{"data-test":"branch-editor-branches-list",children:t.map((k,T)=>e.jsx(ma,{branch:k,index:T,canRemove:t.length>1,conditionCount:n,availableFieldsForOverride:w(T),onMatchChange:l,onRemoveBranch:r,onAddOverride:i,onOverrideChange:c,onRemoveOverride:d,onAddAction:u,onActionChange:h,onRemoveAction:m,onMoveAction:y,onActionSelectorClick:p?(B,P,_)=>p({type:"action",branchIndex:B,actionIndex:P},_):void 0,onActionSelectorHover:v,onRenameKey:j,portalContainer:f},k.key))}),b==="tabs"&&e.jsxs(Fn,{value:N,onValueChange:g,"data-test":"branch-editor-branches-tabs",children:[e.jsx(Mn,{className:"w-full justify-start","data-test":"branch-editor-tabs-list",children:t.map((k,T)=>e.jsxs(Wt,{value:k.key,className:"text-xs","data-test":"branch-editor-tab-trigger",children:[T+1,". ",k.key]},k.key))}),t.map((k,T)=>e.jsx(qt,{value:k.key,"data-test":"branch-editor-tab-content",children:e.jsx(ma,{branch:k,index:T,canRemove:t.length>1,conditionCount:n,availableFieldsForOverride:w(T),onMatchChange:l,onRemoveBranch:E,onAddOverride:i,onOverrideChange:c,onRemoveOverride:d,onAddAction:u,onActionChange:h,onRemoveAction:m,onMoveAction:y,onActionSelectorClick:p?(B,P,_)=>p({type:"action",branchIndex:B,actionIndex:P},_):void 0,onActionSelectorHover:v,onRenameKey:j,portalContainer:f})},k.key))]}),e.jsxs("p",{className:"text-[10px]",style:{color:$.muted},"data-test":"branch-editor-branches-hint",children:["Branches are evaluated in order. First match wins. Use"," ",e.jsx("code",{className:"px-0.5 rounded",style:{backgroundColor:oe.secondary},children:"/./"})," ","as a catch-all pattern."]})]})}const xa={nextButton:"",maxPages:10,delayBetweenPages:1e3,stopWhen:"gone"},fa={selector:"",condition:"exists"};function ac({isOpen:t,fieldPath:s,existingIf:n,existingBranches:a,availableFields:r=[],selectedBranchFields:l=[],onSave:i,onRemove:c,onClose:d,onToggleIf:u,onToggleBranchField:h,onSelectorClick:m,onSelectorHover:y,captureTarget:p,capturedSelector:v,existingSelectors:j={},portalContainer:f,maxJitter:b,onMaxJitterChange:x,existingPagination:N,onPaginationChange:g}){const[w,E]=o.useState("conditionals"),[k,T]=o.useState(!1),[B,P]=o.useState([{...fa}]),[_,I]=o.useState("AND"),[C,S]=o.useState([]),[A,R]=o.useState({...xa}),[L,W]=o.useState(!1);o.useEffect(()=>{const M=()=>{W(document.documentElement.classList.contains("dark"))};M();const F=new MutationObserver(M);return F.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>F.disconnect()},[]),o.useEffect(()=>{if(t){if(n?(T(!0),He(n)?(P(n.conditions.map(M=>({...M}))),I(n.operator)):(P([{selector:n.selector,condition:n.condition}]),I("AND"))):(T(!1),P([{...fa}]),I("AND")),a){const M=Object.entries(a).map(([F,z])=>{const q={};for(const[U,V]of Object.entries(z))U!=="match"&&U!=="_actions"&&typeof V=="string"&&(q[U]=V);const O=z._actions??null;return{key:F,match:z.match,overrides:q,actions:O}});S(M)}else S([{key:"0",match:"/true/",overrides:{},actions:null},{key:"1",match:"/./",overrides:{},actions:null}]);R(N?{...N}:{...xa})}},[t,n,a,N]),o.useEffect(()=>{S(M=>M.map(F=>{if(B.length<=1)return{...F,match:Array.isArray(F.match)?F.match[0]??"/./":F.match};const z=Array.isArray(F.match)?F.match:[F.match];if(z.length===B.length)return F;const q=Array.from({length:B.length},(O,U)=>z[U]??"/./");return{...F,match:q}}))},[B.length]),o.useEffect(()=>{if(!(!v||!p)){if(p.type==="condition"){const M=p.conditionIndex;P(F=>F.map((z,q)=>q===M?{...z,selector:v}:z))}else if(p.type==="action"){const{branchIndex:M,actionIndex:F}=p;S(z=>z.map((q,O)=>{if(O!==M||!q.actions)return q;const U=[...q.actions],V=U[F];return V&&(V.type==="if"?U[F]={...V,_if:{...V._if,selector:v}}:U[F]={...V,selector:v}),{...q,actions:U}}))}else if(p.type==="pagination"){const{field:M}=p,F={...A,[M]:v};R(F),g&&g(F.nextButton?F:null)}}},[v,p,g,A]);const D=o.useCallback(()=>{const M=String(C.length),F=B.length>1?Array.from({length:B.length},()=>"/./"):"/./";S(z=>[...z,{key:M,match:F,overrides:{},actions:null}])},[C.length,B.length]),H=o.useCallback(M=>{S(F=>F.filter((q,O)=>O!==M).map((q,O)=>({...q,key:String(O)})))},[]),Z=o.useCallback((M,F)=>{S(z=>z.map((q,O)=>O===M?{...q,match:F}:q))},[]),le=o.useCallback((M,F)=>{S(z=>z.map((q,O)=>O===M?{...q,overrides:{...q.overrides,[F]:""}}:q))},[]),fe=o.useCallback((M,F,z)=>{S(q=>q.map((O,U)=>U===M?{...O,overrides:{...O.overrides,[F]:z}}:O))},[]),je=o.useCallback((M,F)=>{S(z=>z.map((q,O)=>{if(O!==M)return q;const{[F]:U,...V}=q.overrides;return{...q,overrides:V}}))},[]),ae=o.useCallback((M,F)=>{let z;F==="waitForText"?z={type:"waitForText",selector:"",text:""}:F==="input"?z={type:"input",selector:"",value:""}:F==="key"?z={type:"key",key:"Escape"}:F==="if"?z={type:"if",_if:{selector:"",condition:"exists"},_branches:[{match:"/true/",label:"Case 1",_actions:[]}]}:z={type:F,selector:""},S(q=>q.map((O,U)=>U===M?{...O,actions:[...O.actions??[],z]}:O))},[]),Y=o.useCallback((M,F,z)=>{S(q=>q.map((O,U)=>{if(U!==M||!O.actions)return O;const V=[...O.actions];return V[F]=z,{...O,actions:V}}))},[]),ne=o.useCallback((M,F)=>{S(z=>z.map((q,O)=>{if(O!==M||!q.actions)return q;const U=q.actions.filter((V,J)=>J!==F);return{...q,actions:U.length>0?U:null}}))},[]),Q=o.useCallback((M,F,z)=>{S(q=>q.map((O,U)=>{if(U!==M||!O.actions)return O;const V=z==="up"?F-1:F+1;if(V<0||V>=O.actions.length)return O;const J=[...O.actions];return[J[F],J[V]]=[J[V],J[F]],{...O,actions:J}}))},[]),X=o.useCallback((M,F)=>{S(z=>z.map((q,O)=>O===M?{...q,key:F}:q))},[]),ce=o.useCallback(()=>{const M={};for(const z of C){const O={match:Array.isArray(z.match)?z.match.length===1?z.match[0]||"/./":z.match:z.match||"/./",...z.overrides};z.actions&&z.actions.length>0&&(O._actions=z.actions),M[z.key]=O}let F;B.length===1?F={selector:B[0].selector.trim(),condition:B[0].condition}:F={operator:_,conditions:B.map(z=>({...z,selector:z.selector.trim()}))},i(F,M),d()},[B,_,C,i,d]),de=o.useCallback(()=>{const M=!k;T(M),u(M)},[k,u]),ue=o.useCallback((M,F)=>{R(z=>{const q={...z,[M]:F};return g&&g(q.nextButton?q:null),q})},[g]),ge=os({value:A.nextButton,onSingleClick:m?()=>m({type:"pagination",field:"nextButton"},A.nextButton):void 0,onHoverChange:y?M=>y({type:"pagination",field:"nextButton"},A.nextButton,M):void 0,onClear:()=>ue("nextButton","")}),se=os({value:A.waitForSelector??"",onSingleClick:m?()=>m({type:"pagination",field:"waitForSelector"},A.waitForSelector??""):void 0,onHoverChange:y?M=>y({type:"pagination",field:"waitForSelector"},A.waitForSelector??"",M):void 0,onClear:()=>ue("waitForSelector",void 0)}),Ie=Object.entries(j??{});if(!t)return null;const Ce=e.jsxs("div",{className:"flex items-center gap-2","data-test":"branch-editor-title",children:[e.jsx(Yt,{className:"w-4 h-4",style:{color:_e.primary},"data-test":"branch-editor-title-icon"}),e.jsx("span",{children:"Conditional Branching"})]}),me=e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:de,className:"flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-colors",style:{backgroundColor:k?_e.primary:oe.muted,color:k?$.white:$.muted},title:k?"Hide _if condition section":"Show _if condition section","data-test":"branch-editor-toggle-if-button",children:[k?e.jsx(Nt,{className:"w-3 h-3","data-test":"branch-editor-if-enabled-icon"}):e.jsx(et,{className:"w-3 h-3","data-test":"branch-editor-if-disabled-icon"}),e.jsx("span",{children:"_if"})]}),x&&e.jsxs(ds,{children:[e.jsx(us,{asChild:!0,children:e.jsx("button",{className:"p-1 rounded hover:bg-accent transition-colors",onMouseDown:M=>M.stopPropagation(),"aria-label":"Automation settings",title:"Automation settings","data-test":"branch-editor-config-button",children:e.jsx(Gs,{size:14,style:{color:Te.muted}})})}),e.jsx(hs,{align:"end",container:f,style:{zIndex:Ze.draggablePopoverDropdown+1},"data-test":"jitter-config-menu",children:e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2",onPointerDown:M=>M.stopPropagation(),"data-test":"jitter-config-field",children:[e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:"Max Jitter (ms)"}),e.jsx(ke,{type:"number",min:0,step:ao,value:b??0,onChange:M=>x(Math.max(0,parseInt(M.target.value,10)||0)),className:"text-xs h-6 w-[80px] font-mono","data-test":"jitter-config-input"})]})})]})]});return e.jsx(Ge,{isVisible:t,onClose:d,title:Ce,shouldCloseManually:!0,initialPosition:{x:Math.max(16,(window.innerWidth-720)/2),y:100},initialSize:{width:720,height:500},resizable:!0,showPinButton:!1,showInspectorButton:!1,portalContainer:f,zIndex:Ze.draggablePopoverDropdown,headerActions:me,"data-test":"branch-editor-popover",children:e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900","data-test":"branch-editor-container",children:[e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col bg-white dark:bg-zinc-900","data-test":"branch-editor-content",children:e.jsxs(Fn,{value:w,onValueChange:M=>E(M),className:"flex flex-col h-full",children:[e.jsxs(Mn,{className:"mx-4 mt-4 grid w-auto grid-cols-2","data-test":"branch-editor-tabs",children:[e.jsx(Wt,{value:"conditionals","data-test":"branch-editor-tab-conditionals",children:"Conditionals"}),e.jsx(Wt,{value:"pagination","data-test":"branch-editor-tab-pagination",children:"Pagination"})]}),e.jsxs(qt,{value:"conditionals",className:"flex-1 overflow-auto p-4 space-y-4 mt-0","data-test":"branch-editor-conditionals-content",children:[e.jsx(Fo,{availableFields:r,selectedBranchFields:l,onToggleBranchField:h}),e.jsxs("div",{className:"text-xs",style:{color:$.muted},"data-test":"branch-editor-field-path",children:["Configuring branching for:"," ",e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:oe.secondary},"data-test":"branch-editor-field-path-code",children:s})]}),e.jsxs("div",{className:"flex gap-3","data-test":"branch-match-sections",children:[e.jsx("div",{className:"w-2/5 min-w-0","data-test":"branch-match-section",children:e.jsx(Po,{isIfEnabled:k,conditions:B,operator:_,onConditionsChange:P,onOperatorChange:I,onSelectorClick:m?M=>{var F;return m({type:"condition",conditionIndex:M},((F=B[M])==null?void 0:F.selector)??"")}:void 0,onSelectorHover:y?(M,F)=>{var z;return y({type:"condition",conditionIndex:M},((z=B[M])==null?void 0:z.selector)??"",F)}:void 0,existingSelectors:j,portalContainer:f})}),e.jsx("div",{className:"w-3/5 min-w-0","data-test":"branch-match-section",children:e.jsx(nc,{branches:C,availableFields:r,conditionCount:B.length,onAddBranch:D,onRemoveBranch:H,onMatchChange:Z,onAddOverride:le,onOverrideChange:fe,onRemoveOverride:je,onAddAction:ae,onActionChange:Y,onRemoveAction:ne,onMoveAction:Q,onSelectorClick:m,onActionSelectorHover:y?(M,F,z,q)=>y({type:"action",branchIndex:M,actionIndex:F},z,q):void 0,onRenameKey:X,portalContainer:f})})]})]}),e.jsx(qt,{value:"pagination",className:"flex-1 overflow-auto p-4 space-y-6 mt-0","data-test":"branch-editor-pagination-content",children:e.jsxs("div",{className:"space-y-4","data-test":"pagination-config-fields",children:[e.jsxs("div",{className:"space-y-2","data-test":"pagination-next-button-field",children:[e.jsx(De,{className:"text-xs font-medium",children:"Next Button Selector"}),e.jsxs("div",{className:"relative group/selector",onClick:ge.handleClick,onDoubleClick:ge.handleDoubleClick,onMouseEnter:ge.handleMouseEnter,onMouseLeave:ge.handleMouseLeave,style:{backgroundColor:ge.isHovered?L?"#422006":"#fefce8":L?"#27272a":"#ffffff",border:`1px solid ${ge.isHovered?"#fbbf24":L?"#3f3f46":"#e4e4e7"}`,borderRadius:"6px",cursor:m?"pointer":"default"},onMouseDown:M=>M.stopPropagation(),onPointerDown:M=>M.stopPropagation(),"data-test":"pagination-next-button-wrapper",children:[ge.showCopied&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-green-600 font-medium z-10",children:"Copied!"}),e.jsx(ke,{value:A.nextButton,onChange:M=>ue("nextButton",M.target.value),placeholder:"button.pagination-next, .next-page, etc.",className:"font-mono text-xs h-9 border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 pr-6 text-zinc-900 dark:text-zinc-100","data-test":"pagination-next-button-input"}),A.nextButton&&e.jsx("button",{onClick:ge.handleClear,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 opacity-0 group-hover/selector:opacity-100 hover:text-red-600 transition-opacity",style:{color:$.muted},title:"Clear selector","data-test":"pagination-next-button-clear",children:e.jsx(et,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px]",style:{color:$.muted},children:'CSS selector for the "next page" button. Supports :has-text() for text matching.'})]}),e.jsxs("div",{className:"space-y-2","data-test":"pagination-wait-selector-field",children:[e.jsx(De,{className:"text-xs font-medium",children:"Wait For Selector (optional)"}),e.jsxs("div",{className:"relative group/selector",onClick:se.handleClick,onDoubleClick:se.handleDoubleClick,onMouseEnter:se.handleMouseEnter,onMouseLeave:se.handleMouseLeave,style:{backgroundColor:se.isHovered?L?"#422006":"#fefce8":L?"#27272a":"#ffffff",border:`1px solid ${se.isHovered?"#fbbf24":L?"#3f3f46":"#e4e4e7"}`,borderRadius:"6px",cursor:m?"pointer":"default"},onMouseDown:M=>M.stopPropagation(),onPointerDown:M=>M.stopPropagation(),"data-test":"pagination-wait-selector-wrapper",children:[se.showCopied&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-green-600 font-medium z-10",children:"Copied!"}),e.jsx(ke,{value:A.waitForSelector??"",onChange:M=>ue("waitForSelector",M.target.value||void 0),placeholder:"_container > _item > field (chain with dropdown)",className:`font-mono text-xs h-9 border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 text-zinc-900 dark:text-zinc-100 ${Ie.length>0?"pr-12":"pr-6"}`,"data-test":"pagination-wait-selector-input"}),e.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[A.waitForSelector&&e.jsx("button",{onClick:se.handleClear,className:"p-0.5 opacity-0 group-hover/selector:opacity-100 hover:text-red-600 transition-opacity",style:{color:$.muted},title:"Clear selector","data-test":"pagination-wait-selector-clear",children:e.jsx(et,{className:"w-3 h-3"})}),Ie.length>0&&e.jsxs(Fe,{value:"",onValueChange:M=>{const F=A.waitForSelector??"",z=F?`${F} > ${M}`:M;ue("waitForSelector",z)},children:[e.jsx(Me,{className:"w-6 h-6 p-0 border-0 bg-transparent hover:bg-zinc-200 rounded transition-colors",hideChevron:!0,title:"Add selector to chain (appends with >)","data-test":"pagination-wait-selector-pick",children:e.jsx(Ye,{className:"w-3 h-3",style:{color:$.muted}})}),e.jsx(Be,{container:f,style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border,zIndex:Ze.draggablePopoverDropdown+1},"data-test":"pagination-wait-selector-pick-options",children:Ie.map(([M,F])=>e.jsxs(he,{value:F,style:{color:ee.itemText},"data-test":"pagination-wait-selector-pick-option",children:[e.jsx("span",{className:"font-medium",children:M}),e.jsx("span",{className:"ml-1 opacity-60 font-mono text-[10px]",children:F})]},M))})]})]})]}),e.jsx("p",{className:"text-[10px]",style:{color:$.muted},children:'Chain selectors from dropdown with " > " to wait for nested content (e.g., _container > _item > name).'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2","data-test":"pagination-max-pages-field",children:[e.jsx(De,{className:"text-xs font-medium",children:"Max Pages"}),e.jsx(ke,{type:"number",min:1,max:100,value:A.maxPages??10,onChange:M=>ue("maxPages",Math.max(1,parseInt(M.target.value,10)||10)),className:"font-mono text-xs","data-test":"pagination-max-pages-input"})]}),e.jsxs("div",{className:"space-y-2","data-test":"pagination-delay-field",children:[e.jsx(De,{className:"text-xs font-medium",children:"Delay Between Pages (ms)"}),e.jsx(ke,{type:"number",min:100,step:100,value:A.delayBetweenPages??1e3,onChange:M=>ue("delayBetweenPages",Math.max(100,parseInt(M.target.value,10)||1e3)),className:"font-mono text-xs","data-test":"pagination-delay-input"})]})]}),e.jsxs("div",{className:"space-y-2","data-test":"pagination-stop-condition-field",children:[e.jsx(De,{className:"text-xs font-medium",children:"Stop When"}),e.jsxs(Fe,{value:A.stopWhen??"gone",onValueChange:M=>ue("stopWhen",M),children:[e.jsx(Me,{className:"text-xs","data-test":"pagination-stop-condition-select",children:e.jsx(xt,{})}),e.jsxs(Be,{container:f,style:{zIndex:Ze.draggablePopoverDropdown+1},children:[e.jsx(he,{value:"gone",children:"Button removed from DOM"}),e.jsx(he,{value:"disabled",children:"Button disabled"}),e.jsx(he,{value:"hidden",children:"Button hidden"})]})]}),e.jsx("p",{className:"text-[10px]",style:{color:$.muted},children:"Stop pagination when the next button meets this condition."})]}),A.nextButton&&e.jsxs("div",{className:"p-3 rounded-lg border border-dashed",style:{borderColor:_e.primary},"data-test":"pagination-preview",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:_e.primary},children:"Configuration Preview"}),e.jsxs("div",{className:"text-[10px] font-mono space-y-1",style:{color:$.muted},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Click ",e.jsx("code",{className:"px-1 bg-zinc-100 rounded",children:A.nextButton})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Wait ",A.delayBetweenPages,"ms for content"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Repeat up to ",A.maxPages," pages"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Stop when button is ",A.stopWhen]})]})]})]})})]})}),e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-t border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800","data-test":"branch-editor-footer",children:[n?e.jsxs(re,{variant:"ghost",size:"sm",onClick:()=>{c(),d()},className:"text-red-500 hover:text-red-600 hover:bg-red-50","data-test":"branch-editor-remove-branching-button",children:[e.jsx(ft,{className:"w-3 h-3 mr-1","data-test":"branch-editor-remove-branching-icon"}),"Remove Branching"]}):e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"branch-editor-actions",children:[e.jsx(re,{variant:"outline",size:"sm",onClick:d,"data-test":"branch-editor-cancel-button",children:"Cancel"}),e.jsx(re,{size:"sm",onClick:ce,"data-test":"branch-editor-save-button",children:"Save"})]})]})]})})}function ns({value:t,isSelector:s,truncateLength:n=yn.expanded,onClick:a,onHover:r,onClear:l,onConfigClick:i,onFilterChildrenClick:c,onNavigateUp:d,onNavigateDown:u,canNavigateDown:h=!1,isActive:m=!1,className:y,portalContainer:p}){const v=o.useRef({x:0,y:0}),{isHovered:j,showCopied:f,handleClick:b,handleDoubleClick:x,handleMouseEnter:N,handleMouseLeave:g,handleClear:w}=os({value:t,onSingleClick:a,onHoverChange:r,onClear:l}),k=s&&t===""?Ot.selectorEmpty:s?Ot.selector:Ot.content,T=!!a,{baseSelector:B,indexDisplay:P,attributeDisplay:_,displayValue:I}=o.useMemo(()=>{if(!s||!t){const W=t.length>n?`${t.slice(0,n)}...`:t;return{baseSelector:t,indexDisplay:null,attributeDisplay:null,displayValue:W}}let C=t,S=null;const A=t.lastIndexOf("@");A>0&&(C=t.substring(0,A),S=t.substring(A+1));const R=wt(C);if(!R.indexSpec){const W=C.length>n?`${C.slice(0,n)}...`:C;return{baseSelector:C,indexDisplay:null,attributeDisplay:S,displayValue:W}}const L=R.selector.length>n?`${R.selector.slice(0,n)}...`:R.selector;return{baseSelector:R.selector,indexDisplay:Un(R.indexSpec),attributeDisplay:S,displayValue:L}},[t,s,n]);return e.jsxs("span",{className:`inline-flex items-center group/value ${y??""}`,onMouseDown:C=>C.stopPropagation(),onPointerDown:C=>C.stopPropagation(),onClick:C=>C.stopPropagation(),"data-test":"field-value-v2",children:[s&&t!==""&&d&&e.jsxs("span",{className:"inline-flex items-center mr-0.5","data-test":"nav-buttons-v2",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),d()},className:"p-0.5 hover:bg-gray-200 rounded transition-colors",style:{color:Te.secondary},title:"Go to parent element","data-test":"nav-up-v2",children:e.jsx(Ja,{className:"w-3 h-3"})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),u==null||u()},disabled:!h,className:"p-0.5 hover:bg-gray-200 rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",style:{color:Te.secondary},title:h?"Go back to child element":"Navigate up first to enable","data-test":"nav-down-v2",children:e.jsx(Ye,{className:"w-3 h-3"})})]}),e.jsxs("span",{className:`inline-flex items-center min-w-0 ${m?"animate-pulse":""}`,style:{backgroundColor:j?k.bgHover:k.bg,border:`1px solid ${m?"#3b82f6":k.border}`,borderRadius:"4px",padding:"1px 6px",boxShadow:m?"0 0 0 2px rgba(59, 130, 246, 0.4)":void 0},"data-test-active":m?"true":void 0,children:[e.jsx("span",{onClick:b,onDoubleClick:x,onMouseEnter:N,onMouseLeave:g,style:{color:k.text,cursor:T?"pointer":"default"},title:t.length>n?t:"Double-click to copy","data-test":"field-value-text",children:f?e.jsx("span",{className:"text-green-600 font-medium",children:"Copied!"}):`"${I}"`}),P&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-amber-100 text-amber-700 border border-amber-300",title:`Index filter: ${P}`,"data-test":"field-value-index",children:P}),l&&s&&t!==""&&e.jsx("button",{onClick:w,className:"ml-1 opacity-0 group-hover/value:opacity-100 hover:text-red-600 transition-opacity",style:{color:k.text},title:"Clear selector","data-test":"clear-selector-v2",children:e.jsx(et,{className:"w-3 h-3"})})]}),_&&e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 text-xs font-mono font-medium rounded bg-orange-100 text-orange-700 border border-orange-300",title:`Extract attribute: ${_}`,"data-test":"field-value-attribute",children:["@",_]}),(i||c)&&s&&t!==""&&e.jsxs(Fe,{value:"",onValueChange:C=>{C==="configure"?i==null||i(v.current):C==="filter-children"&&(c==null||c(v.current))},children:[e.jsx(Me,{className:"shrink-0 ml-1 p-1 h-auto w-auto border-0 shadow-none rounded",style:{backgroundColor:oe.muted},hideChevron:!0,"data-test":"config-button-v2",children:e.jsx(fn,{className:"w-3 h-3",style:{color:Te.secondary}})}),e.jsxs(Be,{style:{backgroundColor:ee.bg,color:ee.text,borderColor:ee.border},"data-test":"config-menu-v2",container:p,children:[i&&e.jsx(he,{value:"configure",style:{color:ee.itemText},"data-test":"config-extraction-v2",onPointerDown:C=>{v.current={x:C.clientX,y:C.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fn,{className:"w-3 h-3"}),"Configure extraction"]})}),c&&e.jsx(he,{value:"filter-children",style:{color:ee.itemText},"data-test":"config-filter-children-v2",onPointerDown:C=>{v.current={x:C.clientX,y:C.clientY}},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-3 h-3"}),"Filter out children"]})})]})]})]})}const ga=[{value:"previous-sibling",label:"Previous Sibling",description:"Immediate previous element"},{value:"next-sibling",label:"Next Sibling",description:"Immediate next element"},{value:"closest-sibling",label:"Closest Sibling",description:"Nearest matching sibling (any direction)"},{value:"closest-sibling-before",label:"Closest Before",description:"Nearest matching sibling before"},{value:"closest-sibling-after",label:"Closest After",description:"Nearest matching sibling after"}],rc=[{value:"exact",label:"Exact Match"},{value:"contains",label:"Contains"},{value:"regex",label:"Regex"}],dr=o.forwardRef(function({onApply:s,onCancel:n,currentFilter:a,onStartSelectorCapture:r,isCapturing:l=!1,capturedSelector:i,onNavigateUp:c,onNavigateDown:d,canNavigateDown:u=!1,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y,portalContainer:p},v){var _;const[j,f]=o.useState((a==null?void 0:a.type)??"previous-sibling"),[b,x]=o.useState((a==null?void 0:a.selector)??""),[N,g]=o.useState((a==null?void 0:a.textContent)??""),[w,E]=o.useState((a==null?void 0:a.textMatchMode)??"contains"),[k,T]=o.useState(!!(a!=null&&a.textContent&&a.textContent.trim()!==""));o.useEffect(()=>{i!==void 0&&i!==""&&x(i)},[i]);const B=o.useCallback(()=>{const I={type:j,selector:b,...k&&N.trim()!==""&&{textContent:N,textMatchMode:w}};s(I)},[j,b,N,w,k,s]),P=b.trim()!=="";return o.useImperativeHandle(v,()=>({apply:B,isValid:P}),[B,P]),e.jsxs("div",{className:"p-4 space-y-4","data-test":"sibling-filter-form",children:[e.jsxs("div",{className:"space-y-2","data-test":"filter-type-section",children:[e.jsx(De,{htmlFor:"filter-type","data-test":"filter-type-label",children:"Filter Type"}),e.jsxs(Fe,{value:j,onValueChange:I=>f(I),children:[e.jsx(Me,{id:"filter-type","data-test":"filter-type-select",children:e.jsx(xt,{placeholder:"Select filter type"})}),e.jsx(Be,{children:ga.map(I=>e.jsx(he,{value:I.value,"data-test":"filter-type-option",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:I.label})})},I.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground","data-test":"filter-type-description",children:(_=ga.find(I=>I.value===j))==null?void 0:_.description})]}),e.jsxs("div",{className:"space-y-2","data-test":"selector-input-section",children:[e.jsx(De,{"data-test":"selector-input-label",children:"CSS Selector"}),e.jsx("div",{className:"flex items-center","data-test":"selector-input",children:e.jsx(ns,{value:b,isSelector:!0,onClick:r,onClear:y,onNavigateUp:c,onNavigateDown:d,canNavigateDown:u,onConfigClick:h,onFilterChildrenClick:m,isActive:l,portalContainer:p})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Click any element on the page to capture its selector":"Click the field above to select an element from the page"})]}),e.jsxs("div",{className:"space-y-2","data-test":"text-filter-section",children:[e.jsxs("button",{type:"button",onClick:()=>T(!k),className:"flex items-center gap-1 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors","data-test":"text-filter-toggle",children:[k?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(Ve,{className:"w-4 h-4"}),"Text Content Filter (Optional)"]}),k&&e.jsxs("div",{className:"pl-5 space-y-3 border-l-2 border-border","data-test":"text-filter-content",children:[e.jsxs("div",{className:"space-y-1.5","data-test":"text-content-section",children:[e.jsx(De,{htmlFor:"text-input",className:"text-xs","data-test":"text-input-label",children:"Match Text"}),e.jsx(ke,{id:"text-input",value:N,onChange:I=>g(I.target.value),placeholder:"e.g., Username, Submit",className:"h-8 text-sm","data-test":"text-content-input"})]}),e.jsxs("div",{className:"space-y-1.5","data-test":"text-match-mode-section",children:[e.jsx(De,{className:"text-xs","data-test":"text-match-mode-label",children:"Match Mode"}),e.jsx(hi,{value:w,onValueChange:I=>E(I),className:"flex gap-3","data-test":"text-match-mode-radio-group",children:rc.map(I=>e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(pi,{value:I.value,id:`text-mode-${I.value}`,className:"w-3.5 h-3.5","data-test":"text-match-mode-option"}),e.jsx(De,{htmlFor:`text-mode-${I.value}`,className:"text-xs cursor-pointer",children:I.label})]},I.value))})]})]})]})]})});function lc({state:t,onApply:s,onClose:n,portalContainer:a,onStartSelectorCapture:r,isCapturing:l=!1,capturedSelector:i,onNavigateUp:c,onNavigateDown:d,canNavigateDown:u=!1,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y}){const p=o.useRef(null),[v,j]=o.useState(!1);o.useEffect(()=>{const N=()=>{var w;j(((w=p.current)==null?void 0:w.isValid)??!1)};N();const g=setInterval(N,100);return()=>clearInterval(g)},[t.isOpen]);const f=N=>{s(t.fieldPath,N)},b=()=>{var N;(N=p.current)==null||N.apply()},x=e.jsxs("div",{className:"flex justify-end gap-2 px-3 py-2","data-test":"action-buttons",children:[e.jsx(re,{variant:"outline",size:"sm",onClick:n,"data-test":"cancel-button",children:"Cancel"}),e.jsx(re,{size:"sm",onClick:b,disabled:!v,"data-test":"apply-button",children:"Apply"})]});return e.jsx(Ge,{isVisible:t.isOpen,onClose:n,title:`Filter: ${t.fieldPath}`,initialPosition:t.position,initialSize:{width:380,height:420},resizable:!0,shouldCloseManually:!0,portalContainer:a,footer:x,children:e.jsx(dr,{ref:p,onApply:f,onCancel:n,currentFilter:t.currentFilter,onStartSelectorCapture:r,isCapturing:l,capturedSelector:i,onNavigateUp:c,onNavigateDown:d,canNavigateDown:u,onConfigClick:h,onFilterChildrenClick:m,onClearSelector:y,portalContainer:a})})}function ic({portalContainer:t,isFieldDialogOpen:s,editingField:n,onFieldDialogSubmit:a,onFieldDialogCancel:r,contentPopover:l,onCloseContentPopover:i,onContentPopoverItemHover:c,onContentPopoverItemClick:d,importDialogOpen:u,onImportSchema:h,onCloseImportDialog:m,managerPopoverOpen:y,savedCaptures:p,onLoad:v,onRenameCapture:j,onDeleteCapture:f,onCloseManagerPopover:b,advancedSettingsOpen:x,preventDefaultOnInteraction:N,continuousMode:g,onPreventDefaultChange:w,onContinuousModeChange:E,onCloseAdvancedSettings:k,isDomTreePopoverOpen:T,domTreeFieldPath:B,domContext:P,domTreeInitialSelector:_,domTreePreviousChildIndex:I,onDomTreeParentSelect:C,onDomTreeSiblingSelect:S,onDomTreeChildSelect:A,onAddIndex:R,onRevertSelector:L,onClearSelector:W,onCloseDomTreePopover:D,onSelectorChange:H,onApplyCustomSelector:Z,attributePopover:le,onAttributeSelect:fe,onAttributePopoverClose:je,childFilterPopover:ae,onChildFilterConfirm:Y,onChildFilterPopoverClose:ne,branchEditorState:Q,onSaveBranching:X,onRemoveBranching:ce,onCloseBranchEditor:de,onToggleIf:ue,onPopoverToggleBranchField:ge,onPaginationChange:se,onBranchEditorSelectorClick:Ie,branchEditorCaptureTarget:Ce,branchEditorCapturedSelector:me,onBranchEditorSelectorHover:M,onDomTreeMatchIndexHover:F,onTextNodeClick:z,siblingFilterPopover:q,onSiblingFilterApply:O,onSiblingFilterClose:U,onSiblingFilterStartCapture:V,isSiblingFilterCapturing:J=!1,siblingFilterCapturedSelector:G,onSiblingFilterNavigateUp:be,onSiblingFilterNavigateDown:xe,siblingFilterCanNavigateDown:Ae=!1,onSiblingFilterConfigClick:Ee,onSiblingFilterFilterChildrenClick:Pe,onSiblingFilterClearSelector:ze,maxJitter:Re,onMaxJitterChange:Ct}){return e.jsxs(e.Fragment,{children:[e.jsx(lo,{isOpen:s,suggestedName:"",editingField:n,onSubmit:a,onCancel:r,portalContainer:t,"data-test":"field-dialog"}),e.jsx(io,{isOpen:l!==null,fieldName:(l==null?void 0:l.fieldName)??"",values:(l==null?void 0:l.values)??[],onClose:i,onItemHover:c,onItemClick:d,portalContainer:t,"data-test":"content-popover"}),e.jsx(co,{isOpen:u,onImport:h,onClose:m,portalContainer:t,"data-test":"import-dialog"}),e.jsx(uo,{isOpen:y,savedCaptures:p,onLoad:v,onRename:j,onDelete:f,onClose:b,portalContainer:t,"data-test":"manager-popover"}),e.jsx(ho,{isOpen:x,preventDefaultOnInteraction:N,onPreventDefaultChange:w,continuousMode:g,onContinuousModeChange:E,onClose:k,portalContainer:t,"data-test":"advanced-settings"}),e.jsx(Eo,{isOpen:T,fieldPath:B??"",domContext:P,initialSelector:_,previousChildIndex:I,onSelectParent:C,onSelectSibling:S,onSelectChild:A,onSelectMatch:R,onAddIndex:R,onRevert:L,onClearSelector:W,onClose:D,onSelectorChange:H,onApplyCustomSelector:Z,onMatchIndexHover:F,onTextNodeClick:z,portalContainer:t,"data-test":"dom-tree-popover"}),e.jsx(Oo,{isOpen:le.isOpen,fieldPath:le.fieldPath,attributes:le.attributes,currentAttributes:le.currentAttributes,onSelectAttributes:nt=>fe(le.fieldPath,nt),onClose:je,portalContainer:t,position:le.position,"data-test":"attribute-popover"}),e.jsx(Do,{isOpen:ae.isOpen,fieldPath:ae.fieldPath,childElements:ae.children,excludedChildren:ae.excludedChildren,onConfirm:nt=>Y(ae.fieldPath,nt,ae.children),onClose:ne,portalContainer:t,position:ae.position,"data-test":"child-filter-popover"}),e.jsx(ac,{isOpen:Q.isOpen,fieldPath:Q.fieldPath,existingIf:Q.existingIf,existingBranches:Q.existingBranches,availableFields:Q.availableFields,selectedBranchFields:Q.selectedBranchFields,onSave:X,onRemove:ce,onClose:de,onToggleIf:ue,onToggleBranchField:ge,onSelectorClick:Ie,captureTarget:Ce,capturedSelector:me,onSelectorHover:M,existingSelectors:Q.existingSelectors,portalContainer:t,maxJitter:Re,onMaxJitterChange:Ct,existingPagination:Q.existingPagination,onPaginationChange:se,"data-test":"branch-editor"}),e.jsx(lc,{state:q,onApply:O,onClose:U,portalContainer:t,onStartSelectorCapture:V,isCapturing:J,capturedSelector:G,onNavigateUp:be,onNavigateDown:xe,canNavigateDown:Ae,onConfigClick:Ee,onFilterChildrenClick:Pe,onClearSelector:ze})]})}function oc(t){switch(t){case"string":return"T";case"number":return"#";case"boolean":return"?";case"array":return"[]";case"parentSelector":return"{1}";case"object":return"{}";default:return"·"}}function cc({fields:t,selectedFieldId:s,mode:n,onFieldSelect:a,onFieldUpdate:r,onFieldEdit:l,onFieldDelete:i,onReorder:c,onAddChild:d,onAddSiblingBefore:u,onAddSiblingAfter:h}){const m=o.useMemo(()=>{const f=b=>t.filter(x=>x.parentId===b).sort((x,N)=>x.order-N.order).map(x=>({id:x.id,label:x.name,children:f(x.id),data:x}));return f(null)},[t]),y=o.useMemo(()=>new Set(t.map(f=>f.id)),[t]),p=o.useCallback(f=>{n==="mapped"&&a(f.id)},[n,a]),v=o.useCallback((f,b,x,N)=>{var k;const g=f.data,w=(g==null?void 0:g.mapping)!=null,E=n==="mapped"&&f.id===s;return e.jsxs("div",{className:`flex items-center gap-2 w-full group ${E?"bg-primary/10 -mx-2 px-2 rounded":""}`,"data-test":"schema-field-v2",children:[e.jsx("span",{className:"flex-shrink-0","data-test":"field-status-icon-v2",children:w?e.jsx(Ha,{className:"w-3 h-3 text-green-500"}):e.jsx(Bi,{className:"w-3 h-3 text-muted-foreground"})}),e.jsx("span",{className:"flex-shrink-0 text-xs text-muted-foreground font-mono w-4",title:g==null?void 0:g.type,"data-test":"field-type-indicator-v2",children:oc(g==null?void 0:g.type)}),e.jsx("span",{className:"flex-1 truncate",children:N}),((k=g==null?void 0:g.mapping)==null?void 0:k.sampleValue)&&e.jsxs("span",{className:"text-xs text-muted-foreground truncate max-w-[100px]",title:g.mapping.sampleValue,"data-test":"field-sample-value-v2",children:['"',g.mapping.sampleValue.slice(0,20),g.mapping.sampleValue.length>20?"...":"",'"']}),g&&e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(mi,{onClick:()=>d(g.id),label:"",icon:ot,variant:"ghost",size:"sm",compact:!0,options:[{label:"Add sibling before",onClick:()=>u(g.id)},{label:"Add sibling after",onClick:()=>h(g.id)}],contentStyle:{zIndex:Ze.draggablePopoverDropdown},"data-test":"add-field-v2"})})]})},[n,s,d,u,h]),j=o.useCallback(f=>{const b=f.data;return b?[{id:"edit",icon:e.jsx(Pi,{className:"h-3 w-3"}),title:"Edit field",onClick:()=>l(b.id,b.name,b.type)}]:null},[l]);return t.length===0?e.jsxs("div",{className:"p-4 text-sm text-muted-foreground text-center","data-test":"empty-schema-message-v2",children:[e.jsx("p",{className:"mb-2",children:"No fields defined yet."}),e.jsx("p",{className:"text-xs",children:"Use + to add fields, then click elements to map."})]}):e.jsx("div",{className:"p-2","data-test":"schema-tree-container-v2",children:e.jsx(Qa,{data:m,onUpdate:r,onDelete:i,onReorder:c,onItemClick:p,defaultExpandedIds:y,enableEdit:!1,enableDelete:!0,enableDrag:!0,renderNode:v,quickActions:j})})}function dc(t){if(t.length===0)return"";const s=l=>{switch(l){case"array":return"[]";case"object":return"{}";case"parentSelector":return"{1}";case"number":return"#";case"boolean":return"?";default:return""}},n=[],a=(l,i)=>{const c="  ".repeat(i),d=s(l.type);n.push(`${c}${l.name}${d}`);const u=t.filter(h=>h.parentId===l.id).sort((h,m)=>h.order-m.order);for(const h of u)a(h,i+1)},r=t.filter(l=>l.parentId===null).sort((l,i)=>l.order-i.order);for(const l of r)a(l,0);return n.join(`
`)}function ba(t){var a;const s=t.split(`
`),n=[];for(const r of s){if(r.trim()==="")continue;const l=((a=r.match(/^(\s*)/))==null?void 0:a[1])||"",i=(l.match(/\t/g)||[]).length,c=l.replace(/\t/g,"").length,d=i+Math.floor(c/2);let u=r.trim();if(!u)continue;let h="string";u.endsWith("[]")?(h="array",u=u.slice(0,-2)):u.endsWith("{}")?(h="object",u=u.slice(0,-2)):u.endsWith("{1}")?(h="parentSelector",u=u.slice(0,-3)):u.endsWith("#")?(h="number",u=u.slice(0,-1)):u.endsWith("?")&&(h="boolean",u=u.slice(0,-1)),n.push({name:u,depth:d,type:h})}return n}function uc(t){const s=[],n=[];for(let a=0;a<t.length;a++){const r=t[a];for(;n.length>0&&n[n.length-1].depth>=r.depth;)n.pop();const l=n.length>0?n[n.length-1].id:null,i=`field-${Date.now()}-${a}`;s.push({id:i,name:r.name,type:r.type,order:a,parentId:l,mapping:null}),n.push({depth:r.depth,id:i})}return s}const hc=`products[]
  name
  price#
author
  firstName
  lastName`,pc=[{id:"array",label:"Array",icon:"[]",value:"[]"},{id:"parentSelector",label:"Parent Selector",icon:"{1}",value:"{1}"},{id:"object",label:"Object",icon:"{}",value:"{}"},{id:"number",label:"Number",icon:"#",value:"#"},{id:"boolean",label:"Boolean",icon:"?",value:"?"}];function mc({fields:t,onApply:s,onCancel:n}){const[a,r]=o.useState(()=>dc(t)),l=o.useCallback(()=>{const d=ba(a),u=uc(d);s(u)},[a,s]),i=a.trim()?ba(a).length:0,c={triggerChar:"/",items:pc,header:"Field Type",emptyMessage:"No matching types",zIndex:Ze.draggablePopoverDropdown};return e.jsxs("div",{className:"flex flex-col h-full p-2","data-test":"list-mode-panel-v2",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx(xi,{value:a,onChange:d=>r(d.target.value),placeholder:hc,className:"w-full h-full resize-none font-mono text-sm p-2 border rounded",style:{backgroundColor:$t.bg,color:$t.text},triggerPopover:c,showBuiltInPopover:!1,"data-test":"list-mode-textarea-v2"}),e.jsx("div",{className:"absolute top-1 right-1","data-test":"list-mode-info-v2",children:e.jsx(Pa,{children:e.jsxs(za,{children:[e.jsx(Ra,{asChild:!0,children:e.jsx("button",{type:"button",className:"p-1 rounded hover:bg-gray-200 transition-colors",style:{color:$.muted},"data-test":"list-mode-info-button-v2",children:e.jsx(ps,{className:"w-3.5 h-3.5"})})}),e.jsx($a,{side:"left",className:"max-w-xs","data-test":"list-mode-info-tooltip-v2",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("p",{className:"font-medium",children:'Type "/" to select field type:'}),e.jsxs("div",{className:"font-mono text-[10px] space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"[]"})," = array"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{1}"})," = parent selector"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"{}"})," = object"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"#"})," = number"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-blue-500",children:"?"})," = boolean"]})]}),e.jsx("p",{className:"text-gray-500 pt-1",children:"Indentation = nesting"})]})})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t","data-test":"list-mode-actions-v2",children:[e.jsxs("span",{className:"text-xs",style:{color:$.muted},"data-test":"field-count-v2",children:[i," field",i!==1?"s":""," detected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(re,{variant:"ghost",size:"sm",onClick:n,className:"h-7","data-test":"list-mode-cancel-v2",children:[e.jsx(et,{className:"w-3 h-3 mr-1"}),"Cancel"]}),e.jsxs(re,{size:"sm",onClick:l,disabled:i===0,className:"h-7","data-test":"list-mode-apply-v2",children:[e.jsx(Nt,{className:"w-3 h-3 mr-1"}),"Apply"]})]})]})]})}function ur({action:t,resolvedValue:s,itemElement:n,itemIndex:a,previousAction:r,nextAction:l,onExecute:i,onSkip:c,onCancel:d}){const[u,h]=o.useState(!1),m=o.useRef(null),y=o.useRef(null),p=o.useCallback(()=>{h(!0),i()},[i]);o.useEffect(()=>{const E="manual-mode-pulse-animation";if(!document.getElementById(E)){const k=document.createElement("style");k.id=E,k.textContent=`
        @keyframes manual-mode-pulse {
          0%, 100% {
            box-shadow: 0 0 0 6px rgba(244, 63, 94, 0.3), 0 0 20px rgba(244, 63, 94, 0.4);
          }
          50% {
            box-shadow: 0 0 0 10px rgba(244, 63, 94, 0.5), 0 0 30px rgba(244, 63, 94, 0.6);
          }
        }
        @keyframes manual-mode-pulse-next {
          0%, 100% {
            box-shadow: 0 0 0 4px rgba(234, 179, 8, 0.25), 0 0 15px rgba(234, 179, 8, 0.3);
          }
          50% {
            box-shadow: 0 0 0 8px rgba(234, 179, 8, 0.4), 0 0 25px rgba(234, 179, 8, 0.5);
          }
        }
      `,document.head.appendChild(k)}},[]);const v=o.useRef(null),j=o.useCallback(()=>{v.current&&(clearTimeout(v.current),v.current=null),m.current&&(m.current.style.outline="",m.current.style.outlineOffset="",m.current.style.boxShadow="",m.current.style.backgroundColor="",m.current.style.animation="",m.current=null)},[]),f=o.useCallback(()=>{y.current&&(y.current.style.outline="",y.current.style.outlineOffset="",y.current.style.boxShadow="",y.current.style.animation="",y.current=null)},[]),b=o.useCallback((E,k,T,B=0)=>{let I=n.querySelector(E);if(I||(I=document.querySelector(E)),!I){if(B<20){v.current=setTimeout(()=>{b(E,k,T,B+1)},100);return}return}if(v.current&&(clearTimeout(v.current),v.current=null),I===m.current){I.style.backgroundColor=T?Gt.background:"";return}j(),k?(I.style.outline="3px solid #f43f5e",I.style.outlineOffset="3px",I.style.animation="manual-mode-pulse 1.5s ease-in-out infinite",T||I.scrollIntoView({behavior:"smooth",block:"center"})):(I.style.outline=`2px solid ${Gt.outline}`,I.style.outlineOffset=ct.outlineOffset),T&&(I.style.backgroundColor=Gt.background),m.current=I},[n,j]),x=o.useCallback((E=!1)=>{const k=lt(t);k&&b(k,!0,E)},[b,t]),N=o.useCallback(()=>{const E=r?lt(r):"";E&&b(E,!1,!0)},[b,r]),g=o.useCallback(()=>{const E=l?lt(l):"";E&&b(E,!1,!0)},[b,l]),w=o.useCallback(()=>{f();const E=l?lt(l):"";if(!E)return;let k=n.querySelector(E);k||(k=document.querySelector(E)),k&&(k.style.outline="2px solid #eab308",k.style.outlineOffset="3px",k.style.animation="manual-mode-pulse-next 1.5s ease-in-out infinite",y.current=k)},[l,n,f]);return o.useEffect(()=>(x(),w(),()=>{j(),f()}),[x,w,j,f,t]),e.jsxs("div",{className:"flex flex-col h-full","data-test":"action-confirm-content",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"action-confirm-header",children:[e.jsx(zi,{className:"w-4 h-4 text-rose-500"}),e.jsxs("span",{className:"text-sm font-semibold text-zinc-800",children:["Manual Mode - Item ",a+1]})]}),r&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 px-1","data-test":"action-confirm-previous",children:[e.jsx(Ja,{className:"w-3 h-3"}),e.jsx("span",{className:"uppercase tracking-wide",children:"Prev:"}),e.jsx("span",{className:"font-medium","data-test":"action-confirm-previous-type",children:r.type}),e.jsx("code",{className:"font-mono truncate max-w-[200px] cursor-pointer hover:text-zinc-600 transition-colors","data-test":"action-confirm-previous-selector",onMouseEnter:N,onMouseLeave:()=>x(!1),title:"Hover to highlight element",children:we(lt(r))})]}),e.jsxs("div",{className:"space-y-2 bg-zinc-50 rounded-lg p-3 border border-zinc-200","data-test":"action-confirm-details",children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"action-confirm-type-row",children:[e.jsx("span",{className:"text-xs text-zinc-500 uppercase tracking-wide w-16",children:"Action:"}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded bg-blue-600 text-white","data-test":"action-confirm-type",children:t.type})]}),e.jsxs("div",{className:"flex items-start gap-2","data-test":"action-confirm-selector-row",children:[e.jsx("span",{className:"text-xs text-zinc-500 uppercase tracking-wide w-16 shrink-0 pt-0.5",children:"Selector:"}),e.jsx("code",{className:"text-xs font-mono text-zinc-700 break-all bg-zinc-100 px-2 py-1 rounded cursor-pointer hover:bg-zinc-200 transition-colors flex-1","data-test":"action-confirm-selector",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),title:"Hover to highlight target element",children:we(lt(t))})]}),t.type==="input"&&s!==void 0&&e.jsxs("div",{className:"space-y-1","data-test":"action-confirm-value-row",children:[e.jsx("span",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"Value:"}),e.jsx("textarea",{readOnly:!0,rows:2,value:s,className:"w-full text-sm text-emerald-600 font-medium bg-zinc-100 px-2 py-1 rounded border-none resize-none focus:outline-none","data-test":"action-confirm-value"})]}),t.type==="waitForText"&&e.jsxs("div",{className:"flex items-start gap-2","data-test":"action-confirm-text-row",children:[e.jsx("span",{className:"text-xs text-zinc-500 uppercase tracking-wide w-16 shrink-0 pt-0.5",children:"Text:"}),e.jsxs("span",{className:"text-sm text-zinc-700 break-all","data-test":"action-confirm-text",children:['"',t.text,'"']})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 px-1","data-test":"action-confirm-next",children:[e.jsx(Ye,{className:"w-3 h-3"}),e.jsx("span",{className:"uppercase tracking-wide",children:"Next:"}),e.jsx("span",{className:"font-medium","data-test":"action-confirm-next-type",children:l.type}),e.jsx("code",{className:"font-mono truncate max-w-[200px] cursor-pointer hover:text-zinc-600 transition-colors","data-test":"action-confirm-next-selector",onMouseEnter:g,onMouseLeave:()=>x(!1),title:"Hover to highlight element",children:we(lt(l))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4","data-test":"action-confirm-buttons",children:[e.jsxs(re,{variant:"outline",size:"sm",onClick:d,className:"flex-1 text-red-600 border-red-300 hover:bg-red-50","data-test":"action-confirm-cancel",children:[e.jsx(Ri,{className:"w-4 h-4 mr-1"}),"Cancel"]}),e.jsxs(re,{variant:"outline",size:"sm",onClick:c,className:"flex-1 text-zinc-600 border-zinc-300 hover:bg-zinc-100","data-test":"action-confirm-skip",children:[e.jsx($i,{className:"w-4 h-4 mr-1"}),"Skip"]}),e.jsxs(re,{size:"sm",onClick:p,disabled:u,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-70","data-test":"action-confirm-execute",children:[u?e.jsx(Hs,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(Kt,{className:"w-4 h-4 mr-1"}),u?"Executing...":"Execute"]})]})]})}function xc({activeBranch:t,branchCount:s,parentPath:n,onBranchSwitch:a,onBranchChange:r,onAddBranch:l,className:i}){const c=Array.from({length:s},(d,u)=>u+1);return e.jsxs("div",{className:yt("flex items-center gap-0.5",i),"data-test":"inline-branch-tabs-v2",children:[c.map(d=>e.jsxs("button",{onClick:u=>{u.stopPropagation(),a&&n!==void 0?a(n,d):r&&r(d)},className:yt("px-1 py-px text-[9px] rounded font-mono transition-colors",t===d?"text-white":"bg-muted hover:bg-muted/80 text-muted-foreground"),style:t===d?{backgroundColor:_e.primary}:void 0,"data-test":"branch-tab",children:["[",d,"]"]},d)),e.jsx("button",{onClick:d=>{d.stopPropagation(),l&&n!==void 0&&l(n)},className:"px-1 py-px text-[9px] rounded font-mono bg-muted hover:bg-muted/80 text-muted-foreground transition-colors","data-test":"branch-add-tab-v2",title:"Add new branch",children:"[+]"})]})}function un(t){return He(t)?`${t.operator}(${t.conditions.length})`:t.condition}function fc({node:t,indent:s,isSelector:n,hasChildren:a,hasBranching:r,branchCount:l,branchDetailsExpanded:i,onEditBranching:c,onToggleBranchDetails:d,onToggleIfDirect:u,onToggleBranchField:h,availableBranchFields:m}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{color:t.isArrayItem?$e.arrayIndex:t.name.startsWith("_")?$e.fieldNameUnderscore:$e.fieldName,cursor:r&&c?"pointer":void 0},onDoubleClick:()=>{var f,b;const y=((f=t.branchingMetadata)==null?void 0:f.isBranchParent)??r,p=((b=t.branchingMetadata)==null?void 0:b.isBranchField)??!1;if((y||a)&&n&&u&&t.name!=="_if"){u(t.path);return}if((p||((m==null?void 0:m.includes(t.name))??!1)||n&&!a)&&h&&t.name!=="_if"){const x=t.path.split("."),N=x.pop(),g=x.join(".");h(g,N,!p)}},"data-test":"field-name",children:[s,t.isArrayItem?t.name:`"${t.name}"`]}),t.name==="_if"&&t.conditionalBranching&&c&&e.jsx("button",{onClick:()=>{var p;const y=t.path.replace(/\._if$/,"");c(y,((p=t.conditionalBranching)==null?void 0:p.ifCondition)??null,null)},className:"ml-1 px-1 py-0.5 rounded text-[10px] hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:_e.primary+"20",color:_e.primary},title:"Click to edit condition type","data-test":"if-condition-type-badge-v2",children:un(t.conditionalBranching.ifCondition)}),t.name==="_if"&&t.conditionalBranching&&!c&&e.jsx("span",{className:"ml-1 px-1 py-0.5 rounded text-[10px]",style:{backgroundColor:_e.primary+"20",color:_e.primary},title:`Condition: ${un(t.conditionalBranching.ifCondition)}`,"data-test":"if-condition-type-badge-v2",children:un(t.conditionalBranching.ifCondition)}),r&&t.name!=="_if"&&e.jsxs("button",{onClick:()=>{var y,p;c?c(t.path,((y=t.conditionalBranching)==null?void 0:y.ifCondition)??null,((p=t.conditionalBranching)==null?void 0:p.branches)??null):d()},className:yt("inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors",i?"ring-1 ring-offset-1":"hover:opacity-80"),style:{backgroundColor:_e.primary+"20",color:_e.primary,boxShadow:i?`0 0 0 2px ${_e.primary}`:void 0},title:c?"Click to edit branching":"Click to view branch details","data-test":"branch-indicator-v2",children:[e.jsx(Yt,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:l}),e.jsx(ps,{className:"w-2 h-2 opacity-60"})]}),n&&a&&!r&&c&&e.jsxs("button",{onClick:()=>c(t.path,null,null),className:"inline-flex items-center gap-0.5 ml-1 px-1 py-0.5 rounded text-[10px] transition-colors opacity-0 group-hover:opacity-100 hover:opacity-100",style:{backgroundColor:oe.secondary,color:$.muted},title:"Add conditional branching","data-test":"add-condition-button-v2",children:[e.jsx(ot,{className:"w-2.5 h-2.5"}),e.jsx(Yt,{className:"w-2.5 h-2.5"})]})]})}function hn({fieldPath:t,selector:s,onClick:n,onDoubleClick:a}){const r=l=>{const i=l.currentTarget.getBoundingClientRect();n==null||n(t,s,{x:i.right+8,y:i.top})};return e.jsx("button",{onClick:r,onDoubleClick:()=>a==null?void 0:a(t),className:"p-1 rounded mr-1 hover:opacity-80 transition-opacity",style:{backgroundColor:oe.success},title:"Click: add sibling filter | Double-click: auto-add classes","data-test":"selector-filter-v2",children:e.jsx(Js,{className:"w-3 h-3",style:{color:Te.success}})})}function gc({node:t,isSelector:s,truncateLength:n,activeFieldPath:a,portalContainer:r,onFieldValueClick:l,onFieldValueHover:i,onClearSelector:c,onConfigClick:d,onFilterChildrenClick:u,onNavigateUp:h,onNavigateDown:m,canNavigateDown:y,onSelectorFilterClick:p,onSelectorFilterDoubleClick:v,onArrayBadgeClick:j,onSchemaCountClick:f}){const b=()=>{if(s&&l){const g=ye(t.value)?we(t.value):typeof t.value=="string"?t.value:null;(g!==null||t.name==="_if")&&l(t.path,g??"")}},x=t.value;if(x==null)return t.name==="_if"&&s?e.jsxs("span",{className:"inline-flex items-center","data-test":"if-field-value",children:[e.jsx(hn,{fieldPath:t.path,selector:"",onClick:p,onDoubleClick:v}),e.jsx(ns,{value:"",isSelector:!0,truncateLength:n,onClick:b,onHover:i,onClear:c,isActive:t.path===a,portalContainer:r})]}):e.jsx("span",{style:{color:$e.nullValue},children:"null"});if(ye(x)){const g=we(x);return e.jsxs("span",{className:"inline-flex items-center","data-test":"selector-field-value",children:[s&&e.jsx(hn,{fieldPath:t.path,selector:g,onClick:p,onDoubleClick:v}),e.jsx(ns,{value:g,isSelector:s,truncateLength:n,onClick:s?b:void 0,onHover:i,onClear:s?c:void 0,onConfigClick:s?d:void 0,onFilterChildrenClick:s?u:void 0,onNavigateUp:s?h:void 0,onNavigateDown:s?m:void 0,canNavigateDown:s?y:!1,isActive:s&&t.path===a,portalContainer:r})]})}if(typeof x=="string"){const g=!s&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"string-field-value",children:[s&&e.jsx(hn,{fieldPath:t.path,selector:x,onClick:p,onDoubleClick:v}),e.jsx(ns,{value:x,isSelector:s,truncateLength:n,onClick:s?b:void 0,onHover:i,onClear:s?c:void 0,onConfigClick:s?d:void 0,onFilterChildrenClick:s?u:void 0,onNavigateUp:s?h:void 0,onNavigateDown:s?m:void 0,canNavigateDown:s?y:!1,isActive:s&&t.path===a,portalContainer:r}),g&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}if(typeof x=="object"&&!Array.isArray(x)&&Object.keys(x).length===0)return e.jsx("span",{style:{color:$e.genericValue},children:"{}"});if(Array.isArray(x)){if(!s&&x.length>0){const g=typeof x[0]=="string"?x[0]:String(x[0]),w=x.length-1,E=g.length>n?`${g.slice(0,n)}...`:g;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"array-field-value",children:[e.jsx(ns,{value:E,isSelector:!1,truncateLength:n}),w>0&&e.jsxs("button",{onClick:()=>j==null?void 0:j(t.path,x),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:oe.primary,color:$.white},"data-test":"content-array-badge-v2",children:["+",w]})]})}return e.jsxs("span",{style:{color:$e.genericValue},children:["[",x.length," items]"]})}const N=!s&&t.schemaArrayCount&&t.schemaArrayCount>0;return e.jsxs("span",{className:"inline-flex items-center gap-1","data-test":"primitive-field-value",children:[e.jsx("span",{style:{color:$e.genericValue},children:String(x)}),N&&e.jsxs("button",{onClick:()=>f==null?void 0:f(t.path,t.schemaArrayCount),className:"text-xs px-1.5 py-0.5 rounded-full hover:opacity-80 transition-opacity cursor-pointer",style:{backgroundColor:"#3b82f6",color:"#ffffff"},title:`View all ${t.schemaArrayCount} values`,"data-test":"schema-count-badge-v2",children:["+",t.schemaArrayCount]})]})}function bc({ifCondition:t,branches:s}){const n=He(t)?t.conditions:[t],a=He(t)?t.operator:null;return e.jsxs("div",{className:"ml-4 mt-1 mb-1 p-2 rounded text-[10px] border",style:{backgroundColor:oe.muted,borderColor:_e.primary+"40"},"data-test":"branch-details-v2",children:[n.map((r,l)=>e.jsxs("div",{children:[l>0&&a&&e.jsx("div",{className:"text-center my-0.5",style:{color:_e.primary},"data-test":"condition-operator",children:a}),e.jsxs("div",{className:"flex items-center gap-1 mb-1.5","data-test":"branch-condition",children:[l===0&&e.jsx("span",{style:{color:$.muted},children:"if"}),e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:oe.secondary,color:$.primary},"data-test":"condition-selector",children:we(r.selector)}),e.jsx("span",{className:"px-1 rounded",style:{backgroundColor:_e.primary+"20",color:_e.primary},"data-test":"condition-type",children:r.condition})]})]},l)),Object.entries(s).map(([r,l])=>{const i=Object.keys(l).filter(c=>c!=="match");return e.jsxs("div",{className:"flex items-start gap-1 py-0.5 border-t",style:{borderColor:_e.primary+"20"},"data-test":"branch-item",children:[e.jsx("span",{className:"px-1 rounded shrink-0",style:{backgroundColor:_e.primary,color:$.white},"data-test":"branch-key",children:r}),e.jsx("span",{style:{color:$.muted},children:"match:"}),Array.isArray(l.match)?e.jsx("span",{className:"flex flex-col gap-0.5","data-test":"branch-match",children:l.match.map((c,d)=>e.jsxs("code",{className:"px-1 rounded",style:{backgroundColor:oe.secondary,color:$.primary},"data-test":`branch-match-${d}`,children:["[",d,"]",c]},d))}):e.jsx("code",{className:"px-1 rounded",style:{backgroundColor:oe.secondary,color:$.primary},"data-test":"branch-match",children:l.match}),i.length>0&&e.jsxs("span",{style:{color:$.muted},"data-test":"branch-overrides",children:["(+",i.length," override",i.length>1?"s":"",")"]})]},r)})]})}function hr({node:t,level:s,isLast:n,isSelector:a,valuesCollapsed:r,onFieldValueClick:l,onFieldValueHover:i,onClearSelector:c,onSelectorFilterClick:d,onSelectorFilterDoubleClick:u,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:p,onNavigateUp:v,onNavigateDown:j,canNavigateDown:f,onEditBranching:b,truncateLength:x,activeFieldPath:N,portalContainer:g,isBranchField:w,activeBranch:E,branchCount:k,availableBranchFields:T,branchFields:B,onBranchSwitch:P,onToggleBranchField:_,onToggleIfDirect:I,onAddBranch:C}){var F,z,q,O,U,V,J;const S=w??((F=t.branchingMetadata)==null?void 0:F.isBranchField)??!1,A=E??((z=t.branchingMetadata)==null?void 0:z.activeBranch),R=k??((q=t.branchingMetadata)==null?void 0:q.branchCount)??0,L=T??((O=t.branchingMetadata)==null?void 0:O.availableBranchFields)??[],W=B??((U=t.branchingMetadata)==null?void 0:U.branchFields)??[],D=((V=t.branchingMetadata)==null?void 0:V.isBranchParent)??!1,[H,Z]=o.useState(!0),[le,fe]=o.useState(!1),je=!!(t.children&&t.children.length>0),ae="  ".repeat(s),Y=Array.isArray(t.value)&&je,ne=Y?"[":"{",Q=Y?"]":"}",X=!!t.conditionalBranching,ce=X?Object.keys(t.conditionalBranching.branches).length:0,de=G=>{if(i)if(a){const be=typeof t.value=="object"&&t.value!==null&&"selector"in t.value?we(t.value):typeof t.value=="string"?t.value:null;i(G?be:null,G?t.path:null)}else i(null,G?t.path:null)},ue=()=>{c==null||c(t.path)},ge=G=>{h==null||h(t.path,G)},se=G=>{m==null||m(t.path,G)},Ie=()=>{v==null||v(t.path)},Ce=()=>{j==null||j(t.path)},me=((J=t.children)==null?void 0:J.length)??0,M=Y?`${me} item${me!==1?"s":""}`:`${me} field${me!==1?"s":""}`;return e.jsxs("div",{"data-test":"field-node-v2",children:[e.jsxs("div",{className:"flex items-center group","data-test":"field-node-line",children:[e.jsx(fc,{node:t,indent:ae,isSelector:a,hasChildren:je,hasBranching:X,branchCount:ce,branchDetailsExpanded:le,onEditBranching:b,onToggleBranchDetails:()=>fe(!le),onToggleIfDirect:I,onToggleBranchField:_,availableBranchFields:L}),e.jsxs("span",{style:{color:$e.punctuation},"data-test":"colon",children:[":"," "]}),je?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Z(!H),className:"inline-flex items-center hover:bg-gray-100 rounded px-0.5 transition-colors","data-test":"toggle-v2",children:[H?e.jsx(Ye,{className:"w-3 h-3",style:{color:Te.muted}}):e.jsx(Ve,{className:"w-3 h-3",style:{color:Te.muted}}),e.jsx("span",{style:{color:$e.punctuation},children:ne}),!H&&e.jsxs("span",{style:{color:$e.collapsedLabel},children:[" ",M," "]}),!H&&e.jsx("span",{style:{color:$e.punctuation},children:Q})]}),!H&&!n&&e.jsx("span",{style:{color:$e.punctuation},children:","})]}):e.jsxs(e.Fragment,{children:[e.jsx(gc,{node:t,isSelector:a,truncateLength:x,activeFieldPath:N,portalContainer:g,onFieldValueClick:l,onFieldValueHover:de,onClearSelector:ue,onConfigClick:ge,onFilterChildrenClick:se,onNavigateUp:Ie,onNavigateDown:Ce,canNavigateDown:f==null?void 0:f(t.path),onSelectorFilterClick:d,onSelectorFilterDoubleClick:u,onArrayBadgeClick:y,onSchemaCountClick:p}),!n&&e.jsx("span",{style:{color:$e.punctuation},children:","})]})]}),S&&A!==void 0&&R>0&&e.jsxs("span",{className:"font-mono whitespace-pre","data-test":"branch-tabs-line",children:[ae,"  ",e.jsx(xc,{activeBranch:A,branchCount:R,parentPath:t.path.split(".").slice(0,-1).join("."),onBranchSwitch:P,onAddBranch:C,className:"inline-flex"})]}),X&&le&&e.jsx(bc,{ifCondition:t.conditionalBranching.ifCondition,branches:t.conditionalBranching.branches}),je&&H&&e.jsxs(e.Fragment,{children:[t.children.map((G,be)=>{var Ee;const xe=!!((Ee=G.branchingMetadata)!=null&&Ee.isBranchParent),Ae=D&&!xe;return e.jsx(hr,{node:G,level:s+1,isLast:be===t.children.length-1,isSelector:a,valuesCollapsed:r,onFieldValueClick:l,onFieldValueHover:i,onClearSelector:c,onSelectorFilterClick:d,onSelectorFilterDoubleClick:u,onConfigClick:h,onFilterChildrenClick:m,onArrayBadgeClick:y,onSchemaCountClick:p,onNavigateUp:v,onNavigateDown:j,canNavigateDown:f,onEditBranching:b,truncateLength:x,activeFieldPath:N,portalContainer:g,isBranchField:Ae?W.includes(G.name):void 0,activeBranch:Ae?A:void 0,branchCount:Ae?R:void 0,availableBranchFields:Ae?L:void 0,branchFields:Ae?W:void 0,onBranchSwitch:P,onToggleBranchField:_,onToggleIfDirect:I,onAddBranch:C},G.name)}),e.jsxs("div",{"data-test":"closing-bracket",children:[e.jsxs("span",{style:{color:$e.punctuation},children:[ae,Q]}),!n&&e.jsx("span",{style:{color:$e.punctuation},children:","})]})]})]})}function pr(t,s=""){const n=[];for(const a of Object.keys(t)){const r=s?`${s}.${a}`:a;n.push(r);const l=t[a];l&&typeof l=="object"&&!Array.isArray(l)&&n.push(...pr(l,r))}return n}function mr(t,s){const n=s.split(".");let a=t;for(const r of n){if(a==null)return[];if(typeof a!="object")return[];a=a[r]}return a==null?[]:Array.isArray(a)?a.map(r=>String(r??"")):typeof a=="object"?[]:[String(a)]}function yc(t,s,n,a){const r=mr(t,s),l=[];return r.forEach((i,c)=>{jc(i,n,a)&&l.push({path:`${s}[${c}]`,value:i,index:c})}),l}function jc(t,s,n){const a=t.toLowerCase(),r=n.toLowerCase();switch(s){case"equals":return a===r;case"contains":return a.includes(r);case"startsWith":return a.startsWith(r);case"endsWith":return a.endsWith(r);case"regex":try{return new RegExp(n,"i").test(t)}catch{return!1}case"notEquals":return a!==r;case"notContains":return!a.includes(r);default:return!1}}function Rs(t,s){const n=t.filter(r=>r.toLowerCase().startsWith(s.toLowerCase()));if(n.length===0)return s;if(n.length===1)return n[0];let a=n[0];for(let r=1;r<n.length;r++){let l=0;for(;l<a.length&&l<n[r].length&&a[l].toLowerCase()===n[r][l].toLowerCase();)l++;if(a=a.slice(0,l),a.length===0)return s}return a.length>s.length?a:s}function vc(t,s){const n=mr(t,s);return[...new Set(n)].filter(a=>a.trim()!=="")}function xr(t,s){if(!s)return t;const n=s.toLowerCase();return t.filter(a=>a.toLowerCase().includes(n))}function Nc({value:t,onChange:s,onSelect:n,items:a,placeholder:r="Type to filter...",className:l,disabled:i}){const[c,d]=o.useState(!1),[u,h]=o.useState(0),m=o.useRef(null),y=o.useRef(null),p=o.useMemo(()=>t.trim()?xr(a,t).slice(0,10):a.slice(0,10),[a,t]);o.useEffect(()=>{h(0)},[p.length]);const v=o.useCallback(g=>{s(g.target.value),d(!0)},[s]),j=o.useCallback(g=>{var w;s(g),n==null||n(g),d(!1),(w=m.current)==null||w.focus()},[s,n]),f=o.useCallback(()=>{if(p.length===0)return!1;const g=Rs(p,t);return g.length>t.length?(s(g),!0):p.length===1?(j(p[0]),!0):!1},[p,t,s,j]),b=o.useCallback(g=>{if(!c){(g.key==="ArrowDown"||g.key==="ArrowUp")&&(d(!0),g.preventDefault());return}switch(g.key){case"Escape":g.preventDefault(),d(!1);break;case"ArrowDown":g.preventDefault(),h(w=>w<p.length-1?w+1:0);break;case"ArrowUp":g.preventDefault(),h(w=>w>0?w-1:p.length-1);break;case"Tab":g.preventDefault(),f();break;case"Enter":p.length>0&&(g.preventDefault(),j(p[u]));break}},[c,p,u,f,j]),x=o.useCallback(()=>{setTimeout(()=>d(!1),150)},[]),N=o.useCallback(()=>{a.length>0&&d(!0)},[a.length]);return e.jsx("div",{ref:y,className:"relative","data-test":"fuzzy-value-input",children:e.jsxs(fi,{open:c&&p.length>0,children:[e.jsx(gi,{asChild:!0,children:e.jsx(ke,{ref:m,value:t,onChange:v,onKeyDown:b,onBlur:x,onFocus:N,placeholder:r,disabled:i,className:yt("font-mono text-xs",l),"data-test":"fuzzy-value-input-field"})}),e.jsx(bi,{side:"bottom",align:"start",className:"w-[var(--radix-popover-trigger-width)] p-1",onOpenAutoFocus:g=>g.preventDefault(),"data-test":"fuzzy-value-input-dropdown",children:e.jsx("div",{className:"max-h-[150px] overflow-auto","data-test":"fuzzy-value-input-list",children:p.map(g=>e.jsx("div",{className:yt("px-2 py-1 text-xs cursor-pointer rounded transition-colors truncate",p.indexOf(g)===u?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:w=>{w.preventDefault(),j(g)},onMouseEnter:()=>h(p.indexOf(g)),"data-test":"fuzzy-value-input-item",children:g},g))})})]})})}const wc=[{value:"equals",label:"equals"},{value:"contains",label:"contains"},{value:"startsWith",label:"starts with"},{value:"endsWith",label:"ends with"},{value:"regex",label:"regex"},{value:"notEquals",label:"not equals"},{value:"notContains",label:"not contains"}];function Cc({fieldPath:t,onFieldPathChange:s,availableFieldPaths:n,operator:a,onOperatorChange:r,compareValue:l,onCompareValueChange:i,availableValues:c,filteredItems:d,selectedMatchIndex:u,onSelectedMatchIndexChange:h,isExpanded:m,onExpandedChange:y,onClear:p,portalContainer:v}){const[j,f]=o.useState(!1),[b,x]=o.useState(!1),[N,g]=o.useState(0),w=t?xr(n,t).slice(0,10):n.slice(0,10),E=o.useCallback(_=>{s(_.target.value),x(!0),g(0)},[s]),k=o.useCallback(_=>{s(_),x(!1)},[s]),T=o.useCallback(_=>{if(!b&&w.length>0&&(_.key==="ArrowDown"||_.key==="ArrowUp")){x(!0),_.preventDefault();return}if(b)switch(_.key){case"Escape":_.preventDefault(),x(!1);break;case"ArrowDown":_.preventDefault(),g(I=>I<w.length-1?I+1:0);break;case"ArrowUp":_.preventDefault(),g(I=>I>0?I-1:w.length-1);break;case"Tab":if(_.preventDefault(),w.length>0){const I=Rs(w,t);I.length>t.length?s(I):w.length===1&&k(w[0])}break;case"Enter":w.length>0&&(_.preventDefault(),k(w[N]));break}},[b,w,t,N,s,k]),B=t.trim()!==""&&l.trim()!=="",P=d.length;return e.jsxs("div",{className:"border-t bg-muted/30","data-test":"content-filter-section",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-muted/50",onClick:()=>y(!m),"data-test":"content-filter-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Ye,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(Ve,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Js,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"Content Filter"}),B&&P>0&&e.jsxs("span",{className:"text-xs bg-primary text-primary-foreground px-1.5 py-0.5 rounded","data-test":"filter-match-badge",children:[P," match",P!==1?"es":""]})]}),B&&e.jsx(re,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:_=>{_.stopPropagation(),p()},"data-test":"filter-clear-btn",children:e.jsx(et,{className:"w-3 h-3"})})]}),m&&e.jsxs("div",{className:"px-3 pb-3 space-y-2","data-test":"content-filter-controls",children:[e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"text-xs text-muted-foreground",children:"Field Path"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{value:t,onChange:E,onKeyDown:T,onFocus:()=>x(!0),onBlur:()=>setTimeout(()=>x(!1),150),placeholder:"e.g., champions._item.cost",className:"font-mono text-xs mt-1","data-test":"filter-field-path-input"}),b&&w.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-[150px] overflow-auto","data-test":"filter-field-path-dropdown",children:w.map((_,I)=>e.jsx("div",{className:yt("px-2 py-1 text-xs font-mono cursor-pointer",I===N?"bg-accent text-accent-foreground":"hover:bg-muted"),onMouseDown:C=>{C.preventDefault(),k(_)},onMouseEnter:()=>g(I),"data-test":"filter-field-path-item",children:_},_))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-28",children:[e.jsx(De,{className:"text-xs text-muted-foreground",children:"Operator"}),e.jsxs(Fe,{value:a,onValueChange:_=>r(_),children:[e.jsx(Me,{className:"mt-1 text-xs h-8","data-test":"filter-operator-select",children:e.jsx(xt,{})}),e.jsx(Be,{container:v,children:wc.map(_=>e.jsx(he,{value:_.value,className:"text-xs","data-test":"filter-operator-option",children:_.label},_.value))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(De,{className:"text-xs text-muted-foreground",children:"Value"}),e.jsx("div",{className:"mt-1",children:e.jsx(Nc,{value:l,onChange:i,items:c,placeholder:"Type value to filter...","data-test":"filter-value-input"})})]})]}),B&&P>1&&e.jsxs("div",{className:"pt-2 border-t border-dashed","data-test":"filter-matches-section",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pn,{className:"w-3.5 h-3.5 text-primary"}),e.jsxs("span",{className:"text-xs font-medium",children:["Navigate Matches (",P,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-20 overflow-y-auto",children:d.map((_,I)=>e.jsxs("button",{onClick:()=>h(I),className:yt("px-2 py-1 rounded text-xs font-mono transition-all",I===u?"bg-primary text-primary-foreground font-bold shadow-sm":"bg-muted text-muted-foreground hover:bg-muted/80 border"),title:_.value,"data-test":"filter-match-item",children:["[",_.index,"]"]},I))})]}),B&&P>0&&e.jsxs("div",{className:"pt-2","data-test":"filter-results-section",children:[e.jsxs("button",{onClick:()=>f(!j),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground","data-test":"filter-results-toggle",children:[j?e.jsx(Ye,{className:"w-3 h-3"}):e.jsx(Ve,{className:"w-3 h-3"}),e.jsxs("span",{children:["Filtered Results (",P,")"]})]}),j&&e.jsx("div",{className:"mt-2 bg-background border rounded p-2 max-h-32 overflow-auto","data-test":"filter-results-list",children:d.map((_,I)=>e.jsxs("div",{className:yt("text-xs font-mono py-0.5 px-1 rounded",I===u&&"bg-primary/10"),"data-test":"filter-result-item",children:[e.jsxs("span",{className:"text-muted-foreground",children:[_.path,":"]})," ",e.jsxs("span",{className:"text-foreground",children:['"',_.value,'"']})]},I))})]}),B&&P===0&&e.jsx("div",{className:"text-xs text-muted-foreground italic py-2","data-test":"filter-no-matches",children:"No matches found"})]})]})}const kc={selectors:"Selectors",content:"Content",actions:"Actions"};function pn({mode:t,isActive:s,onModeChange:n,onCopy:a,onImport:r}){const l=kc[t],i=t==="selectors"&&s&&r;return e.jsxs("button",{onClick:()=>n(t),className:`flex-1 px-3 py-2 text-xs font-medium transition-colors flex items-center justify-center gap-1 border-b-2 ${s?"bg-white dark:bg-zinc-800 text-blue-600 dark:text-blue-400 border-blue-600 dark:border-blue-400":"bg-zinc-100 dark:bg-zinc-700 text-zinc-500 dark:text-zinc-400 border-transparent"}`,"data-test":"preview-tab-button-v2",children:[l,s&&a&&e.jsx("span",{onClick:c=>{c.stopPropagation(),a()},className:"p-0.5 rounded hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors",title:`Copy ${t}`,"data-test":"copy-button",children:e.jsx($n,{className:"w-3 h-3"})}),i&&e.jsx("span",{onClick:c=>{c.stopPropagation(),r()},className:"p-0.5 rounded hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors",title:"Import schema","data-test":"import-selectors-button-v2",children:e.jsx(jt,{className:"w-3 h-3"})})]})}const ya={fieldPath:"",operator:"equals",compareValue:"",isExpanded:!1};function Sc(t){const[s,n]=o.useState(ya),[a,r]=o.useState(0),l=o.useMemo(()=>pr(t),[t]),i=o.useMemo(()=>s.fieldPath?vc(t,s.fieldPath):[],[t,s.fieldPath]),c=o.useMemo(()=>!s.fieldPath||!s.compareValue?[]:yc(t,s.fieldPath,s.operator,s.compareValue),[t,s.fieldPath,s.operator,s.compareValue]),d=c.length,u=o.useCallback((f,b)=>Rs(f,b),[]),h=o.useCallback((f,b)=>Rs(f,b),[]),m=o.useCallback(f=>{n(b=>({...b,fieldPath:f,compareValue:""})),r(0)},[]),y=o.useCallback(f=>{n(b=>({...b,operator:f})),r(0)},[]),p=o.useCallback(f=>{n(b=>({...b,compareValue:f})),r(0)},[]),v=o.useCallback(f=>{n(b=>({...b,isExpanded:f}))},[]),j=o.useCallback(()=>{n(ya),r(0)},[]);return{filterState:s,filteredItems:c,matchCount:d,selectedMatchIndex:a,availableFieldPaths:l,findFieldPathLCS:u,availableValues:i,findValueLCS:h,setFieldPath:m,setOperator:y,setCompareValue:p,setSelectedMatchIndex:r,setExpanded:v,clearFilter:j}}function Ec(t,s){if(!t||!s)return null;const n=t.split(".");if(n.length<2)return null;const a=n[n.length-1],r=n.slice(0,-1);let l=s;for(const p of r){if(typeof l!="object"||l===null)return null;l=l[p]}if(typeof l!="object"||l===null)return null;const i=l,c=i._branchFields;if(!(c!=null&&c.includes(a)))return null;const d=i._if;if(!d)return null;let u;if(typeof d=="string")u=d;else if(typeof d=="object"&&d.selector)u=d.selector;else return null;if(!u)return null;const h=i._activeBranch||1,m=i._branches;if(!m)return null;const y=Object.entries(m).map(([p,v])=>({branchNum:parseInt(p),match:(v==null?void 0:v.match)||"/./"})).sort((p,v)=>p.branchNum-v.branchNum);return{ifSelector:u,activeBranch:h,allBranchPatterns:y}}function _c(t,s){if(!t||!s)return null;const n=t.split(".");if(n.length<2)return null;const a=n[n.length-1],r=n.slice(0,-1);let l=s;for(const p of r){if(typeof l!="object"||l===null)return null;l=l[p]}if(typeof l!="object"||l===null)return null;const i=l,c=i._branchFields;if(!(c!=null&&c.includes(a)))return null;const d=i._if;if(!d)return null;let u;if(typeof d=="string")u=d;else if(typeof d=="object"&&d.selector)u=d.selector;else return null;if(!u)return null;const h=i._branches;if(!h)return null;const m=[],y=Object.keys(h).sort((p,v)=>parseInt(p)-parseInt(v));for(const p of y){const v=h[p];if(!v||typeof v!="object")continue;const j=v.match||"/./",f=v[a];let b="";typeof f=="string"?b=f:ye(f)&&(b=we(f)),m.push({pattern:j,selector:b})}return{ifSelector:u,branchSelectors:m}}function wn(t,s,n){var i;const a=t.querySelector(s),r=((i=a==null?void 0:a.textContent)==null?void 0:i.trim())||"",l=!!a;if(n==="true")return l;if(n===".")return!0;try{return new RegExp(n).test(r)}catch{return!0}}function Ic(t,s){const{ifSelector:n,activeBranch:a,allBranchPatterns:r}=s,l=r.find(d=>d.branchNum===a);if(!l)return t;const i=l.match.replace(/^\/|\/$/g,""),c=r.filter(d=>d.branchNum<a).map(d=>d.match.replace(/^\/|\/$/g,""));return t.filter(d=>{if(d===document)return!0;const u=d;for(const h of c)if(wn(u,n,h))return!1;return wn(u,n,i)})}function mn(t,s){const n=s.split("."),a=n[0],r=t[a];if(!Array.isArray(r))return 0;const l=n.slice(1),i=(d,u)=>{if(u.length===0)return 1;const[h,...m]=u;return Array.isArray(d)?d.reduce((y,p)=>y+i(p==null?void 0:p[h],m),0):d&&typeof d=="object"?i(d[h],m):0};let c=0;for(const d of r)c+=i(d,l);return c}function $s(t,s=""){const n=["_branches","_branchFields","_activeBranch"],a=Object.entries(t).filter(([c])=>!n.includes(c)),r={_container:0,_item:1,_if:2};a.sort(([c],[d])=>{const u=r[c]??3,h=r[d]??3;return u-h});const i=Nn(t)?t:null;if(i){const c=new Set(a.map(([u])=>u)),d=i._branches[String(i._activeBranch)]||{};for(const u of i._branchFields)c.has(u)||a.push([u,d[u]??""])}return a.map(([c,d])=>{var y;const u=s?`${s}${c}`:c;if(c==="_if"){if(is(d)){if(He(d)){const v=((y=d.conditions[0])==null?void 0:y.selector)??"";return{name:"_if",path:u,value:v,conditionalBranching:{ifCondition:d,branches:{}}}}const p=typeof d=="string"?{selector:d,condition:"exists"}:d;return{name:"_if",path:u,value:p.selector,conditionalBranching:{ifCondition:p,branches:{}}}}return{name:"_if",path:u,value:null,conditionalBranching:{ifCondition:{selector:"",condition:"exists"},branches:{}}}}let h=d;if(i!=null&&i._branchFields.includes(c)){const p=i._branches[String(i._activeBranch)]||{};c in p&&(h=p[c])}const m={name:c,path:u,value:h};if(i!=null&&i._branchFields.includes(c)&&(m.branchingMetadata={isBranchField:!0,activeBranch:i._activeBranch,branchCount:Object.keys(i._branches).length,branchFields:i._branchFields}),!ye(h))if(h&&typeof h=="object"&&!Array.isArray(h)){const p=h,v=p._if,j=p._branches;if(is(v)&&Zs(j)){const f=typeof v=="string"?{selector:v,condition:"exists"}:v;m.conditionalBranching={ifCondition:f,branches:j}}if(Nn(p)){const f=p,b=Object.keys(p).filter(g=>!g.startsWith("_")),x=f._branchFields,N=[...new Set([...b,...x])];m.branchingMetadata={isBranchParent:!0,activeBranch:f._activeBranch,branchCount:Object.keys(f._branches).length,branchFields:f._branchFields,availableBranchFields:N}}m.children=$s(p,`${u}.`)}else Array.isArray(h)&&h.length>0&&typeof h[0]=="object"&&h[0]!==null&&(m.children=h.map((p,v)=>({name:`[${v}]`,path:`${u}[${v}]`,value:p,isArrayItem:!0,arrayIndex:v,children:typeof p=="object"&&p!==null&&!ye(p)?$s(p,`${u}[${v}].`):void 0})));return m})}function Cn(t,s="",n=null,a=null){const r=n??t;return Object.entries(t).map(([l,i])=>{const c=s?`${s}${l}`:l,d={name:l,path:c,value:i};if(a!==null&&(d.schemaArrayCount=mn(r,c)),Array.isArray(i)&&i.length>0){const u=i[0];typeof u=="object"&&u!==null?(d.schemaArrayCount=mn(r,c),d.value=u,d.children=Cn(u,`${c}.`,r,i.length)):(d.schemaArrayCount=mn(r,c),d.value=u)}else i&&typeof i=="object"&&!Array.isArray(i)&&(d.children=Cn(i,`${c}.`,r,a));return d})}function kn(t){if(Array.isArray(t))return t.map(kn);if(t&&typeof t=="object"){if(ye(t))return t;const s={},n=new Set(["_branchFields","_activeBranch"]);for(const[a,r]of Object.entries(t))n.has(a)||(s[a]=kn(r));return s}return t}function Sn(t){if(Array.isArray(t))return t.map(Sn);if(t&&typeof t=="object"){const s={};for(const[n,a]of Object.entries(t))n.startsWith("_")||(s[n]=Sn(a));return s}return t}function Ac({mode:t,onModeChange:s,selectors:n,content:a,onFieldValueClick:r,onFieldValueHover:l,onClearSelector:i,onSelectorFilterClick:c,onSelectorFilterDoubleClick:d,onConfigClick:u,onFilterChildrenClick:h,onArrayBadgeClick:m,onNavigateUp:y,onNavigateDown:p,canNavigateDown:v,onEditBranching:j,onImportClick:f,onPasteSelectors:b,contentViewMode:x="schema",onSchemaCountClick:N,activeFieldPath:g,className:w,portalContainer:E,onBranchSwitch:k,onToggleBranchField:T,onToggleIfDirect:B,onAddBranch:P,manualAction:_,onManualExecute:I,onManualSkip:C,onManualCancel:S}){const[A,R]=o.useState(!0),L=o.useRef(!1),W=o.useRef(null),D=o.useRef(null),H=o.useCallback(F=>{var O;const z=(O=F.target.files)==null?void 0:O[0];if(!z||!b)return;const q=new FileReader;q.onload=U=>{var V;try{const J=JSON.parse((V=U.target)==null?void 0:V.result);typeof J=="object"&&J!==null&&!Array.isArray(J)?b(J):te.error("File content is not a valid JSON object")}catch{te.error("File content is not valid JSON")}},q.readAsText(z),F.target.value=""},[b]),Z=t==="selectors"?n:a,{filterState:le,filteredItems:fe,selectedMatchIndex:je,availableFieldPaths:ae,availableValues:Y,setFieldPath:ne,setOperator:Q,setCompareValue:X,setSelectedMatchIndex:ce,setExpanded:de,clearFilter:ue}=Sc(Z),ge=t==="selectors"?$s(n):x==="schema"?Cn(a):$s(a),se=Object.keys(Z).length===0,Ie=A?yn.collapsed:yn.expanded,Ce=o.useCallback((F,z)=>{if(l){if(t==="selectors"||F){l(F,z);return}if(z){const q=_c(z,n);if(q){l(null,z,q);return}const O=z.split(".");let U=n;for(const J of O){if(typeof U!="object"||U===null){U=void 0;break}U=U[J]}let V=null;ye(U)?V=we(U):typeof U=="string"&&(V=U),l(V,z)}else l(null,null)}},[t,l,n]),me=async()=>{try{const F=kn(n),z=JSON.stringify(F,null,2);await navigator.clipboard.writeText(z),te.success("Selectors copied to clipboard!")}catch{te.error("Failed to copy to clipboard")}},M=async()=>{try{const F=Sn(a),z=JSON.stringify(F,null,2);await navigator.clipboard.writeText(z),te.success("Content copied to clipboard!")}catch{te.error("Failed to copy to clipboard")}};return o.useEffect(()=>{if(!b||t!=="selectors"||!se)return;const F=async z=>{var O;if(!L.current)return;const q=(O=z.clipboardData)==null?void 0:O.getData("text/plain");if(q)try{const U=JSON.parse(q);typeof U=="object"&&U!==null&&!Array.isArray(U)?(z.preventDefault(),b(U)):te.error("Clipboard content is not a valid JSON object")}catch{te.error("Clipboard content is not valid JSON")}};return document.addEventListener("paste",F),()=>document.removeEventListener("paste",F)},[b,t,se]),e.jsxs("div",{className:`flex flex-col h-full ${w??""}`,"data-test":"preview-tabs-v2",children:[e.jsxs("div",{className:"flex border-b shrink-0",style:{backgroundColor:oe.white},"data-test":"preview-mode-tabs-v2",children:[e.jsx(pn,{mode:"selectors",isActive:t==="selectors",onModeChange:s,onCopy:me,onImport:f}),e.jsx(pn,{mode:"content",isActive:t==="content",onModeChange:s,onCopy:M}),_&&e.jsx(pn,{mode:"actions",isActive:t==="actions",onModeChange:s})]}),e.jsx("div",{ref:W,className:"flex-1 overflow-auto p-2",onMouseEnter:()=>{L.current=!0},onMouseLeave:()=>{L.current=!1},"data-test":"preview-content-v2",children:t==="actions"&&_?e.jsx(ur,{action:_.action,resolvedValue:_.resolvedValue,itemElement:_.itemElement,itemIndex:_.itemIndex,previousAction:_.previousAction,nextAction:_.nextAction,onExecute:I??(()=>{}),onSkip:C??(()=>{}),onCancel:S??(()=>{})}):se?e.jsxs("div",{className:"text-sm text-center py-8 flex flex-col items-center gap-3",style:{color:$.placeholder},"data-test":"empty-preview-v2",children:[e.jsx("span",{children:t==="selectors"?"Paste to apply selectors JSON":"No content extracted"}),t==="selectors"&&b&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:D,type:"file",accept:".json",onChange:H,className:"hidden","data-test":"upload-json-file-input"}),e.jsxs("button",{onClick:()=>{var F;return(F=D.current)==null?void 0:F.click()},className:"flex items-center gap-1 text-xs px-3 py-1.5 rounded border transition-colors hover:bg-zinc-100",style:{color:$.muted,borderColor:$.muted},"data-test":"upload-json-file-button",children:[e.jsx(jt,{className:"w-3 h-3"}),"Upload .json"]})]})]}):e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!A),className:"absolute top-1 right-1 flex items-center gap-1 text-xs px-1.5 py-0.5 rounded hover:bg-gray-200 transition-colors",style:{color:$.muted,backgroundColor:oe.whiteAlpha},title:A?"Expand values":"Collapse values","data-test":"toggle-values-collapse-v2",children:[A?e.jsx(Ve,{className:"w-3 h-3"}):e.jsx(Ye,{className:"w-3 h-3"}),e.jsx("span",{children:A?"Expand":"Collapse"})]}),e.jsxs("pre",{className:"text-xs font-mono m-0 p-0",style:{background:"transparent"},"data-test":"json-tree-v2",children:[e.jsx("span",{style:{color:$e.punctuation},children:"{"}),ge.map((F,z)=>e.jsx(hr,{node:F,level:1,isLast:z===ge.length-1,isSelector:t==="selectors",valuesCollapsed:A,onFieldValueClick:r,onFieldValueHover:Ce,onClearSelector:i,onSelectorFilterClick:c,onSelectorFilterDoubleClick:d,onConfigClick:u,onFilterChildrenClick:h,onArrayBadgeClick:m,onSchemaCountClick:N,onNavigateUp:y,onNavigateDown:p,canNavigateDown:v,onEditBranching:t==="selectors"?j:void 0,truncateLength:Ie,activeFieldPath:t==="selectors"?g:null,portalContainer:E,onBranchSwitch:k,onToggleBranchField:T,onToggleIfDirect:B,onAddBranch:P},F.name)),e.jsx("span",{style:{color:$e.punctuation},children:"}"})]})]})}),e.jsx(Cc,{fieldPath:le.fieldPath,onFieldPathChange:ne,availableFieldPaths:ae,operator:le.operator,onOperatorChange:Q,compareValue:le.compareValue,onCompareValueChange:X,availableValues:Y,filteredItems:fe,selectedMatchIndex:je,onSelectedMatchIndexChange:ce,isExpanded:le.isExpanded,onExpandedChange:de,onClear:ue,portalContainer:E})]})}function Tc(t){const s=t.match(/:has-text\(["']([^"']+)["']\)$/);if(s){const n=s[1].split("|").map(a=>a.trim()).filter(Boolean);return{baseSelector:t.replace(/:has-text\(["'][^"']+["']\)$/,"").trim(),textFilters:n.length>0?n:null}}return{baseSelector:t,textFilters:null}}function vt(t,s){var i;const{baseSelector:n,textFilters:a}=Tc(s);if(!a)return t.querySelector(n);const r=t.querySelectorAll(n),l=a.map(c=>c.toLowerCase());for(const c of r){const d=((i=c.textContent)==null?void 0:i.toLowerCase())??"";if(l.some(u=>d.includes(u)))return c}return null}function Ht(t,s){return t.replace(/\{\{(\w+)(?:\[(-?\d+)\])?\}\}/g,(n,a,r)=>{let l;if(a==="index"?l=String(s.index):a in s.fieldValues&&(l=s.fieldValues[a]),l===void 0)return n;if(r===void 0)return l;const i=l.split(/\s+/).filter(Boolean);if(i.length===0)return"";const c=parseInt(r,10),d=c<0?i.length+c:c;return i[d]??n})}function Oc(t){if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&"selector"in t){const s=t;if(typeof s.selector=="string")return s.selector}return null}function ja(t,s){var a;const n={};for(const[r,l]of Object.entries(s)){if(r.startsWith("_"))continue;const i=Oc(l);if(i)try{const c=vt(t,i);c&&(n[r]=((a=c.textContent)==null?void 0:a.trim())??"")}catch{}}return n}function Ls(t){let s=t;t.startsWith("/")&&t.endsWith("/")&&(s=t.slice(1,-1));try{return new RegExp(s)}catch{return null}}function va(t,s,n){for(let a=0;a<t.length;a++){const r=t[a],l=Array.isArray(r.match)?r.match:null,i=l?null:Ls(r.match);let c=!1;if(l){const d=s.values.map((u,h)=>{const m=l[h]??l[l.length-1]??"/./",y=Ls(m);return y?y.test(u):!1});s.operator==="AND"?c=d.every(Boolean):s.operator==="OR"?c=d.some(Boolean):c=d[0]??!1}else i&&(s.operator==="AND"?c=s.values.every(d=>i.test(d)):s.operator==="OR"?c=s.values.some(d=>i.test(d)):c=i.test(s.values[0]));if(c)return{index:a,branch:r}}return null}function Dc(t,s){const n=Array.isArray(t.match)?t.match:null,a=n?null:Ls(t.match),r=[];return n?s.values.forEach((l,i)=>{const c=n[i]??n[n.length-1]??"/./",d=Ls(c);d&&d.test(l)&&r.push(i)}):a&&s.values.forEach((l,i)=>{a.test(l)&&r.push(i)}),r}let At=null,Tt=null,As=null,ls=[];function En(t){const s=t;At={outline:s.style.outline,outlineOffset:s.style.outlineOffset,boxShadow:s.style.boxShadow,animation:s.style.animation},s.style.outline="3px solid #f43f5e",s.style.outlineOffset="3px",s.style.boxShadow="0 0 0 8px rgba(244, 63, 94, 0.4), 0 0 25px rgba(244, 63, 94, 0.5)",s.scrollIntoView({behavior:"smooth",block:"center"})}function Lt(t){const s=t;At?(s.style.outline=At.outline,s.style.outlineOffset=At.outlineOffset,s.style.boxShadow=At.boxShadow,s.style.animation=At.animation,At=null):(s.style.outline="",s.style.outlineOffset="",s.style.boxShadow="",s.style.animation="")}function Fc(t){mt();const s=t;Tt={outline:s.style.outline,outlineOffset:s.style.outlineOffset,boxShadow:s.style.boxShadow,animation:s.style.animation},s.style.outline="2px solid #eab308",s.style.outlineOffset="3px",s.style.boxShadow="0 0 0 6px rgba(234, 179, 8, 0.3), 0 0 15px rgba(234, 179, 8, 0.4)",s.style.animation="manual-mode-pulse-next 1.5s ease-in-out infinite",As=s}function mt(){if(!As)return;const t=As;Tt?(t.style.outline=Tt.outline,t.style.outlineOffset=Tt.outlineOffset,t.style.boxShadow=Tt.boxShadow,t.style.animation=Tt.animation,Tt=null):(t.style.outline="",t.style.outlineOffset="",t.style.boxShadow="",t.style.animation=""),As=null}function Mc(){const t="wait-selector-pulse-animation";if(document.getElementById(t))return;const s=document.createElement("style");s.id=t,s.textContent=`
    @keyframes wait-selector-pulse {
      0%, 100% {
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.6), 0 0 8px rgba(34, 197, 94, 0.4);
      }
      50% {
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.9), 0 0 20px rgba(34, 197, 94, 0.6);
      }
    }
  `,document.head.appendChild(s)}function Bc(t){Mc(),fr();for(const s of t){const n=s;ls.push({element:n,original:{outline:n.style.outline,outlineOffset:n.style.outlineOffset,boxShadow:n.style.boxShadow,animation:n.style.animation}}),n.style.outline="3px solid #22c55e",n.style.outlineOffset="2px",n.style.boxShadow="0 0 0 3px rgba(34, 197, 94, 0.6), 0 0 8px rgba(34, 197, 94, 0.4)",n.style.animation="wait-selector-pulse 1.5s ease-in-out infinite"}ls.length>0&&ls[0].element.scrollIntoView({behavior:"smooth",block:"center"})}function fr(){for(const{element:t,original:s}of ls)t.style.outline=s.outline,t.style.outlineOffset=s.outlineOffset,t.style.boxShadow=s.boxShadow,t.style.animation=s.animation;ls=[]}const cs=5e3,gr=100,_n=600,Pc={bubbles:!0,cancelable:!0,view:window};function tt(t,s){return new Promise((n,a)=>{if(s!=null&&s.aborted){a(new DOMException("Aborted","AbortError"));return}const r=setTimeout(n,t);s==null||s.addEventListener("abort",()=>{clearTimeout(r),a(new DOMException("Aborted","AbortError"))},{once:!0})})}function dt(t){return t instanceof DOMException&&t.name==="AbortError"}function In(t){const s=t.getBoundingClientRect(),n=s.left+s.width/2,a=s.top+s.height/2,r=document.elementFromPoint(n,a)??t,l={...Pc,clientX:n,clientY:a,button:0};r.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0})),r.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!0})),r.dispatchEvent(new MouseEvent("mousedown",l)),r.dispatchEvent(new MouseEvent("mouseup",l)),r instanceof HTMLElement?r.click():r.dispatchEvent(new MouseEvent("click",l))}function zc(t,s){const n=s??document.body,a={key:t,code:Rc(t),bubbles:!0,cancelable:!0,view:window};n.dispatchEvent(new KeyboardEvent("keydown",a)),n.dispatchEvent(new KeyboardEvent("keyup",a))}function Rc(t){const s={Escape:"Escape",Enter:"Enter",Backspace:"Backspace",Delete:"Delete"};if(s[t])return s[t];const n=t.toLowerCase();return n.length===1&&n>="a"&&n<="z"?`Key${n.toUpperCase()}`:t}async function $c(t,s,n){var l;const a=s.timeout??cs,r=Date.now();for(;Date.now()-r<a;){if(n!=null&&n.aborted)return{success:!1,aborted:!0};let i=vt(t,s.selector);i||(i=vt(document,s.selector));const c=((l=i==null?void 0:i.textContent)==null?void 0:l.trim())??"(element not found)";if(i&&c.includes(s.text))return{success:!0};try{await tt(gr,n)}catch(d){if(dt(d))return{success:!1,aborted:!0};throw d}}return{success:!1,error:`Timeout waiting for text "${s.text}" in ${s.selector}`}}async function Zt(t,s,n=cs,a){const r=Date.now();for(;Date.now()-r<n;){if(a!=null&&a.aborted)return null;let l=vt(s,t);if(l||(l=vt(document,t)),l)return l;try{await tt(gr,a)}catch(i){if(dt(i))return null;throw i}}return null}function Lc(t,s){var r;const n=t instanceof HTMLTextAreaElement?window.HTMLTextAreaElement.prototype:window.HTMLInputElement.prototype,a=(r=Object.getOwnPropertyDescriptor(n,"value"))==null?void 0:r.set;a?a.call(t,s):t.value=s,t.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0}))}async function Vc(t,s,n,a=!1,r){if(r!=null&&r.aborted)return{success:!1,aborted:!0};const l=await Zt(s.selector,t,cs,r);if(r!=null&&r.aborted)return{success:!1,aborted:!0};if(!l)return{success:!1,error:`Target element not found after timeout: ${s.selector}`};if(a){En(l);try{await tt(_n,r)}catch(c){if(Lt(l),dt(c))return{success:!1,aborted:!0};throw c}Lt(l)}const i=Ht(s.value,n);try{return l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?(l.focus(),Lc(l,i),{success:!0}):l instanceof HTMLElement&&l.isContentEditable?(l.focus(),l.textContent=i,l.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0})),{success:!0}):{success:!1,error:`Element is not an input, textarea, or contenteditable: ${s.selector}`}}catch(c){return{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}async function An(t,s,n,a=!1,r=Ys,l){if(t.type==="if")return{success:!1,error:"IfAction should be handled by executeIfAction"};if(l!=null&&l.aborted)return{success:!1,aborted:!0};const i=t.delay??er,c=a&&r>0?Math.floor(Math.random()*(r-da+1))+da:0,d=i+c;if(d>0)try{await tt(d,l)}catch(h){if(dt(h))return{success:!1,aborted:!0};throw h}if(t.type==="waitForText")return await $c(s,t,l);if(t.type==="input")return n?await Vc(s,t,n,a,l):{success:!1,error:"Input action requires template context"};if(t.type==="key")try{let h;if(t.selector){const m=await Zt(t.selector,s,cs,l);if(l!=null&&l.aborted)return{success:!1,aborted:!0};if(!m)return{success:!1,error:`Target element not found for key action: ${t.selector}`};if(h=m,a){En(h);try{await tt(_n,l)}catch(y){if(Lt(h),dt(y))return{success:!1,aborted:!0};throw y}Lt(h)}}return zc(t.key,h),{success:!0}}catch(h){return{success:!1,error:h instanceof Error?h.message:"Unknown error"}}if(l!=null&&l.aborted)return{success:!1,aborted:!0};const u=await Zt(t.selector,s,cs,l);if(l!=null&&l.aborted)return{success:!1,aborted:!0};if(!u)return{success:!1,error:`Target element not found after timeout: ${t.selector}`};if(a){En(u);try{await tt(_n,l)}catch(h){if(Lt(u),dt(h))return{success:!1,aborted:!0};throw h}Lt(u)}try{switch(t.type){case"click":In(u);break;case"hover":u.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!0})),u.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0}));break;case"focus":u instanceof HTMLElement&&u.focus();break;default:return{success:!1,error:`Unknown action type: ${t.type}`}}return{success:!0}}catch(h){return{success:!1,error:h instanceof Error?h.message:"Unknown error"}}}function Uc(t){if(t==="*")return/.*/;const s=t.match(/^\/(.+)\/([gimsuy]*)$/);if(s)try{return new RegExp(s[1],s[2])}catch{return null}try{return new RegExp(`^${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}$`)}catch{return null}}async function Wc(t,s,n,a,r,l,i,c){var y,p,v,j,f;if(console.log("[DEBUG executeIfAction] START",{selector:(y=t._if)==null?void 0:y.selector,condition:(p=t._if)==null?void 0:p.condition,branchCount:(v=t._branches)==null?void 0:v.length}),l!=null&&l.aborted)return{success:!1,aborted:!0};const d=Xt(t._if,s),u=d.values[0]??"";console.log("[DEBUG executeIfAction] condition evaluated",{conditionResult:d,conditionValue:u});const h=t._branches.find(b=>{const x=Uc(b.match),N=x?x.test(u):!1;return console.log("[DEBUG executeIfAction] checking branch",{match:b.match,label:b.label,regex:x==null?void 0:x.toString(),matches:N}),N});if(console.log("[DEBUG executeIfAction] matched branch",{matchedLabel:h==null?void 0:h.label,matchedMatch:h==null?void 0:h.match,actionsCount:(j=h==null?void 0:h._actions)==null?void 0:j.length}),!h||!((f=h._actions)!=null&&f.length))return console.log("[DEBUG executeIfAction] no matching branch or no actions, skipping"),{success:!0};console.log("[DEBUG executeIfAction] executing branch actions",h._actions);const m=await br(h._actions,s,n,a,r,l,void 0,i,c);return console.log("[DEBUG executeIfAction] branch execution result",m),{success:m.success,error:m.error,aborted:m.aborted}}async function br(t,s,n,a=!1,r=Ys,l,i,c,d){let u=0,h=s;for(let m=0;m<t.length;m++){const y=t[m];if(y.active===!1)continue;if(l!=null&&l.aborted)return mt(),{success:!1,completedCount:u,aborted:!0};if(await(d==null?void 0:d()),i==null||i(m),y.type==="if"){const v=await Wc(y,h,n,a,r,l,c,d);if(v.aborted)return mt(),{success:!1,completedCount:u,aborted:!0};if(!v.success)return mt(),{success:!1,error:v.error,completedCount:u};u++;continue}const p=await An(y,h,n,a,r,l);if(p.aborted)return mt(),{success:!1,completedCount:u,aborted:!0};if(!p.success)return mt(),{success:!1,error:p.error,completedCount:u};if(u++,y.type==="click"&&c&&!document.contains(h)){const v=c();v&&(h=v)}if(a){let v;for(let j=m+1;j<t.length;j++)if(t[j].active!==!1){v=t[j];break}if(v&&"selector"in v&&v.selector){const j=Ht(v.selector,n),f=await Zt(j,h,1e3,l);f?Fc(f):mt()}else mt()}}return mt(),{success:!0,completedCount:u}}function Ts(t){if(typeof t!="object"||t===null)return!1;const s=t;if(!("_if"in s)||!("_branches"in s))return!1;const n=s._branches;return!!(Array.isArray(n)||typeof n=="object"&&n!==null)}function Vs(t){return Array.isArray(t)?t:typeof t=="object"&&t!==null?Object.values(t):[]}function Us(t){return t._actions!==null&&t._actions!==void 0?t._actions.length>0?t._actions:null:t._action!==null&&t._action!==void 0?[t._action]:null}const qc=5e3,Kc=100;function Gc(t,s){if(!t)return!0;switch(s){case"gone":{const n=window.getComputedStyle(t);if(n.display==="none"||n.visibility==="hidden"||n.opacity==="0")return!0;const a=t.getBoundingClientRect();return a.width===0&&a.height===0}case"disabled":return!!(t.hasAttribute("disabled")||t.getAttribute("aria-disabled")==="true"||t.classList.contains("disabled"));case"hidden":{const n=window.getComputedStyle(t);return n.display==="none"||n.visibility==="hidden"||n.opacity==="0"}default:return!1}}async function Jc(t,s,n,a,r,l,i){const c=Date.now(),d=Math.max(l*3,qc);try{await tt(l,i)}catch(u){if(dt(u))return{success:!1,newItemCount:0,aborted:!0};throw u}if(r){const u=t.querySelectorAll(r);u.length>0&&Bc(u);const h=await Zt(r,t,d,i);if(fr(),i!=null&&i.aborted)return{success:!1,newItemCount:0,aborted:!0};if(!h)return{success:!1,newItemCount:a}}for(;Date.now()-c<d;){if(i!=null&&i.aborted)return{success:!1,newItemCount:0,aborted:!0};const u=t.querySelector(s);if(u){const h=u.querySelectorAll(n);if(h.length>0)return{success:!0,newItemCount:h.length}}try{await tt(Kc,i)}catch(h){if(dt(h))return{success:!1,newItemCount:0,aborted:!0};throw h}}return{success:!1,newItemCount:0}}function yr(t){const s=[];let n=t,a="";if(!("_container"in t)||!("_item"in t)){for(const[l,i]of Object.entries(t))if(typeof i=="object"&&i!==null&&!l.startsWith("_")){const c=i;if("_container"in c&&"_item"in c){n=c,a=l;break}}}if(Ts(n)){const l=n,i=Vs(l._branches),c=l._if,d=He(c)?c.conditions.map(m=>we(m.selector)??"").join(` ${c.operator} `):we(c.selector)??"",u=He(c)?`${c.operator}(${c.conditions.length})`:c.condition,h=a||"_root";s.push({fieldPath:h,fieldName:h==="_root"?"_root":a,conditionSelector:d,conditionType:u,branches:i.map(m=>({match:m.match,actions:Us(m)})),rawIf:c,rawBranches:typeof l._branches=="object"&&l._branches!==null?l._branches:{},pagination:n._pagination??null})}const r=(l,i)=>{for(const[c,d]of Object.entries(l)){if(c.startsWith("_"))continue;const u=i?`${i}.${c}`:c;if(Ts(d)){const h=d,m=Vs(h._branches),y=h._if,p=He(y)?y.conditions.map(j=>we(j.selector)??"").join(` ${y.operator} `):we(y.selector)??"",v=He(y)?`${y.operator}(${y.conditions.length})`:y.condition;s.push({fieldPath:u,fieldName:c,conditionSelector:p,conditionType:v,branches:m.map(j=>({match:j.match,actions:Us(j)})),rawIf:y,rawBranches:typeof h._branches=="object"&&h._branches!==null?h._branches:{},pagination:h._pagination??null})}else typeof d=="object"&&d!==null&&!Array.isArray(d)&&r(d,u)}};return Ts(n)||r(t,""),s}const Hc=600,Yc=10,Xc=1e3,Zc="gone";function bt(t,s,n){return(He(t)?t.conditions:[t]).map((r,l)=>{const i=s.values[l]??"";let c=!1;if(n){const u=Array.isArray(n.match)?n.match:[n.match],h=u[l]??u[u.length-1]??"/./",m=h.startsWith("/")&&h.endsWith("/")?new RegExp(h.slice(1,-1)):new RegExp(h);try{c=m.test(i)}catch{c=!1}}return{selector:typeof r.selector=="string"?r.selector:String(r.selector??""),value:i,matched:c}})}function Ss(t,s){const n={};for(const a of t)a.type==="input"&&"value"in a&&(n[a.selector]=Ht(a.value,s));return n}async function xn(t,s,n={}){const{itemIndices:a,itemDelay:r=0,dryRun:l=!1,manualMode:i=!1,onActionPending:c,maxJitter:d=Ys,abortSignal:u,onActionStart:h,onPageStart:m,schemaFieldPath:y,onlyRunLastElement:p,onResultsUpdate:v,skipPagination:j=!1,checkPaused:f,showHighlight:b=!0}=n,x=[],N={executed:0,skipped:0,failed:0};let g=0;const w=t._pagination,E=(w==null?void 0:w.maxPages)??Yc,k=(w==null?void 0:w.delayBetweenPages)??Xc,T=(w==null?void 0:w.stopWhen)??Zc,B=w==null?void 0:w.itemKeyTemplate;let P=0,_=!1,I=!1;const C=Object.entries(t).filter(([W,D])=>!W.startsWith("_")&&Ts(D));if("_if"in t&&"_branches"in t){const W=y||"_root";C.push([W,t])}const A=()=>{const W={totalItems:g,actions:x,summary:N};return w&&(W.pagination={pagesProcessed:P,stoppedByCondition:_,stoppedByMaxPages:I}),W},R=W=>x.find(D=>D.itemKey===W),L=(W,D)=>{const H=R(W);H&&Object.assign(H,D)};for(let W=1;W<=E;W++){if(u!=null&&u.aborted)return A();await(f==null?void 0:f()),m==null||m(W);const D=s.querySelector(t._container);if(!D)return A();const H=Array.from(D.querySelectorAll(t._item)),Z=H.length;g+=Z;const le=p?H.slice(-1):a?H.filter((Q,X)=>a.includes(X)):H;for(let Q=0;Q<le.length;Q++){const X=le[Q],ce=H.indexOf(X),de=g-Z+ce,ue=ja(X,t),se=B?Ht(B,{index:de,fieldValues:ue}):`page${W}_idx${ce}`;if(!R(se))for(const[Ie,Ce]of C){const me=Xt(Ce._if,X),M=me.values.join(" | "),F=Vs(Ce._branches),z=va(F,me);if(z){const{branch:q}=z,O=Us(q);if(x.push({itemIndex:de,pageNumber:W,itemIndexInPage:ce,itemKey:se,status:"pending",fieldName:Ie,conditionValue:M,conditionDetails:bt(Ce._if,me,q),matchedBranch:q.match,executedActions:O,capturedFields:ue,success:!1}),l){const U=A();v==null||v(U),await new Promise(V=>requestAnimationFrame(V))}}else N.skipped++}}if(v==null||v(A()),l){if(j)break;continue}for(let Q=0;Q<le.length;Q++){if(u!=null&&u.aborted)return A();await(f==null?void 0:f());const X=le[Q],ce=H.indexOf(X),de=g-Z+ce,ue=ja(X,t),se=B?Ht(B,{index:de,fieldValues:ue}):`page${W}_idx${ce}`,Ie=R(se);if((Ie==null?void 0:Ie.status)==="pending"){if(L(se,{status:"in_progress"}),(W>0||Q>0)&&r>0)try{await tt(r,u)}catch(Ce){if(dt(Ce))return A();throw Ce}for(const[Ce,me]of C){if(u!=null&&u.aborted)return A();await(f==null?void 0:f());const M=Xt(me._if,X),F=M.values.join(" | "),z=Vs(me._branches),q=va(z,M),O=q?Dc(q.branch,M):[],U=M.operator==="AND"?"AND":M.operator==="OR"?"OR":null;h==null||h({phase:"condition",fieldPath:Ce,branchIndex:-1,actionIndex:-1,matchedConditionIndices:O,conditionOperator:U});try{await tt(Hc,u)}catch(xe){if(dt(xe))return A();throw xe}if(!q){L(se,{status:"skipped",conditionValue:F,conditionDetails:bt(me._if,M,null),matchedBranch:null,executedActions:null,success:!0,error:"No matching branch"}),N.skipped++;continue}const{index:V,branch:J}=q,G=Us(J);if(!G||G.length===0){L(se,{status:"completed",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:null,success:!0}),N.skipped++;continue}const be={index:de,fieldValues:ue};if(l)L(se,{status:"pending",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:G,resolvedInputValues:Ss(G,be),success:!1}),N.executed++;else if(i&&c){const xe=[];let Ae=!1,Ee;const Pe=G.filter(ze=>ze.active!==!1);if(Pe.length===0){L(se,{status:"completed",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:null,success:!0}),N.skipped++;continue}for(let ze=0;ze<Pe.length;ze++){const Re=Pe[ze],Ct=ze>0?Pe[ze-1]:null,nt=ze<Pe.length-1?Pe[ze+1]:null;let bs;Re.type==="input"&&(bs=Ht(Re.value,be));const ys=await c(Re,{itemIndex:de,actionIndex:ze,resolvedValue:bs,itemElement:X,previousAction:Ct,nextAction:nt});if(ys==="cancel"){Ae=!0;break}if(ys==="skip")continue;if("replayPreceding"in Re&&Re.replayPreceding){const Dt=[];for(let Je=ze-1;Je>=0&&G[Je].type==="click";Je--)Dt.unshift(G[Je]);if(Dt.length>0){for(const Je of Dt)await An(Je,X,be);if(Re.type==="click"){const Je=await Zt(Re.selector,X);if(Je){In(Je),xe.push(Re);continue}}}}const js=await An(Re,X,be);if(!js.success){Ee=js.error;break}xe.push(Re)}if(Ae)return A();L(se,{status:Ee?"failed":"completed",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:G,resolvedInputValues:Ss(G,be),success:!Ee,error:Ee}),Ee?N.failed++:xe.length>0?N.executed++:N.skipped++}else{const Ee=await br(G,X,be,b,d,u,h?Pe=>h({phase:"action",fieldPath:Ce,branchIndex:V,actionIndex:Pe}):void 0,()=>{const Pe=s.querySelector(t._container);return Pe?Array.from(Pe.querySelectorAll(t._item))[ce]??null:null},f);if(Ee.aborted)return L(se,{status:"failed",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:G,resolvedInputValues:Ss(G,be),success:!1,error:"Stopped by user"}),N.failed++,A();L(se,{status:Ee.success?"completed":"failed",conditionValue:F,conditionDetails:bt(me._if,M,J),matchedBranch:J.match,executedActions:G,resolvedInputValues:Ss(G,be),success:Ee.success,error:Ee.error}),Ee.success?N.executed++:N.failed++}}v==null||v(A())}}if(P++,!w||j)break;const fe=vt(document,w.nextButton);if(Gc(fe,T)){_=!0;break}if(W>=E){I=!0;break}const je=y||"_root";if(h==null||h({phase:"pagination",fieldPath:je,branchIndex:-1,actionIndex:-1,pageNumber:W,paginationStep:"clicking"}),i&&c){const Q={type:"click",selector:w.nextButton},X=await c(Q,{itemIndex:-1,actionIndex:-1,itemElement:fe});if(X==="cancel")return A();if(X==="skip")break}const Y=w.waitForClear??"[class*='modal-overlay'], [class*='artdeco-modal'], [role='dialog']";if(Y){let X=0;for(;X<20;){const ce=document.querySelector(Y);if(!ce)break;const de=window.getComputedStyle(ce);if(de.display==="none"||de.visibility==="hidden"||de.opacity==="0")break;await tt(100,u),X++}}In(fe),h==null||h({phase:"pagination",fieldPath:je,branchIndex:-1,actionIndex:-1,pageNumber:W,paginationStep:"waiting"});const ne=await Jc(s,t._container,t._item,Z,w.waitForSelector,k,u);if(ne.aborted)return A();if(!ne.success)break}return A()}const Qc={click:"#3b82f6",hover:"#8b5cf6",focus:"#06b6d4",waitForText:"#f59e0b",input:"#10b981",key:"#ec4899",if:"#6366f1"},ed={click:as,hover:as,focus:as,waitForText:Ps,input:bn,key:bn,if:Yt},td={click:"Click",hover:"Hover",focus:"Focus",waitForText:"Wait",input:"Input",key:"Key",if:"If"},sd={exists:Xa,text:Li,html:Ka},nd={exists:"#8b5cf6",text:"#06b6d4",html:"#f59e0b"};function jr(t){return"operator"in t&&"conditions"in t}function Na(t){return jr(t)?t.conditions:[t]}function wa(t){return jr(t)?t.operator:null}function Rt(t){return typeof t=="string"?t:typeof t=="object"&&t!==null&&"selector"in t?t.selector:String(t)}function ad({selectors:t,manualAction:s,onManualExecute:n,onManualSkip:a,onManualCancel:r,onPasteSelectors:l,onRunManually:i,onRunActions:c,onStopActions:d,isRunningActions:u,onEditBranching:h,onUploadBranching:m,onSelectorHover:y,currentActionProgress:p,lastRunResult:v,onToggleReport:j}){const f=o.useRef(null),b=o.useRef(null),x=o.useRef(null),[N,g]=o.useState(null),[w,E]=o.useState(!1),[k,T]=o.useState(!1),B=Object.keys(t).length===0;o.useEffect(()=>{const S=()=>{E(document.documentElement.classList.contains("dark"))};S();const A=new MutationObserver(S);return A.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>A.disconnect()},[]),o.useEffect(()=>{const S="automation-pulse-red-animation";if(!document.getElementById(S)){const A=document.createElement("style");A.id=S,A.textContent=`
        @keyframes pulse-red {
          0%, 100% {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.6);
          }
          50% {
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.9), 0 0 12px rgba(239, 68, 68, 0.5);
          }
        }
      `,document.head.appendChild(A)}},[]),o.useEffect(()=>{if(!p||!x.current)return;const S=x.current.querySelector('[data-test-active="true"]');S&&S.scrollIntoView({behavior:"smooth",block:"nearest"})},[p]),o.useEffect(()=>{if(!B)return;const S=A=>{var L;const R=(L=A.clipboardData)==null?void 0:L.getData("text");if(R)try{const W=JSON.parse(R);typeof W=="object"&&W!==null&&!Array.isArray(W)?(l(W),te.success("Selectors JSON loaded from clipboard")):te.error("Clipboard content is not a valid JSON object")}catch{}};return document.addEventListener("paste",S),()=>document.removeEventListener("paste",S)},[B,l]);const P=o.useCallback(S=>{var L;const A=(L=S.target.files)==null?void 0:L[0];if(!A)return;const R=new FileReader;R.onload=W=>{var D;try{const H=JSON.parse((D=W.target)==null?void 0:D.result);typeof H=="object"&&H!==null&&!Array.isArray(H)?l(H):te.error("File content is not a valid JSON object")}catch{te.error("File content is not valid JSON")}},R.readAsText(A),S.target.value=""},[l]),_=o.useCallback(S=>{var L;const A=(L=S.target.files)==null?void 0:L[0];if(!A||!N||!m)return;const R=new FileReader;R.onload=W=>{var D;try{const H=JSON.parse((D=W.target)==null?void 0:D.result);typeof H=="object"&&H!==null&&!Array.isArray(H)?m(N,H):te.error("File content is not a valid JSON object")}catch{te.error("File content is not valid JSON")}},R.readAsText(A),S.target.value="",g(null)},[m,N]),I=o.useCallback(S=>{var A;g(S),(A=b.current)==null||A.click()},[]),C=o.useMemo(()=>yr(t),[t]);return s?e.jsx("div",{className:"flex flex-col h-full p-3","data-test":"automation-panel-content",children:e.jsx(ur,{action:s.action,resolvedValue:s.resolvedValue,itemElement:s.itemElement,itemIndex:s.itemIndex,previousAction:s.previousAction,nextAction:s.nextAction,onExecute:n,onSkip:a,onCancel:r})}):e.jsxs("div",{className:"flex flex-col h-full","data-test":"automation-panel-content",children:[e.jsx("input",{ref:b,type:"file",accept:".json",onChange:_,className:"hidden","data-test":"automation-branching-upload-input"}),B&&e.jsxs("div",{className:"text-sm text-center py-8 flex flex-col items-center gap-3",style:{color:$.placeholder},"data-test":"automation-empty-preview",children:[e.jsx("span",{children:"Press Ctrl+V or upload a selectors JSON"}),e.jsx("input",{ref:f,type:"file",accept:".json",onChange:P,className:"hidden","data-test":"automation-upload-input"}),e.jsxs("button",{onClick:()=>{var S;return(S=f.current)==null?void 0:S.click()},className:"flex items-center gap-1 text-xs px-3 py-1.5 rounded border transition-colors hover:bg-zinc-100",style:{color:$.muted,borderColor:$.muted},"data-test":"automation-upload-button",children:[e.jsx(jt,{className:"w-3 h-3"}),"Upload .json"]})]}),!B&&e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{ref:x,className:"flex-1 overflow-auto space-y-4","data-test":"automation-action-list",children:C.length===0?e.jsx("div",{className:"text-xs text-center py-4",style:{color:$.placeholder},"data-test":"automation-no-actions",children:"No action fields found in schema"}):e.jsx(e.Fragment,{children:C.map((S,A)=>{var R;return e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 p-4 space-y-3","data-test":"automation-action-field",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"automation-field-header",children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"automation-field-name-section",children:[e.jsx(Yt,{className:"w-4 h-4 text-zinc-400 shrink-0","data-test":"automation-field-icon"}),e.jsx("span",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-200","data-test":"automation-field-name",children:S.fieldName})]}),e.jsxs("div",{className:"flex items-center gap-1","data-test":"automation-field-actions",children:[e.jsxs(ds,{children:[e.jsx(us,{asChild:!0,children:e.jsx("button",{className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors shrink-0 ${k?"bg-amber-100 dark:bg-amber-900":""}`,title:"Debug options","data-test":"automation-debug-button",children:e.jsx(Ya,{className:`w-3.5 h-3.5 ${k?"text-amber-600":"text-zinc-400"}`})})}),e.jsx(hs,{align:"end",className:"w-56",style:{zIndex:Ze.draggablePopoverDropdown},children:e.jsxs(Ut,{onClick:L=>{L.preventDefault(),T(!k)},className:"flex items-center justify-between cursor-pointer","data-test":"automation-debug-only-last-element",children:[e.jsx("span",{children:"Only run last element"}),e.jsx(Bs,{checked:k,onCheckedChange:T,className:"scale-75"})]})})]}),m&&e.jsx("button",{onClick:()=>I(S.fieldPath),className:"p-1 rounded hover:bg-zinc-200 transition-colors shrink-0",title:"Upload branching JSON","data-test":"automation-upload-branching-button",children:e.jsx(jt,{className:"w-3.5 h-3.5 text-zinc-400"})}),h&&e.jsx("button",{onClick:()=>h(S.fieldPath,S.rawIf,S.rawBranches),className:"p-1 rounded hover:bg-zinc-200 transition-colors shrink-0",title:"Edit branching","data-test":"automation-edit-branching-button",children:e.jsx(Gs,{className:"w-3.5 h-3.5 text-zinc-400"})})]})]}),(()=>{const L=(p==null?void 0:p.phase)==="condition"&&(p==null?void 0:p.fieldPath)===S.fieldPath,W=L?{outline:"2px solid #000000",outlineOffset:"-1px"}:{};return e.jsxs("div",{className:"rounded-md border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-3 space-y-2",style:W,"data-test":"automation-if-block","data-test-active":L?"true":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs","data-test":"automation-if-header",children:[e.jsx("span",{className:"font-semibold text-violet-600","data-test":"automation-if-label",children:"IF"}),wa(S.rawIf)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-violet-100 text-violet-700 font-medium text-[10px]","data-test":"automation-if-operator",children:wa(S.rawIf)})]}),e.jsx("div",{className:"space-y-1.5 pl-4","data-test":"automation-conditions-list",children:Na(S.rawIf).map((D,H)=>{var ae;const Z=sd[D.condition]??Xa,le=nd[D.condition]??"#6b7280",fe=L&&((ae=p==null?void 0:p.matchedConditionIndices)==null?void 0:ae.includes(H)),je=fe?{backgroundColor:"#ecfdf5",borderRadius:"4px",padding:"4px",margin:"-4px",boxShadow:"0 0 0 2px #6ee7b7"}:{};return e.jsxs("div",{className:"flex flex-col gap-1 transition-all",style:je,"data-test":"automation-condition-item","data-test-matched":fe?"true":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs","data-test":"automation-condition-header",children:[Na(S.rawIf).length>1&&e.jsx("span",{className:"w-4 h-4 flex items-center justify-center rounded-full bg-zinc-100 text-zinc-500 text-[10px] font-medium shrink-0","data-test":"automation-condition-index",children:H+1}),e.jsx(Z,{className:"w-3.5 h-3.5 shrink-0",style:{color:le}}),e.jsx("span",{className:"font-medium",style:{color:le},children:D.condition}),D.label&&e.jsx("span",{className:"font-bold text-zinc-700 truncate",title:D.label,children:D.label})]}),e.jsx("code",{className:"font-mono text-[10px] text-zinc-400 truncate pl-6 hover:text-zinc-600 hover:bg-amber-50 px-1 rounded cursor-pointer transition-colors",title:Rt(D.selector),onMouseEnter:()=>y==null?void 0:y(Rt(D.selector)),onMouseLeave:()=>y==null?void 0:y(null),"data-test":"automation-condition-selector",children:Rt(D.selector)})]},H)})})]})})(),e.jsx("div",{"data-test":"automation-branches-container",children:S.branches.map((L,W)=>{const D=(p==null?void 0:p.phase)==="action"&&(p==null?void 0:p.fieldPath)===S.fieldPath&&(p==null?void 0:p.branchIndex)===W,H=D?{outline:"2px solid #000000",outlineOffset:"-1px"}:{};return e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-md border border-zinc-200 dark:border-zinc-700 p-3 space-y-3",style:H,"data-test":"automation-branch-item","data-test-active":D?"true":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs flex-wrap","data-test":"automation-branch-header",children:[e.jsx("span",{className:"font-semibold text-emerald-600",children:"THEN"}),e.jsx("span",{className:"text-zinc-400",children:"when matches"}),e.jsx("code",{className:"font-mono text-zinc-600 bg-zinc-100 px-1.5 py-0.5 rounded text-[11px]","data-test":"automation-branch-match-pattern",children:Array.isArray(L.match)?L.match.join(" & "):L.match})]}),L.actions?e.jsx("div",{className:"space-y-2","data-test":"automation-actions-container",children:L.actions.map((Z,le)=>{const fe=ed[Z.type]??as,je=Qc[Z.type]??"#6b7280",ae=td[Z.type]??Z.type,Y=(p==null?void 0:p.fieldPath)===S.fieldPath,ne=(p==null?void 0:p.branchIndex)===W,Q=(p==null?void 0:p.actionIndex)===le,X=Y&&ne&&Q,ce=Z.active===!1,de=X?{backgroundColor:w?"#1e3a5f":"#eff6ff",borderColor:"#60a5fa",boxShadow:"0 0 0 2px #93c5fd",opacity:1}:ce?{backgroundColor:w?"#27272a":"#fafafa",borderColor:w?"#3f3f46":"#d4d4d8",opacity:.6}:{backgroundColor:w?"#27272a":"#ffffff",borderColor:w?"#3f3f46":"#e4e4e7",opacity:1},ue=ce?"#a1a1aa":je;return e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded-md border shadow-sm transition-all",style:de,"data-test":"automation-action-step","data-test-active":X?"true":void 0,"data-inactive":ce?"true":void 0,children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full text-white text-[10px] font-bold shrink-0",style:{backgroundColor:ue},children:le+1}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1.5","data-test":"automation-action-details",children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"automation-action-header",children:[e.jsx(fe,{className:"w-3.5 h-3.5 shrink-0",style:{color:ue}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:ue},"data-test":"automation-action-label",children:ae}),ce&&e.jsx("span",{className:"text-[10px] text-zinc-400 italic",children:"(disabled)"}),Z.label&&e.jsx("span",{className:`text-xs font-bold truncate ${ce?"text-zinc-400":"text-zinc-700 dark:text-zinc-200"}`,title:Z.label,children:Z.label})]}),Z.type==="input"&&"value"in Z&&e.jsxs("div",{className:"text-[10px] text-zinc-400 truncate",title:Z.value,"data-test":"automation-action-input-value",children:["value: ",e.jsx("span",{className:"text-zinc-500",children:Z.value})]}),e.jsx("code",{className:"block text-[10px] font-mono text-zinc-400 truncate hover:text-zinc-600 hover:bg-amber-50 px-1 -mx-1 rounded cursor-pointer transition-colors",title:Rt("selector"in Z?Z.selector:""),onMouseEnter:()=>y==null?void 0:y(Rt("selector"in Z?Z.selector:"")),onMouseLeave:()=>y==null?void 0:y(null),"data-test":"automation-action-selector",children:Rt("selector"in Z?Z.selector:"")}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-zinc-400","data-test":"automation-action-meta",children:["delay"in Z&&Z.delay!==void 0&&e.jsxs("span",{className:"flex items-center gap-1","data-test":"automation-action-delay",children:[e.jsx(Ps,{className:"w-3 h-3"}),Z.delay,"ms"]}),Z.type==="waitForText"&&"timeout"in Z&&Z.timeout!==void 0&&e.jsxs("span",{className:"flex items-center gap-1","data-test":"automation-action-timeout",children:[e.jsx(Ps,{className:"w-3 h-3"}),Z.timeout,"ms"]}),Z.type==="waitForText"&&"text"in Z&&e.jsxs("span",{className:"truncate",title:Z.text,"data-test":"automation-action-wait-text",children:["text: ",e.jsxs("span",{className:"text-zinc-500",children:['"',Z.text,'"']})]}),"replayPreceding"in Z&&Z.replayPreceding&&e.jsx("span",{className:"text-amber-500","data-test":"automation-action-replay",children:"↻ replay"})]})]})]},le)})}):e.jsx("div",{className:"text-xs text-zinc-400 italic py-1","data-test":"automation-no-actions-configured",children:"No actions configured"})]},W)})}),((R=S.pagination)==null?void 0:R.nextButton)&&(()=>{const L=(p==null?void 0:p.phase)==="pagination"&&(p==null?void 0:p.fieldPath)===S.fieldPath,W=L&&(p==null?void 0:p.paginationStep)==="waiting",D=L?(p==null?void 0:p.paginationStep)==="clicking"?" (clicking...)":" (waiting...)":"",H=L?{outline:"2px solid #000000",outlineOffset:"-1px"}:{};return e.jsxs("div",{className:"rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-3 space-y-2",style:H,"data-test":"automation-pagination-section","data-test-active":L?"true":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2","data-test":"automation-pagination-header",children:[e.jsx(Vi,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 shrink-0"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:["Pagination",D]})]}),e.jsx("div",{className:"rounded-md border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 p-3 space-y-2 overflow-x-auto","data-test":"automation-pagination-config",children:e.jsxs("div",{className:"text-[10px] font-mono space-y-1.5",style:{color:$.muted},children:[e.jsxs("div",{className:"flex items-center gap-1","data-test":"automation-pagination-next-button",children:[e.jsx(Ve,{className:"w-3 h-3 text-blue-400 shrink-0"}),e.jsx("span",{className:"text-zinc-500 shrink-0",children:"Click"}),e.jsx("code",{className:"px-1 bg-zinc-100 rounded text-[10px] text-zinc-600 hover:bg-amber-50 hover:text-zinc-700 cursor-pointer transition-colors truncate",onMouseEnter:()=>y==null?void 0:y(S.pagination.nextButton),onMouseLeave:()=>y==null?void 0:y(null),"data-test":"automation-pagination-next-button-selector",title:S.pagination.nextButton,children:S.pagination.nextButton})]}),S.pagination.waitForSelector&&e.jsxs("div",{className:"flex items-center gap-1 rounded px-1 -mx-1",style:W?{backgroundColor:"#fef2f2",boxShadow:"0 0 0 2px #ef4444",animation:"pulse-red 1.5s ease-in-out infinite"}:{},"data-test":"automation-pagination-wait-selector","data-test-waiting":W?"true":void 0,children:[e.jsx(Ve,{className:`w-3 h-3 shrink-0 ${W?"text-red-500":"text-blue-400"}`}),e.jsx("span",{className:`shrink-0 ${W?"text-red-600 font-medium":"text-zinc-500"}`,children:"Wait for"}),e.jsx("code",{className:`px-1 rounded text-[10px] cursor-pointer transition-colors truncate ${W?"bg-red-100 text-red-700":"bg-zinc-100 text-zinc-600 hover:bg-amber-50 hover:text-zinc-700"}`,onMouseEnter:()=>y==null?void 0:y(S.pagination.waitForSelector),onMouseLeave:()=>y==null?void 0:y(null),"data-test":"automation-pagination-wait-selector-value",title:S.pagination.waitForSelector,children:S.pagination.waitForSelector})]}),e.jsxs("div",{className:"flex items-center gap-1","data-test":"automation-pagination-delay",children:[e.jsx(Ve,{className:"w-3 h-3 text-blue-400 shrink-0"}),e.jsx("span",{className:"text-zinc-500 shrink-0",children:"Delay"}),e.jsxs("span",{className:"text-zinc-600","data-test":"automation-pagination-delay-value",children:[S.pagination.delayBetweenPages??1e3,"ms"]})]}),e.jsxs("div",{className:"flex items-center gap-1","data-test":"automation-pagination-max-pages",children:[e.jsx(Ve,{className:"w-3 h-3 text-blue-400 shrink-0"}),e.jsx("span",{className:"text-zinc-500 shrink-0",children:"Max pages"}),e.jsx("span",{className:"text-zinc-600","data-test":"automation-pagination-max-pages-value",children:S.pagination.maxPages??10})]}),e.jsxs("div",{className:"flex items-center gap-1","data-test":"automation-pagination-stop-when",children:[e.jsx(Ve,{className:"w-3 h-3 text-blue-400 shrink-0"}),e.jsx("span",{className:"text-zinc-500 shrink-0",children:"Stop when"}),e.jsx("span",{className:"text-zinc-600","data-test":"automation-pagination-stop-when-value",children:S.pagination.stopWhen??"gone"})]})]})})]})})()]},`${S.fieldName}-${A}`)})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t border-zinc-200 shrink-0","data-test":"automation-run-buttons-container",children:[v&&j&&e.jsx(re,{variant:"outline",size:"sm",onClick:S=>j({x:S.clientX,y:S.clientY}),className:"shrink-0",title:"Show automation report","data-test":"automation-show-report-button",children:e.jsx(Ui,{className:"w-4 h-4"})}),e.jsxs(re,{variant:"outline",size:"sm",onClick:i,className:"flex-1",disabled:u,"data-test":"automation-run-manually-button",children:[e.jsx(Va,{className:"w-4 h-4 mr-1"}),"Run Manually"]}),e.jsx(re,{size:"sm",onClick:u?d:()=>c({onlyRunLastElement:k}),className:`flex-1 text-white ${u?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,"data-test":"automation-run-all-button",children:u?e.jsxs(e.Fragment,{children:[e.jsx(zn,{className:"w-4 h-4 mr-1"}),"Stop"]}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{className:"w-4 h-4 mr-1"}),"Run All"]})})]})]})]})}function rd({isRunningActions:t,lastRunResult:s,currentActionProgress:n}){const[a,r]=o.useState(new Set([1])),[l,i]=o.useState(new Set),[c,d]=o.useState(new Set),u=o.useMemo(()=>{if(!t||!s)return null;const h=s.actions.find(m=>m.status==="in_progress");return h?{pageNumber:h.pageNumber??1,itemIndex:h.itemIndex,itemKey:`${h.pageNumber??1}-${h.itemIndex}`}:null},[t,s]);return o.useEffect(()=>{u&&(r(h=>{if(h.has(u.pageNumber))return h;const m=new Set(h);return m.add(u.pageNumber),m}),i(h=>{if(h.has(u.itemKey))return h;const m=new Set(h);return m.add(u.itemKey),m}))},[u]),o.useEffect(()=>{if(!s)return;const h=new Set;for(const m of s.actions)if(m.status==="completed"||m.status==="failed"){const y=`${m.pageNumber??1}-${m.itemIndex}`;c.has(y)||h.add(y)}h.size>0&&(i(m=>{const y=new Set(m);return h.forEach(p=>y.delete(p)),y}),d(m=>new Set([...m,...h])))},[s,c]),o.useEffect(()=>{t||d(new Set)},[t]),{expandedPages:a,setExpandedPages:r,expandedItems:l,setExpandedItems:i,activeItem:u}}const ld=28,Ca=7;function vr({isExpanded:t,onToggle:s,label:n,children:a,indent:r=0,colors:l,scrollable:i=!1,itemCount:c=0,style:d,headerDarker:u=!1}){const h=t?Ye:Ve,m=a!=null,y=i&&c>Ca,p=y?ld*Ca+24:void 0;return e.jsxs("div",{style:{paddingLeft:`${r*16}px`,...d},"data-test":"tui-collapsible-row",children:[e.jsxs("div",{onClick:m?s:void 0,style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",cursor:m?"pointer":"default",backgroundColor:u?l.headerBg:l.rowBg,fontFamily:"monospace",fontSize:"12px",color:l.text},"data-test":"tui-row-header",children:[m&&e.jsx(h,{style:{width:"14px",height:"14px",color:l.muted,flexShrink:0},"data-test":"tui-row-toggle-icon"}),!m&&e.jsx("span",{style:{width:"14px",flexShrink:0}}),n]}),t&&a&&e.jsx("div",{style:{maxHeight:p,overflowY:y?"auto":void 0},"data-test":"tui-row-content",children:a})]})}function id({colors:t,isDarkMode:s,actionSummary:n,onlyRunLastElement:a,setOnlyRunLastElement:r,onEditBranching:l,onUploadBranching:i,displayData:c,portalContainer:d}){const u=n[0],h=o.useRef(null),m=o.useRef(null),y=o.useCallback(j=>{var N;const f=(N=j.target.files)==null?void 0:N[0],b=m.current;if(!f||!b||!i)return;const x=new FileReader;x.onload=g=>{var w;try{const E=JSON.parse((w=g.target)==null?void 0:w.result);typeof E=="object"&&E!==null&&!Array.isArray(E)?(i(b,E),te.success("Branching JSON uploaded")):te.error("File content is not a valid JSON object")}catch{te.error("File content is not valid JSON")}},x.readAsText(f),j.target.value="",m.current=null},[i]),p=o.useCallback(j=>{var f;m.current=j,(f=h.current)==null||f.click()},[]),v=()=>{if(!c||c.length===0){te.info("No work queue to copy");return}const j=[];for(const f of c){j.push(`Page ${f.pageNumber} (${f.items.length} items)`);for(const b of f.items){j.push(`  [${b.itemIndex}] ${b.name} | branch: ${b.branchMatch} | processed: ${b.processed}`);for(const x of b.actions)j.push(`    - ${x.description}`)}}navigator.clipboard.writeText(j.join(`
`)),te.success("Work queue copied")};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},"data-test":"tui-field-actions",children:[e.jsx("input",{ref:h,type:"file",accept:".json",onChange:y,style:{display:"none"},"data-test":"branching-file-input"}),e.jsx("button",{onClick:v,style:{padding:"4px",borderRadius:"4px",background:"transparent",border:"none",cursor:"pointer"},title:"Copy work queue as text","data-test":"automation-copy-work-queue-button",children:e.jsx($n,{style:{width:"14px",height:"14px",color:t.muted}})}),e.jsxs(ds,{children:[e.jsx(us,{asChild:!0,children:e.jsx("button",{style:{padding:"4px",borderRadius:"4px",background:a?s?"#78350f":"#fef3c7":"transparent",border:"none",cursor:"pointer"},title:"Debug options","data-test":"automation-debug-button",children:e.jsx(Ya,{style:{width:"14px",height:"14px",color:a?"#d97706":t.muted}})})}),e.jsx(hs,{align:"end",className:"w-56",style:{zIndex:Ze.draggablePopoverDropdown},container:d,children:e.jsxs(Ut,{onClick:j=>{j.preventDefault(),r(!a)},className:"flex items-center justify-between cursor-pointer","data-test":"automation-debug-only-last-element",children:[e.jsx("span",{children:"Only run last element"}),e.jsx(Bs,{checked:a,onCheckedChange:r,className:"scale-75"})]})})]}),i&&u&&e.jsx("button",{onClick:()=>p(u.fieldPath),style:{padding:"4px",borderRadius:"4px",background:"transparent",border:"none",cursor:"pointer"},title:"Upload branching JSON","data-test":"automation-upload-branching-button",children:e.jsx(jt,{style:{width:"14px",height:"14px",color:t.muted}})}),l&&u&&e.jsx("button",{onClick:()=>l(u.fieldPath,u.rawIf,u.rawBranches),style:{padding:"4px",borderRadius:"4px",background:"transparent",border:"none",cursor:"pointer"},title:"Edit branching","data-test":"automation-edit-branching-button",children:e.jsx(Gs,{style:{width:"14px",height:"14px",color:t.muted}})})]})}function od(t){const s=[/^(click on)\s+(.+)$/i,/^(hover on)\s+(.+)$/i,/^(hover over)\s+(.+)$/i,/^(input)\s+(.+)$/i,/^(wait for)\s+(.+)$/i,/^(wait for text)\s+(.+)$/i,/^(scroll to)\s+(.+)$/i,/^(press)\s+(.+)$/i];for(const a of s){const r=t.match(a);if(r)return{prefix:r[1],selector:r[2]}}const n=t.match(/^(if)\s+(\S+)\s+(.+)$/i);return n?{prefix:`${n[1]} ${n[3]}`,selector:n[2]}:{prefix:t,selector:""}}function cd({index:t,prefix:s,selector:n,rawSelector:a,isCurrentAction:r,isActive:l,colors:i,onSelectorHover:c,depth:d=0,branchLabel:u}){const[h,m]=o.useState(!1),y=l?i.text:i.muted,p=d*16;return e.jsxs("div",{style:{fontSize:"11px",color:y,padding:"2px 4px",paddingLeft:`${4+p}px`,fontFamily:"monospace",backgroundColor:r?i.accent+"20":"transparent",borderLeft:r?`3px solid ${i.accent}`:d>0?`3px solid ${i.muted}30`:"3px solid transparent",fontWeight:r?"bold":"normal",cursor:"text",userSelect:"text",opacity:l?1:.5},"data-test":"tui-action-line","data-test-active":r?"true":void 0,"data-test-depth":d>0?d:void 0,onMouseEnter:v=>{v.buttons===0&&(m(!0),c==null||c(a))},onMouseLeave:v=>{v.buttons===0&&(m(!1),c==null||c(null))},children:[e.jsxs("span",{style:{color:i.accent,marginRight:"8px"},children:[t+1,"."]}),u&&e.jsxs("span",{style:{color:i.warning,marginRight:"6px",fontSize:"10px"},children:["[",u,"]"]}),s,n&&e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{style:{backgroundColor:h?i.accent+"30":"transparent",padding:"1px 4px",borderRadius:"2px",transition:"background-color 0.15s"},"data-test":"tui-action-selector",children:n})]})]})}function dd({item:t,isExpanded:s,onToggle:n,colors:a,isActive:r=!1,currentActionIndex:l,onSelectorHover:i}){const c=t.actions.length>0,d=r?{backgroundColor:a.headerBg,outline:`2px solid ${a.accent}`,outlineOffset:"-2px"}:{};return e.jsx(vr,{isExpanded:s,onToggle:n,indent:1,colors:a,style:d,label:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 120px 80px",gap:"4px",flex:1,fontSize:"12px"},"data-test":"tui-item-row","data-test-active":r?"true":void 0,children:[e.jsxs("span",{style:{color:a.muted,minWidth:"16px"},"data-test":"tui-item-index",children:[t.itemIndex+1,"."]}),e.jsx("span",{style:{color:a.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:r?"bold":"normal"},title:t.name,children:t.name}),e.jsx("span",{style:{color:a.accent,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t.branchMatch,children:t.branchMatch}),e.jsx("span",{style:{color:t.processed?a.success:a.warning},children:t.processed?"true":"false"})]}),children:c&&e.jsx("div",{style:{paddingLeft:"54px",paddingTop:"4px",paddingBottom:"8px",backgroundColor:a.rowBg,userSelect:"text",cursor:"text"},"data-test":"tui-actions-list",children:t.actions.map((u,h)=>{const m=r&&l===h,{prefix:y,selector:p}=od(u.description);return e.jsx(cd,{index:h,prefix:y,selector:p,rawSelector:u.selector,isCurrentAction:m,isActive:u.active!==!1,colors:a,onSelectorHover:i,depth:u.depth,branchLabel:u.branchLabel},h)})})})}function ud({selectors:t,onRunActions:s,onStopActions:n,onPauseActions:a,isRunningActions:r,isPaused:l=!1,lastRunResult:i,onPrepare:c,onEditBranching:d,onUploadBranching:u,currentActionProgress:h,onSelectorHover:m,accumulatedPages:y,setAccumulatedPages:p,onPasteSelectors:v,onRunManually:j,manualAction:f,isInManualMode:b,onManualExecute:x,onManualCancel:N}){const[g,w]=o.useState(!1),[E,k]=o.useState(null),[T,B]=o.useState(!1),[P,_]=o.useState(!1),[I,C]=o.useState(1),{expandedPages:S,setExpandedPages:A,expandedItems:R,setExpandedItems:L,activeItem:W}=rd({isRunningActions:r,lastRunResult:i,currentActionProgress:h}),D=o.useRef(null),H=o.useRef(null);o.useEffect(()=>{f?D.current={itemIndex:f.itemIndex,actionIndex:f.actionIndex}:b||(D.current=null)},[f,b]);const Z=o.useRef(!1);o.useEffect(()=>{r&&!Z.current&&C(1),Z.current=r},[r]),o.useEffect(()=>{if(!f)return;const O=1,U=`${O}-${f.itemIndex}`;A(V=>{if(V.has(O))return V;const J=new Set(V);return J.add(O),J}),L(V=>{if(V.has(U))return V;const J=new Set(V);return J.add(U),J})},[f,A,L]);const le=o.useRef(null),fe=o.useRef(null),je=o.useRef(null),ae=o.useRef(null),Y=o.useRef(null),ne=o.useRef(null),Q=o.useCallback(()=>{ne.current&&(clearTimeout(ne.current),ne.current=null),ae.current&&(ae.current.style.outline="",ae.current.style.outlineOffset="",ae.current.style.boxShadow="",ae.current.style.animation="",ae.current=null),Y.current&&(Y.current.style.outline="",Y.current.style.outlineOffset="",Y.current.style.boxShadow="",Y.current.style.animation="",Y.current=null)},[]),X=20,ce=100,de=o.useCallback((O,U,V,J=0)=>{let G=vt(U,O);if(G||(G=vt(document,O)),!G){if(J<X){ne.current=setTimeout(()=>{de(O,U,V,J+1)},ce);return}return}ne.current&&(clearTimeout(ne.current),ne.current=null),V?(ae.current&&ae.current!==G&&(ae.current.style.outline="",ae.current.style.outlineOffset="",ae.current.style.boxShadow="",ae.current.style.animation=""),G.style.outline="3px solid #f43f5e",G.style.outlineOffset="3px",G.style.animation="manual-mode-pulse 1.5s ease-in-out infinite",G.scrollIntoView({behavior:"smooth",block:"center"}),ae.current=G):(G.style.outline="2px solid #eab308",G.style.outlineOffset="3px",G.style.animation="manual-mode-pulse-next 1.5s ease-in-out infinite",Y.current=G)},[]);o.useEffect(()=>{if(!f){Q();return}const O="manual-mode-pulse-animation";if(!document.getElementById(O)){const J=document.createElement("style");J.id=O,J.textContent=`
        @keyframes manual-mode-pulse {
          0%, 100% { box-shadow: 0 0 0 6px rgba(244, 63, 94, 0.3), 0 0 20px rgba(244, 63, 94, 0.4); }
          50% { box-shadow: 0 0 0 10px rgba(244, 63, 94, 0.5), 0 0 30px rgba(244, 63, 94, 0.6); }
        }
        @keyframes manual-mode-pulse-next {
          0%, 100% { box-shadow: 0 0 0 4px rgba(234, 179, 8, 0.25), 0 0 15px rgba(234, 179, 8, 0.3); }
          50% { box-shadow: 0 0 0 8px rgba(234, 179, 8, 0.4), 0 0 25px rgba(234, 179, 8, 0.5); }
        }
      `,document.head.appendChild(J)}const U="selector"in f.action?f.action.selector:void 0;U&&de(U,f.itemElement,!0);const V=f.nextAction&&"selector"in f.nextAction?f.nextAction.selector:void 0;return V&&de(V,f.itemElement,!1),()=>{Q()}},[f,Q,de]);const ue=o.useCallback(O=>{var J;const U=(J=O.target.files)==null?void 0:J[0];if(!U||!v)return;const V=new FileReader;V.onload=G=>{var be;try{const xe=JSON.parse((be=G.target)==null?void 0:be.result);typeof xe=="object"&&xe!==null&&(v(xe),te.success("JSON uploaded successfully"))}catch{te.error("Invalid JSON file")}},V.readAsText(U),O.target.value=""},[v]);o.useEffect(()=>{const O=()=>{B(document.documentElement.classList.contains("dark"))};O();const U=new MutationObserver(O);return U.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>U.disconnect()},[]);const ge=o.useRef(null);o.useEffect(()=>{if(!W||!le.current)return;const U=le.current.querySelector(`[data-item-key="${W.itemKey}"]`);if(U){const V=U.closest('[data-test="tui-row-content"]');V&&(ge.current&&clearTimeout(ge.current),ge.current=setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{const J=V.getBoundingClientRect(),be=U.getBoundingClientRect().top-J.top;Math.abs(be)>5&&V.scrollBy({top:be,behavior:"smooth"})})})},100))}return()=>{ge.current&&clearTimeout(ge.current)}},[W]);const se=Xo(T),Ie=o.useMemo(()=>yr(t),[t]),Ce=Object.keys(t).length===0;o.useEffect(()=>{if(!Ce||!v)return;const O=U=>{var J;const V=(J=U.clipboardData)==null?void 0:J.getData("text");if(V)try{const G=JSON.parse(V);typeof G=="object"&&G!==null&&(v(G),te.success("JSON pasted successfully"))}catch{}};return document.addEventListener("paste",O),()=>document.removeEventListener("paste",O)},[Ce,v]);const me=o.useCallback(O=>{A(U=>{const V=new Set(U);return V.has(O)?V.delete(O):V.add(O),V})},[]),M=o.useCallback(O=>{L(U=>{const V=new Set(U);return V.has(O)?V.delete(O):V.add(O),V})},[]),F=o.useCallback(async O=>{if(c){w(!0),k(null);try{console.log("[handlePrepare] Calling onPrepare with onlyRunLastElement:",P);const U=await c((J,G)=>{k({current:J,total:G})},{onlyRunLastElement:P}),V=Is(U);O!==void 0&&V.forEach(J=>{J.pageNumber=O}),p(J=>{const G=new Set(V.map(xe=>xe.pageNumber));return[...J.filter(xe=>!G.has(xe.pageNumber)),...V].sort((xe,Ae)=>xe.pageNumber-Ae.pageNumber)}),V.length>0&&A(J=>{const G=new Set(J);return V.forEach(be=>G.add(be.pageNumber)),G})}finally{w(!1),k(null)}}},[c,P]),z=o.useCallback(async()=>{j&&(c&&await F(I),s({manual:!0,onlyRunLastElement:P}))},[c,j,F,s,P,I]);o.useEffect(()=>{if(!c)return;const O=H.current,U=(O==null?void 0:O.phase)==="pagination"&&(O==null?void 0:O.step)==="waiting";if(!h){if(U){const G=((O==null?void 0:O.page)??1)+1;C(G),F(G),H.current=null}return}const V={phase:h.phase,step:h.paginationStep,page:h.pageNumber},J=V.phase!=="pagination"||V.step!=="waiting";if(U&&J){const G=((O==null?void 0:O.page)??1)+1;C(G),F(G)}H.current=V},[h,c,F,b]);const q=o.useMemo(()=>r&&i?Is(i):y.length>0?y:Is(i),[y,i,r]);return Ce?e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",fontFamily:"monospace",backgroundColor:se.rowBg,color:se.muted},"data-test":"automation-panel-content-v2",children:[e.jsx("input",{ref:je,type:"file",accept:".json",onChange:ue,style:{display:"none"},"data-test":"automation-file-input"}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px",textAlign:"center",gap:"16px"},"data-test":"tui-empty-state",children:[e.jsx("span",{children:"No selectors loaded. Paste (Ctrl+V) or upload JSON."}),v&&e.jsxs(re,{variant:"outline",size:"sm",onClick:()=>{var O;return(O=je.current)==null?void 0:O.click()},"data-test":"automation-upload-json-button",children:[e.jsx(jt,{className:"w-4 h-4 mr-2"}),"Upload JSON"]})]})]}):e.jsxs("div",{ref:fe,style:{display:"flex",flexDirection:"column",height:"100%",fontFamily:"monospace",backgroundColor:se.rowBg},"data-test":"automation-panel-content-v2",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:`1px solid ${se.border}`,backgroundColor:se.headerBg,fontSize:"11px",color:se.muted},"data-test":"tui-schema-info",children:[e.jsxs("span",{children:[Ie.length," action field(s) configured"]}),e.jsx(id,{colors:se,isDarkMode:T,actionSummary:Ie,onlyRunLastElement:P,setOnlyRunLastElement:_,onEditBranching:d,onUploadBranching:u,displayData:q,portalContainer:fe.current})]}),e.jsx("div",{ref:le,style:{flex:1,overflow:"auto"},"data-test":"tui-content",children:q.length===0?e.jsx("div",{style:{padding:"24px",textAlign:"center",color:se.muted,fontSize:"12px"},"data-test":"tui-no-data",children:'Click "Prepare" to evaluate conditions and preview items'}):q.map((O,U)=>{const V=S.has(O.pageNumber);return e.jsx("div",{style:{marginTop:U>0?"8px":void 0},"data-test":"tui-page-block",children:e.jsxs(vr,{isExpanded:V,onToggle:()=>me(O.pageNumber),colors:se,scrollable:!0,itemCount:O.items.length,headerDarker:!0,label:e.jsxs("span",{style:{fontWeight:"bold",color:se.accent},children:["Page ",O.pageNumber,e.jsxs("span",{style:{fontWeight:"normal",color:se.muted,marginLeft:"8px"},children:["(",O.items.length," items)"]})]}),children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px 80px",gap:"8px",padding:"6px 8px 6px 38px",backgroundColor:se.rowBg,fontSize:"10px",color:se.muted,textTransform:"uppercase",letterSpacing:"0.5px"},"data-test":"tui-column-headers",children:[e.jsx("span",{children:"Name"}),e.jsx("span",{children:"Branch"}),e.jsx("span",{children:"Processed"})]}),O.items.map(J=>{const G=`${O.pageNumber}-${J.itemIndex}`,be=(W==null?void 0:W.itemKey)===G,xe=f??(b?D.current:null),Ae=xe&&J.itemIndex===xe.itemIndex,Ee=be||Ae||void 0,Pe=Ae?xe==null?void 0:xe.actionIndex:be?h==null?void 0:h.actionIndex:void 0;return e.jsx("div",{"data-item-key":G,children:e.jsx(dd,{item:J,pageNumber:O.pageNumber,isExpanded:R.has(G),onToggle:()=>M(G),colors:se,isActive:Ee,currentActionIndex:Pe,onSelectorHover:m})},G)})]})},O.pageNumber)})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",borderTop:`1px solid ${se.border}`,backgroundColor:se.headerBg,flexShrink:0},"data-test":"automation-run-buttons-container",children:[c&&e.jsx(re,{variant:"outline",size:"sm",onClick:()=>F(I),disabled:g||r,style:{width:"calc(50% - 4px)"},"data-test":"automation-prepare-button",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"w-4 h-4 mr-1 animate-spin"}),E&&E.current>0?`${E.current} found`:"Preparing..."]}):"Prepare"}),b?e.jsxs("div",{style:{width:"calc(50% - 4px)",display:"flex",gap:"4px"},"data-test":"automation-manual-buttons",children:[e.jsx(re,{size:"sm",variant:"outline",onClick:N,className:"border-zinc-400 text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800",style:{flex:1},"data-test":"automation-manual-cancel-button",children:e.jsx(et,{className:"w-4 h-4"})}),e.jsxs(re,{size:"sm",onClick:x,disabled:!f,className:"bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",style:{flex:3},"data-test":"automation-manual-execute-button",children:[e.jsx(Kt,{className:"w-4 h-4 mr-1"}),f?"Execute":"Executing..."]})]}):r?e.jsxs("div",{style:{width:"calc(50% - 4px)",display:"flex",gap:"4px"},"data-test":"automation-running-buttons",children:[a&&e.jsx(re,{type:"button",size:"sm",variant:"outline",onClick:()=>a(),className:l?"border-green-500 text-green-500 hover:bg-green-50 dark:hover:bg-green-950":"border-red-500 text-red-500 hover:bg-red-50 dark:hover:bg-red-950",style:{flex:1},"data-test":l?"automation-resume-button":"automation-pause-button",children:l?e.jsx(Kt,{className:"w-4 h-4"}):e.jsx(Wi,{className:"w-4 h-4"})}),e.jsxs(re,{size:"sm",onClick:n,className:"bg-red-600 hover:bg-red-700 text-white",style:{flex:3},"data-test":"automation-stop-button",children:[e.jsx(zn,{className:"w-4 h-4 mr-1"}),"Stop"]})]}):e.jsxs("div",{className:"flex",style:{width:"calc(50% - 4px)"},"data-test":"automation-run-all-button",children:[e.jsxs(re,{size:"sm",onClick:()=>s({onlyRunLastElement:P}),className:"bg-blue-600 hover:bg-blue-700 text-white rounded-r-none flex-1",children:[e.jsx(Kt,{className:"w-4 h-4 mr-1"}),l?"Resume":"Run All"]}),e.jsxs(ds,{children:[e.jsx(us,{asChild:!0,children:e.jsx(re,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white rounded-l-none border-l border-blue-500 px-1.5","data-test":"automation-run-dropdown-trigger",children:e.jsx(Ye,{className:"w-4 h-4"})})}),e.jsx(hs,{align:"end",style:{zIndex:Ze.draggablePopoverDropdown},"data-test":"automation-run-dropdown",container:fe.current,children:e.jsxs(Ut,{onClick:z,disabled:!j||g,"data-test":"automation-run-manually-option",children:[e.jsx(qi,{className:"w-4 h-4 mr-2"}),"Run Manually"]})})]})]})]})]})}function hd({continuousMode:t,onContinuousModeToggle:s,previewMode:n,contentViewMode:a,onContentViewModeChange:r,filledCount:l,totalCount:i,warningMessage:c}){return e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-3 py-2 text-xs border-t border-zinc-200 dark:border-zinc-700 relative bg-zinc-100 dark:bg-zinc-800","data-test":"continuous-mode-status-v2",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-amber-100 text-amber-800 font-medium animate-pulse","data-test":"status-bar-warning-v2",children:c}),e.jsxs("button",{className:"flex items-center gap-2 hover:opacity-80 transition-opacity cursor-pointer",onClick:s,"data-test":"continuous-mode-toggle-v2",children:[e.jsx(Ki,{className:"w-3 h-3",style:{color:t?Te.primary:Te.muted}}),e.jsxs("span",{style:{color:t?$.primary:$.muted},children:["Continuous Mode: ",t?"ON":"OFF"]})]}),n==="content"&&e.jsxs("div",{className:"flex items-center gap-1","data-test":"content-view-toggle-v2",children:[e.jsx("button",{onClick:()=>r("schema"),className:`p-1 rounded transition-colors ${a==="schema"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Schema view","data-test":"content-view-schema-v2",children:e.jsx(Gi,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>r("array"),className:`p-1 rounded transition-colors ${a==="array"?"bg-blue-100 text-blue-700":"hover:bg-gray-200 text-gray-500"}`,title:"Array view","data-test":"content-view-array-v2",children:e.jsx(Ks,{className:"w-3 h-3"})})]}),e.jsxs("span",{style:{color:$.muted},children:[l,"/",i," fields"]})]})}function pd({mode:t,fields:s,selectedFieldId:n,schemaSectionHeight:a,previewMode:r,contentViewMode:l,selectors:i,content:c,activeFieldPath:d,continuousMode:u,filledCount:h,totalCount:m,portalContainer:y,containerRef:p,onFieldSelect:v,onFieldUpdate:j,onFieldEdit:f,onFieldDelete:b,onReorder:x,onAddChild:N,onAddSiblingBefore:g,onAddSiblingAfter:w,onListModeApply:E,onListModeCancel:k,onResizeStart:T,onPreviewModeChange:B,onFieldValueClick:P,onFieldValueHover:_,onClearSelector:I,onSelectorFilterClick:C,onSelectorFilterDoubleClick:S,onConfigClick:A,onFilterChildrenClick:R,onArrayBadgeClick:L,onNavigateUp:W,onNavigateDown:D,canNavigateDown:H,onEditBranching:Z,onImportClick:le,onPasteSelectors:fe,onSchemaCountClick:je,onBranchSwitch:ae,onToggleBranchField:Y,onToggleIfDirect:ne,onAddBranch:Q,manualAction:X,isInManualMode:ce,onManualExecute:de,onManualSkip:ue,onManualCancel:ge,onContinuousModeToggle:se,onContentViewModeChange:Ie,warningMessage:Ce,onRunManually:me,onRunActions:M,onStopActions:F,onPauseActions:z,isRunningActions:q,isPaused:O,onUploadBranching:U,onAutomationSelectorHover:V,currentActionProgress:J,lastRunResult:G,onToggleReport:be,onPrepare:xe,accumulatedPages:Ae,setAccumulatedPages:Ee}){return e.jsxs("div",{ref:p,className:"flex flex-col h-full","data-test":"capture-panel-v2",children:[t==="automation"?e.jsx("div",{className:"flex-1 min-h-0 overflow-auto","data-test":"automation-section-v2",children:e.jsx(ad,{selectors:i,manualAction:X??null,onManualExecute:de??(()=>{}),onManualSkip:ue??(()=>{}),onManualCancel:ge??(()=>{}),onPasteSelectors:fe??(()=>{}),onRunManually:me??(()=>{}),onRunActions:M??(()=>{}),onStopActions:F??(()=>{}),isRunningActions:q??!1,onEditBranching:Z,onUploadBranching:U,onSelectorHover:V,currentActionProgress:J,lastRunResult:G,onToggleReport:be})}):t==="automationV2"?e.jsx("div",{className:"flex-1 min-h-0 overflow-auto","data-test":"automation-section-v2-tui",children:e.jsx(ud,{selectors:i,onRunActions:M??(()=>{}),onStopActions:F??(()=>{}),onPauseActions:z,isRunningActions:q??!1,isPaused:O,lastRunResult:G,onPrepare:xe,onEditBranching:Z,onUploadBranching:U,currentActionProgress:J,onSelectorHover:V,accumulatedPages:Ae,setAccumulatedPages:Ee,onPasteSelectors:fe,onRunManually:me,manualAction:X,isInManualMode:ce,onManualExecute:de,onManualCancel:ge})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 text-xs font-medium border-b shrink-0 bg-zinc-50 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700","data-test":"schema-header",children:["Schema ",t==="list"&&"(List Mode)"]}),e.jsx("div",{className:"min-h-0 overflow-auto",style:a!==null?{height:a}:{flex:r==="actions"?1:t==="list"?3:1},"data-test":"schema-section-v2",children:t==="mapped"?e.jsx(cc,{fields:s,selectedFieldId:n,mode:t,onFieldSelect:v,onFieldUpdate:j,onFieldEdit:f,onFieldDelete:b,onReorder:x,onAddChild:N,onAddSiblingBefore:g,onAddSiblingAfter:w}):e.jsx(mc,{fields:s,onApply:E,onCancel:k})}),e.jsx("div",{className:"h-1.5 bg-border hover:bg-primary/50 cursor-row-resize shrink-0 transition-colors flex items-center justify-center group",onMouseDown:T,"data-test":"section-resize-handle",children:e.jsx("div",{className:"w-8 h-0.5 bg-muted-foreground/30 group-hover:bg-primary/70 rounded-full transition-colors"})}),e.jsx("div",{className:"min-h-0",style:{flex:r==="actions"?3:1},"data-test":"preview-section-v2",children:e.jsx(Ac,{mode:r,onModeChange:B,selectors:i,content:c,onFieldValueClick:P,onFieldValueHover:_,onClearSelector:I,onSelectorFilterClick:C,onSelectorFilterDoubleClick:S,onConfigClick:A,onFilterChildrenClick:R,onArrayBadgeClick:L,onNavigateUp:W,onNavigateDown:D,canNavigateDown:H,onEditBranching:Z,onImportClick:le,onPasteSelectors:fe,contentViewMode:l,onSchemaCountClick:je,activeFieldPath:d,portalContainer:y,onBranchSwitch:ae,onToggleBranchField:Y,onToggleIfDirect:ne,onAddBranch:Q,manualAction:X,onManualExecute:de,onManualSkip:ue,onManualCancel:ge})})]}),e.jsx(hd,{continuousMode:u,onContinuousModeToggle:se,previewMode:r,contentViewMode:l,onContentViewModeChange:Ie,filledCount:h,totalCount:m,warningMessage:Ce})]})}function md(t){if(!t.capturedFields)return null;for(const[s,n]of Object.entries(t.capturedFields))if(!s.startsWith("_")&&n)return n;return null}function Nr(t,s){return t?t.replace(/\{\{(\w+)(?::(\d+))?\}\}/g,(n,a,r)=>{var i;if(a==="value"||a==="condition"){const c=r?parseInt(r,10):0,d=s.conditionDetails;return d&&d[c]?d[c].value||"(empty)":"(no value)"}const l=(i=s.capturedFields)==null?void 0:i[a];return l!==void 0?l||"(empty)":n}):md(s)||""}function wr(t){switch(t){case"click":return"Clicked on";case"hover":return"Hovered over";case"focus":return"Focused on";case"input":return"Input value to";case"waitForText":return"Waited for text in";default:return t}}function xd({type:t}){return t==="input"?e.jsx(bn,{className:"w-3 h-3"}):e.jsx(as,{className:"w-3 h-3"})}function fd(t){const s=new Map;for(const n of t){const a=n.pageNumber??1;s.has(a)||s.set(a,[]),s.get(a).push(n)}return s}function ka(t,s){const n=[],a=t.success?"✓":t.executedActions?"✗":"○";let r=`Item ${t.itemIndex+1}`;const l=Nr(s,t);if(l?r+=` - ${l}`:t.fieldName!=="_root"&&(r+=` - ${t.fieldName}`),n.push(`${a} ${r}`),t.conditionValue){const i=t.matchedBranch?`Matched: ${Array.isArray(t.matchedBranch)?t.matchedBranch.join(" & "):t.matchedBranch}`:"No match";if(n.push("  IF Conditions"),t.conditionDetails&&t.conditionDetails.length>0)for(const c of t.conditionDetails)n.push(`    ${c.selector} → "${c.value}"`);n.push(`    ${i}`)}if(t.executedActions&&t.executedActions.length>0){n.push("  Actions Executed");for(const i of t.executedActions){const c=`${wr(i.type)} ${we("selector"in i?i.selector??"":"")}`;n.push(`    ${c}`)}}return t.error&&n.push(`  Error: ${t.error}`),n.join(`
`)}function Cr({action:t,showPageInfo:s,useInPageIndex:n,labelTemplate:a}){const r=n&&t.itemIndexInPage!==void 0?t.itemIndexInPage+1:t.itemIndex+1;let l=s&&t.pageNumber!==void 0?`Page ${t.pageNumber} Item ${r}`:`Item ${r}`;const i=Nr(a??"",t);i?l+=` - ${i}`:t.fieldName!=="_root"&&(l+=` - ${t.fieldName}`);const c=t.status==="pending"||t.status==="in_progress",d=()=>c?{borderColor:"#fde047",backgroundColor:"#fefce8"}:t.success?{borderColor:"#e4e4e7",backgroundColor:"#ffffff"}:{borderColor:"#fecaca",backgroundColor:"#fef2f2"};return e.jsxs("div",{className:"rounded-lg border p-3 space-y-2",style:d(),"data-test":"automation-report-item",children:[e.jsxs("div",{className:"flex items-center justify-between","data-test":"automation-report-item-header",children:[e.jsx("span",{className:"text-xs font-medium text-zinc-700","data-test":"automation-report-item-label",children:l}),c?e.jsx(Ps,{className:"w-4 h-4 text-yellow-500"}):t.success?e.jsx(Ln,{className:"w-4 h-4 text-emerald-500"}):e.jsx(Vn,{className:"w-4 h-4 text-red-500"})]}),t.conditionDetails&&t.conditionDetails.length>0&&e.jsxs("div",{className:"space-y-1","data-test":"automation-report-conditions",children:[e.jsx("div",{className:"text-[10px] font-medium text-violet-600 uppercase",children:"IF Conditions"}),t.conditionDetails.map((u,h)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs pl-2",style:{borderLeft:`2px solid ${u.matched?"#10b981":"#d1d5db"}`},"data-test":"automation-report-condition-item",children:[e.jsx("span",{className:"shrink-0",style:{color:u.matched?"#10b981":"#9ca3af"},children:u.matched?"✓":"○"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("code",{className:"text-[10px] text-zinc-500 block truncate",title:we(u.selector),children:we(u.selector)}),e.jsxs("span",{className:"text-zinc-700",children:['→ "',u.value||"(empty)",'"']})]})]},h))]}),t.matchedBranch&&e.jsxs("div",{className:"text-xs text-zinc-500","data-test":"automation-report-matched-branch",children:[e.jsx("span",{className:"text-emerald-600 font-medium",children:"Matched: "}),e.jsx("code",{className:"text-zinc-600",children:Array.isArray(t.matchedBranch)?t.matchedBranch.join(" & "):t.matchedBranch})]}),t.executedActions&&t.executedActions.length>0&&e.jsxs("div",{className:"space-y-1","data-test":"automation-report-actions",children:[e.jsx("div",{className:"text-[10px] font-medium text-blue-600 uppercase",children:"Actions Executed"}),t.executedActions.map((u,h)=>{var p;const m="selector"in u?u.selector??"":"",y=m?(p=t.resolvedInputValues)==null?void 0:p[m]:void 0;return e.jsxs("div",{className:"flex items-start gap-2 text-xs pl-2 text-zinc-700","data-test":"automation-report-action-item",children:[e.jsx(xd,{type:u.type}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-medium",children:wr(u.type)})," ",e.jsx("code",{className:"text-[10px] text-zinc-500 truncate inline-block max-w-[200px] align-bottom",title:we(m),children:we(m)}),u.type==="input"&&y&&e.jsxs("div",{className:"text-zinc-600 mt-0.5",children:["Value: ",e.jsxs("span",{className:"font-medium",children:['"',y,'"']})]})]})]},h)})]}),t.error&&e.jsx("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded","data-test":"automation-report-error",children:t.error}),!t.executedActions&&!t.error&&e.jsx("div",{className:"text-xs text-zinc-400 italic","data-test":"automation-report-no-actions",children:"No actions executed"})]})}function gd({pageNumber:t,actions:s,isExpanded:n,onToggle:a,labelTemplate:r}){const l=s.filter(c=>c.success).length,i=s.filter(c=>!c.success).length;return e.jsxs("div",{className:"rounded-lg border border-blue-200 overflow-hidden","data-test":"automation-report-page-block",children:[e.jsxs("button",{onClick:a,className:"w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 transition-colors text-left","data-test":"automation-report-page-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(Ye,{className:"w-4 h-4 text-blue-500"}):e.jsx(Ve,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-700","data-test":"automation-report-page-title",children:["Page ",t]}),e.jsxs("span",{className:"text-xs text-blue-500",children:["(",s.length," items)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[l>0&&e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600","data-test":"automation-report-page-success",children:[e.jsx(Ln,{className:"w-3 h-3"}),l]}),i>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-500","data-test":"automation-report-page-failed",children:[e.jsx(Vn,{className:"w-3 h-3"}),i]})]})]}),n&&e.jsx("div",{className:"p-3 space-y-3 bg-white","data-test":"automation-report-page-content",children:s.map((c,d)=>e.jsx(Cr,{action:c,showPageInfo:!1,useInPageIndex:!0,labelTemplate:r},d))})]})}function bd({result:t,labelTemplate:s="",onLabelTemplateChange:n}){const a=t.pagination!==void 0,r=o.useMemo(()=>fd(t.actions),[t.actions]),l=o.useMemo(()=>Array.from(r.keys()).sort((p,v)=>p-v),[r]),[i,c]=o.useState(()=>new Set(l.length>0?[l[0]]:[])),d=l.length>0&&l.every(p=>i.has(p)),u=p=>{c(v=>{const j=new Set(v);return j.has(p)?j.delete(p):j.add(p),j})},h=()=>{c(d?new Set:new Set(l))},m=o.useCallback(()=>{const p=[];if(p.push(`Summary: ${t.summary.executed} executed, ${t.summary.skipped} skipped, ${t.summary.failed} failed`),t.pagination&&p.push(`Pages: ${t.pagination.pagesProcessed}`),p.push(""),a)for(const v of l){const j=r.get(v)??[];p.push(`--- Page ${v} (${j.length} items) ---`);for(const f of j)p.push(ka(f,s));p.push("")}else for(const v of t.actions)p.push(ka(v,s));return p.join(`
`)},[t,a,l,r,s]),y=o.useCallback(async()=>{const p=m();await navigator.clipboard.writeText(p),te.success("Report copied to clipboard")},[m]);return e.jsxs("div",{className:"flex flex-col h-full","data-test":"automation-report-view",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border-b text-xs",style:{borderColor:"#e4e4e7",backgroundColor:"#fafafa"},"data-test":"automation-report-summary",children:[e.jsxs("span",{className:"text-zinc-500",children:["Total items: ",t.totalItems]}),a&&e.jsxs("span",{className:"text-blue-500",children:["(",l.length," pages)"]}),e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(Ln,{className:"w-3 h-3"}),t.summary.executed," executed"]}),e.jsxs("span",{className:"flex items-center gap-1 text-zinc-500",children:[e.jsx(Ua,{className:"w-3 h-3"}),t.summary.skipped," skipped"]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(Vn,{className:"w-3 h-3"}),t.summary.failed," failed"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-3","data-test":"automation-report-results",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ke,{type:"text",value:s,onChange:p=>n==null?void 0:n(p.target.value),placeholder:"{{value}}",className:"h-7 w-32 text-xs","data-test":"automation-report-label-template",title:"Label template: use {{value}} for first condition value, {{value:N}} for Nth"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-2 py-1 text-xs text-zinc-600 hover:text-zinc-700 hover:bg-zinc-100 rounded transition-colors","data-test":"automation-report-copy",title:"Copy report as text",children:[e.jsx($n,{className:"w-3 h-3"}),"Copy"]}),a&&l.length>1&&e.jsx("button",{onClick:h,className:"px-2 py-1 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors","data-test":"automation-report-toggle-all",children:d?"Collapse All":"Expand All"})]})]}),t.actions.length===0?e.jsx("div",{className:"text-xs text-center py-4 text-zinc-400","data-test":"automation-report-empty",children:"No actions were processed"}):a?e.jsx("div",{className:"space-y-3",children:l.map(p=>e.jsx(gd,{pageNumber:p,actions:r.get(p),isExpanded:i.has(p),onToggle:()=>u(p),labelTemplate:s},p))}):e.jsx("div",{className:"space-y-3",children:t.actions.map((p,v)=>e.jsx(Cr,{action:p,showPageInfo:!1,labelTemplate:s},v))})]})]})}const yd=/([[\]():!#$%&'*+,./;<=>?@\\^`{|}~])/g;function kr(t){return t.replace(yd,"\\$1")}function Vt(t){const s=t.tagName.toLowerCase(),n=Array.from(t.classList).filter(a=>!a.startsWith("css-")).map(kr).join(".");return n?`${s}.${n}`:s}function Os(t){const s=t.getRootNode();if(s instanceof ShadowRoot){const l=window.__watcherShadowRoot;if(l&&s===l)return!0}if(t.closest('[data-test="capture-panel-v2"]'))return!0;const a=t.closest('[data-test="draggable-popover-container"]');if(a&&a.querySelector('[data-test$="-v2"]'))return!0;const r=t.closest("[data-radix-popper-content-wrapper]")||t.closest('[role="dialog"]')||t.closest('[role="listbox"]')||t.closest('[role="menu"]');if(r){let l=t;for(;l&&l!==r;){const c=l.getAttribute("data-test");if(c!=null&&c.endsWith("-v2"))return!0;l=l.parentElement}if(r.querySelector('[data-test$="-v2"]'))return!0}return!1}function jd(t){const s=Array.from(t.classList).filter(n=>!n.startsWith("css-")).map(kr).join(".");return s?`.${s}`:t.tagName.toLowerCase()}function Se(t,s,n){if(s.length===1)return{...t,[s[0]]:n};const[a,...r]=s,l=typeof t[a]=="object"&&t[a]!==null?t[a]:{};return{...t,[a]:Se(l,r,n)}}function Le(t,s){if(s.length===0)return t;const[n,...a]=s,r=t[n];if(a.length===0)return r;if(typeof r=="object"&&r!==null)return Le(r,a)}function Sa(t,s){if(!t||!s)return[document];const n=t.split("."),a=n[n.length-1];if(a==="_container"||a==="_item")return[document];const r=[];let l=s;for(let c=0;c<n.length;c++){const d=n[c];if(typeof l!="object"||l===null)break;const u=l;if(!(d in u))break;if(l=u[d],typeof l=="object"&&l!==null){const h=l;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",p=typeof m=="string"?m:(m==null?void 0:m.selector)??"",v=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(p){const j=p.endsWith("[]")?p.slice(0,-2):p;v?r.push({containerSelector:j,itemSelector:v}):r.push({containerSelector:j,itemSelector:"",containerOnly:!0})}}}}if(r.length===0)return[document];let i=[document];for(let c=0;c<r.length;c++){const d=r[c],u=[];for(const h of i){const m=Array.from(h.querySelectorAll(d.containerSelector));for(const y of m)if(d.containerOnly)u.push(y);else{const p=Array.from(y.querySelectorAll(d.itemSelector));u.push(...p)}}if(u.length===0)return[document];i=u}return i}function vd(t,s){if(!t||!s)return[document];const n=t.split("."),a=n[n.length-1];if(a==="_container"||a==="_item")return[document];const r=[];let l=s;for(let c=0;c<n.length;c++){const d=n[c];if(typeof l!="object"||l===null)break;const u=l;if(!(d in u))break;if(l=u[d],typeof l=="object"&&l!==null){const h=l;if("_container"in h){const m=h._container,y="_item"in h?h._item:"",p=typeof m=="string"?m:(m==null?void 0:m.selector)??"",v=typeof y=="string"?y:(y==null?void 0:y.selector)??"";if(p){const j=p.endsWith("[]")?p.slice(0,-2):p;v?r.push({containerSelector:j,itemSelector:v}):r.push({containerSelector:j,itemSelector:"",containerOnly:!0})}}}}if(r.length===0)return[document];let i=[document];for(let c=0;c<r.length;c++){const d=r[c],u=c===r.length-1,h=[];for(const m of i){const y=Array.from(m.querySelectorAll(d.containerSelector));for(const p of y)if(u)h.push(p);else if(d.containerOnly)h.push(p);else{const v=Array.from(p.querySelectorAll(d.itemSelector));h.push(...v)}}if(h.length===0)return[document];i=h}return i}function Nd(t,s){var a;let n=0;for(const r of t.childNodes)if(r.nodeType===Node.TEXT_NODE&&((a=r.textContent)==null?void 0:a.trim())){if(n===s){const i=window.getSelection();if(i){const c=document.createRange();return c.selectNodeContents(r),i.removeAllRanges(),i.addRange(c),!0}}n++}return!1}function Ea(t,s){if(!t||!s)return;const n=t.split("."),a=Le(s,n);if(ye(a)&&a.siblingFilter)return a.siblingFilter}function wd({selectors:t}={}){const s=o.useRef([]);o.useEffect(()=>{const i="capture-selection-style";if(document.getElementById(i))return;const c=document.createElement("style");return c.id=i,c.textContent=`::selection { background: ${Gt.background}; }`,document.head.appendChild(c),()=>{const d=document.getElementById(i);d&&d.remove()}},[]);const n=o.useCallback(()=>{for(const{element:c,originalOutline:d,originalOutlineOffset:u,originalBackground:h}of s.current)c.style.outline=d,c.style.outlineOffset=u,c.style.background=h;s.current=[];const i=window.getSelection();i&&i.removeAllRanges()},[]),a=o.useCallback(i=>{Os(i)||(s.current.push({element:i,originalOutline:i.style.outline,originalOutlineOffset:i.style.outlineOffset,originalBackground:i.style.background}),i.style.outline=ct.outline,i.style.outlineOffset=ct.outlineOffset,i.style.background=ct.background)},[]),r=o.useCallback((i,c,d)=>{n();try{let u=Sa(c,t);if(d){const{ifSelector:j,branchSelectors:f}=d;for(const b of u){if(b===document)continue;const x=b;let N="";for(const{pattern:g,selector:w}of f){const E=g.replace(/^\/|\/$/g,"");if(wn(x,j,E)){N=w;break}}if(N){const g=Jt(N,b);for(const w of g)a(w)}}return}const h=Ec(c,t);h&&(u=Ic(u,h));const m=Ea(c,t),y=Xs(i),p=fs(i),v=y.textNodeIndex;for(const j of u){let f=Jt(p,j);if(f=zs(f,m),v!==void 0)for(const b of f)Nd(b,v);else for(const b of f)a(b)}}catch{}},[n,a,t]),l=o.useCallback((i,c,d)=>{if(n(),!(!i||d===null||d<0))try{const u=Sa(c,t);if(d>=u.length)return;const h=u[d],m=Ea(c,t);let y=Jt(i,h);y=zs(y,m);for(const p of y)a(p)}catch{}},[n,a,t]);return{clearHighlights:n,highlightElement:a,highlightMatches:r,highlightByIndex:l}}function Cd({onSelectorCaptured:t,onSelectorInspect:s,selectors:n,preventDefaultOnInteraction:a,onEscapePressed:r}){const[l,i]=o.useState(null),{clearHighlights:c,highlightElement:d,highlightMatches:u,highlightByIndex:h}=wd({selectors:n});o.useEffect(()=>{if(!l)return;const f=g=>{g.key==="Escape"&&(c(),i(null),r==null||r())},b=g=>{const E=g.composedPath()[0]||g.target;Os(E)||(c(),d(E))},x=g=>{var C;const E=g.composedPath()[0]||g.target;if(Os(E))return;a&&(g.preventDefault(),g.stopPropagation());const T=jd(E),B=Array.from(document.querySelectorAll(T)),P=B.indexOf(E),_=B.length>1&&P>=0?Ke(T,{type:"single",index:P}):T,I=B.length>1&&P>=0?[((C=E.textContent)==null?void 0:C.trim())??""]:B.map(S=>{var A;return((A=S.textContent)==null?void 0:A.trim())??""});t(l,_,I),c(),i(null)},N=g=>{const E=g.composedPath()[0]||g.target;Os(E)||a&&(g.preventDefault(),g.stopPropagation(),g.stopImmediatePropagation())};return window.addEventListener("keydown",f),document.addEventListener("mouseover",b),document.addEventListener("pointerdown",N,!0),document.addEventListener("mousedown",N,!0),document.addEventListener("click",x,!0),()=>{window.removeEventListener("keydown",f),document.removeEventListener("mouseover",b),document.removeEventListener("pointerdown",N,!0),document.removeEventListener("mousedown",N,!0),document.removeEventListener("click",x,!0)}},[l,c,d,t,a,r]),o.useEffect(()=>{l||c()},[l,c]);const m=o.useCallback((f,b)=>{!b||b===""?i(f):s==null||s(f,b)},[s]),y=o.useCallback((f,b,x)=>{if(x){u("",b,x);return}if(!f){c();return}u(f,b)},[c,u]),p=o.useCallback((f,b,x=400)=>{y(f,b),setTimeout(()=>{c()},x)},[y,c]),v=o.useCallback((f,b,x)=>{if(!(x===null||x<0))try{const N=vd(b,n);if(x>=N.length)return;const g=N[x];if(g===document)return;g.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},[n]),j=o.useCallback(()=>{c(),i(null)},[c]);return{selectorCaptureFieldPath:l,handleFieldValueClick:m,handleFieldValueHover:y,flashHighlight:p,highlightByIndex:h,scrollToElementByIndex:v,cancelCapture:j}}function kd({selectors:t}){const[s,n]=o.useState(!1),[a,r]=o.useState(null),[l,i]=o.useState(null),[c,d]=o.useState(null),[u,h]=o.useState(null),[m,y]=o.useState(null),p=o.useCallback((b,x)=>{n(!0),r(b);const N=yo(b,t);if(N.length===0){y(null);const C=_s(x,document);i(C),d(x),h(null);return}const g=fs(x),E=wt(g).selector;let k=null,T=-1,B=0;for(let C=0;C<N.length;C++){const S=N[C];try{S.querySelectorAll(E).length>0&&(B++,k===null&&(k=S,T=C))}catch{}}const P=k??N[0],_=T>=0?T:0;y(P);const I=_s(x,P);I&&(I.itemStats={itemsWithMatch:B,totalItems:N.length,displayedItemIndex:_}),i(I),d(x),h(null)},[t]),v=o.useCallback(()=>{n(!1),r(null),i(null),d(null),h(null),y(null)},[]),j=o.useCallback(b=>{i(_s(b,m??document))},[m]),f=o.useCallback(b=>{if(!l||b<0||b>=l.siblings.length)return null;const x=l.siblings[b];return gs(x)?x.element:null},[l]);return{isOpen:s,fieldPath:a,domContext:l,initialSelector:c,previousChildIndex:u,openPopover:p,closePopover:v,refreshContext:j,setPreviousChildIndex:h,getSiblingElement:f}}function Sr(t,s){var i,c,d;let n=t;if(s&&s.length>0){n=t.cloneNode(!0);for(const u of s){if(u==="#text")continue;n.querySelectorAll(u).forEach(m=>m.remove())}}const a=["DIV","P","LI","SECTION","ARTICLE","HEADER","FOOTER"];if(Array.from(n.children).some(u=>a.includes(u.tagName))){const u=[];for(const h of n.childNodes)if(h.nodeType===Node.TEXT_NODE){const m=(i=h.textContent)==null?void 0:i.trim();m&&u.push(m)}else if(h.nodeType===Node.ELEMENT_NODE){const m=(c=h.textContent)==null?void 0:c.trim();m&&u.push(m)}return u.join(" ")}return((d=n.textContent)==null?void 0:d.trim())??""}function Sd(t){return t.endsWith("[]")?{baseSelector:t.slice(0,-2),selectAll:!0}:{baseSelector:t,selectAll:!1}}function Er(t){const s={};for(const[n,a]of Object.entries(t))n.startsWith("_")||(s[n]=a);return s}function _r(t,s){const n={...t};for(const[a,r]of Object.entries(s))a!=="match"&&(n[a]=r);return n}function Ed(t){const s=t.selector;return s?t.index?`${s}[${t.index.type==="single"?t.index.index:""}]`:s:""}function Ir(t,s){var a;let n=0;for(const r of t.childNodes)if(r.nodeType===Node.TEXT_NODE){const l=(a=r.textContent)==null?void 0:a.trim();if(l){if(n===s)return l;n++}}return""}function Ws(t,s){return s.textNodeIndex!==void 0?Ir(t,s.textNodeIndex):s.extractAttribute?t.getAttribute(s.extractAttribute)??"":Sr(t,s.excludeChildren)}function _d({domTreeFieldPath:t,domContext:s,domTreeInitialSelector:n,onSelectorCaptured:a,refreshDomTreeContext:r,closeDomTreePopover:l,setDomTreePreviousChildIndex:i}){const c=o.useCallback((j,f)=>{var E;if(!t)return;const b=Vt(f),x=Array.from(document.querySelectorAll(b)),N=x.indexOf(f),g=x.length>1&&N>=0?Ke(b,{type:"single",index:N}):b,w=x.length>1&&N>=0?[((E=f.textContent)==null?void 0:E.trim())??""]:x.map(k=>{var T;return((T=k.textContent)==null?void 0:T.trim())??""});a(t,g,w)},[t,a]),d=o.useCallback(j=>{var w;if(!t||!s)return;i(s.capturedIndex);const f=Vt(j),b=Array.from(document.querySelectorAll(f)),x=b.indexOf(j),N=b.length>1&&x>=0?Ke(f,{type:"single",index:x}):f,g=b.length>1&&x>=0?[((w=j.textContent)==null?void 0:w.trim())??""]:b.map(E=>{var k;return((k=E.textContent)==null?void 0:k.trim())??""});a(t,N,g),r(N)},[t,s,a,r,i]),u=o.useCallback((j,f)=>{var E;if(!t)return;i(null);const b=Vt(f),x=Array.from(document.querySelectorAll(b)),N=x.indexOf(f),g=x.length>1&&N>=0?Ke(b,{type:"single",index:N}):b,w=x.length>1&&N>=0?[((E=f.textContent)==null?void 0:E.trim())??""]:x.map(k=>{var T;return((T=k.textContent)==null?void 0:T.trim())??""});a(t,g,w),r(g)},[t,a,r,i]),h=o.useCallback(()=>{t&&(a(t,"",[]),l())},[t,a,l]),m=o.useCallback(j=>{var w;if(!t||!s)return;const f=s.baseSelector,b=Ke(f,{type:"single",index:j}),N=document.querySelectorAll(f)[j],g=((w=N==null?void 0:N.textContent)==null?void 0:w.trim())??"";a(t,b,[g]),r(b),te.success(`Updated selector to :nth-of-type(${j+1})`)},[t,s,a,r]),y=o.useCallback(()=>{if(!t||!n)return;const j=document.querySelectorAll(n),f=Array.from(j).map(b=>{var x;return((x=b.textContent)==null?void 0:x.trim())??""});a(t,n,f),r(n),te.success("Reverted to original selector")},[t,n,a,r]),p=o.useCallback((j,f)=>{t&&yi(async()=>{const{querySelectorWithIndex:b}=await Promise.resolve().then(()=>fo);return{querySelectorWithIndex:b}},void 0).then(({querySelectorWithIndex:b})=>{const N=b(j).map(g=>{var w;return((w=g.textContent)==null?void 0:w.trim())??""});a(t,j,N),r(j)})},[t,a,r]),v=o.useCallback((j,f)=>{var B;if(!t||!s)return;const b=(B=s.parent)==null?void 0:B.element;if(!b)return;const x=Vt(b),N=Array.from(document.querySelectorAll(x)),g=N.indexOf(b),E=`${N.length>1&&g>=0?Ke(x,{type:"single",index:g}):x}@text[${f.nodeIndex}]`,k=f.parentElement,T=Ir(k,f.nodeIndex);a(t,E,[T]),l(),te.success(`Captured text node @text[${f.nodeIndex}]`)},[t,s,a,l]);return{handleDomTreeSiblingSelect:c,handleDomTreeParentSelect:d,handleDomTreeChildSelect:u,handleClearSelector:h,handleAddIndex:m,handleRevertSelector:y,handleSelectorChange:p,handleTextNodeClick:v}}function Id(t){const[s,n]=o.useState(t),[a,r]=o.useState(null),[l,i]=o.useState(null),[c,d]=o.useState(!1),u=o.useCallback(N=>{r(N)},[]),h=o.useCallback((N,g)=>{n(w=>w.map(E=>E.id===N?{...E,name:g}:E))},[]),m=o.useCallback((N,g,w)=>{i({id:N,name:g,type:w}),d(!0)},[]),y=o.useCallback(N=>{N&&l&&n(g=>g.map(w=>w.id===l.id?{...w,name:N.name,type:N.type}:w)),i(null),d(!1)},[l]),p=o.useCallback(()=>{i(null),d(!1)},[]),v=o.useCallback(N=>{n(g=>g.filter(w=>w.id!==N&&w.parentId!==N))},[]),j=o.useCallback(N=>{const g=(w,E)=>w.flatMap((k,T)=>{const P={...k.data,parentId:E,order:T},_=k.children?g(k.children,k.id):[];return[P,..._]});n(g(N,null))},[]),f=o.useCallback(N=>{const g=`field-${Date.now()}`;n(w=>[...w,{id:g,name:"newField",type:"string",order:w.length,parentId:N,mapping:null}])},[]),b=o.useCallback(N=>{n(g=>{const w=g.find(k=>k.id===N);if(!w)return g;const E=`field-${Date.now()}`;return[...g,{id:E,name:"newField",type:"string",order:w.order-.5,parentId:w.parentId,mapping:null}]})},[]),x=o.useCallback(N=>{n(g=>{const w=g.find(k=>k.id===N);if(!w)return g;const E=`field-${Date.now()}`;return[...g,{id:E,name:"newField",type:"string",order:w.order+.5,parentId:w.parentId,mapping:null}]})},[]);return{fields:s,setFields:n,selectedFieldId:a,editingField:l,isFieldDialogOpen:c,handleFieldSelect:u,handleFieldUpdate:h,handleFieldEdit:m,handleFieldDialogSubmit:y,handleFieldDialogCancel:p,handleFieldDelete:v,handleReorder:j,handleAddChild:f,handleAddSiblingBefore:b,handleAddSiblingAfter:x}}const Et="watcher:custom-captures-v2",_a=5e3,Ia=()=>typeof window<"u"&&!!window.__watcherShadowRoot,Aa=()=>`storage-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,_t={async get(t){return Ia()?new Promise((s,n)=>{const a=Aa(),r=setTimeout(()=>{window.removeEventListener("watcher:storage:response",l),console.warn("[Storage] Request timed out, falling back to localStorage"),s(localStorage.getItem(t))},_a),l=(i=>{i.detail.id===a&&(clearTimeout(r),window.removeEventListener("watcher:storage:response",l),i.detail.success?s(i.detail.value??null):(console.error("[Storage] Bridge error:",i.detail.error),s(localStorage.getItem(t))))});window.addEventListener("watcher:storage:response",l),window.dispatchEvent(new CustomEvent("watcher:storage:request",{detail:{id:a,action:"get",key:t}}))}):localStorage.getItem(t)},async set(t,s){if(Ia())return new Promise((n,a)=>{const r=Aa(),l=setTimeout(()=>{window.removeEventListener("watcher:storage:response",i),console.warn("[Storage] Request timed out, falling back to localStorage"),localStorage.setItem(t,s),n()},_a),i=(c=>{c.detail.id===r&&(clearTimeout(l),window.removeEventListener("watcher:storage:response",i),c.detail.success||(console.error("[Storage] Bridge error:",c.detail.error),localStorage.setItem(t,s)),n())});window.addEventListener("watcher:storage:response",i),window.dispatchEvent(new CustomEvent("watcher:storage:request",{detail:{id:r,action:"set",key:t,value:s}}))});localStorage.setItem(t,s)}};function Ad(){const[t,s]=o.useState([]);o.useEffect(()=>{(async()=>{try{const u=await _t.get(Et);if(u){const h=JSON.parse(u);s(h)}}catch(u){console.error("[Storage] Failed to load captures:",u)}})()},[]);const n=o.useCallback(d=>{const u={...d,id:`capture-${Date.now()}`,capturedAt:Date.now()};return s(h=>{const m=[...h,u];return _t.set(Et,JSON.stringify(m)),m}),te.success("Capture saved!"),u},[]),a=o.useCallback(async d=>{const u=await _t.get(Et);if(!u)return;const m=JSON.parse(u).find(y=>y.id===d);return m&&te.success("Capture loaded!"),m},[]),r=o.useCallback(d=>{s(u=>{const h=u.filter(m=>m.id!==d);return _t.set(Et,JSON.stringify(h)),h}),te.success("Capture deleted")},[]),l=o.useCallback((d,u)=>{s(h=>{const m=h.map(y=>y.id===d?{...y,name:u}:y);return _t.set(Et,JSON.stringify(m)),m}),te.success("Capture renamed")},[]),i=o.useCallback(d=>{s(u=>{const h=u.findIndex(y=>y.name===d.name);let m;if(h>=0)m=u.map((y,p)=>p===h?{...y,...d,capturedAt:Date.now()}:y);else{const y={...d,id:`capture-${Date.now()}`,capturedAt:Date.now()};m=[...u,y]}return _t.set(Et,JSON.stringify(m)),m})},[]),c=o.useCallback(async()=>{try{const d=await _t.get(Et);if(!d)return;const u=JSON.parse(d);return u.length===0?void 0:u[u.length-1]}catch(d){console.error("[Storage] getLastCapture failed:",d);return}},[]);return{savedCaptures:t,saveCapture:n,loadCapture:a,deleteCapture:r,renameCapture:l,upsertCaptureByName:i,getLastCapture:c}}function Td(t){const s={};for(const[n,a]of Object.entries(t))n==="match"?s[n]=a:typeof a=="string"?s[n]=xs(a):(ye(a)||typeof a=="object"&&a!==null&&Array.isArray(a),s[n]=a);return s}function Od(t){const s=new Set;for(const n of Object.values(t))if(typeof n=="object"&&n!==null)for(const a of Object.keys(n))a!=="match"&&s.add(a);return Array.from(s)}function Ds(t){const s={};for(const[n,a]of Object.entries(t))if(n==="_container"||n==="_item")s[n]=a;else if(n==="_if")s[n]=a;else if(n==="_branches")if(Array.isArray(a))s[n]=a;else if(typeof a=="object"&&a!==null){const r=a,l={};for(const[c,d]of Object.entries(r))typeof d=="object"&&d!==null?l[c]=Td(d):l[c]=d;s[n]=l;const i=Od(r);i.length>0&&(s._branchFields=i),"_activeBranch"in t||(s._activeBranch=1)}else s[n]=a;else n==="_branchFields"||n==="_activeBranch"||n==="_pagination"?s[n]=a:typeof a=="string"?s[n]=xs(a):ye(a)?s[n]=a:typeof a=="object"&&a!==null&&!Array.isArray(a)?s[n]=Ds(a):s[n]=a;return s}function Fs(t){const s={};for(const[n,a]of Object.entries(t))n==="_if"?s[n]=a:ye(a)?s[n]=Wn(a):typeof a=="object"&&a!==null&&!Array.isArray(a)?s[n]=Fs(a):s[n]=a;return s}function Dd({fields:t,selectors:s,content:n,setFields:a,setSelectors:r,setContent:l}){const[i,c]=o.useState(!0),[d,u]=o.useState(!1),[h,m]=o.useState(!1),[y,p]=o.useState(!1),[v,j]=o.useState(!1),[f,b]=o.useState(!0),[x,N]=o.useState(null),{savedCaptures:g,saveCapture:w,loadCapture:E,deleteCapture:k,renameCapture:T,upsertCaptureByName:B,getLastCapture:P}=Ad();o.useEffect(()=>{(async()=>{const X=await P(),ce=X&&Object.keys(X.selectors).length>0;if(X&&ce){a(X.fields);const de=Ds(X.selectors);r(de),l(X.content)}})()},[P,a,r,l]);const _=o.useCallback(()=>{const Q=Fs(s);w({name:"TFT Capture",url:window.location.href,fields:t,selectors:Q,content:n})},[w,t,s,n]),I=o.useCallback(async Q=>{const X=await E(Q);if(X){a(X.fields);const ce=Ds(X.selectors);r(ce),l(X.content)}},[E,a,r,l]),C=o.useCallback(()=>{const Q=Fs(s),X={fields:t,selectors:Q,content:n},ce=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),de=URL.createObjectURL(ce),ue=document.createElement("a");ue.href=de,ue.download=`capture-${Date.now()}.json`,ue.click(),URL.revokeObjectURL(de)},[t,s,n]),S=o.useCallback(()=>{r({}),l({}),te.success("Capture data cleared")},[r,l]),A=o.useCallback(()=>{c(!0)},[]),R=o.useCallback(()=>{c(!1)},[]),L=o.useCallback(()=>{m(!0)},[]),W=o.useCallback(()=>{m(!1)},[]),D=o.useCallback(()=>{p(!0)},[]),H=o.useCallback(()=>{p(!1)},[]),Z=o.useCallback(()=>{j(!0)},[]),le=o.useCallback(()=>{j(!1)},[]),fe=o.useCallback((Q,X)=>{T(Q,X)},[T]),je=o.useCallback(Q=>{k(Q)},[k]),ae=o.useCallback(Q=>{const X=Ds(Q);r(X);const ce=Fs(X);B({name:"Initial",url:window.location.href,fields:t,selectors:ce,content:n}),te.success("Schema imported and saved as Initial")},[r,B,t,n]),Y=o.useCallback((Q,X)=>{N({fieldName:Q,values:X})},[]),ne=o.useCallback(()=>{N(null)},[]);return{savedCaptures:g,isPopoverVisible:i,moreActionsOpen:d,importDialogOpen:h,managerPopoverOpen:y,advancedSettingsOpen:v,preventDefaultOnInteraction:f,contentPopover:x,setMoreActionsOpen:u,setPreventDefaultOnInteraction:b,handleSave:_,handleLoad:I,handleRenameCapture:fe,handleDeleteCapture:je,handleDownload:C,handleClear:S,handleOpenPopover:A,handleClosePopover:R,handleOpenImportDialog:L,handleCloseImportDialog:W,handleOpenManagerPopover:D,handleCloseManagerPopover:H,handleOpenAdvancedSettings:Z,handleCloseAdvancedSettings:le,handleImportSchema:ae,handleArrayBadgeClick:Y,handleCloseContentPopover:ne}}function Fd(t){return t.replace(/([[\]():#$^*=!|~'"/@+?{}])/g,"\\$1")}function Md({selectors:t,captureRoot:s,setAttributePopover:n,setChildFilterPopover:a,onUpdateExcludeChildren:r,onUpdateExtractAttribute:l,onWarning:i}){const c=o.useCallback(f=>{const b=f.split("."),x=Le(t,b);if(ye(x))return fs(x);if(typeof x=="string"){const N=x.lastIndexOf("@");return N>0?x.substring(0,N):x}return null},[t]),d=o.useCallback(f=>{const b=f.split("."),x=Le(t,b);return ye(x)&&x.excludeChildren?x.excludeChildren:[]},[t]),u=o.useCallback(f=>{const b=f.split("."),x=Le(t,b);return ye(x)&&x.extractAttribute?[x.extractAttribute]:["innerText"]},[t]),h=o.useCallback((f,b)=>{const x=c(f);if(!x){i==null||i("No selector defined for this field");return}const N=s??document;try{const g=N.querySelector(x);if(!g){i==null||i("Element not found on page");return}const w=[];for(const k of g.attributes)w.push({name:k.name,value:k.value});const E=u(f);n({isOpen:!0,fieldPath:f,attributes:w,currentAttributes:E,position:b})}catch{i==null||i("Invalid selector")}},[t,c,u,s,n,i]),m=o.useCallback((f,b)=>{const x=c(f);if(!x){te.error("No selector defined for this field");return}const N=s??document;try{const g=N.querySelector(x);if(!g){te.error("No element found for selector");return}const w=[];g.childNodes.forEach((T,B)=>{var P,_,I;if(T.nodeType===Node.ELEMENT_NODE){const C=T,S=C.tagName.toLowerCase(),A=typeof C.className=="string"?C.className:((P=C.className)==null?void 0:P.baseVal)??"",R=A?`.${A.split(" ").filter(Boolean).join(".")}`:"",L=A?`.${A.split(" ").filter(Boolean).map(Z=>Fd(Z)).join(".")}`:"",W=`child-${B}-${S}`,D=`${S}${R}`.slice(0,30),H=((_=C.textContent)==null?void 0:_.trim().slice(0,50))||"";w.push({id:W,label:D,selector:`${S}${L}`,textPreview:H})}else if(T.nodeType===Node.TEXT_NODE){const C=(I=T.textContent)==null?void 0:I.trim();C&&w.push({id:`text-${B}`,label:"#text",selector:"#text",textPreview:C.slice(0,50)})}});const E=d(f),k=w.filter(T=>E.includes(T.selector)).map(T=>T.id);a({isOpen:!0,fieldPath:f,children:w,excludedChildren:k,position:b})}catch{te.error("Invalid selector")}},[c,d,s,a]),y=o.useCallback(()=>{n(f=>({...f,isOpen:!1}))},[n]),p=o.useCallback((f,b)=>{const x=b.filter(g=>g!=="innerText"),N=x.length>0?x[0]:void 0;l&&l(f,N),N?te.success(`Extraction set to: ${N}`):te.success("Extraction set to: innerText (default)")},[l]),v=o.useCallback(()=>{a(f=>({...f,isOpen:!1}))},[a]),j=o.useCallback((f,b,x)=>{const N=x.filter(w=>b.includes(w.id)).map(w=>w.selector);r&&r(f,N);const g=x.length-b.length;te.success(`Saved: ${g} children included, ${b.length} excluded`)},[r]);return{handleConfigClick:h,handleFilterChildrenClick:m,handleAttributePopoverClose:y,handleAttributeSelect:p,handleChildFilterPopoverClose:v,handleChildFilterConfirm:j}}function Bd({containerRef:t,headerHeight:s=33,minHeight:n=80,bottomPadding:a=100}){const[r,l]=o.useState(null),i=o.useRef(!1),c=o.useCallback(d=>{d.preventDefault(),i.current=!0,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[]);return o.useEffect(()=>{const d=h=>{if(!i.current||!t.current)return;const m=t.current.getBoundingClientRect(),y=h.clientY-m.top-s,p=m.height-s-a;l(Math.max(n,Math.min(p,y)))},u=()=>{i.current&&(i.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",u)}},[t,s,n,a]),{schemaSectionHeight:r,handleResizeStart:c}}const Pd=new Set(["_if","_branches","_branchFields","_actions","_pagination","_attributes","_excludeChildren"]),zd={isOpen:!1,fieldPath:"",existingIf:null,existingBranches:null,availableFields:[],selectedBranchFields:[],autoToggleIf:!1,existingSelectors:{},existingPagination:null};function Rd({selectors:t,setSelectors:s}){const[n,a]=o.useState(zd),r=o.useCallback((j,f,b,x=!1)=>{const N=j.split("."),g=Le(t,N);let w=[],E=f,k=b,T=[],B={};if(typeof g=="object"&&g!==null){const _=g;w=Object.keys(_).filter(I=>!I.startsWith("_"));for(const[I,C]of Object.entries(_))Pd.has(I)||(typeof C=="string"&&C?B[I]=C:ye(C)&&(B[I]=we(C)));!E&&_._if&&(E=_._if),!k&&_._branches&&(k=_._branches),Array.isArray(_._branchFields)&&(T=_._branchFields)}const P=typeof g=="object"&&g!==null?g._pagination??null:null;a({isOpen:!0,fieldPath:j,existingIf:E,existingBranches:k,availableFields:w,selectedBranchFields:T,autoToggleIf:x,existingSelectors:B,existingPagination:P})},[t]),l=o.useCallback((j,f)=>{const b=n.fieldPath;s(x=>{if(b==="_root")return{...x,_if:j,_branches:f};const N=b.split("."),g=Le(x,N);if(typeof g=="object"&&g!==null){const w={...g,_if:j,_branches:f};return Se(x,N,w)}return x})},[n.fieldPath,s]),i=o.useCallback(()=>{const j=n.fieldPath;s(f=>{if(j==="_root"){const{_if:N,_branches:g,...w}=f;return w}const b=j.split("."),x=Le(f,b);if(typeof x=="object"&&x!==null){const{_if:N,_branches:g,...w}=x;return Se(f,b,w)}return f})},[n.fieldPath,s]),c=o.useCallback(()=>{a(j=>({...j,isOpen:!1}))},[]),d=o.useCallback(j=>{const f=n.fieldPath;s(b=>{if(f==="_root"){if(j)return{_if:{selector:"",condition:"exists"},...b};{const{_if:g,...w}=b;return w}}const x=f.split("."),N=Le(b,x);if(typeof N=="object"&&N!==null){const g=N;if(j){const w={};for(const[E,k]of Object.entries(g))w[E]=k,(E==="_item"||E==="_container"&&!("_item"in g))&&(w._if={selector:"",condition:"exists"});return"_if"in w?Se(b,x,w):Se(b,x,{_if:{selector:"",condition:"exists"},...g})}else{const{_if:w,...E}=g;return Se(b,x,E)}}return b})},[n.fieldPath,s]),u=o.useCallback(j=>{const f=j.split(".");s(b=>{const x=Le(b,f);if(typeof x=="object"&&x!==null){const N=x;if("_if"in N){const{_if:w,_branchFields:E,_branches:k,_activeBranch:T,...B}=N;return Se(b,f,B)}else{const w={};for(const[E,k]of Object.entries(N))w[E]=k,(E==="_item"||E==="_container"&&!("_item"in N))&&(w._if={selector:"",condition:"exists"});return"_if"in w?Se(b,f,w):Se(b,f,{_if:{selector:"",condition:"exists"},...N})}}return b})},[s]),h=o.useCallback((j,f)=>{a(x=>{const N=f?[...x.selectedBranchFields,j]:x.selectedBranchFields.filter(g=>g!==j);return{...x,selectedBranchFields:N}});const b=n.fieldPath.split(".");s(x=>{const N=Le(x,b);if(typeof N=="object"&&N!==null){const g=N,w=Array.isArray(g._branchFields)?g._branchFields:[],E=f?[...w,j]:w.filter(k=>k!==j);if(f&&w.length===0)return Se(x,b,{...g,_branchFields:E,_activeBranch:1,_branches:{1:{},2:{}}});if(!f&&E.length===0){const{_branchFields:k,_activeBranch:T,_branches:B,...P}=g;return Se(x,b,P)}return Se(x,b,{...g,_branchFields:E})}return x})},[n.fieldPath,s]),m=o.useCallback((j,f)=>{s(b=>{const x=(g,w)=>{if(w.length===0)return{...g,_activeBranch:f};const[E,...k]=w;return{...g,[E]:x(g[E],k)}},N=j?j.split("."):[];return x(b,N)})},[s]),y=o.useCallback((j,f,b)=>{s(x=>{const N=(w,E)=>{var B;if(E.length===0){const P=w._branchFields||[],_=w._branches||{1:{},2:{}};if(b){const I=w[f],C={..._};for(const S of Object.keys(C))C[S]={...C[S],[f]:I};return{...w,_branchFields:[...P,f],_branches:C,_activeBranch:w._activeBranch??1}}else{const I=w._activeBranch||1,C=((B=_[String(I)])==null?void 0:B[f])??w[f],S={..._};for(const R of Object.keys(S)){const{[f]:L,...W}=S[R];S[R]=W}const A=P.filter(R=>R!==f);return{...w,_branchFields:A,_branches:S,[f]:C}}}const[k,...T]=E;return{...w,[k]:N(w[k],T)}},g=j?j.split("."):[];return N(x,g)})},[s]),p=o.useCallback(j=>{s(f=>{const b=(N,g)=>{if(g.length===0){const k=N._branches||{},T=N._branchFields||[],B=String(Object.keys(k).length+1),P={};for(const _ of T)P[_]="";return{...N,_branches:{...k,[B]:P}}}const[w,...E]=g;return{...N,[w]:b(N[w],E)}},x=j?j.split("."):[];return b(f,x)})},[s]),v=o.useCallback(j=>{const f=n.fieldPath;s(b=>{if(f==="_root"){if(j===null){const{_pagination:g,...w}=b;return w}return{...b,_pagination:j}}const x=f.split("."),N=Le(b,x);if(typeof N=="object"&&N!==null){const g=N;if(j===null){const{_pagination:w,...E}=g;return Se(b,x,E)}return Se(b,x,{...g,_pagination:j})}return b}),a(b=>({...b,existingPagination:j}))},[n.fieldPath,s]);return{branchEditorState:n,setBranchEditorState:a,handleEditBranching:r,handleSaveBranching:l,handleRemoveBranching:i,handleCloseBranchEditor:c,handleToggleIf:d,handleToggleIfDirect:u,handlePopoverToggleBranchField:h,handleBranchSwitch:m,handleToggleBranchField:y,handleAddBranch:p,handlePaginationChange:v}}function Tn(t,s,n){if(s.length===0)return typeof t=="string"?[t]:[String(t??"")];const[a,...r]=s;return Array.isArray(t)?t.flatMap(l=>Tn(l==null?void 0:l[a],r)):t&&typeof t=="object"?Tn(t[a],r):[]}function Ta(t,s){const n=s.split(".");if(n.length<2)return null;const a=n[0],r=n.slice(1);let l=t[a];for(let i=0;i<r.length;i++){const c=r[i];if(typeof l!="object"||l===null)return null;const d=l;if(c in d)l=d[c];else if(d._branches&&typeof d._branches=="object"){const u=d._branches,h=d._activeBranch,m=String(h??1),y=u[m];if(y&&c in y)l=y[c];else for(const p of Object.values(u))if(p&&c in p){l=p[c];break}}else return null}if(ye(l))return we(l);if(typeof l=="string")return l;if(typeof l=="object"&&l!==null){const i=l;if(i._item){if(ye(i._item))return we(i._item);if(typeof i._item=="string")return i._item}}return null}function $d({content:t,selectors:s,contentPopover:n,highlightByIndex:a,scrollToElementByIndex:r,handleArrayBadgeClick:l}){const i=o.useCallback(u=>{const h=u.split("."),m=h[0],y=t[m];if(!Array.isArray(y))return;const p=h.slice(1),v=[];for(let j=0;j<y.length;j++){const f=y[j],b=Tn(f,p);v.push(...b)}l(u,v)},[t,l]),c=o.useCallback(u=>{if(!n)return;const h=n.fieldName,m=Ta(s,h);a(m,h,u)},[n,s,a]),d=o.useCallback(u=>{if(!n)return;const h=n.fieldName,m=Ta(s,h);r(m,h,u)},[n,s,r]);return{handleSchemaCountClick:i,handleContentPopoverItemHover:c,handleContentPopoverItemClick:d}}function Ld({setSelectors:t}){const s=o.useCallback((r,l)=>{const i=r.split(".");t(c=>{const d=Le(c,i),u=ye(d)?{...d,excludeChildren:l}:{selector:typeof d=="string"?d:"",index:null,excludeChildren:l};return Se(c,i,u)})},[t]),n=o.useCallback((r,l)=>{const i=r.split(".");t(c=>{const d=Le(c,i),u=ye(d)?{...d,extractAttribute:l}:{selector:typeof d=="string"?d:"",index:null,extractAttribute:l};return Se(c,i,u)})},[t]),a=o.useCallback((r,l)=>{const i=r.split(".");t(c=>{const d=Le(c,i),u=ye(d)?{...d,siblingFilter:l}:{selector:typeof d=="string"?d:"",index:null,siblingFilter:l};return Se(c,i,u)})},[t]);return{handleUpdateExcludeChildren:s,handleUpdateExtractAttribute:n,handleUpdateSiblingFilter:a}}function Vd(){const[t,s]=o.useState(new Map),n=o.useCallback(i=>{const c=t.get(i);return!!c&&c.length>0},[t]),a=o.useCallback((i,c)=>{if(!c)return null;const d=_s(c);if(!d||!d.parent)return null;const u=d.siblings[d.capturedIndex];if(!u||!gs(u))return null;const h=u.element,m=d.parent.element,y=Vt(m),p=Array.from(document.querySelectorAll(y)),v=p.indexOf(m),j=p.length>1&&v>=0?Ke(y,{type:"single",index:v}):y;return s(f=>{const b=new Map(f),x=b.get(i)??[];return b.set(i,[...x,{parentSelector:j,childIndex:d.capturedIndex,childElement:h}]),b}),j},[]),r=o.useCallback(i=>{const c=t.get(i);if(!c||c.length===0)return null;const d=c[c.length-1];if(!document.contains(d.childElement))return s(v=>{const j=new Map(v),f=j.get(i)??[];return j.set(i,f.slice(0,-1)),j}),null;const u=d.childElement,h=Vt(u),m=Array.from(document.querySelectorAll(h)),y=m.indexOf(u),p=m.length>1&&y>=0?Ke(h,{type:"single",index:y}):h;return s(v=>{const j=new Map(v),f=j.get(i)??[];return j.set(i,f.slice(0,-1)),j}),{selector:p,element:u}},[t]),l=o.useCallback(i=>{s(c=>{const d=new Map(c);return d.delete(i),d})},[]);return{canNavigateDown:n,navigateUp:a,navigateDown:r,clearHistory:l}}function Oa(t){return typeof t=="string"?t:t&&typeof t=="object"&&"selector"in t?t.selector:""}function Ud(t,s){const n=s.split(".");let a=t,r=null;for(const i of n){if(typeof a!="object"||a===null)return"";r=a,a=r[i]}const l=Oa(a);if(l)return l;if(r&&"_branchFields"in r&&"_activeBranch"in r&&"_branches"in r){const i=r._branchFields,c=n[n.length-1];if(i.includes(c)){const d=String(r._activeBranch),h=r._branches[d];if(h&&c in h)return Oa(h[c])}}return""}function Wd({selectors:t,handleSelectorCaptured:s,flashHighlight:n}){const{navigateUp:a,navigateDown:r,canNavigateDown:l}=Vd(),i=o.useCallback(u=>{const h=Ud(t,u);if(!h)return;const m=a(u,h);if(m){const y=document.querySelectorAll(m),p=Array.from(y).map(v=>{var j;return((j=v.textContent)==null?void 0:j.trim())??""});s(u,m,p),n(m,u)}},[t,a,s,n]),c=o.useCallback(u=>{const h=r(u);if(h){const m=document.querySelectorAll(h.selector),y=Array.from(m).map(p=>{var v;return((v=p.textContent)==null?void 0:v.trim())??""});s(u,h.selector,y),n(h.selector,u)}},[r,s,n]),d=o.useCallback(u=>l(u),[l]);return{handleNavigateUp:i,handleNavigateDown:c,handleCanNavigateDown:d}}function qd(){const[t,s]=o.useState("automationV2"),[n,a]=o.useState("selectors"),[r,l]=o.useState("schema"),[i,c]=o.useState({}),[d,u]=o.useState({}),[h,m]=o.useState(!0),[y,p]=o.useState({isOpen:!1,fieldPath:"",attributes:[],currentAttributes:[],position:{x:0,y:0}}),[v,j]=o.useState({isOpen:!1,fieldPath:"",children:[],excludedChildren:[],position:{x:0,y:0}}),[f,b]=o.useState({isOpen:!1,fieldPath:"",currentSelector:"",currentFilter:null,position:{x:0,y:0}}),x=o.useRef(null),N=o.useRef(()=>{});return{mode:t,setMode:s,previewMode:n,setPreviewMode:a,contentViewMode:r,setContentViewMode:l,selectors:i,setSelectors:c,content:d,setContent:u,continuousMode:h,setContinuousMode:m,attributePopover:y,setAttributePopover:p,childFilterPopover:v,setChildFilterPopover:j,siblingFilterPopover:f,setSiblingFilterPopover:b,containerRef:x,handleFieldValueClickRef:N}}function Gn(t,s=""){const n=[];for(const[a,r]of Object.entries(t)){const l=s?`${s}.${a}`:a;ye(r)||typeof r=="string"?n.push(l):typeof r=="object"&&r!==null&&n.push(...Gn(r,l))}return n}function Kd(t,s){const n=s.split(".");let a=t;for(const r of n){if(typeof a!="object"||a===null)return;a=a[r]}return a}function On(t,s){const n=Kd(t,s);return ye(n)?we(n)==="":n===""||n===void 0}function Gd(t,s){const n=Gn(t),a=n.indexOf(s);for(let r=a+1;r<n.length;r++)if(On(t,n[r]))return n[r];for(let r=0;r<a;r++)if(On(t,n[r]))return n[r];return null}function Da(t){const s=Gn(t);return{filled:s.filter(a=>!On(t,a)).length,total:s.length}}function Jd({continuousMode:t,selectors:s,setSelectors:n,setContent:a,handleFieldValueClickRef:r,selectorCaptureFieldPathRef:l,onOpenSiblingFilterPopover:i}){const c=o.useCallback((m,y,p)=>{const v=m.split("."),j=p.length>1?p:p[0]??"",f=xs(y),b=v[v.length-1]==="_if";n(x=>{let N;if(b){const g=Le(x,v),w={selector:y,condition:(g==null?void 0:g.condition)||"exists"};N=Se(x,v,w)}else{let g=!1,w=[];const E=v[v.length-1];if(v.length>1){w=v.slice(0,-1);const k=Le(x,w);if(typeof k=="object"&&k!==null){const T=k;if(g=(T._branchFields||[]).includes(E),g){const P=T._activeBranch||1,_=T._branches||{},I=String(P);if(_[I]){const C={..._};C[I]={...C[I],[E]:f};const S={...T,_branches:C};N=Se(x,w,S)}else N=Se(x,v,f)}else N=Se(x,v,f)}else N=Se(x,v,f)}else N=Se(x,v,f)}if(t&&y!==""){const g=Gd(N,m);g?setTimeout(()=>{l.current===null&&r.current(g,"")},50):te.success("All fields captured!")}return N}),a(x=>Se(x,v,j))},[t,n,a,r,l]),d=o.useCallback(m=>c(m,"",[]),[c]),u=o.useCallback((m,y,p)=>{i?i(m,y,p):te.info(`Filter for ${m} - coming soon!`)},[i]),h=o.useCallback(m=>{te.info(`Auto-filter for ${m} - coming soon!`)},[]);return{handleSelectorCaptured:c,handleClearSelectorFromPreview:d,handleSelectorFilterClick:u,handleSelectorFilterDoubleClick:h}}function Hd(t,s){const n=[];let a=t;for(;a;){const r=s.find(l=>l.id===a);if(!r)break;n.unshift(r.name),a=r.parentId}return n.join(".")}function Ms(t,s=null){const n={},a=t.filter(r=>r.parentId===s).sort((r,l)=>r.order-l.order);for(const r of a){const l=t.some(i=>i.parentId===r.id);r.type==="array"?n[r.name]={_container:"",_item:"",...Ms(t,r.id)}:r.type==="parentSelector"?n[r.name]={_container:"",...Ms(t,r.id)}:r.type==="object"||l?n[r.name]=Ms(t,r.id):n[r.name]=""}return n}function Yd({fields:t,editingField:s,selectors:n,domTreeFieldPath:a,getFieldPath:r,setFields:l,setSelectors:i,setContent:c,setMode:d,baseHandleFieldDialogSubmit:u,handleSelectorCaptured:h,closeDomTreePopover:m}){const y=o.useCallback(j=>{var f;if(j&&s){const b=(f=t.find(N=>N.id===s.id))==null?void 0:f.type,x=j.type;if(b!==x&&(x==="parentSelector"||x==="array")){const g=r(s.id).split(".");i(w=>{const E=JSON.parse(JSON.stringify(w));let k=E;for(let _=0;_<g.length-1;_++)(typeof k[g[_]]!="object"||k[g[_]]===null)&&(k[g[_]]={}),k=k[g[_]];const T=g[g.length-1],B=k[T],P=x==="array"?{_container:"",_item:""}:{_container:""};return typeof B=="object"&&B!==null?k[T]={...P,...B}:k[T]=P,E})}}u(j)},[s,t,r,i,u]),p=o.useCallback(j=>{l(j),i(Ms(j,null)),c({}),d("mapped"),te.success("Schema updated from list")},[l,i,c,d]),v=o.useCallback(j=>{if(a)try{const f=document.querySelectorAll(j),b=Array.from(f).map(x=>{var N;return((N=x.textContent)==null?void 0:N.trim())||""});h(a,j,b),m()}catch{}},[a,h,m]);return{handleFieldDialogSubmit:y,handleListModeApply:p,handleApplyCustomSelector:v}}function qs(t,s){const n=Ed(t);if(!n)return null;if(!t.siblingFilter)return rr(n,s);const a=Jt(n,s);return zs(a,t.siblingFilter)[0]??null}function Qs(t,s=document){const n={};for(const[a,r]of Object.entries(t))if(!a.startsWith("_")){if(typeof r=="string"){if(!r){n[a]="";continue}const l=Xs(r),i=qs(l,s);n[a]=i?Ws(i,l):""}else if(ye(r)){const l=qs(r,s);n[a]=l?Ws(l,r):""}else if(typeof r=="object"&&r!==null){const l=r,i="_container"in l&&l._container,c="_item"in l&&l._item;i&&c?n[a]=Tr(l,s):i&&!c?n[a]=Ar(l,s):n[a]=Qs(l,s)}}return n}function Ar(t,s){const n=t._container,a=ye(n)?we(n):n;if(!a)return Qs(t,s);const r=s.querySelector(a);if(!r)return{};const l=t._if,i=t._branches,c=is(l)&&Zs(i),d=Er(t);if(c){const u=Xt(l,r),h=qn(i,u);if(h){const m=_r(d,h.branch);return Dn(m,r)}}return Dn(d,r)}function Tr(t,s){const n=t._container,a=t._item,r=ye(n)?we(n):n,l=ye(a)?we(a):a;if(!r)return[];const{baseSelector:i,selectAll:c}=Sd(r),d=Array.from(s.querySelectorAll(i));if(d.length===0)return[];const u=t._if,h=t._branches,m=is(u)&&Zs(h),y=Er(t),p=[];for(const v of d){const j=l?v.querySelectorAll(l):[v],f=Object.keys(y).length===0&&!m;for(const b of j){if(f){p.push(Sr(b));continue}let x;if(m){const g=Xt(u,b),w=qn(h,g);w?x=_r(y,w.branch):x=y}else x=y;const N=Dn(x,b);p.push(N)}}return p}function Dn(t,s){const n={};for(const[a,r]of Object.entries(t))if(!a.startsWith("_")){if(typeof r=="string"){if(!r){n[a]="";continue}const l=Xs(r),i=qs(l,s);n[a]=i?Ws(i,l):""}else if(ye(r)){const l=qs(r,s);n[a]=l?Ws(l,r):""}else if(typeof r=="object"&&r!==null){const l=r,i="_container"in l&&l._container,c="_item"in l&&l._item;i&&c?n[a]=Tr(l,s):i&&!c?n[a]=Ar(l,s):n[a]=Qs(l,s)}}return n}function Xd({selectors:t,captureRoot:s,setContent:n}){const a=o.useRef(""),r=o.useRef(null);o.useEffect(()=>{const l=JSON.stringify(t),i=s??document,c=l!==a.current,d=i!==r.current;if(!c&&!d)return;a.current=l,r.current=i;const u=setTimeout(()=>{try{const h=Qs(t,i);n(h)}catch(h){console.error("[CustomCapture] Extraction error:",h)}},100);return()=>clearTimeout(u)},[t,s,n])}function Zd({portalContainer:t,captureRoot:s,isVisible:n,onVisibilityChange:a}){const{mode:r,setMode:l,previewMode:i,setPreviewMode:c,contentViewMode:d,setContentViewMode:u,selectors:h,setSelectors:m,content:y,setContent:p,continuousMode:v,setContinuousMode:j,attributePopover:f,setAttributePopover:b,childFilterPopover:x,setChildFilterPopover:N,siblingFilterPopover:g,setSiblingFilterPopover:w,containerRef:E,handleFieldValueClickRef:k}=qd(),{schemaSectionHeight:T,handleResizeStart:B}=Bd({containerRef:E}),{fields:P,setFields:_,selectedFieldId:I,editingField:C,isFieldDialogOpen:S,handleFieldSelect:A,handleFieldUpdate:R,handleFieldEdit:L,handleFieldDialogSubmit:W,handleFieldDialogCancel:D,handleFieldDelete:H,handleReorder:Z,handleAddChild:le,handleAddSiblingBefore:fe,handleAddSiblingAfter:je}=Id([]),ae=o.useCallback(K=>Hd(K,P),[P]),{savedCaptures:Y,isPopoverVisible:ne,moreActionsOpen:Q,importDialogOpen:X,managerPopoverOpen:ce,advancedSettingsOpen:de,preventDefaultOnInteraction:ue,contentPopover:ge,setMoreActionsOpen:se,setPreventDefaultOnInteraction:Ie,handleSave:Ce,handleLoad:me,handleRenameCapture:M,handleDeleteCapture:F,handleDownload:z,handleClear:q,handleClosePopover:O,handleOpenImportDialog:U,handleCloseImportDialog:V,handleOpenManagerPopover:J,handleCloseManagerPopover:G,handleOpenAdvancedSettings:be,handleCloseAdvancedSettings:xe,handleImportSchema:Ae,handleArrayBadgeClick:Ee,handleCloseContentPopover:Pe}=Dd({fields:P,selectors:h,content:y,setFields:_,setSelectors:m,setContent:p}),ze=o.useRef(null),[Re,Ct]=o.useState(void 0),nt="__siblingFilter",[bs,ys]=o.useState(null),[js,Dt]=o.useState(void 0),Je="__branchEditor",Or=o.useCallback((K,ie,ve)=>{Ct(void 0),w({isOpen:!0,fieldPath:K,currentSelector:ie,currentFilter:null,position:ve})},[w]),Dr=o.useCallback(()=>{var K;(K=k.current)==null||K.call(k,nt,"")},[k]),Fr=o.useCallback(()=>{w(K=>({...K,isOpen:!1}))},[w]),Mr=o.useCallback(()=>{Ct("")},[]),Br=o.useCallback(()=>{},[Re]),Pr=o.useCallback(()=>{},[]),zr=o.useCallback(K=>{},[Re]),Rr=o.useCallback(K=>{},[Re]),$r=o.useCallback((K,ie)=>{var ve;Dt(void 0),ys(K),(ve=k.current)==null||ve.call(k,Je,ie)},[k]),{handleSelectorCaptured:Jn,handleClearSelectorFromPreview:Lr,handleSelectorFilterClick:Vr,handleSelectorFilterDoubleClick:Ur}=Jd({continuousMode:v,selectors:h,setSelectors:m,setContent:p,handleFieldValueClickRef:k,selectorCaptureFieldPathRef:ze,onOpenSiblingFilterPopover:Or}),vs=o.useCallback((K,ie,ve)=>{if(K===nt){Ct(ie);return}if(K===Je){Dt(ie);return}Jn(K,ie,ve)},[Jn,nt,Je]),{branchEditorState:Wr,handleEditBranching:qr,handleSaveBranching:Kr,handleRemoveBranching:Gr,handleCloseBranchEditor:Jr,handleToggleIf:Hr,handleToggleIfDirect:Yr,handlePopoverToggleBranchField:Xr,handleBranchSwitch:Zr,handleToggleBranchField:Qr,handleAddBranch:el,handlePaginationChange:tl}=Rd({selectors:h,setSelectors:m}),sl=o.useCallback((K,ie)=>{ie&&m(ve=>{const Xe={...ve},Oe=K.split(".");let We=Xe;for(let kt=0;kt<Oe.length-1;kt++)We[Oe[kt]]||(We[Oe[kt]]={}),We=We[Oe[kt]];return We[Oe[Oe.length-1]]=ie,Xe})},[m]),{handleUpdateExcludeChildren:nl,handleUpdateExtractAttribute:al,handleUpdateSiblingFilter:Hn}=Ld({setSelectors:m}),rl=o.useCallback((K,ie)=>{Hn(K,ie),w(ve=>({...ve,isOpen:!1}))},[Hn,w]),[ll,Yn]=o.useState(null),en=o.useRef(null),il=o.useCallback((K,ie=3e3)=>{en.current&&clearTimeout(en.current),Yn(K),en.current=setTimeout(()=>{Yn(null)},ie)},[]),{handleConfigClick:ol,handleFilterChildrenClick:cl,handleAttributePopoverClose:dl,handleAttributeSelect:ul,handleChildFilterPopoverClose:hl,handleChildFilterConfirm:pl}=Md({selectors:h,captureRoot:s,setAttributePopover:b,setChildFilterPopover:N,onUpdateExcludeChildren:nl,onUpdateExtractAttribute:al,onWarning:il}),ml=n??ne,xl=o.useCallback(()=>{Mt.current&&Mt.current.abort(),O(),a==null||a(!1)},[O,a]),{isOpen:fl,fieldPath:Qt,domContext:Xn,initialSelector:Zn,previousChildIndex:gl,openPopover:Qn,closePopover:tn,refreshContext:bl,setPreviousChildIndex:yl}=kd({selectors:h}),{handleFieldDialogSubmit:jl,handleListModeApply:vl,handleApplyCustomSelector:Nl}=Yd({fields:P,editingField:C,selectors:h,domTreeFieldPath:Qt,getFieldPath:ae,setFields:_,setSelectors:m,setContent:p,setMode:l,baseHandleFieldDialogSubmit:W,handleSelectorCaptured:vs,closeDomTreePopover:tn}),{handleDomTreeSiblingSelect:wl,handleDomTreeParentSelect:Cl,handleDomTreeChildSelect:kl,handleClearSelector:Sl,handleAddIndex:El,handleRevertSelector:_l,handleSelectorChange:Il,handleTextNodeClick:Al}=_d({domTreeFieldPath:Qt,domContext:Xn,domTreeInitialSelector:Zn,onSelectorCaptured:vs,refreshDomTreeContext:bl,closeDomTreePopover:tn,setDomTreePreviousChildIndex:yl}),Tl=o.useCallback((K,ie)=>Qn(K,ie),[Qn]),{selectorCaptureFieldPath:sn,handleFieldValueClick:ea,handleFieldValueHover:ht,flashHighlight:Ol,highlightByIndex:Dl,scrollToElementByIndex:Fl,cancelCapture:ta}=Cd({onSelectorCaptured:vs,onSelectorInspect:Tl,selectors:h,preventDefaultOnInteraction:ue,onEscapePressed:()=>j(!1)});ze.current=sn,k.current=ea;const Ml=o.useCallback((K,ie,ve)=>{ht(ve&&ie?ie:null,null)},[ht]),Bl=o.useCallback(K=>{ht(K,null)},[ht]),Pl=o.useCallback((K,ie)=>{if(ie===null)ht(null,null);else{const ve=`${K}[${ie}]`;ht(ve,Qt)}},[ht,Qt]),zl=o.useCallback(K=>{ta(),c(K)},[ta]),{handleSchemaCountClick:Rl,handleContentPopoverItemHover:$l,handleContentPopoverItemClick:Ll}=$d({content:y,selectors:h,contentPopover:ge,highlightByIndex:Dl,scrollToElementByIndex:Fl,handleArrayBadgeClick:Ee}),{handleNavigateUp:Vl,handleNavigateDown:Ul,handleCanNavigateDown:Wl}=Wd({selectors:h,handleSelectorCaptured:vs,flashHighlight:Ol});Xd({selectors:h,captureRoot:s,setContent:p});const es=o.useCallback(K=>typeof K=="string"?K:typeof K=="object"&&K!==null&&"selector"in K?K.selector:null,[]),Ft=o.useCallback(()=>{const K=h;if(K._container&&K._item){const ie=es(K._container),ve=es(K._item);if(ie&&ve)return{schema:{...K,_container:ie,_item:ve},fieldPath:null}}for(const[ie,ve]of Object.entries(K))if(typeof ve=="object"&&ve!==null&&!ie.startsWith("_")){const Xe=ve;if(Xe._container&&Xe._item){const Oe=es(Xe._container),We=es(Xe._item);if(Oe&&We)return{schema:{...Xe,_container:Oe,_item:We},fieldPath:ie}}}return null},[h,es]),[nn,ql]=o.useState(Ys),[an,sa]=o.useState(!1),[Kl,rn]=o.useState(!1),[Gl,na]=o.useState(null),[ln,aa]=o.useState(null),[Jl,ra]=o.useState([]),[Hl,la]=o.useState(!1),[Yl,Xl]=o.useState(null),[Zl,Ql]=o.useState(""),Mt=o.useRef(null),ts=o.useRef(!1),gt=o.useRef(null),[ei,Ns]=o.useState(null),[on,ia]=o.useState(!1),at=o.useRef(null),oa=o.useCallback(async()=>{if(ts.current)return new Promise(K=>{gt.current=K})},[]),ws=o.useCallback(async K=>{if(an||on)return;if(!s){te.error("No capture root configured");return}const ie=Ft();if(!ie){te.error("Schema missing _container or _item fields");return}const{schema:ve,fieldPath:Xe}=ie,Oe=(K==null?void 0:K.manual)??!1,We=new AbortController;Mt.current=We,sa(!0),Oe&&ia(!0);const kt=Oe?(pt,rt)=>new Promise(St=>{Ns({action:pt,resolvedValue:rt.resolvedValue,itemElement:rt.itemElement,itemIndex:rt.itemIndex,actionIndex:rt.actionIndex,previousAction:rt.previousAction,nextAction:rt.nextAction}),c("actions"),at.current=cn=>{St(cn)}}):void 0;try{const pt=await xn(ve,s,{dryRun:!1,itemDelay:Oe?300:500,maxJitter:Oe?0:nn,abortSignal:We.signal,schemaFieldPath:Xe??void 0,onlyRunLastElement:K==null?void 0:K.onlyRunLastElement,showHighlight:!(K!=null&&K.skipHighlight),checkPaused:Oe?void 0:oa,manualMode:Oe,onActionPending:kt,onActionStart:St=>{na(St)},onResultsUpdate:St=>{aa(St)}});aa(pt);const rt=Is(pt);rt.length>0&&ra(St=>{const cn=new Set(rt.map(ss=>ss.pageNumber));return[...St.filter(ss=>!cn.has(ss.pageNumber)),...rt].sort((ss,oi)=>ss.pageNumber-oi.pageNumber)}),We.signal.aborted?te.info("Automation stopped"):pt.summary.executed>0||pt.summary.skipped>0?te.success(`Executed: ${pt.summary.executed}, Skipped: ${pt.summary.skipped}, Failed: ${pt.summary.failed}`):Oe&&te.info("Manual run cancelled")}finally{sa(!1),na(null),Mt.current=null,ts.current=!1,rn(!1),gt.current=null,Oe&&(Ns(null),ia(!1),c("selectors"))}},[s,Ft,nn,an,on,oa,c]),ti=o.useCallback(()=>{Mt.current&&Mt.current.abort(),ts.current=!1,rn(!1),gt.current&&(gt.current(),gt.current=null)},[]),si=o.useCallback(()=>{const K=!ts.current;ts.current=K,rn(K),!K&&gt.current&&(gt.current(),gt.current=null)},[]),ni=o.useCallback(async()=>{if(!s){te.error("No capture root configured");return}const K=Ft();if(!K){te.error("Schema missing _container or _item fields");return}const{schema:ie}=K,ve=await xn(ie,s,{dryRun:!0});te.success(`Dry run complete: ${ve.summary.executed} actions would execute`)},[s,Ft]),ai=o.useCallback(async(K,ie)=>{if(!s)throw new Error("No capture root configured");const ve=Ft();if(!ve)throw new Error("Schema missing _container or _item fields");const{schema:Xe}=ve;return console.log("[CustomCaptureV2] handlePrepare called with onlyRunLastElement:",ie==null?void 0:ie.onlyRunLastElement),await xn(Xe,s,{dryRun:!0,skipPagination:!0,onlyRunLastElement:ie==null?void 0:ie.onlyRunLastElement,onResultsUpdate:K?We=>{K(We.actions.length,We.totalItems)}:void 0})},[s,Ft]),ri=o.useCallback(()=>{var K;Ns(null),(K=at.current)==null||K.call(at,"execute")},[]),li=o.useCallback(()=>{var K;Ns(null),(K=at.current)==null||K.call(at,"skip")},[]),ii=o.useCallback(()=>{var K;(K=at.current)==null||K.call(at,"cancel")},[]),ca=o.useCallback(()=>{ws({manual:!0})},[ws]);return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{isVisible:ml,onClose:xl,title:"Automation",shouldCloseManually:!0,resizable:!0,initialPosition:{x:20,y:20},initialSize:{width:500,height:630},showPinButton:!1,portalContainer:t,headerActions:e.jsx(Zi,{mode:r,moreActionsOpen:Q,onModeChange:l,onMoreActionsOpenChange:se,onSave:Ce,onManage:J,onAdvancedSettings:be,onDownload:z,onClear:q,onRunActions:ws,onDryRun:ni,onRunManually:ca,portalContainer:t}),children:e.jsx(pd,{mode:r,fields:P,selectedFieldId:I,schemaSectionHeight:T,previewMode:i,contentViewMode:d,selectors:h,content:y,activeFieldPath:sn,continuousMode:v,filledCount:Da(h).filled,totalCount:Da(h).total,portalContainer:t,containerRef:E,onFieldSelect:A,onFieldUpdate:R,onFieldEdit:L,onFieldDelete:H,onReorder:Z,onAddChild:le,onAddSiblingBefore:fe,onAddSiblingAfter:je,onListModeApply:vl,onListModeCancel:()=>l("mapped"),onResizeStart:B,onPreviewModeChange:zl,onFieldValueClick:ea,onFieldValueHover:ht,onClearSelector:Lr,onSelectorFilterClick:Vr,onSelectorFilterDoubleClick:Ur,onConfigClick:ol,onFilterChildrenClick:cl,onArrayBadgeClick:Ee,onNavigateUp:Vl,onNavigateDown:Ul,canNavigateDown:Wl,onEditBranching:qr,onImportClick:U,onPasteSelectors:Ae,onSchemaCountClick:Rl,onBranchSwitch:Zr,onToggleBranchField:Qr,onToggleIfDirect:Yr,onAddBranch:el,manualAction:ei,isInManualMode:on,onManualExecute:ri,onManualSkip:li,onManualCancel:ii,onContinuousModeToggle:()=>j(K=>!K),onContentViewModeChange:u,warningMessage:ll,onRunManually:ca,onRunActions:ws,onStopActions:ti,onPauseActions:si,isRunningActions:an,isPaused:Kl,onUploadBranching:sl,onAutomationSelectorHover:Bl,currentActionProgress:Gl,lastRunResult:ln,onToggleReport:K=>{Xl(K),la(!0)},onPrepare:ai,accumulatedPages:Jl,setAccumulatedPages:ra})}),ln&&e.jsx(Ge,{isVisible:Hl,onClose:()=>la(!1),title:"Automation Report",shouldCloseManually:!0,resizable:!0,initialPosition:Yl??{x:window.innerWidth-520,y:80},initialSize:{width:480,height:550},portalContainer:t,children:e.jsx(bd,{result:ln,labelTemplate:Zl,onLabelTemplateChange:Ql})}),e.jsx(ic,{portalContainer:t,isFieldDialogOpen:S,editingField:C,onFieldDialogSubmit:jl,onFieldDialogCancel:D,contentPopover:ge,onCloseContentPopover:Pe,onContentPopoverItemHover:$l,onContentPopoverItemClick:Ll,importDialogOpen:X,onImportSchema:Ae,onCloseImportDialog:V,managerPopoverOpen:ce,savedCaptures:Y,onLoad:me,onRenameCapture:M,onDeleteCapture:F,onCloseManagerPopover:G,advancedSettingsOpen:de,preventDefaultOnInteraction:ue,continuousMode:v,onPreventDefaultChange:Ie,onContinuousModeChange:j,onCloseAdvancedSettings:xe,isDomTreePopoverOpen:fl,domTreeFieldPath:Qt,domContext:Xn,domTreeInitialSelector:Zn,domTreePreviousChildIndex:gl,onDomTreeParentSelect:Cl,onDomTreeSiblingSelect:wl,onDomTreeChildSelect:kl,onAddIndex:El,onRevertSelector:_l,onClearSelector:Sl,onCloseDomTreePopover:tn,onSelectorChange:Il,onApplyCustomSelector:Nl,attributePopover:f,onAttributeSelect:ul,onAttributePopoverClose:dl,childFilterPopover:x,onChildFilterConfirm:pl,onChildFilterPopoverClose:hl,branchEditorState:Wr,onSaveBranching:Kr,onRemoveBranching:Gr,onCloseBranchEditor:Jr,onToggleIf:Hr,onPopoverToggleBranchField:Xr,onPaginationChange:tl,onBranchEditorSelectorClick:$r,onBranchEditorSelectorHover:Ml,branchEditorCaptureTarget:bs,branchEditorCapturedSelector:js,onDomTreeMatchIndexHover:Pl,onTextNodeClick:Al,siblingFilterPopover:g,onSiblingFilterApply:rl,onSiblingFilterClose:Fr,onSiblingFilterStartCapture:Dr,isSiblingFilterCapturing:sn===nt,siblingFilterCapturedSelector:Re,onSiblingFilterNavigateUp:Br,onSiblingFilterNavigateDown:Pr,siblingFilterCanNavigateDown:!1,onSiblingFilterConfigClick:zr,onSiblingFilterFilterChildrenClick:Rr,onSiblingFilterClearSelector:Mr,maxJitter:nn,onMaxJitterChange:ql})]})}function Qd(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-anivia-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Anivia",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Anivia",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Anivia.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Freljord 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_freljord_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Freljord"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Invoker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_invoker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Invoker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Caster"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Anivia.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Frostbite"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/40"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Fire an ice shard at target that deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"325/455/650"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage. If they are "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilled"})}),e.jsx("span",{children:e.jsx("span",{children:", the damage Critically"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Strikes."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsx("div",{className:"flex flex-col gap-[2px]",children:e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"455 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[325/",e.jsx("span",{className:"text-white1",children:"455"}),"/650]"]})})]})})]}),e.jsx(ms,{})]})}function eu(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-blitzcrank-v2",children:[e.jsx("a",{className:"no-webkit-preview",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-7wiopk",children:["Blitzcrank",e.jsxs("div",{className:"flex items-end text-[16px]",children:["1",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Blitzcrank",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Blitzcrank.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Zaun 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_zaun_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Zaun"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Juggernaut 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_juggernaut_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Juggernaut"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Blitzcrank.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Static Field"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"60/120"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/480/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds and deal "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"56/84/126"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to all enemies within 1 hex."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"480 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"480"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"84 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/315]"]})})]})]})]}),e.jsx(ms,{})]})}function tu(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-neeko-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/neeko",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Neeko",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Neeko",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Neeko.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Ixtal 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_ixtal_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Ixtal"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Arcanist 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_arcanist_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",style:{outlineOffset:"2px"},children:"Arcanist"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Defender 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_defender_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Defender"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Magic Tank"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Neeko.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Pop Blossom"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"15/65"})]})]})]}),e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Leap at target and gain "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"400/475/600"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" Shield for 4 seconds. Slam down after a brief delay, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"80/120/180"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" magic damage to enemies within two"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hexes and 20% "})}),e.jsx("span",{children:e.jsx("span",{className:"text-bronze-11",children:"Chilling"})}),e.jsx("span",{children:e.jsx("span",{children:" them for 2"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"seconds."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Shield: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"475 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[400/",e.jsx("span",{className:"text-white1",children:"475"}),"/600]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",style:{outlineOffset:"2px"},children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-sky-11",children:[e.jsx("span",{children:e.jsx("span",{children:"120 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[80/",e.jsx("span",{className:"text-white1",children:"120"}),"/180]"]})})]})]})]}),e.jsx(ms,{})]})}function su(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-graves-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/graves",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Graves",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["2",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Graves",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Graves.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Bilgewater 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_bilgewater_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Bilgewater"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Gunslinger 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_gunslinger_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Gunslinger"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsxs("div",{className:"leading-snug pb-3",children:[e.jsx("span",{className:"font-medium",children:"Unlock: "}),e.jsx("div",{className:"leading-tight inline",children:e.jsx("span",{children:e.jsx("span",{children:"Twisted Fate with 2 items equipped"})})})]}),e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",children:"Attack Fighter"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Graves.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Collateral Damage"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",children:"0/50"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Attacks fire in a cone on target, dealing "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"45%"})})})}),e.jsx("span",{children:e.jsx("span",{children:" damage to other enemies hit. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Fire an explosive shell at target, dealing "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"200/300/450"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage split among enemies in a 1"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"hex"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"circle. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"text-tertiary-11",children:e.jsx("span",{children:e.jsx("span",{children:"Partners in Crime:"})})})}),e.jsx("span",{children:e.jsx("span",{children:" When you field Graves and Twisted Fate, both gain bonuses."})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[20/",e.jsx("span",{className:"text-white1",children:"30"}),"/45]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"300"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"270 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"30 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[180/",e.jsx("span",{className:"text-white1",children:"270"}),"/405]"]})})]})]})]}),e.jsx(ms,{})]})}function nu(){return e.jsxs("div",{className:"rounded text-white1 w-[291px] flex flex-col h-full bg-bg","data-test":"champion-card-draven-v2",children:[e.jsx("a",{className:"no-webkit-preview",href:"https://tactics.tools/info/units/draven",children:e.jsxs("div",{className:"relative rounded-[6px] border-[3px] border-primary-6",children:[e.jsxs("div",{className:"relative flex justify-between p-[9px] bg-bg text-[18px] font-montserrat font-semibold rounded-[3px] css-14klq53",children:["Draven",e.jsxs("div",{className:"flex items-end text-[16px]",style:{outlineOffset:"2px"},children:["3",e.jsx("img",{className:"ml-[2px] pb-[1px]",alt:"gold",height:"13",src:"https://cdn.tft.tools/general/gold.png?width=13",width:"13"})]})]}),e.jsx("img",{className:"mt-[-3px] z-[-1] aspect-[9/4] object-cover css-hzvj2z",alt:"Draven",src:"https://ap.tft.tools/img/face_full_ultrawide/TFT16_Draven.jpg?w=290",width:"290"}),e.jsxs("div",{className:"absolute text-lg leading-snug bottom-[6px] left-[6px]",style:{outlineOffset:"2px"},children:[e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Noxus 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_noxus_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Noxus"})]}),e.jsxs("div",{className:"flex items-center sm:pt-1 font-montserrat font-bold text-[15px]",children:[e.jsx("img",{alt:"Quickstriker 0",className:"aspect-square w-[21px]",src:"https://ap.tft.tools/static/trait-icons/tft16_quickstriker_w.svg",style:{opacity:.87}}),e.jsx("div",{className:"pl-1 css-1fxzlo3",children:"Quickstriker"})]})]})]})}),e.jsxs("div",{className:"p-3 flex flex-col text-sm",children:[e.jsx("div",{className:"mb-2 bg-bg2 rounded-lg px-2 py-1 font-montserrat font-medium self-start",style:{outlineOffset:"2px"},children:"Attack Marksman"}),e.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[e.jsx("img",{className:"rounded flex-shrink-0 w-[22px] h-[22px]",height:"22",src:"https://ap.tft.tools/img/ability/TFT16_Draven.jpg?w=22",width:"22"}),e.jsxs("div",{className:"flex items-center pl-2 leading-none",children:[e.jsx("div",{className:"font-medium text-sm",children:"Spinning Axes"}),e.jsxs("div",{className:"flex items-center pt-[2px] h-[18px] text-sm pl-2",children:[e.jsx("div",{className:"mt-[-1px] mr-[2px] w-[14px] h-[14px]",children:e.jsx("img",{alt:"Mana",height:"14",src:"https://cdn.tft.tools/general/mana.png",width:"14"})}),e.jsx("div",{className:"pt-[1px]",style:{outlineOffset:"2px"},children:"60/100"})]})]})]}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Passive:"})})}),e.jsx("span",{children:e.jsx("span",{children:" If Draven has an empowered axe in hand, his next attack will throw it. On takedown, gain an Adoration stack, doubled if Draven or Darius scored the kill. Every 11 Adoration stacks grants "})}),e.jsx("span",{children:e.jsx("span",{className:"text-yellow-11",children:e.jsx("span",{children:e.jsx("span",{children:"1/3/5"})})})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"Gold. "})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("span",{className:"font-medium text-gold-11",children:e.jsx("span",{children:"Active:"})})}),e.jsx("span",{children:e.jsx("span",{children:" Spin an empowered axe that replaces his basic attack and deals "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-tomato-11",children:[e.jsx("span",{children:e.jsx("span",{children:"150/225/375"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" physical damage and returns to Draven after hitting an"})}),e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx("span",{children:"enemy."})}),e.jsx("span",{children:e.jsx("div",{className:"h-[10px]"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("hr",{className:"my-[10px] mx-1 border-white2"}),e.jsxs("div",{className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[10/",e.jsx("span",{className:"text-white1",children:"15"}),"/25]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{children:e.jsx("span",{children:"Damage: "})}),e.jsx("span",{children:e.jsx("span",{className:"text-tomato-11",children:e.jsx("span",{children:e.jsx("span",{children:"225"})})})}),e.jsx("span",{children:e.jsx("span",{children:" = "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"210 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Attack damage",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ad.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{children:" + "})}),e.jsx("span",{children:e.jsxs("span",{className:"text-yellow-11",children:[e.jsx("span",{children:e.jsx("span",{children:"15 ("})}),e.jsx("span",{children:e.jsx("img",{className:"inline-block mt-[-2px]",alt:"Ability power",width:"14",height:"14",src:"https://ap.tft.tools/img/general/ap.png?w=14"})}),e.jsx("span",{children:e.jsx("span",{children:")"})})]})}),e.jsx("span",{children:e.jsx("span",{})})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[140/",e.jsx("span",{className:"text-white1",children:"210"}),"/350]"]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsx("div",{className:"leading-tight",children:e.jsx("span",{children:e.jsx("span",{children:"Gold Gained:"})})}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-white2",children:["[1/",e.jsx("span",{className:"text-white1",children:"3"}),"/5]"]})})]})]})]}),e.jsx(ms,{})]})}function au(){return e.jsxs("div",{"data-test":"tft-cards-v2",children:[e.jsxs("section",{className:"mb-8","data-test":"one-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"1-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(Qd,{}),e.jsx(eu,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"two-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"2-Cost Champions"}),e.jsxs("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:[e.jsx(tu,{}),e.jsx(su,{})]})]}),e.jsxs("section",{className:"mb-8","data-test":"three-cost-section-v2",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-200","data-test":"section-heading",children:"3-Cost Champions"}),e.jsx("div",{className:"flex flex-wrap gap-4","data-test":"card-container",children:e.jsx(nu,{})})]})]})}function ru(){const[t,s]=o.useState(!1),[n,a]=o.useState({x:0,y:0}),[r,l]=o.useState(null),i=o.useCallback(u=>{const h=u.currentTarget.getBoundingClientRect();a({x:h.right+8,y:h.top}),s(!0)},[]),c=o.useCallback(()=>{s(!1)},[]),d=o.useCallback(u=>{l(u),s(!1)},[]);return e.jsxs("div",{className:"siblings-selector-demo p-4","data-test":"siblings-selector-demo",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6","data-test":"demo-header",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground","data-test":"demo-title",children:"Feature: Sibling Selectors"}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white","data-test":"selector-filter-v2",children:[e.jsx(Js,{className:"w-4 h-4"}),"Selector Filter"]})]}),e.jsx("div",{className:"mb-6 p-4 rounded border border-border bg-card","data-test":"morbol-content-section",dangerouslySetInnerHTML:{__html:`<div class="col-md-4 col-lg-5 col-sm-12" style="">These monstrocities are probably my worst kind of landscape mob. It's so bad that I still hate <em>The Aurum Vale</em> even now. Get out of the way of their bad breath AoEs, else you get multiple debuffs. I'm not sure setting the Choco to heals stops them dying from it, and as an Archer or Bard you may find it difficult to keep the<strong style=""> Morbol</strong>'s attention. Keep the Chocobo on DPS: on heals they stand with you, and tank will turn the ugly plant towards it!    <h4 id="morbol-location" style="">Morbol Location</h4>The<strong style=""> Morbol</strong>s are found in <strong style="">Larkscall in the East Shroud</strong>. For any other reason, keep away from here. The challenge is not aggroing multiple<strong style=""> Morbol</strong>s...ew.<hr style="border-top: 1px solid rgb(238, 238, 238) !important;">          <h4 id="region-area-east-shroud-larkscallnearest-aetheryte" style="">Region/Area</h4> <strong style="">East Shroud:</strong> Larkscall<h4 style="">Nearest Aetheryte</h4> <strong style="">East Shroud:</strong> The Hawthorn Hut        </div>`}}),r&&e.jsxs("div",{className:"mb-4 p-3 rounded bg-muted border border-border","data-test":"active-filter-display",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Active Filter: "}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[r.type,r.selector&&e.jsxs(e.Fragment,{children:[" → ",e.jsx("code",{className:"px-1 bg-background rounded",children:r.selector})]}),r.textContent&&e.jsxs(e.Fragment,{children:[' | "',r.textContent,'" (',r.textMatchMode??"exact",")"]})]})]}),e.jsxs("div",{className:"space-y-6","data-test":"demo-content",children:[e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-simple",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 1: Simple Siblings"}),e.jsxs("div",{className:"flex gap-2","data-test":"sibling-row-1",children:[e.jsx("span",{className:"px-3 py-1 rounded bg-red-500/20 text-red-400","data-test":"item-a",children:"Item A"}),e.jsx("span",{className:"px-3 py-1 rounded bg-blue-500/20 text-blue-400","data-test":"item-b",children:"Item B (target)"}),e.jsx("span",{className:"px-3 py-1 rounded bg-green-500/20 text-green-400","data-test":"item-c",children:"Item C"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "previous-sibling" to select Item A relative to Item B'})]}),e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-nested",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 2: Text Content Matching"}),e.jsxs("div",{className:"space-y-2","data-test":"sibling-row-2",children:[e.jsx("div",{className:"px-3 py-1 rounded bg-purple-500/20 text-purple-400","data-test":"label-field",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Enter username",className:"px-3 py-1 rounded border border-border bg-background text-foreground w-full","data-test":"input-field"}),e.jsx("div",{className:"px-3 py-1 rounded bg-purple-500/20 text-purple-400","data-test":"label-field",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Enter password",className:"px-3 py-1 rounded border border-border bg-background text-foreground w-full","data-test":"input-field"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "closest-sibling-before" + text "Username" to target specific input'})]}),e.jsxs("section",{className:"p-4 rounded border border-border bg-card","data-test":"example-disambiguation",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-foreground","data-test":"example-title",children:"Example 3: Disambiguation with Regex"}),e.jsxs("div",{className:"flex flex-wrap gap-2","data-test":"sibling-row-3",children:[e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save Draft"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save & Continue"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-emerald-500/20 text-emerald-400","data-test":"submit-btn",children:"Submit"}),e.jsx("button",{className:"btn px-3 py-1 rounded bg-amber-500/20 text-amber-400","data-test":"action-btn",children:"Save Final"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2","data-test":"example-description",children:'Use "next-sibling" + regex "/^Save &/" to find "Submit" after "Save & Continue"'})]})]}),e.jsx(Ge,{isVisible:t,onClose:c,title:"Sibling Selector Filter",initialPosition:n,initialSize:{width:380,height:420},resizable:!0,shouldCloseManually:!0,children:e.jsx(dr,{onApply:d,onCancel:c,currentFilter:r})})]})}const pe={CONNECTED:"Connected",PENDING:"Pending",NOT_CONNECTED:"Not Connected",CONNECTING:"Connecting...",SENT:"Sent"},Fa=500,lu=1500,iu=`Hi {{name}},

I came across your profile and was impressed by your work at {{company}}. I'd love to connect and learn more about your experience.

Looking forward to connecting!

Best regards`,Ma=[{id:"profile-1",name:"Sarah Chen",headline:"Senior Software Engineer at Google",company:"Google",location:"San Francisco, CA",connectionStatus:pe.CONNECTED,mutualConnections:42},{id:"profile-2",name:"Marcus Johnson",headline:"Product Manager | Ex-Amazon | Building the future",company:"Stripe",location:"Seattle, WA",connectionStatus:pe.NOT_CONNECTED,mutualConnections:15},{id:"profile-3",name:"Elena Rodriguez",headline:"Founder & CEO at TechStart",company:"TechStart",location:"Austin, TX",connectionStatus:pe.PENDING,mutualConnections:8},{id:"profile-4",name:"David Kim",headline:"Data Scientist | ML/AI Enthusiast",company:"Meta",location:"New York, NY",connectionStatus:pe.CONNECTED,mutualConnections:67},{id:"profile-5",name:"Priya Patel",headline:"UX Designer | Creating delightful experiences",company:"Airbnb",location:"Los Angeles, CA",connectionStatus:pe.NOT_CONNECTED,mutualConnections:23},{id:"profile-6",name:"James Wilson",headline:"Engineering Manager at Netflix",company:"Netflix",location:"Los Gatos, CA",connectionStatus:pe.CONNECTED,mutualConnections:89},{id:"profile-7",name:"Aisha Mohammed",headline:"DevOps Engineer | Cloud Infrastructure",company:"AWS",location:"Denver, CO",connectionStatus:pe.NOT_CONNECTED,mutualConnections:12},{id:"profile-8",name:"Thomas Anderson",headline:"Full Stack Developer | Open Source Contributor",company:"GitHub",location:"Remote",connectionStatus:pe.PENDING,mutualConnections:34},{id:"profile-9",name:"Lisa Wang",headline:"VP of Engineering | Building High-Performance Teams",company:"Uber",location:"San Francisco, CA",connectionStatus:pe.CONNECTED,mutualConnections:156},{id:"profile-10",name:"Michael Brown",headline:"Security Engineer | Protecting Digital Assets",company:"CrowdStrike",location:"Austin, TX",connectionStatus:pe.NOT_CONNECTED,mutualConnections:28},{id:"profile-11",name:"Jennifer Lee",headline:"Technical Program Manager at Apple",company:"Apple",location:"Cupertino, CA",connectionStatus:pe.CONNECTED,mutualConnections:73},{id:"profile-12",name:"Robert Garcia",headline:"Backend Engineer | Distributed Systems",company:"Databricks",location:"Seattle, WA",connectionStatus:pe.NOT_CONNECTED,mutualConnections:19},{id:"profile-13",name:"Amanda Foster",headline:"Product Designer | Design Systems Expert",company:"Figma",location:"New York, NY",connectionStatus:pe.PENDING,mutualConnections:45},{id:"profile-14",name:"Chris Martinez",headline:"Site Reliability Engineer at Cloudflare",company:"Cloudflare",location:"Austin, TX",connectionStatus:pe.CONNECTED,mutualConnections:31},{id:"profile-15",name:"Nina Patel",headline:"Machine Learning Engineer | NLP Specialist",company:"OpenAI",location:"San Francisco, CA",connectionStatus:pe.NOT_CONNECTED,mutualConnections:52},{id:"profile-16",name:"Kevin O'Brien",headline:"Frontend Architect | React & TypeScript",company:"Vercel",location:"Remote",connectionStatus:pe.CONNECTED,mutualConnections:87},{id:"profile-17",name:"Sophia Zhang",headline:"Data Engineer | Building Data Pipelines at Scale",company:"Snowflake",location:"Bellevue, WA",connectionStatus:pe.NOT_CONNECTED,mutualConnections:14},{id:"profile-18",name:"Daniel Thompson",headline:"iOS Developer | Swift Enthusiast",company:"Spotify",location:"Stockholm, Sweden",connectionStatus:pe.PENDING,mutualConnections:22},{id:"profile-19",name:"Rachel Green",headline:"Engineering Director | Tech Leadership",company:"Salesforce",location:"San Francisco, CA",connectionStatus:pe.CONNECTED,mutualConnections:134},{id:"profile-20",name:"Alex Turner",headline:"Platform Engineer | Kubernetes & Infrastructure",company:"HashiCorp",location:"Portland, OR",connectionStatus:pe.NOT_CONNECTED,mutualConnections:41}];function ou(){return Math.random()*(lu-Fa)+Fa}const cu=.3;function du({status:t}){const s={[pe.CONNECTED]:"bg-green-100 text-green-800",[pe.PENDING]:"bg-yellow-100 text-yellow-800",[pe.NOT_CONNECTED]:"bg-gray-100 text-gray-800",[pe.CONNECTING]:"bg-blue-100 text-blue-800",[pe.SENT]:"bg-purple-100 text-purple-800"},n=t===pe.CONNECTING;return e.jsxs("span",{"data-test":"connection-status-badge",className:`px-2 py-0.5 rounded-full text-xs font-medium inline-flex items-center gap-1 ${s[t]}`,children:[n&&e.jsx(Hs,{className:"w-3 h-3 animate-spin"}),t]})}function uu({profile:t,onConnect:s,onMessage:n}){const a=t.connectionStatus===pe.CONNECTED,r=t.connectionStatus===pe.CONNECTING,l=t.connectionStatus===pe.NOT_CONNECTED;return e.jsxs("div",{"data-test":"profile-actions",className:"flex items-center gap-2",children:[e.jsxs(re,{"data-test":"send-message-btn",size:"sm",variant:"default",onClick:i=>{i.stopPropagation(),n(t)},disabled:!a,title:a?"Send message":"Connect first to send message",children:[e.jsx(Za,{className:"w-3.5 h-3.5 mr-1"}),"Message"]}),e.jsxs(re,{"data-test":"connect-btn",size:"sm",variant:"outline",onClick:i=>{i.stopPropagation(),l&&s(t.id)},disabled:r,children:[r?e.jsx(Hs,{className:"w-3.5 h-3.5 mr-1 animate-spin"}):e.jsx(Ji,{className:"w-3.5 h-3.5 mr-1"}),a?"Connected":r?"Connecting":"Connect"]})]})}function hu({type:t,profileName:s,onConfirm:n,onRetry:a,onCancel:r}){if(!t)return null;const l=t==="error";return e.jsx("div",{"data-test":"connect-dialog-overlay",className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:i=>{i.target===i.currentTarget&&r()},children:e.jsxs("div",{"data-test":l?"error-dialog":"confirm-dialog",className:`bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4 ${l?"border-2 border-red-200":"border-2 border-green-200"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[l?e.jsx(Hi,{className:"w-6 h-6 text-red-500 shrink-0 mt-0.5"}):e.jsx(Ha,{className:"w-6 h-6 text-green-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{"data-test":"dialog-title",className:`font-semibold ${l?"text-red-700":"text-green-700"}`,children:l?"Connection Failed":"Confirm Connection"}),e.jsx("p",{"data-test":"dialog-message",className:"text-sm text-gray-600 mt-1",children:l?`Unable to connect with ${s}. The profile may have restrictions enabled.`:`Are you sure you want to send a connection request to ${s}?`})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(re,{"data-test":"dialog-cancel-btn",variant:"outline",size:"sm",onClick:r,children:"Cancel"}),l?e.jsx(re,{"data-test":"dialog-retry-btn",size:"sm",variant:"destructive",onClick:a,children:"Retry"}):e.jsx(re,{"data-test":"dialog-confirm-btn",size:"sm",onClick:n,children:"Confirm"})]})]})})}function pu(){var j,f,b;const[t,s]=o.useState(Ma),[n,a]=o.useState({isOpen:!1,profile:null,message:""}),[r,l]=o.useState({type:null,profileId:null,profileName:""}),i=o.useCallback(x=>{const N=t.find(w=>w.id===x);if(!N)return;const g=Math.random()<cu?"error":"confirm";l({type:g,profileId:x,profileName:N.name})},[t]),c=o.useCallback(()=>{const x=r.profileId;if(!x)return;l({type:null,profileId:null,profileName:""}),s(g=>g.map(w=>w.id===x?{...w,connectionStatus:pe.CONNECTING}:w));const N=ou();setTimeout(()=>{s(g=>g.map(w=>w.id===x?{...w,connectionStatus:pe.CONNECTED}:w)),te.success(`Connected with ${r.profileName}`)},N)},[r.profileId,r.profileName]),d=o.useCallback(()=>{const x=r.profileId,N=r.profileName;x&&(l({type:null,profileId:null,profileName:""}),setTimeout(()=>{l({type:"confirm",profileId:x,profileName:N})},300))},[r.profileId,r.profileName]),u=o.useCallback(()=>{l({type:null,profileId:null,profileName:""})},[]),h=o.useCallback(x=>{const N=iu.replace("{{name}}",x.name.split(" ")[0]).replace("{{company}}",x.company);a({isOpen:!0,profile:x,message:N})},[]),m=o.useCallback(()=>{if(!n.profile)return;const x=n.profile.id;s(N=>N.map(g=>g.id===x?{...g,connectionStatus:pe.SENT}:g)),te.success(`Message sent to ${n.profile.name}`,{description:"Your message has been delivered."}),a({isOpen:!1,profile:null,message:""})},[n.profile]),y=o.useCallback(()=>{a({isOpen:!1,profile:null,message:""})},[]),p=o.useCallback(()=>{s(Ma),l({type:null,profileId:null,profileName:""}),te.success("Table state reset to initial values")},[]),v=o.useMemo(()=>[Bt("name","Name",{width:"150px"}),Bt("headline","Headline",{width:"250px"}),Bt("company","Company",{width:"120px"}),Bt("location","Location",{width:"130px"}),Bt("connectionStatus","Status",{width:"120px",renderDisplay:x=>e.jsx(du,{status:x})}),Bt("mutualConnections","Mutual",{width:"80px",renderDisplay:x=>e.jsx("span",{"data-test":"mutual-count",className:"text-muted-foreground",children:x})}),{id:"actions",header:()=>e.jsx("div",{"data-test":"header-cell",children:"Actions"}),cell:({row:x})=>e.jsx(uu,{profile:x.original,onConnect:i,onMessage:h}),size:200}],[i,h]);return e.jsxs("div",{"data-test":"linkedin-profiles-demo",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{"data-test":"demo-description",className:"text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:"This table simulates LinkedIn profile data for testing automation workflows. Use the CustomCaptureV2 popover's More Actions menu (⋯) to configure and run automation actions."}),e.jsxs("p",{className:"text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded border border-indigo-200",children:[e.jsx("strong",{children:"If Action Demo:"}),' Click "Connect" to see a confirmation or error dialog (random). Configure an "if" action to handle both cases automatically.']})]}),e.jsxs(re,{variant:"outline",size:"sm",onClick:p,className:"shrink-0","data-test":"reset-state-btn",children:[e.jsx(Rn,{className:"w-3.5 h-3.5 mr-1"}),"Reset State"]})]}),e.jsx(Xi,{data:t,columns:v,filterPlaceholder:"Search profiles...",initialPageSize:5}),e.jsx(hu,{type:r.type,profileName:r.profileName,onConfirm:c,onRetry:d,onCancel:u}),e.jsx(Ge,{isVisible:n.isOpen,onClose:y,title:`Message to ${((j=n.profile)==null?void 0:j.name)??""}`,initialPosition:"center",initialSize:{width:400,height:350},resizable:!0,shouldCloseManually:!0,children:e.jsxs("div",{className:"p-4 space-y-4","data-test":"message-composer",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Sending message to"," ",e.jsx("span",{className:"font-medium text-foreground",children:(f=n.profile)==null?void 0:f.name})," ","at ",(b=n.profile)==null?void 0:b.company]}),e.jsx(ji,{"data-test":"message-textarea",value:n.message,onChange:x=>a(N=>({...N,message:x.target.value})),placeholder:"Write your message...",className:"min-h-[150px] resize-none"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(re,{variant:"outline",size:"sm",onClick:y,"data-test":"cancel-message-btn",children:"Cancel"}),e.jsxs(re,{size:"sm",onClick:m,disabled:!n.message.trim(),"data-test":"send-message-confirm-btn",children:[e.jsx(Za,{className:"w-3.5 h-3.5 mr-1"}),"Send Message"]})]})]})})]})}const mu=["tft-cards","siblings","linkedin"],xu="tft-cards",Ba="activeTab";function fu(t){return t!==null&&mu.includes(t)}function Au(){const[t,s]=ci(),n=t.get(Ba),a=fu(n)?n:xu,r=m=>{s({[Ba]:m})},[l,i]=o.useState(!0),c=o.useRef(null),[d,u]=o.useState(null);o.useEffect(()=>{c.current&&u(c.current)},[]),o.useEffect(()=>{const m=setTimeout(()=>{c.current},500);return()=>clearTimeout(m)},[]);const h=o.useCallback(async()=>{if(!c.current){te.error("Capture target not ready");return}},[]);return e.jsxs("div",{className:"custom-capture-v2-demo-page flex-1 flex flex-col h-full","data-test":"custom-capture-v2-demo-page",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 border-b bg-background border-border","data-test":"demo-header",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Custom Capture V2 Demo"}),e.jsxs("div",{className:"flex items-center gap-2","data-test":"header-actions",children:[e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors bg-amber-500 hover:bg-amber-600 text-white","data-test":"copy-comparison-btn",children:[e.jsx(Yi,{className:"w-4 h-4"}),"Copy Comparison"]}),e.jsx("button",{onClick:()=>i(!l),className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-colors text-white ${l?"bg-primary":"bg-muted-foreground"}`,"data-test":"toggle-capture-panel",children:l?e.jsxs(e.Fragment,{children:[e.jsx(gn,{className:"w-4 h-4"}),"Hide Panel"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ga,{className:"w-4 h-4"}),"Show Panel"]})})]})]}),e.jsx("div",{ref:c,className:"page-content flex-1 flex flex-col overflow-y-auto min-h-0 bg-background","data-test":"capture-target",children:e.jsxs(Fn,{value:a,onValueChange:r,className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"px-6 pt-4","data-test":"tab-navigation",children:e.jsxs(Mn,{"data-test":"tabs-list",children:[e.jsx(Wt,{value:"tft-cards","data-test":"tab-tft-cards",children:"TFT Cards"}),e.jsx(Wt,{value:"siblings","data-test":"tab-siblings",children:"Feature: Siblings"}),e.jsx(Wt,{value:"linkedin","data-test":"tab-linkedin",children:"Automation: LinkedIn"})]})}),e.jsx(qt,{value:"tft-cards",className:"flex-1 p-6","data-test":"tab-content-tft",children:e.jsx(au,{})}),e.jsx(qt,{value:"siblings",className:"flex-1 p-6","data-test":"tab-content-siblings",children:e.jsx(ru,{})}),e.jsx(qt,{value:"linkedin",className:"flex-1 p-6","data-test":"tab-content-linkedin",children:e.jsx(pu,{})})]})}),e.jsx(Zd,{isVisible:l,onVisibilityChange:i,captureRoot:d})]})}export{Au as CustomCaptureV2DemoPage};
