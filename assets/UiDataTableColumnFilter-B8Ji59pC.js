var de=Object.defineProperty;var pe=(d,t,o)=>t in d?de(d,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[t]=o;var te=(d,t,o)=>pe(d,typeof t!="symbol"?t+"":t,o);import{r as x,j as e}from"./react-vendor-Byz07MLO.js";import{S as he}from"./SFSService-cYgO5WK9.js";import{I as L,aj as se,L as H,a as z,B as ne,S as J,h as X,i as Q,j as ee,k as Y,l as me,az as ge,aA as fe,aB as xe}from"./index-BEUYSeX_.js";import{a2 as le,X as oe,aG as be,V as ye,O as ie,g as ve,b2 as Se}from"./icons-Detj0uxE.js";function je(d){const t={field:d.field,caseSensitive:!1};switch(d.operator){case"equals":return{...t,operator:"eq",value:d.value};case"contains":return{...t,operator:"contains",value:String(d.value)};case"starts_with":return{...t,operator:"startsWith",value:String(d.value)};case"ends_with":return{...t,operator:"endsWith",value:String(d.value)};case"greater_than":return{...t,operator:"gt",value:Number(d.value)};case"less_than":return{...t,operator:"lt",value:Number(d.value)};case"between":return{...t,operator:"between",valueRange:[d.valueMin??0,d.valueMax??0]};case"is_true":return{...t,operator:"eq",value:!0};case"is_false":return{...t,operator:"eq",value:!1};default:return{...t,operator:"eq",value:d.value}}}let Ce=0;function Pe({data:d,initialSearchTerm:t="",initialFilters:o=[],initialSort:c=null}){const[l,n]=x.useState(t),[a,s]=x.useState(!1),[u,p]=x.useState(!1),[g,r]=x.useState(o),[i,h]=x.useState(c),[v,m]=x.useState([]),j=x.useMemo(()=>new he(d),[d]),M=x.useMemo(()=>{let y=j.chain();if(l.trim()&&(y=y.search(l,{caseSensitive:a,exactMatch:u})),g.length>0){const C=g.map(w=>je(w));C.length===1?y=y.advancedFilter(C[0]):C.length>1&&(y=y.advancedFilter({conditions:C,logic:"AND"}))}if(v.length>0){const C=v.map(w=>({field:w.field,direction:w.direction}));y=y.multiSort(C)}else i&&(y=y.sort({field:i.field,direction:i.direction}));return y.getItems()},[j,l,a,u,g,i,v]),I=x.useCallback(y=>{const C={...y,id:`filter-${++Ce}`};r(w=>[...w,C])},[]),A=x.useCallback(y=>{r(C=>C.filter(w=>w.id!==y))},[]),O=x.useCallback((y,C)=>{r(w=>w.map(G=>G.id===y?{...G,...C}:G))},[]),k=x.useCallback(()=>{r([])},[]),T=x.useCallback((y,C)=>{h({field:y,direction:C}),m([])},[]),F=x.useCallback(y=>{h(C=>!C||C.field!==y?{field:y,direction:"asc"}:C.direction==="asc"?{field:y,direction:"desc"}:null),m([])},[]),B=x.useCallback(()=>{h(null)},[]),_=x.useCallback(y=>{m(C=>{let w=C;return C.length===0&&i&&(w=[i]),w.find(E=>E.field===y)?w.map(E=>E.field===y?{...E,direction:E.direction==="asc"?"desc":"asc"}:E):[...w,{field:y,direction:"asc"}]}),h(null)},[i]),V=x.useCallback(y=>{m(C=>C.filter(w=>w.field!==y))},[]),N=x.useCallback(()=>{m([])},[]),$=x.useCallback((y,C)=>{m(w=>{const G=w.findIndex(S=>S.field===y);if(G===-1)return w;const E=C==="up"?G-1:G+1;if(E<0||E>=w.length)return w;const f=[...w];return[f[G],f[E]]=[f[E],f[G]],f})},[]),U={searchTerm:l,caseSensitive:a,exactMatch:u,filters:g,sort:i,multiSort:v},D={setSearchTerm:n,setCaseSensitive:s,setExactMatch:p,addFilter:I,removeFilter:A,updateFilter:O,clearFilters:k,setSort:T,toggleSort:F,clearSort:B,addMultiSort:_,removeMultiSort:V,clearMultiSort:N,reorderMultiSort:$},b={processedData:M,totalCount:d.length,filteredCount:M.length};return{state:U,actions:D,computed:b,tableProps:{data:M}}}class we{constructor(t){te(this,"items",[]);t&&(this.items=structuredClone(t))}getItems(){return structuredClone(this.items)}setItems(t){this.items=structuredClone(t)}categorize(t,o={}){const{allowMultiple:c=!1,usePriority:l=!0}=o,n=this.getItems(),a={categories:{},uncategorized:[],summary:{totalItems:n.length,categorizedItems:0,uncategorizedItems:0,categoryStats:{}}};return t.forEach(s=>{a.categories[s.name]=[],a.summary.categoryStats[s.name]=0}),n.forEach(s=>{const u=t.filter(p=>p.criteria(s));if(u.length===0)a.uncategorized.push(s),a.summary.uncategorizedItems++;else if(u.length===1||!c){let p;if(u.length===1)p=u[0];else if(l)p=u.reduce((g,r)=>(g.priority??0)>=(r.priority??0)?g:r);else{const g=t.findIndex(r=>r.name===u[0].name);p=t[g]}a.categories[p.name].push(structuredClone(s)),a.summary.categoryStats[p.name]++,a.summary.categorizedItems++}else u.forEach(p=>{a.categories[p.name].push(structuredClone(s)),a.summary.categoryStats[p.name]++}),a.summary.categorizedItems++}),a}groupBy(t,o={}){const{nullGroupName:c="null",sortGroups:l}=o,n=this.getItems(),a={},s={};n.forEach(h=>{const v=h[t],m=v!=null?String(v):c;a[m]||(a[m]=[],s[m]=0),a[m].push(structuredClone(h)),s[m]++});const u=Object.entries(s);let p="",g="",r=0,i=n.length;if(u.forEach(([h,v])=>{v>r&&(r=v,p=h),v<i&&(i=v,g=h)}),l){const h={};return Object.keys(a).sort((m,j)=>l==="asc"?m.localeCompare(j):j.localeCompare(m)).forEach(m=>{h[m]=a[m]}),{groups:h,summary:{totalItems:n.length,groupCount:Object.keys(h).length,largestGroup:p,smallestGroup:g,groupStats:s}}}return{groups:a,summary:{totalItems:n.length,groupCount:Object.keys(a).length,largestGroup:p,smallestGroup:g,groupStats:s}}}groupByMultiple(t,o={}){if(t.length===0)return{};if(t.length===1)return this.groupBy(t[0],o).groups;const{nullGroupName:c="null",sortGroups:l}=o,n=this.getItems(),a=(u,p,g=0)=>{const r=p[g],i={};if(u.forEach(v=>{const m=v[r],j=m!=null?String(m):c;i[j]||(i[j]=[]),i[j].push(v)}),g===p.length-1)return i;const h={};return Object.entries(i).forEach(([v,m])=>{h[v]=a(m,p,g+1)}),h};let s=a(n,t);if(l){const u=p=>{const g={};return Object.keys(p).sort((i,h)=>l==="asc"?i.localeCompare(h):h.localeCompare(i)).forEach(i=>{const h=p[i];h&&typeof h=="object"&&!Array.isArray(h)?g[i]=u(h):g[i]=h}),g};s=u(s)}return s}groupByFn(t,o={}){const{sortGroups:c}=o,l=this.getItems(),n={},a={};l.forEach(i=>{const h=t(i);n[h]||(n[h]=[],a[h]=0),n[h].push(structuredClone(i)),a[h]++});const s=Object.entries(a);let u="",p="",g=0,r=l.length;if(s.forEach(([i,h])=>{h>g&&(g=h,u=i),h<r&&(r=h,p=i)}),c){const i={};return Object.keys(n).sort((v,m)=>c==="asc"?v.localeCompare(m):m.localeCompare(v)).forEach(v=>{i[v]=n[v]}),{groups:i,summary:{totalItems:l.length,groupCount:Object.keys(i).length,largestGroup:u,smallestGroup:p,groupStats:a}}}return{groups:n,summary:{totalItems:l.length,groupCount:Object.keys(n).length,largestGroup:u,smallestGroup:p,groupStats:a}}}sliceEqual(t,o={}){if(t<=0)throw new Error("Count must be greater than 0");const{includeStats:c=!0}=o,l=this.getItems(),n=l.length;t>n&&(t=n);const a=[],s=[],u=Math.floor(n/t),p=n%t;let g=0;for(let i=0;i<t;i++){const h=u+(i<p?1:0),v=g+h,m=l.slice(g,v);a.push(m),s.push(m.length),g=v}const r={slices:a};return c&&(r.summary={totalItems:n,sliceCount:a.length,itemsPerSlice:s}),r}sliceBySize(t,o={}){if(t<=0)throw new Error("Size must be greater than 0");const{includeStats:c=!0}=o,l=this.getItems(),n=l.length,a=[],s=[];for(let p=0;p<n;p+=t){const g=l.slice(p,p+t);a.push(g),s.push(g.length)}const u={slices:a};return c&&(u.summary={totalItems:n,sliceCount:a.length,itemsPerSlice:s}),u}sliceByDistribution(t,o={}){const{includeStats:c=!0}=o,l=this.getItems(),n=l.length,a=t(l),s=a.map(p=>p.length),u={slices:a};return c&&(u.summary={totalItems:n,sliceCount:a.length,itemsPerSlice:s}),u}transformToArray(t,o=(c,l)=>({key:c,items:l})){return Object.entries(t).map(([c,l])=>o(c,structuredClone(l)))}getStats(t){const o=this.getItems(),c={totalItems:o.length};return t.forEach(l=>{c[l.name]=l.fn(o)}),c}}const ae={primaryField:null,secondaryFields:[],sortGroups:"asc",nullGroupName:"(empty)"},re={enabled:!1,currentSlice:0,sliceSize:5,sliceSizeOptions:[1,5,10,20,50]};function ce(d,t,o=[]){return`${o.length>0?o.join("::")+"::":""}${d}:${t}`}function Ne(d,t,o,c=0,l=[]){const n=[];return Object.entries(d).forEach(([a,s])=>{const u=ce(t,a,l),p=o[u]!==!1,g={id:`header-${u}`,type:"group-header",depth:c,fieldName:t,groupValue:a,itemCount:s.length,isExpanded:p,groupKey:u,parentGroupKeys:l};n.push(g),p&&s.forEach((r,i)=>{const h={id:`data-${u}-${i}`,type:"data-row",depth:c+1,data:r,parentGroupKey:u,originalIndex:i};n.push(h)})}),n}function ue(d,t,o,c=0,l=[]){const n=[],a=t[0],s=t.slice(1);return Object.entries(d).forEach(([u,p])=>{const g=ce(a,u,l),r=o[g]!==!1;let i=0;if(s.length===0)i=Array.isArray(p)?p.length:0;else{const v=m=>Array.isArray(m)?m.length:Object.values(m).reduce((j,M)=>j+v(M),0);i=v(p)}const h={id:`header-${g}`,type:"group-header",depth:c,fieldName:a,groupValue:u,itemCount:i,isExpanded:r,groupKey:g,parentGroupKeys:l};if(n.push(h),r){if(s.length===0&&Array.isArray(p))p.forEach((v,m)=>{const j={id:`data-${g}-${m}`,type:"data-row",depth:c+1,data:v,parentGroupKey:g,originalIndex:m};n.push(j)});else if(s.length>0){const v=ue(p,s,o,c+1,[...l,g]);n.push(...v)}}}),n}function Fe(d){if(d.length===0)return[];const t=d[0],o=[];return Object.entries(t).forEach(([c,l])=>{if(Array.isArray(l)||typeof l=="object"&&l!==null)return;let n="string";typeof l=="number"?n="number":typeof l=="boolean"?n="boolean":(l instanceof Date||!isNaN(Date.parse(String(l))))&&(n="date"),o.push({field:c,label:c.charAt(0).toUpperCase()+c.slice(1).replace(/([A-Z])/g," $1"),type:n})}),o}function Te(d){const{data:t,groupableFields:o,initialGroupConfig:c,initialSliceConfig:l,onGroupChange:n,onSliceChange:a}=d,[s,u]=x.useState({...ae,...c}),[p,g]=x.useState({}),[r,i]=x.useState({...re,...l}),h=x.useMemo(()=>o||Fe(t),[t,o]),v=x.useMemo(()=>new we(t),[t]),m=x.useMemo(()=>{if(!s.primaryField)return null;const f=[s.primaryField,...s.secondaryFields];return f.length===1?v.groupBy(s.primaryField,{nullGroupName:s.nullGroupName,sortGroups:s.sortGroups}):{groups:v.groupByMultiple(f,{nullGroupName:s.nullGroupName,sortGroups:s.sortGroups}),summary:{totalItems:t.length,groupCount:0,largestGroup:"",smallestGroup:"",groupStats:{}}}},[v,s,t.length]),j=x.useMemo(()=>{if(!m||!s.primaryField)return t.map((S,q)=>({id:`data-${q}`,type:"data-row",depth:0,data:S,parentGroupKey:"",originalIndex:q}));const f=[s.primaryField,...s.secondaryFields];return f.length===1?Ne(m.groups,s.primaryField,p):ue(m.groups,f,p)},[m,s.primaryField,s.secondaryFields,p,t]),M=x.useMemo(()=>{if(!r.enabled)return j;if(s.primaryField){const f=j.filter(P=>P.type==="group-header"&&P.depth===0),S=r.currentSlice*r.sliceSize,q=S+r.sliceSize,R=new Set(f.slice(S,q).map(P=>P.groupKey));return j.filter(P=>{if(P.type==="group-header"){const K=P;return K.depth===0?R.has(K.groupKey):K.parentGroupKeys.some(Z=>R.has(Z))||R.has(K.groupKey)}else{const K=P,Z=K.parentGroupKey.split("::")[0];return R.has(Z)||R.has(K.parentGroupKey)}})}else{const f=r.currentSlice*r.sliceSize,S=f+r.sliceSize;return j.slice(f,S)}},[j,r,s.primaryField]),I=x.useMemo(()=>{if(!r.enabled)return 1;if(s.primaryField){const f=j.filter(S=>S.type==="group-header"&&S.depth===0);return Math.ceil(f.length/r.sliceSize)}else return Math.ceil(j.length/r.sliceSize)},[j,r,s.primaryField]),A=x.useMemo(()=>{var f;return(f=m==null?void 0:m.summary)!=null&&f.groupStats?m.summary.groupStats:{}},[m]),O=x.useMemo(()=>m&&typeof m.groups=="object"?Object.keys(m.groups).length:0,[m]),k=x.useCallback(f=>{const S={...s,primaryField:f,secondaryFields:f?s.secondaryFields:[]};u(S),g({}),n==null||n(S)},[s,n]),T=x.useCallback(f=>{const S={...s,primaryField:f[0]||null,secondaryFields:f.slice(1)};u(S),g({}),n==null||n(S)},[s,n]),F=x.useCallback(f=>{if(!s.primaryField){k(f);return}const S={...s,secondaryFields:[...s.secondaryFields,f]};u(S),n==null||n(S)},[s,n,k]),B=x.useCallback(f=>{if(f===0)if(s.secondaryFields.length>0){const S={...s,primaryField:s.secondaryFields[0],secondaryFields:s.secondaryFields.slice(1)};u(S),n==null||n(S)}else k(null);else{const S={...s,secondaryFields:s.secondaryFields.filter((q,R)=>R!==f-1)};u(S),n==null||n(S)}},[s,n,k]),_=x.useCallback(f=>{g(S=>({...S,[f]:S[f]===!1}))},[]),V=x.useCallback(()=>{const f={};j.forEach(S=>{S.type==="group-header"&&(f[S.groupKey]=!0)}),g(f)},[j]),N=x.useCallback(()=>{const f={};j.forEach(S=>{S.type==="group-header"&&(f[S.groupKey]=!1)}),g(f)},[j]),$=x.useCallback(()=>{const f={...r,enabled:!r.enabled,currentSlice:0};i(f),a==null||a(f)},[r,a]),U=x.useCallback(f=>{const S={...r,sliceSize:f,currentSlice:0};i(S),a==null||a(S)},[r,a]),D=x.useCallback(()=>{if(r.currentSlice<I-1){const f={...r,currentSlice:r.currentSlice+1};i(f),a==null||a(f)}},[r,I,a]),b=x.useCallback(()=>{if(r.currentSlice>0){const f={...r,currentSlice:r.currentSlice-1};i(f),a==null||a(f)}},[r,a]),y=x.useCallback(f=>{if(f>=0&&f<I){const S={...r,currentSlice:f};i(S),a==null||a(S)}},[r,I,a]),C=x.useCallback(()=>{u(ae),g({}),i(re)},[]),w={groupConfig:s,expandedGroups:p,sliceConfig:r},G={setGroupBy:k,setGroupByMultiple:T,addGroupLevel:F,removeGroupLevel:B,toggleGroup:_,expandAll:V,collapseAll:N,toggleSlicing:$,setSliceSize:U,nextSlice:D,previousSlice:b,goToSlice:y,reset:C},E={flattenedRows:M,totalGroups:O,totalItems:t.length,totalSlices:I,sliceDisplay:`${r.currentSlice+1} of ${I}`,hasNextSlice:r.currentSlice<I-1,hasPreviousSlice:r.currentSlice>0,groupStats:A,groupableFields:h};return{state:w,actions:G,computed:E,tableProps:{data:M,isGrouped:!!s.primaryField,isSliced:r.enabled}}}const W={string:["equals","contains","starts_with","ends_with"],number:["equals","greater_than","less_than","between"],boolean:["is_true","is_false"],date:["equals","greater_than","less_than","between"]};function Re({columns:d,filters:t,searchTerm:o,caseSensitive:c,exactMatch:l,onSearchChange:n,onCaseSensitiveChange:a,onExactMatchChange:s,onAddFilter:u,onRemoveFilter:p,onClearFilters:g}){const[r,i]=x.useState(""),[h,v]=x.useState(""),[m,j]=x.useState(""),[M,I]=x.useState(""),[A,O]=x.useState(""),[k,T]=x.useState("true"),F=d.find(b=>b.id===r),B=F?W[F.type]:[],_=b=>{i(b);const y=d.find(C=>C.id===b);y&&v(W[y.type][0]),j(""),I(""),O("")},V=()=>{if(!r||!h&&(F==null?void 0:F.type)!=="boolean")return;let b=m;const y=d.find(G=>G.id===r);(y==null?void 0:y.type)==="number"&&h!=="between"?b=Number(m):(y==null?void 0:y.type)==="boolean"&&(b=k==="true");let C=h;(y==null?void 0:y.type)==="boolean"&&(C=k==="true"?"is_true":"is_false");const w={field:r,operator:C,value:b};h==="between"&&(w.valueMin=Number(M),w.valueMax=Number(A)),u(w),i(""),v(""),j(""),I(""),O("")},N=b=>{const y=d.find(G=>G.id===b.field),C=(y==null?void 0:y.label)??b.field,w=b.operator;return b.operator==="between"?`${C} ${w} ${b.valueMin} and ${b.valueMax}`:b.operator==="is_true"||b.operator==="is_false"?`${C} ${w}`:`${C} ${w} ${b.value}`},$=t.length,U=h==="between",D=(F==null?void 0:F.type)==="boolean";return e.jsxs("div",{className:"space-y-4","data-test":"enhanced-filter-bar",children:[e.jsxs("div",{className:"flex items-center gap-4","data-test":"search-row",children:[e.jsx(L,{placeholder:"Filter all columns...",value:o,onChange:b=>n(b.target.value),className:"max-w-sm","data-test":"global-search-input"}),e.jsxs("div",{className:"flex items-center gap-4","data-test":"search-options",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{id:"case-sensitive",checked:c,onCheckedChange:b=>a(b===!0),"data-test":"search-case-sensitive-toggle"}),e.jsx(H,{htmlFor:"case-sensitive",className:"text-sm","data-test":"case-sensitive-label",children:"Case sensitive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{id:"exact-match",checked:l,onCheckedChange:b=>s(b===!0),"data-test":"search-exact-match-toggle"}),e.jsx(H,{htmlFor:"exact-match",className:"text-sm","data-test":"exact-match-label",children:"Exact match"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap","data-test":"filter-builder-row",children:[e.jsxs("select",{value:r,onChange:b=>_(b.target.value),className:"h-9 w-40 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-field-select",children:[e.jsx("option",{value:"",children:"Select field"}),d.map(b=>e.jsx("option",{value:b.id,"data-test":"filter-field-option",children:b.label},b.id))]}),r&&!D&&e.jsx("select",{value:h,onChange:b=>v(b.target.value),className:"h-9 w-36 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-operator-select",children:B.map(b=>e.jsx("option",{value:b,"data-test":"filter-operator-option",children:b},b))}),r&&D?e.jsxs("select",{value:k,onChange:b=>T(b.target.value),className:"h-9 w-24 rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-boolean-select",children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]}):r&&U?e.jsxs(e.Fragment,{children:[e.jsx(L,{type:"number",placeholder:"Min",value:M,onChange:b=>I(b.target.value),className:"w-24","data-test":"filter-value-min-input"}),e.jsx(L,{type:"number",placeholder:"Max",value:A,onChange:b=>O(b.target.value),className:"w-24","data-test":"filter-value-max-input"})]}):r?e.jsx(L,{type:(F==null?void 0:F.type)==="number"?"number":"text",placeholder:"Value...",value:m,onChange:b=>j(b.target.value),className:"w-32","data-test":"filter-value-input"}):null,r&&e.jsxs(z,{size:"sm",onClick:V,"data-test":"filter-add-button",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2","data-test":"active-filter-count",children:[$," ",$===1?"filter":"filters"]}),$>0&&e.jsx(z,{size:"sm",variant:"outline",onClick:g,"data-test":"filter-clear-all-button",children:"Clear all"})]}),$>0&&e.jsx("div",{className:"flex flex-wrap gap-2","data-test":"filter-chips",children:t.map(b=>e.jsxs(ne,{variant:"secondary",className:"flex items-center gap-1 pr-1","data-test":"filter-chip",children:[e.jsx("span",{children:N(b)}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>p(b.id),"data-test":"filter-chip-remove",children:e.jsx(oe,{className:"h-3 w-3"})})]},b.id))})]})}function Ge({groupableFields:d,selectedField:t,onFieldSelect:o,disabled:c}){return e.jsxs("div",{"data-test":"group-selector",className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Group by"}),e.jsxs(J,{value:t||"none",onValueChange:l=>o(l==="none"?null:l),disabled:c,children:[e.jsx(X,{"data-test":"group-selector-trigger",className:"w-[180px] h-8",children:e.jsx(Q,{placeholder:"Select field..."})}),e.jsxs(ee,{"data-test":"group-selector-dropdown",children:[e.jsx(Y,{value:"none","data-test":"group-option-none",children:"None"}),d.map(l=>e.jsx(Y,{value:l.field,"data-test":"group-option",children:l.label},l.field))]})]})]})}function Ie({groupableFields:d,selectedField:t,excludeFields:o,onFieldSelect:c,onRemove:l,index:n,disabled:a}){const s=d.filter(u=>!o.includes(u.field)||u.field===t);return e.jsxs("div",{"data-test":"group-selector-secondary",className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"then"}),e.jsxs(J,{value:t,onValueChange:c,disabled:a,children:[e.jsx(X,{"data-test":"group-selector-secondary-trigger",className:"w-[150px] h-8",children:e.jsx(Q,{placeholder:"Select field..."})}),e.jsx(ee,{"data-test":"group-selector-secondary-dropdown",children:s.map(u=>e.jsx(Y,{value:u.field,"data-test":"group-option",children:u.label},u.field))})]}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:l,"data-test":"remove-group-secondary",title:"Remove grouping level",children:e.jsx(oe,{className:"h-4 w-4"})})]})}function ke({onClick:d,disabled:t}){return e.jsxs(z,{variant:"ghost",size:"sm",onClick:d,disabled:t,"data-test":"add-group-button",className:"h-8 gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Add level"})]})}function Ke({groupableFields:d,selectedField:t,secondaryFields:o,onFieldSelect:c,onAddSecondary:l,onRemoveSecondary:n,disabled:a}){const s=[t,...o].filter(Boolean),u=d.filter(r=>!s.includes(r.field)),p=t&&u.length>0,g=()=>{u.length>0&&l(u[0].field)};return e.jsxs("div",{"data-test":"group-selector-container",className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Ge,{groupableFields:d,selectedField:t,onFieldSelect:c,disabled:a}),o.map((r,i)=>e.jsx(Ie,{groupableFields:d,selectedField:r,excludeFields:s.filter(h=>h!==r),onFieldSelect:h=>{[...o],n(i),l(h)},onRemove:()=>n(i),index:i,disabled:a},`secondary-${i}`)),t&&o.length===0&&e.jsx("div",{"data-test":"group-selector-secondary",className:"hidden"}),p&&e.jsx(ke,{onClick:g,disabled:a})]})}function Le({enabled:d,currentSlice:t,totalSlices:o,sliceSize:c,sliceSizeOptions:l,onToggle:n,onSliceSizeChange:a,onNextSlice:s,onPreviousSlice:u,hasNext:p,hasPrevious:g,sliceDisplay:r}){return e.jsxs("div",{"data-test":"slice-controls-container",className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{id:"slice-toggle",checked:d,onCheckedChange:n,"data-test":"slice-toggle"}),e.jsxs(H,{htmlFor:"slice-toggle",className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),"Slice view"]})]}),d&&e.jsxs("div",{"data-test":"slice-controls",className:"flex items-center gap-3 border-l pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show"}),e.jsxs(J,{value:String(c),onValueChange:i=>a(Number(i)),children:[e.jsx(X,{"data-test":"slice-size-config",className:"w-[70px] h-8",children:e.jsx(Q,{})}),e.jsx(ee,{children:l.map(i=>e.jsx(Y,{value:String(i),"data-test":"slice-size-option",children:i},i))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:u,disabled:!g,"data-test":"slice-previous",title:"Previous slice",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx("span",{"data-test":"slice-info",className:"text-sm text-muted-foreground min-w-[60px] text-center",children:r}),e.jsx(z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:s,disabled:!p,"data-test":"slice-next",title:"Next slice",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]})}function Me(d){return{paddingLeft:`${1+d*1.5}rem`}}function Ee({groupRow:d,onToggle:t,colSpan:o}){const{fieldName:c,groupValue:l,itemCount:n,isExpanded:a,groupKey:s,depth:u}=d,g=`group-header-${l.replace(/\s+/g,"-").toLowerCase()}`;return e.jsx("tr",{"data-test":g,className:"bg-muted/50 hover:bg-muted/70 cursor-pointer transition-colors group-header-row",onClick:()=>t(s),children:e.jsx("td",{colSpan:o,className:"py-2 font-medium",style:Me(u),"data-test":"group-header-level",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{"data-test":"group-toggle-icon",className:"flex items-center justify-center w-5 h-5 rounded hover:bg-muted",children:a?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[c,":"]})," ",e.jsx("span",{className:"font-medium",children:l})]}),e.jsx(ne,{variant:"secondary","data-test":"group-count",className:"ml-2 text-xs",children:n})]})})})}function $e({dataRow:d,columns:t,onRowClick:o,columnSizeVars:c}){const{data:l,originalIndex:n,depth:a,parentGroupKey:s}=d,u={paddingLeft:`${a*1.5}rem`},p=s.replace(/[^a-zA-Z0-9-]/g,"-").toLowerCase(),g=s?`data-row-${p}-${n}`:`data-row-${n}`;return e.jsx("tr",{"data-test":g,className:"hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>o==null?void 0:o(l),children:t.map((r,i)=>{const h=r.accessorKey||r.id||`col-${i}`,v=l[h],m=i===0?{...u}:{};if(c){const j=`--col-${h}-size`;c[j]&&(m.width=`calc(var(${j}) * 1px)`,m.maxWidth=`calc(var(${j}) * 1px)`)}return e.jsx("td",{className:"p-3 text-sm border-b break-words overflow-hidden",style:m,children:ze(r,v,l)},h)})})}function ze(d,t,o){if(d.cellRenderer)return d.cellRenderer(o);if(d.accessorFn){const c=d.accessorFn(o,0);return String(c??"")}return t==null?e.jsx("span",{className:"text-muted-foreground",children:"-"}):typeof t=="boolean"?t?"Yes":"No":typeof t=="object"?JSON.stringify(t):String(t)}function De({rows:d,columns:t,onToggleGroup:o,onRowClick:c,columnSizeVars:l}){const n=t.length;return e.jsx("tbody",{"data-test":"grouped-table-body",className:"divide-y divide-gray-200",style:l,children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:n,className:"px-4 py-8 text-center text-muted-foreground",children:"No results found"})}):d.map(a=>{if(a.type==="group-header"){const s=a;return e.jsx(Ee,{groupRow:s,onToggle:o,colSpan:n},s.id)}else{const s=a;return e.jsx($e,{dataRow:s,columns:t,onRowClick:c,columnSizeVars:l},s.id)}})})}function Ue({columnId:d,columnLabel:t,columnType:o,currentFilter:c,onApplyFilter:l,onClearFilter:n,isActive:a=!1}){var B,_,V;const[s,u]=x.useState(!1),[p,g]=x.useState((c==null?void 0:c.operator)??W[o][0]),[r,i]=x.useState(((B=c==null?void 0:c.value)==null?void 0:B.toString())??""),[h,v]=x.useState(((_=c==null?void 0:c.valueMin)==null?void 0:_.toString())??""),[m,j]=x.useState(((V=c==null?void 0:c.valueMax)==null?void 0:V.toString())??""),[M,I]=x.useState(o==="boolean"&&c?c.value===!0?"true":"false":"true"),A=W[o],O=p==="between",k=o==="boolean",T=()=>{let N=r;o==="number"&&p!=="between"?N=Number(r):k&&(N=M==="true");const $={field:d,operator:p,value:N};p==="between"&&($.valueMin=Number(h),$.valueMax=Number(m)),l($),u(!1)},F=()=>{i(""),v(""),j(""),g(W[o][0]),n(),u(!1)};return e.jsxs(ge,{open:s,onOpenChange:u,children:[e.jsx(fe,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"sm","data-test":"column-filter-button",className:`h-6 w-6 p-0 ${a?"active text-primary":"text-muted-foreground"}`,onClick:N=>{N.stopPropagation()},children:e.jsx(Se,{className:"h-3.5 w-3.5"})})}),e.jsx(xe,{"data-test":"column-filter-popover",className:"w-72 p-4",align:"start",onClick:N=>N.stopPropagation(),children:e.jsxs("div",{className:"space-y-4","data-test":"filter-popover-content",children:[e.jsxs("div",{className:"font-medium text-sm","data-test":"filter-column-label",children:["Filter: ",t]}),!k&&e.jsx("select",{value:p,onChange:N=>g(N.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-operator-select",children:A.map(N=>e.jsx("option",{value:N,"data-test":"operator-option",children:N},N))}),k?e.jsxs("select",{value:M,onChange:N=>I(N.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 focus:ring-ring","data-test":"filter-boolean-select",children:[e.jsx("option",{value:"true","data-test":"boolean-option-true",children:"True"}),e.jsx("option",{value:"false","data-test":"boolean-option-false",children:"False"})]}):O?e.jsxs("div",{className:"flex gap-2","data-test":"between-inputs",children:[e.jsx(L,{type:"number",placeholder:"Min",value:h,onChange:N=>v(N.target.value),"data-test":"filter-value-min-input"}),e.jsx(L,{type:"number",placeholder:"Max",value:m,onChange:N=>j(N.target.value),"data-test":"filter-value-max-input"})]}):e.jsx(L,{type:o==="number"?"number":"text",placeholder:`Enter ${o} value...`,value:r,onChange:N=>i(N.target.value),"data-test":"filter-value-input"}),e.jsxs("div",{className:"flex gap-2","data-test":"filter-actions",children:[e.jsx(z,{size:"sm",className:"flex-1",onClick:T,"data-test":"filter-apply-button",children:"Apply"}),e.jsx(z,{size:"sm",variant:"outline",onClick:F,"data-test":"filter-clear-button",children:"Clear"})]})]})})]})}export{De as T,Re as U,Te as a,Ke as b,Le as c,Ue as d,Pe as u};
