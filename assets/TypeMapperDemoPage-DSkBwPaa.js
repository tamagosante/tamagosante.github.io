import{r as n,j as e,N as Oe,e as Ee,f as G,g as Ie}from"./react-vendor-Byz07MLO.js";import{J as q,K as ee,a as E,C as I,b as R,c as A,d as L,e as D,T as W,V as Re,aS as ue,L as _,I as U,aj as Ae,aT as B,aU as De,aV as Me,aW as Pe}from"./index-eHP58yiE.js";import{W as Le,a as Ue,N as Ke,I as Je}from"./WorkflowRowItem-iqt932NO.js";import{D as _e}from"./DraggableTree-Dr3LK8bf.js";import{R as ce,a as te,E as Fe,J as We,a1 as ze,b4 as $e,w as me,a8 as He,b5 as Be,b6 as Xe,au as Ve,an as he,aT as Ge,a6 as Ye,e as xe,D as fe,T as qe}from"./icons-vtiX7BHn.js";import"./utils-DJ2ViQ2u.js";import"./radix-ui-v9Pxfv0s.js";import"./ui-utils-BxIQ3qGg.js";import"./string-4WCj7OpV.js";import"./DragDropManager-KcuPnjwl.js";import"./treeHelpers-DUv_6quS.js";class Ze{static mapKeys(s,d){const r={};for(const[x,i,p]of d)s[x]!==void 0&&(typeof p=="function"?r[i]=p(s[x]):r[i]=s[x]);return r}static mapKeysArray(s,d){return s.map(r=>this.mapKeys(r,d))}}const le=[{id:"loop_1",label:"Loop",order:1,stepType:"loop",children:[{id:"if_1",label:"If matches",order:10,stepType:"if",config:{field:"content",operator:"matches",expectedValue:"/^([^\\n]+)/"}},{id:"update_1",label:"Update title",order:11,stepType:"nodeUpdate",config:{mode:"simple",simpleFieldUpdates:[{field:"title",template:"{{if.capture[1]}}"}]}}]}],Qe=[{id:"loop_1",label:"Loop all",order:1,stepType:"loop",children:[{id:"update_1",label:"Update title",order:10,stepType:"nodeUpdate",config:{mode:"simple",simpleFieldUpdates:[{field:"title",template:"Processed: {{loop.index}}"}]}}]}],pe=[{id:"node-1",type:"TEXT",title:"",content:`agenda setting 
    - it's the ability of the news to influence the importance placed on certain Topics`,x:100,y:100,width:300,height:100},{id:"node-2",type:"TEXT",title:"",content:`appeal to fear
    - appeals to fear seek to build support by instilling anxiety`,x:100,y:250,width:300,height:100},{id:"node-3",type:"TEXT",title:"",content:`appeal to Prejudice 
    - using prejudices to attach value or moral goodness`,x:100,y:400,width:300,height:100}];function et({logger:t}){var oe,re,ie;const[s,d]=n.useState(JSON.parse(JSON.stringify(le))),[r,x]=n.useState("visual"),[i,p]=n.useState(null),[j,y]=n.useState(!1),[m,w]=n.useState(!1),[g,S]=n.useState(!1),[C,N]=n.useState(null),[v,M]=n.useState(null),F=n.useRef(new Map),[K,f]=n.useState(JSON.stringify(pe,null,2)),[h,l]=n.useState(null),[o,k]=n.useState(null),[T,z]=n.useState(!1),O=n.useMemo(()=>({id:"demo-node",x:0,y:0,width:400,height:500,type:q.WORKFLOW_ORCHESTRATION,title:"Demo Workflow",content:"",data:{nodeType:"workflowOrchestration",parameters:{rows:s}}}),[s]),Z=n.useMemo(()=>JSON.stringify({rows:s},null,2),[s]),P=n.useMemo(()=>{try{l(null);const a=JSON.parse(K);return Array.isArray(a)?a:(l("Nodes must be an array"),null)}catch(a){return l(a instanceof Error?a.message:"Invalid JSON"),null}},[K]),X=n.useCallback((a,c)=>{for(const u of a){if(u.id===c)return u;if(u.children){const b=X(u.children,c);if(b)return b}}return null},[]),$=n.useCallback((a,c,u)=>a.map(b=>b.id===c?{...b,...u}:b.children?{...b,children:$(b.children,c,u)}:b),[]),Q=n.useCallback((a,c)=>a.filter(u=>u.id!==c).map(u=>u.children?{...u,children:Q(u.children,c)}:u),[]),ae=n.useCallback(a=>{d(JSON.parse(JSON.stringify(a))),k(null),t==null||t.info("Loaded preset")},[t]),je=n.useCallback(()=>{const a=s.length+1,c={id:ee(),label:`Step ${a}`,order:a,stepType:"empty"};d([...s,c])},[s]),Ne=n.useCallback((a,c,u)=>{const b=X(s,a);p(a);const H=window.innerWidth,J=window.innerHeight,V=c.clientX,Y=c.clientY,ke=V<H/2?V+100:V-100;N({x:ke,y:Y});const Te=Math.min(450,Math.floor(J*.6));if(M({width:500,height:Te}),u==="badge")y(!0);else if(u==="gear"){const de=b==null?void 0:b.stepType;de==="nodeUpdate"?w(!0):de==="if"&&S(!0)}},[s,X]),ye=n.useCallback((a,c)=>{const u=$(s,a,{stepType:c});d(u),p(null)},[s,$]),be=n.useCallback(a=>{const c=Q(s,a);d(c)},[s,Q]),ve=n.useCallback(a=>{if(!i)return;const c=$(s,i,{stepType:"nodeUpdate",config:a});d(c),w(!1),p(null)},[i,s,$]),we=n.useCallback(a=>{if(!i)return;const c=$(s,i,{stepType:"if",config:a});d(c),S(!1),p(null)},[i,s,$]),Se=n.useCallback(()=>{f(JSON.stringify(pe,null,2)),l(null),k(null),t==null||t.info("Reset nodes to sample data")},[t]),ge=n.useCallback(async()=>{if(!P){t==null||t.error("Cannot execute: invalid nodes");return}z(!0),k(null);try{const a={id:"demo-orchestration",x:0,y:0,width:400,height:500,type:q.WORKFLOW_ORCHESTRATION,title:"Demo Workflow",content:"",data:{nodeType:"workflowOrchestration",showExecuteButton:!0,parameters:{rows:s},inputHandles:[]}},c=P.map(J=>({...J,type:J.type||q.TEXT})),u=[a,...c],b=new Le;b.loadWorkflow(u,[]);const H=await b.executeWorkflow("demo-orchestration");k(H),t==null||t.info(`Execution ${H.success?"succeeded":"failed"}`)}catch(a){const c=a instanceof Error?a.message:"Unknown error";k({success:!1,error:c,errors:[]}),t==null||t.error(`Execution error: ${c}`)}finally{z(!1)}},[s,P,t]),ne=n.useMemo(()=>!(o!=null&&o.nodeUpdates)||!P?[]:o.nodeUpdates.filter(a=>a.nodeId!=="demo-orchestration").map(a=>{const c=P.find(u=>u.id===a.nodeId);return{nodeId:a.nodeId,before:c||{},after:a.updates}}),[o,P]),Ce=n.useCallback(a=>{const c=(b,H=1)=>b.map((J,V)=>{const Y=H+V;return{...J,order:Y,children:J.children?c(J.children,Y*10):J.children}}),u=c(a);d(u)},[]);return e.jsxs("div",{"data-test":"workflow-builder-demo",className:"workflow-builder-demo flex flex-col gap-4",children:[e.jsxs("div",{"data-test":"demo-header",className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{"data-test":"demo-title",className:"text-xl font-semibold",children:"Workflow Builder Demo"}),e.jsx("p",{"data-test":"demo-description",className:"text-sm text-muted-foreground",children:"Simulate how workflows execute on canvas nodes"})]}),e.jsx(E,{"data-test":"execute-button",onClick:ge,disabled:T||!P,className:"gap-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),"Executing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4"}),"Execute"]})})]}),e.jsxs("div",{"data-test":"demo-columns",className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(I,{"data-test":"source-section",children:[e.jsxs(R,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"source-title",className:"text-base",children:"Source"}),e.jsx(L,{"data-test":"source-description",children:"Workflow steps"})]}),e.jsxs("div",{"data-test":"view-mode-toggle",className:"flex gap-1",children:[e.jsx(E,{"data-test":"view-visual-button",variant:r==="visual"?"default":"ghost",size:"sm",onClick:()=>x("visual"),className:"h-7 px-2",children:e.jsx(Fe,{className:"h-3 w-3"})}),e.jsx(E,{"data-test":"view-json-button",variant:r==="json"?"default":"ghost",size:"sm",onClick:()=>x("json"),className:"h-7 px-2",children:e.jsx(We,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{"data-test":"preset-buttons",className:"flex gap-2 pt-2",children:[e.jsxs(E,{"data-test":"preset-capture-first-line",variant:"outline",size:"sm",onClick:()=>ae(le),className:"gap-1 text-xs",children:[e.jsx(ze,{className:"h-3 w-3"}),"Capture First Line"]}),e.jsxs(E,{"data-test":"preset-loop-update-all",variant:"outline",size:"sm",onClick:()=>ae(Qe),className:"gap-1 text-xs",children:[e.jsx($e,{className:"h-3 w-3"}),"Loop + Update"]})]})]}),e.jsx(D,{children:r==="json"?e.jsx(W,{"data-test":"workflow-json-textarea",value:Z,readOnly:!0,placeholder:"Workflow configuration JSON...",className:"font-mono text-xs h-[350px] resize-none bg-muted/50"}):e.jsxs("div",{"data-test":"visual-step-builder",className:"space-y-2 h-[350px] overflow-y-auto",children:[e.jsx(_e,{data:s,defaultExpandedIds:new Set(s.filter(a=>a.children&&a.children.length>0).map(a=>a.id)),onReorder:Ce,renderCustomContent:a=>e.jsx(Ue,{row:a,node:O,nodes:P||[],incomingArrows:[],selectedRowId:i,configPopoverOpen:j,rowElementsRef:F,onRowClick:Ne,onConfigureRow:ye,onDeleteRow:be,onSelectedRowIdChange:p})}),e.jsxs("button",{"data-test":"add-step-button",onClick:je,className:"w-full flex items-center justify-center gap-2 py-2 text-xs text-muted-foreground border border-dashed border-border rounded hover:bg-accent hover:text-foreground transition-colors",children:[e.jsx(me,{className:"h-3 w-3"}),"Add Step"]})]})})]}),e.jsxs(I,{"data-test":"nodes-section",children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"nodes-title",className:"text-base",children:"Nodes Data"}),e.jsx(L,{"data-test":"nodes-description",children:"Canvas nodes to process"})]}),e.jsxs(E,{"data-test":"reset-nodes-button",variant:"ghost",size:"sm",onClick:Se,className:"gap-1 text-xs",children:[e.jsx(ce,{className:"h-3 w-3"}),"Reset"]})]})}),e.jsxs(D,{children:[e.jsx(W,{"data-test":"nodes-json-textarea",value:K,onChange:a=>f(a.target.value),placeholder:"Canvas nodes JSON array...",className:"font-mono text-xs h-[350px] resize-none"}),h&&e.jsx("p",{"data-test":"nodes-error",className:"text-destructive text-xs mt-2",children:h}),P&&e.jsxs("p",{"data-test":"nodes-count",className:"text-muted-foreground text-xs mt-2",children:[P.length," node(s) loaded"]})]})]}),e.jsxs(I,{"data-test":"output-section",children:[e.jsxs(R,{className:"pb-3",children:[e.jsx(A,{"data-test":"output-title",className:"text-base",children:"Output"}),e.jsx(L,{"data-test":"output-description",children:"Execution results"})]}),e.jsx(D,{children:o?e.jsxs("div",{"data-test":"output-results",className:"space-y-4",children:[e.jsx("div",{"data-test":"execution-status",className:"flex items-center gap-2",children:o.success?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-green-500",children:"SUCCESS"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-5 w-5 text-destructive"}),e.jsx("span",{className:"text-sm font-medium text-destructive",children:"FAILED"})]})}),o.success&&e.jsxs("div",{"data-test":"execution-stats",className:"text-sm space-y-1",children:[e.jsxs("p",{children:["Duration: ",e.jsxs("span",{className:"font-mono",children:[o.duration,"ms"]})]}),e.jsxs("p",{children:["Nodes executed: ",e.jsx("span",{className:"font-mono",children:o.executedNodeCount})]}),e.jsxs("p",{children:["Updates generated: ",e.jsx("span",{className:"font-mono",children:((oe=o.nodeUpdates)==null?void 0:oe.length)||0})]})]}),o.error&&e.jsxs("div",{"data-test":"execution-error",className:"text-sm text-destructive",children:[e.jsx("p",{className:"font-medium",children:"Error:"}),e.jsx("p",{className:"font-mono text-xs",children:o.error})]}),o.errors&&o.errors.length>0&&e.jsxs("div",{"data-test":"execution-errors-list",className:"text-sm",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Node Errors:"}),e.jsx("ul",{className:"list-disc list-inside text-xs",children:o.errors.map((a,c)=>e.jsxs("li",{className:"font-mono",children:["[",a.nodeId,"] ",a.message]},c))})]}),o.nodeUpdates&&o.nodeUpdates.length>0&&e.jsxs("div",{"data-test":"node-updates",className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-2",children:"Node Updates:"}),e.jsx("div",{className:"space-y-2 max-h-[180px] overflow-y-auto",children:o.nodeUpdates.filter(a=>a.nodeId!=="demo-orchestration").map((a,c)=>e.jsxs("div",{"data-test":"node-update",className:"p-2 bg-muted rounded text-xs font-mono",children:[e.jsx("p",{className:"font-medium",children:a.nodeId}),Object.entries(a.updates).map(([u,b])=>e.jsxs("p",{className:"text-muted-foreground",children:[u,': "',String(b),'"']},u))]},c))})]})]}):e.jsxs("div",{"data-test":"output-placeholder",className:"text-center py-8 text-muted-foreground",children:[e.jsx(te,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Click Execute to run the workflow"})]})})]})]}),ne.length>0&&e.jsxs(I,{"data-test":"diff-section",children:[e.jsxs(R,{className:"pb-3",children:[e.jsx(A,{"data-test":"diff-title",className:"text-base",children:"Before → After"}),e.jsx(L,{"data-test":"diff-description",children:"Changes applied to nodes"})]}),e.jsx(D,{children:e.jsx("div",{"data-test":"diff-grid",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ne.map((a,c)=>e.jsxs("div",{"data-test":"diff-item",className:"flex items-start gap-2",children:[e.jsxs("div",{"data-test":"diff-before",className:"flex-1 p-2 bg-muted/50 rounded text-xs",children:[e.jsx("p",{className:"font-medium mb-1",children:a.nodeId}),e.jsxs("p",{className:"text-muted-foreground",children:['title: "',a.before.title||"(empty)",'"']})]}),e.jsx(Xe,{className:"h-4 w-4 mt-3 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{"data-test":"diff-after",className:"flex-1 p-2 bg-green-500/10 border border-green-500/20 rounded text-xs",children:[e.jsx("p",{className:"font-medium mb-1",children:a.nodeId}),Object.entries(a.after).map(([u,b])=>e.jsxs("p",{className:"text-green-700 dark:text-green-400",children:[u,': "',String(b),'"']},u))]})]},c))})})]}),m&&i&&e.jsx(Ke,{isVisible:m,onClose:()=>{w(!1),p(null)},allNodes:P||[],currentConfig:(re=X(s,i))==null?void 0:re.config,onSave:ve,initialPosition:C||void 0,initialSize:v||void 0}),g&&i&&e.jsx(Je,{isVisible:g,onClose:()=>{S(!1),p(null)},currentConfig:(ie=X(s,i))==null?void 0:ie.config,onSave:we,initialPosition:C||void 0,initialSize:v||void 0})]})}const tt=`{
  "nodes": [
    {"id": "1", "type": "text", "text": "Hello World", "x": 100, "y": 200, "width": 300, "height": 150},
    {"id": "2", "type": "card", "text": "Another node", "x": 500, "y": 300, "width": 250, "height": 100}
  ]
}`,st=[{id:"1",fromKey:"id",toKey:"id",enabled:!0},{id:"2",fromKey:"type",toKey:"type",enabled:!0},{id:"3",fromKey:"text",toKey:"title",enabled:!0},{id:"4",fromKey:"x",toKey:"x",enabled:!0},{id:"5",fromKey:"y",toKey:"y",enabled:!0},{id:"6",fromKey:"width",toKey:"width",enabled:!0},{id:"7",fromKey:"height",toKey:"height",enabled:!0}];function se(t,s=0){if(t===null)return"null";if(t===void 0)return"undefined";const d=typeof t;if(d==="string")return"string";if(d==="number")return"number";if(d==="boolean")return"boolean";if(Array.isArray(t))return t.length===0?"unknown[]":`${se(t[0],s+1)}[]`;if(d==="object"){if(s<2){const r=Object.entries(t);return r.length===0?"Record<string, unknown>":`{ ${r.map(([i,p])=>`${i}: ${se(p,s+1)}`).join("; ")} }`}return"Record<string, unknown>"}return"unknown"}function at(t,s,d){try{const r=typeof t=="string"?JSON.parse(t):t,x=d.split(".").filter(Boolean);let i=r;for(const y of x)if(i&&typeof i=="object"&&y in i)i=i[y];else return`// Error: Path "${d}" not found in JSON`;const p=Array.isArray(i)?i[0]:i;if(!p||typeof p!="object")return"// Error: Could not find an object to analyze";const j=[];j.push(`export interface ${s} {`);for(const[y,m]of Object.entries(p)){const w=se(m,0),g=m==null;j.push(`  ${y}${g?"?":""}: ${w};`)}return j.push("}"),d&&(j.push(""),j.push(`export interface ${s}Data {`),j.push(`  ${d}: ${s}[];`),j.push("}")),j.join(`
`)}catch(r){return`// Error: ${r instanceof Error?r.message:"Unknown error"}`}}const nt=[{path:"/demo/type-mapper/mapper",label:"Type Mapper",icon:Ve},{path:"/demo/type-mapper/interface",label:"Interface Extractor",icon:he},{path:"/demo/type-mapper/workflow",label:"Workflow Builder",icon:Ge},{path:"/demo/type-mapper/list-to-nodes",label:"List to Nodes",icon:Ye}];function ot(t){const[s,d]=n.useState(tt),[r,x]=n.useState(st),[i,p]=n.useState("nodes"),[j,y]=n.useState(null),[m,w]=n.useState("NodeItem"),g=n.useCallback(()=>{const h={id:Date.now().toString(),fromKey:"",toKey:"",enabled:!0};x(l=>[...l,h]),t==null||t.info("Added new mapping")},[t]),S=n.useCallback(h=>{x(l=>l.filter(o=>o.id!==h)),t==null||t.info(`Removed mapping ${h}`)},[t]),C=n.useCallback((h,l,o)=>{x(k=>k.map(T=>T.id===h?{...T,[l]:o}:T))},[]),N=n.useMemo(()=>{try{y(null);const h=JSON.parse(s),l=i.split(".").filter(Boolean);let o=h;for(const O of l)if(o&&typeof o=="object"&&O in o)o=o[O];else{o=null;break}if(!Array.isArray(o))if(o&&typeof o=="object")o=[o];else if(Array.isArray(h))o=h;else return{error:`Path "${i}" does not point to an array or object`};const T=r.filter(O=>O.enabled&&O.fromKey&&O.toKey).map(O=>[O.fromKey,O.toKey]),z=Ze.mapKeysArray(o,T);return t==null||t.info(`Successfully mapped ${z.length} items`),{nodes:z}}catch(h){const l=h instanceof Error?h.message:"Unknown error";return y(l),t==null||t.error(`Parse error: ${l}`),{error:l}}},[s,r,i,t]),v=n.useMemo(()=>at(s,m,i),[s,m,i]),M=n.useCallback(()=>{const h=ue+JSON.stringify(N,null,2);navigator.clipboard.writeText(h),t==null||t.info("Copied output to clipboard with paste marker")},[N,t]),F=n.useCallback(()=>{const h=JSON.stringify(N,null,2),l=new Blob([h],{type:"application/json"}),o=URL.createObjectURL(l),k=document.createElement("a");k.href=o,k.download="mapped-nodes.json",k.click(),URL.revokeObjectURL(o),t==null||t.info("Downloaded mapped output")},[N,t]),K=n.useCallback(()=>{navigator.clipboard.writeText(v),t==null||t.info("Copied interface to clipboard")},[v,t]),f=n.useCallback(()=>{try{const h=JSON.parse(s),l=i.split(".").filter(Boolean);let o=h;for(const T of l)o&&typeof o=="object"&&T in o&&(o=o[T]);const k=Array.isArray(o)?o[0]:o;if(k&&typeof k=="object"){const T=Object.keys(k),z=T.map((O,Z)=>({id:(Z+1).toString(),fromKey:O,toKey:O,enabled:!0}));x(z),t==null||t.info(`Detected ${T.length} keys from source`)}}catch{t==null||t.error("Failed to detect keys from source")}},[s,i,t]);return{sourceJson:s,setSourceJson:d,mappings:r,arrayPath:i,setArrayPath:p,parseError:j,interfaceName:m,setInterfaceName:w,mappedOutput:N,generatedInterface:v,addMapping:g,removeMapping:S,updateMapping:C,copyToClipboard:M,downloadOutput:F,copyInterface:K,detectKeys:f}}function rt({sharedState:t}){const{sourceJson:s,setSourceJson:d,mappings:r,arrayPath:x,setArrayPath:i,parseError:p,mappedOutput:j,addMapping:y,removeMapping:m,updateMapping:w,copyToClipboard:g,downloadOutput:S,detectKeys:C}=t;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-test":"io-row",className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs(I,{"data-test":"source-card",children:[e.jsxs(R,{children:[e.jsx(A,{"data-test":"source-title",children:"Source JSON"}),e.jsx(L,{"data-test":"source-description",children:"Paste your JSON data here. Supports objects or arrays."})]}),e.jsxs(D,{children:[e.jsxs("div",{"data-test":"array-path-input",className:"mb-4",children:[e.jsx(_,{htmlFor:"array-path",children:"Array Path (dot notation)"}),e.jsx(U,{id:"array-path","data-test":"array-path-field",value:x,onChange:N=>i(N.target.value),placeholder:"e.g., nodes or data.items",className:"font-mono"})]}),e.jsx(W,{"data-test":"source-textarea",value:s,onChange:N=>d(N.target.value),placeholder:"Paste your JSON here...",className:"font-mono text-sm h-[300px] resize-none"}),p&&e.jsx("p",{"data-test":"parse-error",className:"text-red-500 text-sm mt-2",children:p})]})]}),e.jsxs(I,{"data-test":"output-card",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"output-title",children:"Mapped Output"}),e.jsx(L,{"data-test":"output-description",children:"NodeDataV2 compatible JSON output"})]}),e.jsxs("div",{"data-test":"output-actions",className:"flex gap-2",children:[e.jsxs(E,{"data-test":"copy-button",variant:"outline",size:"sm",onClick:g,children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Copy"]}),e.jsxs(E,{"data-test":"download-button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}),e.jsx(D,{children:e.jsx(W,{"data-test":"output-textarea",value:JSON.stringify(j,null,2),readOnly:!0,className:"font-mono text-sm h-[340px] resize-none bg-muted"})})]})]}),e.jsxs(I,{"data-test":"mapping-card",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"mapping-title",children:"Key Mappings"}),e.jsx(L,{"data-test":"mapping-description",children:"Define how source keys map to NodeDataV2 properties"})]}),e.jsxs("div",{"data-test":"mapping-actions",className:"flex gap-2",children:[e.jsxs(E,{"data-test":"detect-keys-button",variant:"outline",size:"sm",onClick:C,children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Detect Keys"]}),e.jsxs(E,{"data-test":"add-mapping-button",variant:"outline",size:"sm",onClick:y,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Add Mapping"]})]})]})}),e.jsxs(D,{children:[e.jsxs("div",{"data-test":"mappings-list",className:"space-y-3",children:[e.jsxs("div",{"data-test":"mappings-header",className:"grid grid-cols-[1fr_40px_1fr_40px] gap-2 text-sm font-medium text-muted-foreground px-2",children:[e.jsx("span",{children:"Source Key"}),e.jsx("span",{}),e.jsx("span",{children:"Target Key (NodeDataV2)"}),e.jsx("span",{})]}),r.map(N=>e.jsxs("div",{"data-test":`mapping-row-${N.id}`,className:"grid grid-cols-[1fr_40px_1fr_40px] gap-2 items-center",children:[e.jsx(U,{"data-test":`from-key-${N.id}`,value:N.fromKey,onChange:v=>w(N.id,"fromKey",v.target.value),placeholder:"e.g., text",className:"font-mono"}),e.jsx("span",{"data-test":"arrow",className:"text-center text-muted-foreground",children:"→"}),e.jsx(U,{"data-test":`to-key-${N.id}`,value:N.toKey,onChange:v=>w(N.id,"toKey",v.target.value),placeholder:"e.g., title",className:"font-mono"}),e.jsx(E,{"data-test":`remove-mapping-${N.id}`,variant:"ghost",size:"icon",onClick:()=>m(N.id),className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(qe,{className:"h-4 w-4"})})]},N.id)),r.length===0&&e.jsx("p",{"data-test":"no-mappings",className:"text-muted-foreground text-center py-4",children:'No mappings defined. Click "Detect Keys" or "Add Mapping" to start.'})]}),e.jsxs("div",{"data-test":"reference-section",className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsx("h4",{"data-test":"reference-title",className:"font-medium mb-2",children:"NodeDataV2 Available Keys"}),e.jsx("p",{"data-test":"reference-keys",className:"text-sm text-muted-foreground font-mono",children:"id, x, y, width, height, type, content, title, data, subContent, className, isSelected, isEditing, styles, options, highlights, linkedHighlightId, linkedSourceNodeId, tags, isPinned, createdAt, updatedAt"})]})]})]})]})}function it({sharedState:t}){const{sourceJson:s,setSourceJson:d,arrayPath:r,setArrayPath:x,interfaceName:i,setInterfaceName:p,generatedInterface:j,copyInterface:y}=t;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-test":"interface-row",className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(I,{"data-test":"interface-source-card",children:[e.jsxs(R,{children:[e.jsx(A,{"data-test":"interface-source-title",children:"Source JSON"}),e.jsx(L,{"data-test":"interface-source-description",children:"Paste JSON to extract TypeScript interface. Uses the same input as Type Mapper."})]}),e.jsxs(D,{children:[e.jsxs("div",{"data-test":"interface-config",className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"interface-name",children:"Interface Name"}),e.jsx(U,{id:"interface-name","data-test":"interface-name-field",value:i,onChange:m=>p(m.target.value),placeholder:"e.g., NodeItem",className:"font-mono"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"interface-path",children:"Array Path"}),e.jsx(U,{id:"interface-path","data-test":"interface-path-field",value:r,onChange:m=>x(m.target.value),placeholder:"e.g., nodes",className:"font-mono"})]})]}),e.jsx(W,{"data-test":"interface-source-textarea",value:s,onChange:m=>d(m.target.value),placeholder:"Paste your JSON here...",className:"font-mono text-sm h-[350px] resize-none"})]})]}),e.jsxs(I,{"data-test":"interface-output-card",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"interface-output-title",children:"Generated Interface"}),e.jsx(L,{"data-test":"interface-output-description",children:"TypeScript interface extracted from JSON structure"})]}),e.jsxs(E,{"data-test":"copy-interface-button",variant:"outline",size:"sm",onClick:y,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Copy"]})]})}),e.jsx(D,{children:e.jsx(W,{"data-test":"interface-output-textarea",value:j,readOnly:!0,className:"font-mono text-sm h-[390px] resize-none bg-muted"})})]})]}),e.jsxs(I,{"data-test":"interface-tips-card",className:"mt-4",children:[e.jsx(R,{children:e.jsx(A,{"data-test":"tips-title",className:"text-base",children:"Tips"})}),e.jsx(D,{children:e.jsxs("ul",{"data-test":"tips-list",className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"The interface is generated from the first item in the array"}),e.jsx("li",{children:"Nested objects are inlined up to 2 levels deep"}),e.jsx("li",{children:"Arrays are typed based on their first element"}),e.jsx("li",{children:"null/undefined values are marked as optional"}),e.jsx("li",{children:"Both tabs share the same source JSON and array path"})]})})]})]})}const dt=`- Project Overview
  - Requirements
    - Functional Requirements
    - Non-Functional Requirements
  - Timeline
- Design Phase
  - Wireframes
  - Mockups
- Development
  - Frontend
    - Components
    - State Management
  - Backend
    - API Design
    - Database Schema`;function ct(t){var x;const s=t.split(`
`).filter(i=>i.trim()),d=[],r=[];for(const i of s){const p=((x=i.match(/^(\s*)/))==null?void 0:x[1])||"",j=Math.floor(p.length/2),y=i.replace(/^\s*[-*+]\s*/,"").replace(/^\s*\d+\.\s*/,"").trim();if(!y)continue;let m=null;for(;r.length>0&&r[r.length-1].level>=j;)r.pop();r.length>0&&(m=r[r.length-1].index);const w=d.length;d.push({text:y,level:j,index:w,parentIndex:m}),r.push({level:j,index:w})}return d}function lt(t,s,d){if(d){De();const{width:r,height:x}=Me(t);return{width:Math.max(r,B.DEFAULT_NODE_WIDTH),height:Math.max(x,B.DEFAULT_NODE_HEIGHT)}}else{const r=Pe(t,s-B.NODE_X_PADDING*2);return{width:s,height:Math.max(B.DEFAULT_NODE_HEIGHT,r+B.NODE_Y_PADDING)}}}function pt(t,s){const{nodeWidth:d,nodeGap:r,indentOffset:x,startX:i,startY:p,fitWidth:j}=s,y=[],m=[],w=[],g=new Map;g.set(0,p);for(const S of t){const C=ee(10);w.push(C);const N=i+S.level*x;let v=g.get(S.level)??p;if(S.parentIndex!==null){const l=y[S.parentIndex],o=l.y+(l.height??B.DEFAULT_NODE_HEIGHT);v=Math.max(v,o+r)}const{width:M,height:F}=lt(S.text,d,j),K={id:C,x:N,y:v,width:M,height:F,type:q.TEXT,content:S.text};y.push(K);const f=v+F+r,h=Math.max(...t.map(l=>l.level));for(let l=0;l<=h;l++){const o=g.get(l)??p;f>o&&g.set(l,f)}if(S.parentIndex!==null){const l=w[S.parentIndex];m.push({id:ee(10),startNodeId:l,endNodeId:C})}}return{nodes:y,arrows:m}}function ut({logger:t}){const[s,d]=n.useState(dt),[r,x]=n.useState(200),[i,p]=n.useState(20),[j,y]=n.useState(250),[m,w]=n.useState(100),[g,S]=n.useState(100),[C,N]=n.useState(!0),v=n.useMemo(()=>{const f=ct(s);return pt(f,{nodeWidth:r,nodeGap:i,indentOffset:j,startX:m,startY:g,fitWidth:C})},[s,r,i,j,m,g,C]),M=n.useMemo(()=>JSON.stringify(v,null,2),[v]),F=n.useCallback(()=>{const f=ue+M;navigator.clipboard.writeText(f),t==null||t.info("Copied nodes and arrows to clipboard with paste marker")},[M,t]),K=n.useCallback(()=>{const f=new Blob([M],{type:"application/json"}),h=URL.createObjectURL(f),l=document.createElement("a");l.href=h,l.download="list-nodes.json",l.click(),URL.revokeObjectURL(h),t==null||t.info("Downloaded list nodes output")},[M,t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-test":"list-to-nodes-row",className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4",children:[e.jsxs(I,{"data-test":"list-input-card",children:[e.jsxs(R,{children:[e.jsx(A,{"data-test":"list-input-title",children:"Markdown List"}),e.jsx(L,{"data-test":"list-input-description",children:"Enter a markdown list with indentation. Use 2 spaces per level."})]}),e.jsx(D,{children:e.jsx(W,{"data-test":"list-input-textarea",value:s,onChange:f=>d(f.target.value),placeholder:`- Item 1
  - Sub-item 1.1
  - Sub-item 1.2
- Item 2`,className:"font-mono text-sm h-[350px] resize-none"})})]}),e.jsxs(I,{"data-test":"list-output-card",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{"data-test":"list-output-title",children:"Generated Nodes & Arrows"}),e.jsxs(L,{"data-test":"list-output-description",children:[v.nodes.length," nodes, ",v.arrows.length," arrows"]})]}),e.jsxs("div",{"data-test":"list-output-actions",className:"flex gap-2",children:[e.jsxs(E,{"data-test":"list-copy-button",variant:"outline",size:"sm",onClick:F,children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Copy"]}),e.jsxs(E,{"data-test":"list-download-button",variant:"outline",size:"sm",onClick:K,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}),e.jsx(D,{children:e.jsx(W,{"data-test":"list-output-textarea",value:M,readOnly:!0,className:"font-mono text-sm h-[350px] resize-none bg-muted"})})]})]}),e.jsxs(I,{"data-test":"list-options-card",children:[e.jsx(R,{children:e.jsx(A,{"data-test":"list-options-title",className:"text-base",children:"Conversion Options"})}),e.jsxs(D,{children:[e.jsxs("div",{"data-test":"list-options-grid",className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{"data-test":"fit-width-option",className:"flex items-end gap-2",children:[e.jsx(Ae,{id:"fit-width","data-test":"fit-width-checkbox",checked:C,onCheckedChange:f=>N(f===!0)}),e.jsx(_,{htmlFor:"fit-width",className:"cursor-pointer",children:"Fit Width"})]}),e.jsxs("div",{"data-test":"node-width-option",children:[e.jsx(_,{htmlFor:"node-width",className:C?"text-muted-foreground":"",children:"Fixed Width (px)"}),e.jsx(U,{id:"node-width","data-test":"node-width-input",type:"number",min:100,max:500,value:r,onChange:f=>x(parseInt(f.target.value)||200),className:"font-mono",disabled:C})]}),e.jsxs("div",{"data-test":"node-gap-option",children:[e.jsx(_,{htmlFor:"node-gap",children:"Node Gap (px)"}),e.jsx(U,{id:"node-gap","data-test":"node-gap-input",type:"number",min:5,max:100,value:i,onChange:f=>p(parseInt(f.target.value)||20),className:"font-mono"})]}),e.jsxs("div",{"data-test":"indent-offset-option",children:[e.jsx(_,{htmlFor:"indent-offset",children:"Indent Offset (px)"}),e.jsx(U,{id:"indent-offset","data-test":"indent-offset-input",type:"number",min:50,max:500,value:j,onChange:f=>y(parseInt(f.target.value)||250),className:"font-mono"})]}),e.jsxs("div",{"data-test":"start-x-option",children:[e.jsx(_,{htmlFor:"start-x",children:"Start X (px)"}),e.jsx(U,{id:"start-x","data-test":"start-x-input",type:"number",min:0,max:1e3,value:m,onChange:f=>w(parseInt(f.target.value)||100),className:"font-mono"})]}),e.jsxs("div",{"data-test":"start-y-option",children:[e.jsx(_,{htmlFor:"start-y",children:"Start Y (px)"}),e.jsx(U,{id:"start-y","data-test":"start-y-input",type:"number",min:0,max:1e3,value:g,onChange:f=>S(parseInt(f.target.value)||100),className:"font-mono"})]})]}),e.jsx("div",{"data-test":"list-tips-section",className:"mt-4 p-3 bg-muted rounded-lg",children:e.jsxs("p",{"data-test":"list-tips-text",className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Tips:"})," Use ",e.jsx("code",{children:"-"}),", ",e.jsx("code",{children:"*"}),", or ",e.jsx("code",{children:"+"}),' for list markers. Indent with 2 spaces per level. When "Fit Width" is enabled, node dimensions are calculated to fit the text content. Arrows connect parent items to their children.']})})]})]})]})}function kt({logger:t}){const s=ot(t);return e.jsx("div",{"data-test":"type-mapper-demo-page",className:"type-mapper-demo-page flex-1 flex flex-col h-full",children:e.jsxs("div",{"data-test":"page-content",className:"page-content flex-1 p-6 overflow-y-auto min-h-0",children:[e.jsx("nav",{"data-test":"nav-tabs",className:"flex gap-1 mb-4 border-b",children:nt.map(d=>e.jsxs(Oe,{to:d.path,"data-test":`nav-tab-${d.path}`,className:({isActive:r})=>Re("flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-t-md transition-colors","hover:bg-muted/50",r?"bg-background border border-b-background -mb-px text-foreground":"text-muted-foreground"),children:[e.jsx(d.icon,{className:"h-4 w-4"}),d.label]},d.path))}),e.jsxs(Ee,{children:[e.jsx(G,{index:!0,element:e.jsx(Ie,{to:"mapper",replace:!0})}),e.jsx(G,{path:"mapper",element:e.jsx(rt,{sharedState:s})}),e.jsx(G,{path:"interface",element:e.jsx(it,{sharedState:s})}),e.jsx(G,{path:"workflow",element:e.jsx(et,{logger:t})}),e.jsx(G,{path:"list-to-nodes",element:e.jsx(ut,{logger:t})})]})]})})}export{kt as TypeMapperDemoPage};
